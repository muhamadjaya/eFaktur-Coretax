Option Strict Off
Option Explicit On

Imports System.IO
Imports System.Xml
Imports System.Threading
Imports System.Text
Imports System.Data.SqlClient
Imports System.Windows.Forms
Imports System.IO.Compression
Imports CrystalDecisions.CrystalReports.Engine
Imports System.Net
Imports Newtonsoft.Json
Imports Newtonsoft.Json.Linq
Imports Newtonsoft.Json.Serialization
Imports System.Text.RegularExpressions
Imports System.Security.Cryptography.X509Certificates
Imports SAPbobsCOM
Imports OfficeOpenXml


Imports System.Drawing
Imports PdfiumViewer
Imports ZXing

Public Class SBOEventHandler

#Region " Private Attribute "

    Private WithEvents oSBOApplication As SAPbouiCOM.Application
    Private oSBOCompany As SAPbobsCOM.Company
    Private parentForm As SAPbouiCOM.Form
    Private parentDT As SAPbouiCOM.DataTable

#End Region

#Region " Public Constructor "

    Public Sub New()
    End Sub

    Public Sub New(ByVal oSBOApplication As SAPbouiCOM.Application)
        Me.oSBOApplication = oSBOApplication
    End Sub

    Public Sub New(ByVal oSBOApplication As SAPbouiCOM.Application, ByVal oSBOCompany As SAPbobsCOM.Company)
        Me.oSBOApplication = oSBOApplication
        Me.oSBOCompany = oSBOCompany
    End Sub

#End Region


    Public Sub HandleAppEvent(ByVal EventType As SAPbouiCOM.BoAppEventTypes) ' AWAL JALAN
        Select Case EventType
            Case SAPbouiCOM.BoAppEventTypes.aet_ShutDown
                If oSBOCompany.Connected = True Then oSBOCompany.Disconnect()
                System.Windows.Forms.Application.Exit()
            Case SAPbouiCOM.BoAppEventTypes.aet_CompanyChanged
                If oSBOCompany.Connected = True Then oSBOCompany.Disconnect()
                System.Windows.Forms.Application.Exit()
            Case SAPbouiCOM.BoAppEventTypes.aet_LanguageChanged
                If oSBOCompany.Connected = True Then oSBOCompany.Disconnect()
                System.Windows.Forms.Application.Exit()
            Case SAPbouiCOM.BoAppEventTypes.aet_ServerTerminition
                If oSBOCompany.Connected = True Then oSBOCompany.Disconnect()
                System.Windows.Forms.Application.Exit()
        End Select
    End Sub

    Public Sub HandleLayoutKeyEvent(ByVal eventInfo As SAPbouiCOM.LayoutKeyInfo, ByRef BubbleEvent As Boolean) 'AKHIR JALAN
        Try

            If eventInfo.FormUID = "frmOffFKMASSAL" Then
                LayoutKeyEvent_Handler_eFakturMasal(eventInfo, BubbleEvent)
            End If
            If eventInfo.FormUID = "frmOffFKGABUNGAN" Then
                LayoutKeyEvent_Handler_eFakturGabungan(eventInfo, BubbleEvent)
            End If
            If eventInfo.FormUID = "frmOffFKGUNGGUNG" Then
                LayoutKeyEvent_Handler_eFakturGunggung(eventInfo, BubbleEvent)
            End If

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub HandleMenuEvent(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        Try
            If pVal.MenuUID = "mnuEFaktur" Then
                MenuEvent_HandlerEFaktur(pVal, BubbleEvent) ' MENU E FAkTUR 
            ElseIf pVal.MenuUID = "mnuEFakturMS" Then
                MenuEvent_HandlerEFakturMS(pVal, BubbleEvent)
            ElseIf pVal.MenuUID = "mnuEFakturGB" Then
                MenuEvent_HandlerEFakturGB(pVal, BubbleEvent)
            ElseIf pVal.MenuUID = "mnuEFakturGG" Then
                MenuEvent_HandlerEFakturGG(pVal, BubbleEvent)
            ElseIf (pVal.MenuUID = "CLS") Then 'Right Click Close
                MenuEvent_Handler_CLOSE(pVal, BubbleEvent)
            ElseIf (pVal.MenuUID = "CNC") Then ' Right Click Cancel
                MenuEvent_Handler_CANCEL(pVal, BubbleEvent)
            ElseIf (pVal.MenuUID = "6913") Then 'DISABLE ADDON UDF
                MenuEvent_HandlerUDF(pVal, BubbleEvent)
            ElseIf (pVal.MenuUID = "mnuEFakturSt") Then
                MenuEvent_Handler_SetupEfaktur(pVal, BubbleEvent)
            ElseIf (pVal.MenuUID = "mnuEFakturUp") Then
                MenuEvent_Handler_upload(pVal, BubbleEvent)
            End If

            If pVal.MenuUID = "1282" And pVal.BeforeAction = False Then
                BubbleEvent = True
                If pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                    If oForm.UniqueID = "frmOffFKGABUNGAN" Then
                        MenuEvent_HandlerEFakturGB_ADD(pVal, BubbleEvent)
                    ElseIf oForm.UniqueID = "frmOffFKGUNGGUNG" Then
                        MenuEvent_HandlerEFakturGG_ADD(pVal, BubbleEvent)
                    ElseIf oForm.UniqueID = "frmOffFKMASSAL" Then
                        MenuEvent_HandlerEFakturMS_ADD(pVal, BubbleEvent)
                    End If
                End If
            End If
            If pVal.MenuUID = "1281" And pVal.BeforeAction = False Then
                BubbleEvent = True
                If pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                    If oForm.UniqueID = "frmOffFKGABUNGAN" Then
                        EnableAlFieldGabungan()
                    ElseIf oForm.UniqueID = "frmOffFKGUNGGUNG" Then
                        EnableAlFieldGunggung()
                    ElseIf oForm.UniqueID = "frmOffFKMASSAL" Then
                        EnableAlFieldMassal()
                    End If
                End If
            End If



        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub HandleItemEvent(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        Try
            If pVal.FormUID = "frmEFaktur" Then ' Event dalam form eFaktur
                ItemEvent_Handler_eFaktur(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormUID = "frmLookUp" Then  ' EVENT saat tampilan setelah klik Export di form eFaktur (BUAT FORM NYA DI CreateForm)
                ItemEvent_Handler_LookUp(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormUID = "frmConfigInfo" Then ' EVENT dalam form ConfigInfo pertama saat jalanin AddOn
                ItemEvent_Handler_ConfigInfo(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormUID = "frmOffFKMASSAL" Then ' Event dalam form massal
                ItemEvent_Handler_OffFaktur_MASSAL(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormUID = "frmOffFKGABUNGAN" Then ' Event dalam form gabungan
                ItemEvent_Handler_OffFaktur_GABUNGAN(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormUID = "frmOffFKGUNGGUNG" Then ' Event dalam form gunggung
                ItemEvent_Handler_OffFaktur_GUNGGUNG(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "141" Then 'AP Invoice
                ItemEventHandler_PurchaseScanFP(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "60092" Then 'AP Reserver Invoice
                ItemEventHandler_PurchaseScanFP(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "65301" Then 'AP DP Invoice
                ItemEventHandler_PurchaseScanFP(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "frmeFakturScan" Then
                ItemEventHandler_eFakturScan(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "-141" Then 'AP invoice 
                ItemEventHandler_AP_scan(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "-181" Then 'AP CM invoice 
                ItemEventHandler_APCM_scan(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "-60092" Then 'AP Reserve invoice 
                ItemEventHandler_APReserve_scan(FormUID, pVal, BubbleEvent)
            ElseIf pVal.FormTypeEx = "-65301" Then 'AP DP invoice 
                ItemEventHandler_APDP_scan(FormUID, pVal, BubbleEvent)

            ElseIf pVal.FormTypeEx = "-133" Then 'AP DP invoice 
                'QueryToJSON()

            ElseIf pVal.FormUID = "frmOffFKUp" Then
                ItemEventHandler_UploadPDF(FormUID, pVal, BubbleEvent)
            End If



            If pVal.FormTypeEx = "frmSetupFaktur" Then
                ItemEventHandler_SettingFP(FormUID, pVal, BubbleEvent)
            End If

            If pVal.FormTypeEx = "0" And bLoadInputEvents Then
                oUserInput.ItemEvents(pVal, BubbleEvent)
            End If

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub


    'If (pVal.ItemUID == "38" && pVal.ColUID == "1" && pVal.Row > 0 && pVal.EventType == SAPbouiCOM.BoEventTypes.et_VALIDATE && pVal.InnerEvent == True)
    '    {
    '        If (pVal.BeforeAction == False && pVal.ActionSuccess == True)
    '        {
    '            SAPbouiCOM.Form oForm = oSBOApplication.Forms.GetForm("139", 1);
    '            //SAPbouiCOM.Form oForm = oSBOApplication.Forms.ActiveForm;
    '            SAPbouiCOM.Matrix oMatrix = oForm.Items.Item("38").Specific;
    '            SAPbouiCOM.EditText oItemType  = oMatrix.Columns.Item("39").Cells.Item(pVal.Row).Specific;
    '            int cCnt = 0;

    '            Try
    '            {
    '                If (oItemType.Value == "S" || oItemType.Value == "I")
    '                {
    '                    For (cCnt = 1; cCnt <= oMatrix.RowCount - 1; cCnt++)
    '                    {
    '                        SAPbouiCOM.EditText oCheckItemType = oMatrix.Columns.Item("39").Cells.Item(cCnt).Specific;
    '                        If (oCheckItemType.Value == "S" || oCheckItemType.Value == "I")
    '                        {
    '                            oMatrix.CommonSetting.SetRowBackColor(cCnt, 16724787);
    '                        }
    '                    }
    '                }
    '            }
    '            Catch (Exception ex)
    '            {
    '                Try { oForm.Freeze(False); } Catch (Exception exa) { }
    '                oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error);
    '            }
    '        }
    '    }

    Public Sub HandleFormDataEvent(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
        Try

            If BusinessObjectInfo.FormTypeEx = "frmOffFKMASSAL" Then
                DataEvent_Handler_Massal(BusinessObjectInfo, BubbleEvent)
            End If

            If BusinessObjectInfo.FormTypeEx = "frmOffFKGABUNGAN" Then
                DataEvent_Handler_Gabungan(BusinessObjectInfo, BubbleEvent)
            End If

            If BusinessObjectInfo.FormTypeEx = "frmOffFKGUNGGUNG" Then
                DataEvent_Handler_Gunggung(BusinessObjectInfo, BubbleEvent)
            End If

            If BusinessObjectInfo.FormTypeEx = "frmSetupFaktur" Then
                DataEvent_Handler_SetupFaktur(BusinessObjectInfo, BubbleEvent)
            End If

            If BusinessObjectInfo.FormTypeEx = "" Then
                FormDataEvent_Handler(BusinessObjectInfo, BubbleEvent)
            End If
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub HandleRightClickEvent(ByRef eventInfo As SAPbouiCOM.ContextMenuInfo, ByRef BubbleEvent As Boolean)
        Try
            If eventInfo.FormUID <> "frmOffFKMASSAL" Or eventInfo.FormUID <> "frmOffFKGABUNGAN" Or eventInfo.FormUID <> "frmOffFKGUNGGUNG" Then
                RightClickEvent_Handler(eventInfo, BubbleEvent)
            End If
            If eventInfo.FormUID = "frmOffFKMASSAL" Then
                RightClickEvent_MS(eventInfo, BubbleEvent)
            End If

            If eventInfo.FormUID = "frmOffFKGABUNGAN" Then
                RightClickEvent_GB(eventInfo, BubbleEvent)
            End If

            If eventInfo.FormUID = "frmOffFKGUNGGUNG" Then
                RightClickEvent_GG(eventInfo, BubbleEvent)
            End If
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

#Region " LayoutKeyEvent Handler "
    Public Sub LayoutKeyEvent_Handler_eFakturMasal(ByVal eventInfo As SAPbouiCOM.LayoutKeyInfo, ByRef BubbleEvent As Boolean)

        If eventInfo.BeforeAction = True Then
            Try
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(eventInfo.FormUID)
                Dim Code As String = CType(oForm.Items.Item("DocNum").Specific, SAPbouiCOM.EditText).Value
                Dim DocEntry As String
                Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                oRec.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" + Code + "'")
                DocEntry = oRec.Fields.Item("DocEntry").Value
                If oRec.RecordCount > 0 Then
                    BubbleEvent = True
                    eventInfo.LayoutKey = Code
                Else
                    BubbleEvent = False
                End If
                oForm.Freeze(True)

                'oForm.Items.Item("txt_PRT").Specific.value = "Printed"
                ' AABC
                'oRec.DoQuery(" UPDATE ""@SOL_TKR_FAK_H""" &
                '              " SET ""U_SOL_PRINTED"" =  'Printed' " &
                '              " WHERE ""DocEntry"" = '" & DocEntry & "'")

                'If oForm.Items.Item("txt_STS").Specific.value = "Closed" And oForm.Mode = BoFormMode.fm_OK_MODE Then
                '    oForm.Items.Item("txt_STS").Enabled = False
                '    oForm.Items.Item("mtx_CLC").Enabled = False
                '    oForm.Items.Item("txt_RMK").Enabled = False
                'End If
                oForm.Freeze(False)
            Catch ex As Exception
                MsgBox(ex.Message)
            End Try

        End If
    End Sub

    Public Sub LayoutKeyEvent_Handler_eFakturGabungan(ByVal eventInfo As SAPbouiCOM.LayoutKeyInfo, ByRef BubbleEvent As Boolean)

        If eventInfo.BeforeAction = True Then
            Try
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(eventInfo.FormUID)
                Dim Code As String = CType(oForm.Items.Item("DocNum").Specific, SAPbouiCOM.EditText).Value
                Dim DocEntry As String
                Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                oRec.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" + Code + "'")
                DocEntry = oRec.Fields.Item("DocEntry").Value
                If oRec.RecordCount > 0 Then
                    BubbleEvent = True
                    eventInfo.LayoutKey = Code
                Else
                    BubbleEvent = False
                End If
                oForm.Freeze(True)

                'oForm.Items.Item("txt_PRT").Specific.value = "Printed"
                ' AABC
                'oRec.DoQuery(" UPDATE ""@SOL_TKR_FAK_H""" &
                '              " SET ""U_SOL_PRINTED"" =  'Printed' " &
                '              " WHERE ""DocEntry"" = '" & DocEntry & "'")

                'If oForm.Items.Item("txt_STS").Specific.value = "Closed" And oForm.Mode = BoFormMode.fm_OK_MODE Then
                '    oForm.Items.Item("txt_STS").Enabled = False
                '    oForm.Items.Item("mtx_CLC").Enabled = False
                '    oForm.Items.Item("txt_RMK").Enabled = False
                'End If
                oForm.Freeze(False)
            Catch ex As Exception
                MsgBox(ex.Message)
            End Try

        End If
    End Sub

    Public Sub LayoutKeyEvent_Handler_eFakturGunggung(ByVal eventInfo As SAPbouiCOM.LayoutKeyInfo, ByRef BubbleEvent As Boolean)

        If eventInfo.BeforeAction = True Then
            Try
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(eventInfo.FormUID)
                Dim Code As String = CType(oForm.Items.Item("DocNum").Specific, SAPbouiCOM.EditText).Value
                Dim DocEntry As String
                Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                oRec.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" + Code + "'")
                DocEntry = oRec.Fields.Item("DocEntry").Value
                If oRec.RecordCount > 0 Then
                    BubbleEvent = True
                    eventInfo.LayoutKey = Code
                Else
                    BubbleEvent = False
                End If
                oForm.Freeze(True)

                'oForm.Items.Item("txt_PRT").Specific.value = "Printed"
                ' AABC
                'oRec.DoQuery(" UPDATE ""@SOL_TKR_FAK_H""" &
                '              " SET ""U_SOL_PRINTED"" =  'Printed' " &
                '              " WHERE ""DocEntry"" = '" & DocEntry & "'")

                'If oForm.Items.Item("txt_STS").Specific.value = "Closed" And oForm.Mode = BoFormMode.fm_OK_MODE Then
                '    oForm.Items.Item("txt_STS").Enabled = False
                '    oForm.Items.Item("mtx_CLC").Enabled = False
                '    oForm.Items.Item("txt_RMK").Enabled = False
                'End If
                oForm.Freeze(False)
            Catch ex As Exception
                MsgBox(ex.Message)
            End Try

        End If
    End Sub
#End Region

#Region " MenuEvent Handler "

    Public Sub MenuEvent_HandlerEFaktur(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        If pVal.BeforeAction = False Then
            Dim oXMLLoader As New XMLLoader
            Dim oXMLDoc As New XmlDocument


            Dim Found As Boolean = False
            Dim IndexFound As Integer
            Dim FormCount As Integer = oSBOApplication.Forms.Count

            For a As Integer = 0 To FormCount - 1
                If oSBOApplication.Forms.Item(a).TypeEx = "frmEFaktur" Then
                    Found = True
                    IndexFound = a
                    Exit For
                End If
            Next
            If Found = False Then
                oXMLLoader.LoadFromXML(oSBOApplication, oXMLDoc, "eFaktur.srf")
            Else
                oSBOApplication.Forms.Item(IndexFound).Select()
            End If

            If Found = False Then

                IndexSetup()

                Dim oForm As SAPbouiCOM.Form
                oForm = oSBOApplication.Forms.ActiveForm
                oForm.Refresh()
                Try
                    oForm.Freeze(True)
                    oForm.DataSources.UserDataSources.Add("TABPK", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("TABPM", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("TABRPK", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("TABRPM", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)

                    Dim oTabPK As SAPbouiCOM.Folder
                    oTabPK = CType(oForm.Items.Item("tabPK").Specific, SAPbouiCOM.Folder)
                    oTabPK.DataBind.SetBound(True, "", "TABPK")

                    Dim oTabPM As SAPbouiCOM.Folder
                    oTabPM = CType(oForm.Items.Item("tabPM").Specific, SAPbouiCOM.Folder)
                    oTabPM.DataBind.SetBound(True, "", "TABPM")

                    Dim oTabRPK As SAPbouiCOM.Folder
                    oTabRPK = CType(oForm.Items.Item("tabRPK").Specific, SAPbouiCOM.Folder)
                    oTabRPK.DataBind.SetBound(True, "", "TABRPK")

                    Dim oTabRPM As SAPbouiCOM.Folder
                    oTabRPM = CType(oForm.Items.Item("tabRPM").Specific, SAPbouiCOM.Folder)
                    oTabRPM.DataBind.SetBound(True, "", "TABRPM")

                    oForm.DataSources.UserDataSources.Add("DFRPK", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DTOPK", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DFRPM", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DTOPM", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DFRRPK", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DTORPK", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DFRRPM", SAPbouiCOM.BoDataType.dt_DATE, 1)
                    oForm.DataSources.UserDataSources.Add("DTORPM", SAPbouiCOM.BoDataType.dt_DATE, 1)

                    oForm.DataSources.UserDataSources.Add("SCHKPK", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("SCHKPM", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("SCHKRPK", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
                    oForm.DataSources.UserDataSources.Add("SCHKRPM", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)

                    CType(oForm.Items.Item("dtpPDFrPK").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DFRPK")
                    CType(oForm.Items.Item("dtpPDToPK").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DTOPK")
                    CType(oForm.Items.Item("dtpPDFrPM").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DFRPM")
                    CType(oForm.Items.Item("dtpPDToPM").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DTOPM")
                    CType(oForm.Items.Item("dtpPDFrRPK").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DFRRPK")
                    CType(oForm.Items.Item("dtpPDToRPK").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DTORPK")
                    CType(oForm.Items.Item("dtpPDFrRPM").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DFRRPM")
                    CType(oForm.Items.Item("dtpPDToRPM").Specific, SAPbouiCOM.EditText).DataBind.SetBound(True, "", "DTORPM")

                    CType(oForm.Items.Item("chkIncPK").Specific, SAPbouiCOM.CheckBox).DataBind.SetBound(True, "", "SCHKPK")
                    CType(oForm.Items.Item("chkIncPM").Specific, SAPbouiCOM.CheckBox).DataBind.SetBound(True, "", "SCHKPM")
                    CType(oForm.Items.Item("chkIncRPK").Specific, SAPbouiCOM.CheckBox).DataBind.SetBound(True, "", "SCHKRPK")
                    CType(oForm.Items.Item("chkIncRPM").Specific, SAPbouiCOM.CheckBox).DataBind.SetBound(True, "", "SCHKRPM")

                    oTabPK.GroupWith("tabPM")
                    oTabPK.GroupWith("tabRPK")
                    oTabPK.GroupWith("tabRPM")

                    oTabPK.Select()

                    oForm.Freeze(False)
                    oForm.Items.Item("dtpPDFrPK").Click()
                Catch ex As Exception
                    oForm.Freeze(False)
                    oSBOApplication.MessageBox(ex.Message)
                End Try
            End If
        End If
    End Sub

    Public Sub MenuEvent_HandlerEFakturMS(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        If pVal.BeforeAction = False Then

            Dim oXMLDoc As New XmlDocument
            Dim oFormFKMS As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try
                Dim Found As Boolean = False
                Dim IndexFound As Integer
                Dim FormCount As Integer = oSBOApplication.Forms.Count
                For a As Integer = 0 To FormCount - 1
                    If oSBOApplication.Forms.Item(a).TypeEx = "frmOffFKMASSAL" Then
                        Found = True
                        IndexFound = a
                        Exit For
                    End If
                Next
                If Found = False Then
                    oXMLDoc.Load("OffFakturMassal.srf")
                    oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
                Else
                    oSBOApplication.Forms.Item(IndexFound).Select()
                End If

                If Found = False Then

                    oFormFKMS = oSBOApplication.Forms.ActiveForm
                    Dim Layout As String = "eFakturMassal.rpt"
                    Dim TypeCode As String = "Faktur Pajak Massal"

                    Dim oCmbBranch As SAPbouiCOM.ComboBox = oFormFKMS.Items.Item("cmbBranch").Specific

                    oFormFKMS = oSBOApplication.Forms.Item("frmOffFKMASSAL")

                    oFormFKMS.Freeze(True)

                    MtxDetail = oFormFKMS.Items.Item("tblData").Specific
                    MtxDetail.CommonSetting.EnableArrowKey = True

                    oDBSOL_FPMS_HD = oSBOApplication.Forms.Item("frmOffFKMASSAL").DataSources.DBDataSources.Item("@SOL_FP_TRX_MS_HD")
                    oDBSOL_FPMS_DT = oSBOApplication.Forms.Item("frmOffFKMASSAL").DataSources.DBDataSources.Item("@SOL_FP_TRX_MS_DT")

                    If oDBSOL_FPMS_HD.Size = 0 Then
                        oDBSOL_FPMS_HD.InsertRecord(oDBSOL_FPMS_HD.Size)
                        oDBSOL_FPMS_HD.Offset = oDBSOL_FPMS_HD.Size - 1
                    End If

                    'If oDBSOL_FPGB_DT.Size = 0 Then
                    '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                    '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                    'End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                    Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_MS_HD"""
                    oRec.DoQuery(Query)
                    If oRec.RecordCount > 0 Then
                        oDBSOL_FPMS_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                    End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'OffFakturGB'")
                    'If oRec.RecordCount > 0 Then
                    '    oFormFKGB.ReportType = oRec.Fields.Item("Code").Value
                    'Else
                    '    oFormFKGB.ReportType = CRSetup(TypeCode, Layout, oFormFKGB)
                    'End If


                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    If oSQLConnection.ServerType = "SQL" Then
                        Query = "SELECT DISTINCT ISNULL(""U_SOL_FP_Branch"",'') as ""BRANCH"" FROM ""@SOL_MST_BRCH_FP"" "
                    Else
                        Query = "SELECT DISTINCT IFNULL(""U_SOL_FP_Branch"",'') as ""BRANCH"" FROM ""@SOL_MST_BRCH_FP"" "
                    End If
                    Try
                        oRec.DoQuery(Query)
                    Catch ex As Exception
                        Dim errorr As String = ex.Message
                    End Try

                    If oRec.RecordCount > 0 Then
                        Dim colKodeTrans As SAPbouiCOM.Column
                        colKodeTrans = MtxDetail.Columns.Item(2)

                        For i As Integer = 0 To oRec.RecordCount - 1
                            oCmbBranch.ValidValues.Add((oRec.Fields.Item("BRANCH").Value), (oRec.Fields.Item("BRANCH").Value))
                            colKodeTrans.ValidValues.Add((oRec.Fields.Item("BRANCH").Value), (oRec.Fields.Item("BRANCH").Value))
                            oRec.MoveNext()
                        Next i
                        oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                        colKodeTrans.Editable = True
                    End If

                    Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")

                    oDBSOL_FPMS_HD.SetValue("U_DOCSTAT", 0, "N")
                    oDBSOL_FPMS_HD.SetValue("U_DOCDATE", 0, datenow)
                    oDBSOL_FPMS_HD.SetValue("U_CHKINVDT", 0, "Y")

                    oFormFKMS.Items.Item("txtCSTFR").Click()

                    oRec.DoQuery("SELECT ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Faktur Pajak Massal'")
                    If oRec.RecordCount > 0 Then
                        oFormFKMS.ReportType = oRec.Fields.Item("Code").Value
                    Else
                        oFormFKMS.ReportType = CRSetup(TypeCode, Layout, oFormFKMS)
                    End If

                    CheckStatusMassal()

                    IndexSetup()

                    MtxDetail.AutoResizeColumns()


                    Dim oCmbTipeFaktur As SAPbouiCOM.ComboBox = oFormFKMS.Items.Item("cmbTypeFP").Specific
                    oCmbTipeFaktur.ValidValues.Add("Massal", "Massal")
                    oCmbTipeFaktur.ValidValues.Add("On Invoice", "On Invoice")
                    oCmbTipeFaktur.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    Dim oCmbJenisFaktur As SAPbouiCOM.ComboBox = oFormFKMS.Items.Item("cmbJnsFp").Specific
                    oCmbJenisFaktur.ValidValues.Add("Pajak Keluaran", "Pajak Keluaran")
                    'oCmbJenisFaktur.ValidValues.Add("Pajak Masukan", "Pajak Masukan")
                    'oCmbJenisFaktur.ValidValues.Add("Retur Pajak Keluaran", "Retur Pajak Keluaran")
                    oCmbJenisFaktur.ValidValues.Add("Retur Pajak Masukan", "Retur Pajak Masukan")
                    oCmbJenisFaktur.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    Dim oCmbIsXlsx As SAPbouiCOM.ComboBox = oFormFKMS.Items.Item("Item_11").Specific
                    oCmbIsXlsx.ValidValues.Add("XLSX", "XLSX")
                    oCmbIsXlsx.ValidValues.Add("XML", "XML")
                    oCmbIsXlsx.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    oFormFKMS.Items.Item("btnGenFP").Visible = False

                    Dim oMatrix As SAPbouiCOM.Matrix
                    oMatrix = oFormFKMS.Items.Item("tblData").Specific
                    oMatrix.Columns.Item("KMK").Visible = False


                    oFormFKMS.Freeze(False)
                End If

            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKMS.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub

    Public Sub MenuEvent_HandlerEFakturMS_ADD(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        Try
            If pVal.BeforeAction = False Then

                Dim oXMLDoc As New XmlDocument
                Dim oFormFKMS As SAPbouiCOM.Form
                Dim MtxDetail As SAPbouiCOM.Matrix
                Dim oRec As SAPbobsCOM.Recordset
                Dim Query As String = ""
                Try
                    Dim Layout As String = "OffFakturMS.rpt"
                    Dim TypeCode As String = "Off Faktur Massal"

                    oFormFKMS = oSBOApplication.Forms.ActiveForm
                    Dim oCmbBranch As SAPbouiCOM.ComboBox = oFormFKMS.Items.Item("cmbBranch").Specific

                    oFormFKMS = oSBOApplication.Forms.Item("frmOffFKMASSAL")
                    MtxDetail = oFormFKMS.Items.Item("tblData").Specific
                    MtxDetail.CommonSetting.EnableArrowKey = True

                    oFormFKMS.Freeze(True)

                    oDBSOL_FPMS_HD = oSBOApplication.Forms.Item("frmOffFKMASSAL").DataSources.DBDataSources.Item("@SOL_FP_TRX_MS_HD")
                    oDBSOL_FPMS_DT = oSBOApplication.Forms.Item("frmOffFKMASSAL").DataSources.DBDataSources.Item("@SOL_FP_TRX_MS_DT")

                    If oDBSOL_FPMS_HD.Size = 0 Then
                        oDBSOL_FPMS_HD.InsertRecord(oDBSOL_FPMS_HD.Size)
                        oDBSOL_FPMS_HD.Offset = oDBSOL_FPMS_HD.Size - 1
                    End If


                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                    Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_MS_HD"""
                    oRec.DoQuery(Query)
                    If oRec.RecordCount > 0 Then
                        oDBSOL_FPMS_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                    End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Workorder'")
                    'If oRec.RecordCount > 0 Then
                    '    oFormFKMS.ReportType = oRec.Fields.Item("Code").Value
                    'Else
                    '    oFormFKMS.ReportType = CRSetup(TypeCode, Layout, oFormFKMS)
                    'End If

                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    If oSQLConnection.ServerType = "SQL" Then
                        Query = "SELECT DISTINCT ISNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                    Else
                        Query = "SELECT DISTINCT IFNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                    End If
                    Try
                        oRec.DoQuery(Query)
                    Catch ex As Exception
                        Dim errorr As String = ex.Message
                    End Try

                    oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")

                    oDBSOL_FPMS_HD.SetValue("U_DOCSTAT", 0, "N")
                    oDBSOL_FPMS_HD.SetValue("U_DOCDATE", 0, datenow)
                    'oFormFKMS.Items.Item("tabSummary").Click()

                    IndexSetup()

                    CheckStatusMassal()

                    MtxDetail.AutoResizeColumns()
                    oFormFKMS.Freeze(False)
                Catch ex As Exception
                    oSBOApplication.MessageBox(ex.Message)
                    Try
                        oFormFKMS.Freeze(False)
                    Catch exa As Exception
                    End Try
                End Try
            End If
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub MenuEvent_HandlerEFakturGB(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        If pVal.BeforeAction = False Then

            Dim oXMLDoc As New XmlDocument
            Dim oFormFKGB As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oForm As SAPbouiCOM.Form
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try

                Dim Found As Boolean = False
                Dim IndexFound As Integer
                Dim FormCount As Integer = oSBOApplication.Forms.Count

                For a As Integer = 0 To FormCount - 1
                    If oSBOApplication.Forms.Item(a).TypeEx = "frmOffFKGABUNGAN" Then
                        Found = True
                        IndexFound = a
                        Exit For
                    End If
                Next
                If Found = False Then
                    oXMLDoc.Load("OffFakturGabungan.srf")
                    oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
                Else
                    oSBOApplication.Forms.Item(IndexFound).Select()
                End If

                If Found = False Then
                    Dim Layout As String = "eFakturGabungan.rpt"
                    Dim TypeCode As String = "Faktur Pajak Gabungan"

                    oForm = oSBOApplication.Forms.ActiveForm
                    Dim oCmbBranch As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbBranch").Specific
                    Dim oCmbTrans As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTrans").Specific
                    Dim oCmbStatus As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbStatus").Specific

                    oFormFKGB = oSBOApplication.Forms.Item("frmOffFKGABUNGAN")
                    MtxDetail = oFormFKGB.Items.Item("tblData").Specific
                    MtxDetail.CommonSetting.EnableArrowKey = True

                    oFormFKGB.Freeze(True)

                    oDBSOL_FPGB_HD = oSBOApplication.Forms.Item("frmOffFKGABUNGAN").DataSources.DBDataSources.Item("@SOL_FP_TRX_GB_HD")
                    oDBSOL_FPGB_DT = oSBOApplication.Forms.Item("frmOffFKGABUNGAN").DataSources.DBDataSources.Item("@SOL_FP_TRX_GB_DT")

                    If oDBSOL_FPGB_HD.Size = 0 Then
                        oDBSOL_FPGB_HD.InsertRecord(oDBSOL_FPGB_HD.Size)
                        oDBSOL_FPGB_HD.Offset = oDBSOL_FPGB_HD.Size - 1
                    End If

                    'If oDBSOL_FPGB_DT.Size = 0 Then
                    '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                    '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                    'End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                    Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_GB_HD"""
                    oRec.DoQuery(Query)
                    If oRec.RecordCount > 0 Then
                        oDBSOL_FPGB_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                    End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)


                    '-- update 14/10/2024 karena menggunakan address as filter

                    'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'OffFakturGB'")
                    'If oRec.RecordCount > 0 Then
                    '    oFormFKGB.ReportType = oRec.Fields.Item("Code").Value
                    'Else
                    '    oFormFKGB.ReportType = CRSetup(TypeCode, Layout, oFormFKGB)
                    'End If

                    'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    'If oSQLConnection.ServerType = "SQL" Then
                    '    Query = "SELECT DISTINCT ISNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                    'Else
                    '    Query = "SELECT DISTINCT IFNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                    'End If
                    'Try
                    '    oRec.DoQuery(Query)
                    'Catch ex As Exception
                    '    Dim errorr As String = ex.Message
                    'End Try

                    'If oRec.RecordCount > 0 Then
                    '    For i As Integer = 0 To oRec.RecordCount - 1
                    '        oCmbBranch.ValidValues.Add((oRec.Fields.Item("BRANCH").Value), (oRec.Fields.Item("BRANCH").Value))
                    '        oRec.MoveNext()
                    '    Next i
                    '    oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                    'End If

                    oCmbTrans.ValidValues.Add("01", "Kepada Pihak yang Bukan Pemungut PPN")
                    oCmbTrans.ValidValues.Add("02", "Kepada Pemungut Bendaharawan")
                    oCmbTrans.ValidValues.Add("03", "Kepada Pemungut Selain Bendaharawan")
                    oCmbTrans.ValidValues.Add("04", "DPP Nilai Lain")
                    oCmbTrans.ValidValues.Add("05", "-")
                    oCmbTrans.ValidValues.Add("06", "Penyerahan Lainnya, termasuk penyerahan kepada turis asing dalam rangka VAT refund")
                    oCmbTrans.ValidValues.Add("07", "Penyerahan yang PPN-nya Tidak Dipungut")
                    oCmbTrans.ValidValues.Add("08", "Penyerahan yang PPN-nya Dibebaskan")
                    oCmbTrans.ValidValues.Add("09", "Penyerahan Aktiva (Pasal 16D UU PPN)")
                    oCmbTrans.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    oCmbStatus.ValidValues.Add("0", "Normal")
                    oCmbStatus.ValidValues.Add("1", "Penggantian")
                    oCmbStatus.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)


                    Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")

                    oDBSOL_FPGB_HD.SetValue("U_DOCSTAT", 0, "N")
                    oDBSOL_FPGB_HD.SetValue("U_TAXDATE", 0, datenow)
                    oDBSOL_FPGB_HD.SetValue("U_DOCDATE", 0, datenow)
                    'oFormFKGB.Items.Item("tabSummary").Click()


                    oRec.DoQuery("SELECT ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Faktur Pajak Gabungan'")
                    If oRec.RecordCount > 0 Then
                        oFormFKGB.ReportType = oRec.Fields.Item("Code").Value
                    Else
                        oFormFKGB.ReportType = CRSetup(TypeCode, Layout, oFormFKGB)
                    End If

                    'Dim cbo As SAPbouiCOM.ComboBox = oForm.Items.Item("txt_STS").Specific

                    CheckStatusGabungan()

                    IndexSetup()

                    MtxDetail.AutoResizeColumns()

                    oFormFKGB.Freeze(False)
                End If

            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKGB.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub

    Public Sub MenuEvent_HandlerEFakturGB_ADD(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)

        If pVal.BeforeAction = False Then

            Dim oXMLDoc As New XmlDocument
            Dim oFormFKGB As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oForm As SAPbouiCOM.Form
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try
                Dim Layout As String = "OffFakturGB.rpt"
                Dim TypeCode As String = "Off Faktur Gabungan"

                oForm = oSBOApplication.Forms.ActiveForm
                Dim oCmbBranch As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbBranch").Specific
                Dim oCmbTrans As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTrans").Specific
                Dim oCmbStatus As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbStatus").Specific

                oFormFKGB = oSBOApplication.Forms.Item("frmOffFKGABUNGAN")
                MtxDetail = oFormFKGB.Items.Item("tblData").Specific
                MtxDetail.CommonSetting.EnableArrowKey = True
                oFormFKGB.Freeze(True)
                oDBSOL_FPGB_HD = oSBOApplication.Forms.Item("frmOffFKGABUNGAN").DataSources.DBDataSources.Item("@SOL_FP_TRX_GB_HD")
                oDBSOL_FPGB_DT = oSBOApplication.Forms.Item("frmOffFKGABUNGAN").DataSources.DBDataSources.Item("@SOL_FP_TRX_GB_DT")

                If oDBSOL_FPGB_HD.Size = 0 Then
                    oDBSOL_FPGB_HD.InsertRecord(oDBSOL_FPGB_HD.Size)
                    oDBSOL_FPGB_HD.Offset = oDBSOL_FPGB_HD.Size - 1
                End If

                'If oDBSOL_FPGB_DT.Size = 0 Then
                '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                'End If

                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_GB_HD"""
                oRec.DoQuery(Query)
                If oRec.RecordCount > 0 Then
                    oDBSOL_FPGB_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                End If

                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Workorder'")
                'If oRec.RecordCount > 0 Then
                '    oFormFKGB.ReportType = oRec.Fields.Item("Code").Value
                'Else
                '    oFormFKGB.ReportType = CRSetup(TypeCode, Layout, oFormFKGB)
                'End If

                oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                If oSQLConnection.ServerType = "SQL" Then
                    Query = "SELECT DISTINCT ISNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                Else
                    Query = "SELECT DISTINCT IFNULL(""U_SOL_FP_BRANCH"",'') as ""BRANCH"" FROM ""@SOL_FP_SETUP"" "
                End If
                Try
                    oRec.DoQuery(Query)
                Catch ex As Exception
                    Dim errorr As String = ex.Message
                End Try

                Try
                    oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                    oCmbTrans.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                    oCmbStatus.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                Catch ex As Exception

                End Try

                'If oRec.RecordCount > 0 Then
                '    For i As Integer = 0 To oRec.RecordCount - 1
                '        oCmbBranch.ValidValues.Add((oRec.Fields.Item("BRANCH").Value), (oRec.Fields.Item("BRANCH").Value))
                '    Next i
                '    oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                'End If

                'oCmbTrans.ValidValues.Add("01", "Kepada Pihak yang Bukan Pemungut PPN")
                'oCmbTrans.ValidValues.Add("02", "Kepada Pemungut Bendaharawan")
                'oCmbTrans.ValidValues.Add("03", "Kepada Pemungut Selain Bendaharawan")
                'oCmbTrans.ValidValues.Add("04", "DPP Nilai Lain")
                'oCmbTrans.ValidValues.Add("06", "Penyerahan Lainnya, termasuk penyerahan kepada turis asing dalam rangka VAT refund")
                'oCmbTrans.ValidValues.Add("07", "Penyerahan yang PPN-nya Tidak Dipungut")
                'oCmbTrans.ValidValues.Add("08", "Penyerahan yang PPN-nya Dibebaskan")
                'oCmbTrans.ValidValues.Add("09", "Penyerahan Aktiva (Pasal 16D UU PPN)")
                'oCmbTrans.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                'oCmbStatus.ValidValues.Add("0", "Normal")
                'oCmbStatus.ValidValues.Add("1", "Penggantian")
                'oCmbStatus.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)


                Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")

                'oDBSOL_FPGB_HD.SetValue("U_TRANSCD", 0, "U")
                'oDBSOL_FPGB_HD.SetValue("U_STATUSCD", 0, "17")
                oDBSOL_FPGB_HD.SetValue("U_DOCSTAT", 0, "N")
                oDBSOL_FPGB_HD.SetValue("U_TAXDATE", 0, datenow)
                oDBSOL_FPGB_HD.SetValue("U_DOCDATE", 0, datenow)
                'oFormFKGB.Items.Item("tabSummary").Click()

                IndexSetup()

                CheckStatusGabungan()

                MtxDetail.AutoResizeColumns()
                oFormFKGB.Freeze(False)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKGB.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub

    Public Sub MenuEvent_HandlerEFakturGG(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        If pVal.BeforeAction = False Then
            Dim oXMLDoc As New XmlDocument
            Dim oFormFKGG As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try

                Dim Found As Boolean = False
                Dim IndexFound As Integer
                Dim FormCount As Integer = oSBOApplication.Forms.Count

                For a As Integer = 0 To FormCount - 1
                    If oSBOApplication.Forms.Item(a).TypeEx = "frmOffFKGUNGGUNG" Then
                        Found = True
                        IndexFound = a
                        Exit For
                    End If
                Next
                If Found = False Then
                    oXMLDoc.Load("OffFakturGunggung.srf")
                    oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
                Else
                    oSBOApplication.Forms.Item(IndexFound).Select()
                End If

                If Found = False Then
                    Dim Layout As String = "eFakturGunggung.rpt"
                    Dim TypeCode As String = "Faktur Pajak Gunggung"

                    oFormFKGG = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG")
                    MtxDetail = oFormFKGG.Items.Item("tblData").Specific
                    MtxDetail.CommonSetting.EnableArrowKey = True
                    oFormFKGG.Freeze(True)
                    oDBSOL_FPGG_HD = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG").DataSources.DBDataSources.Item("@SOL_FP_TRX_GG_HD")
                    oDBSOL_FPGG_DT = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG").DataSources.DBDataSources.Item("@SOL_FP_TRX_GG_DT")

                    If oDBSOL_FPGG_HD.Size = 0 Then
                        oDBSOL_FPGG_HD.InsertRecord(oDBSOL_FPGG_HD.Size)
                        oDBSOL_FPGG_HD.Offset = oDBSOL_FPGG_HD.Size - 1
                    End If

                    'If oDBSOL_FPGB_DT.Size = 0 Then
                    '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                    '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                    'End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                    Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_GG_HD"""
                    oRec.DoQuery(Query)
                    If oRec.RecordCount > 0 Then
                        oDBSOL_FPGG_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                    End If

                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'OffFakturGG'")
                    'If oRec.RecordCount > 0 Then
                    '    oFormFKGG.ReportType = oRec.Fields.Item("Code").Value
                    'Else
                    '    oFormFKGG.ReportType = CRSetup(TypeCode, Layout, oFormFKGG)
                    'End If

                    Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")
                    Dim Month As String = System.DateTime.Now.ToString("MM")
                    Dim Year As String = System.DateTime.Now.ToString("yyyy")

                    oDBSOL_FPGG_HD.SetValue("U_DOCSTAT", 0, "N")
                    oDBSOL_FPGG_HD.SetValue("U_DOCDATE", 0, datenow)
                    oDBSOL_FPGG_HD.SetValue("U_MP_M", 0, Month)
                    oDBSOL_FPGG_HD.SetValue("U_MP_Y", 0, Year)

                    oDBSOL_FPGG_HD.SetValue("U_CHKINVDT", 0, "Y")
                    'oFormFKGB.Items.Item("tabSummary").Click()

                    oRec.DoQuery("SELECT ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Faktur Pajak Gunggung'")
                    If oRec.RecordCount > 0 Then
                        oFormFKGG.ReportType = oRec.Fields.Item("Code").Value
                    Else
                        oFormFKGG.ReportType = CRSetup(TypeCode, Layout, oFormFKGG)
                    End If
                    'Dim cbo As SAPbouiCOM.ComboBox = oFormFKGG.Items.Item("txt_STS").Specific

                    CheckStatusGunggung()

                    IndexSetup()

                    MtxDetail.AutoResizeColumns()
                    oFormFKGG.Freeze(False)
                End If

            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKGG.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub

    Public Sub MenuEvent_HandlerEFakturGG_ADD(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)

        If pVal.BeforeAction = False Then
            Dim oXMLDoc As New XmlDocument
            Dim oFormFKGG As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try
                Dim Layout As String = "OffFakturGG.rpt"
                Dim TypeCode As String = "Off Faktur Gunggung"

                oFormFKGG = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG")
                MtxDetail = oFormFKGG.Items.Item("tblData").Specific
                MtxDetail.CommonSetting.EnableArrowKey = True
                oFormFKGG.Freeze(True)
                oDBSOL_FPGG_HD = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG").DataSources.DBDataSources.Item("@SOL_FP_TRX_GG_HD")
                oDBSOL_FPGG_DT = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG").DataSources.DBDataSources.Item("@SOL_FP_TRX_GG_DT")

                If oDBSOL_FPGG_HD.Size = 0 Then
                    oDBSOL_FPGG_HD.InsertRecord(oDBSOL_FPGG_HD.Size)
                    oDBSOL_FPGG_HD.Offset = oDBSOL_FPGG_HD.Size - 1
                End If

                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                Query = "Select (MAX(""DocNum"")+1) As ""NewNum"" from ""@SOL_FP_TRX_GG_HD"""
                oRec.DoQuery(Query)
                If oRec.RecordCount > 0 Then
                    oDBSOL_FPGG_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                End If

                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                'oRec.DoQuery("Select ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = 'Workorder'")
                'If oRec.RecordCount > 0 Then
                '    oFormFKGG.ReportType = oRec.Fields.Item("Code").Value
                'Else
                '    oFormFKGG.ReportType = CRSetup(TypeCode, Layout, oFormFKGG)
                'End If

                Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")
                Dim Month As String = System.DateTime.Now.ToString("MM")
                Dim Year As String = System.DateTime.Now.ToString("yyyy")

                oDBSOL_FPGG_HD.SetValue("U_DOCSTAT", 0, "N")
                oDBSOL_FPGG_HD.SetValue("U_DOCDATE", 0, datenow)
                oDBSOL_FPGG_HD.SetValue("U_MP_M", 0, Month)
                oDBSOL_FPGG_HD.SetValue("U_MP_Y", 0, Year)

                IndexSetup()

                CheckStatusGunggung()

                MtxDetail.AutoResizeColumns()
                oFormFKGG.Freeze(False)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKGG.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub

    Public Sub MenuEvent_Handler_CLOSE(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        BubbleEvent = True
        If pVal.BeforeAction = False Then
            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
            Dim DocNum As SAPbouiCOM.EditText = oForm.Items.Item("DocNum").Specific
            Dim Notes As String
            Dim DocEntry As Integer
            Dim oRecDocEntry As SAPbobsCOM.Recordset
            Dim oProgBar As SAPbouiCOM.ProgressBar
            Dim oGeneralService As SAPbobsCOM.GeneralService
            Dim oGeneralData As SAPbobsCOM.GeneralData
            Dim oChild As SAPbobsCOM.GeneralData
            Dim oChildren As SAPbobsCOM.GeneralDataCollection
            Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
            Dim oCmpSrv As SAPbobsCOM.CompanyService
            If oForm.UniqueID = "frmOffFKMASSAL" Then
                If oSBOApplication.MessageBox("Are you sure to Close this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Close Notes", "Reason for Close this Document")
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'")
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    '----------------------------UPDATE Cancel Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "L")
                        oGeneralData.SetProperty("U_NOTES", Notes)

                        oGeneralService.Update(oGeneralData)
                    Catch ex As Exception
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try

                    oSBOApplication.ActivateMenuItem("1304")
                End If

            ElseIf oForm.UniqueID = "frmOffFKGABUNGAN" Then
                If oSBOApplication.MessageBox("Are you sure to Close this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Close Notes", "Reason for Close this Document")
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'")
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    '----------------------------UPDATE Close Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "L")
                        oGeneralData.SetProperty("U_NOTES", Notes)

                        oGeneralService.Update(oGeneralData)
                    Catch ex As Exception
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try

                    oSBOApplication.ActivateMenuItem("1304")
                End If
            ElseIf oForm.UniqueID = "frmOffFKGUNGGUNG" Then
                If oSBOApplication.MessageBox("Are you sure to Close this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Close Notes", "Reason for Close this Document")
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'")
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    '----------------------------UPDATE Close Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "L")
                        oGeneralData.SetProperty("U_NOTES", Notes)

                        oGeneralService.Update(oGeneralData)
                    Catch ex As Exception
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try

                    oSBOApplication.ActivateMenuItem("1304")
                End If
            End If
        End If
    End Sub

    Public Sub MenuEvent_Handler_CANCEL(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean) ' EVENT Saat klik kanan untuk Cancel document
        BubbleEvent = True
        If pVal.BeforeAction = False Then
            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
            Dim DocNum As SAPbouiCOM.EditText = oForm.Items.Item("DocNum").Specific
            Dim ContinueLoop As Boolean = True
            Dim oProgBar As SAPbouiCOM.ProgressBar
            Dim oGeneralService As SAPbobsCOM.GeneralService
            Dim oGeneralData As SAPbobsCOM.GeneralData
            Dim oChild As SAPbobsCOM.GeneralData
            Dim oChildren As SAPbobsCOM.GeneralDataCollection
            Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
            Dim oCmpSrv As SAPbobsCOM.CompanyService
            Dim Notes As String
            Dim Status As SAPbouiCOM.ComboBox = oForm.Items.Item("txtDocStat").Specific
            Dim retval As String = ""
            Dim DocEntry As Integer = 0
            Dim oRecDocEntry As SAPbobsCOM.Recordset
            If oForm.UniqueID = "frmOffFKMASSAL" Then ' Posisi Cancel di Form MASSAL
                If oSBOApplication.MessageBox("Are you sure to Cancel this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then  ' validasi jadi cancel atau tidak

                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Cancel Notes", "Reason for Cancel this Document") ' Muncul POPup untuk masukan alasan cancel dan dimasukan status note
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'") ' Ambil data dari tabel UDT massal Header
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    '----------------------------UPDATE Cancel Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "C") ' Update status dokumen di menu addon massal
                        oGeneralData.SetProperty("U_NOTES", Notes) ' Update status note

                        oGeneralService.Update(oGeneralData)
                        ContinueLoop = True ' SET ContinueLoop menjadi TRUE >> dan loncat di IF Contiuneloop True
                    Catch ex As Exception
                        ContinueLoop = False
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        Try
                            If oSBOCompany.InTransaction Then
                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                            End If
                        Catch exn As Exception
                        End Try
                    End Try

                    '----------------------------UPDATE Invoice-----------------------------------------

                    If ContinueLoop = True Then
                        Dim TypeForm As String = "Massal"
                        Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value

                        Dim oRec As SAPbobsCOM.Recordset
                        Dim oRecUpdate As SAPbobsCOM.Recordset
                        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        Dim Query As String
                        Dim QueryUpdate As String
                        Dim DateQuery As Date
                        Dim DateString As String

                        If oSQLConnection.ServerType = "SQL" Then
                            Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','','" & DocNumReferences & "' "
                        Else
                            Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','','" & DocNumReferences & "' ) " ' DICHECK pakai SP, untuk check semua UDF di dokumen a/r invoice dan a/r dp invoice jika ada datanya di CLean > record = 1
                        End If

                        Try
                            oRec.DoQuery(Query)

                            If oRec.RecordCount > 0 Then
                                'Ada Invoice yang nomor fp nya harus di hapus
                                Try
                                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False) ' munculin status di bar kalau sedang di canceling invoice
                                    oProgBar.Value = 0
                                Catch ex As Exception
                                End Try

                                For i As Integer = 0 To oRec.RecordCount - 1
                                    If ContinueLoop = True Then ' JIKA TRUE di akan hapus/ Update udf invoice
                                        DateQuery = Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
                                        ' DateQuery = Date.ParseExact(oRec.Fields.Item("TaxDate").Value, "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
                                        DateString = DateQuery.ToString("yyyyMMdd")

                                        'dibawah ini ganti semua value di udf(Invoice) menjadi kosongin
                                        'ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0", "", "", "", "", "", TypeForm, True)
                                        'If ContinueLoop = False Then
                                        '    Exit For
                                        'End If
                                        oRec.MoveNext()
                                    End If

                                    Try
                                        oProgBar.Value = i
                                        oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                                    Catch ex As Exception
                                    End Try
                                Next
                            End If

                            Try
                                'oProgBar.Stop()
                                'System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                'oProgBar = Nothing
                            Catch exa As Exception
                            End Try

                            If ContinueLoop = True Then
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                                        oSBOApplication.ActivateMenuItem("1304")
                                        oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                                    End If
                                Catch ex As Exception
                                    oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                                End Try
                            Else
                                '---------------------Roll Back--------------------------------
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                    End If
                                Catch ex As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End If

                        Catch ex As Exception
                            '---------------------Stop Progress Bar--------------------------------
                            Try
                                oProgBar.Stop()
                                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                oProgBar = Nothing
                            Catch exa As Exception
                            End Try
                            '---------------------Roll Back--------------------------------
                            Try
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                            Catch exn As Exception
                            End Try
                            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End Try
                    End If
                End If

            ElseIf oForm.UniqueID = "frmOffFKGABUNGAN" Then

                If oSBOApplication.MessageBox("Are you sure to Cancel this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Cancel Notes", "Reason for Cancel this Document")
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'")
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If
                    '----------------------------UPDATE Cancel Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "C")
                        oGeneralData.SetProperty("U_NOTES", Notes)

                        oGeneralService.Update(oGeneralData)
                        ContinueLoop = True
                    Catch ex As Exception
                        ContinueLoop = False
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        Try
                            If oSBOCompany.InTransaction Then
                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                            End If
                        Catch exn As Exception
                        End Try
                    End Try

                    '----------------------------UPDATE Invoice-----------------------------------------

                    If ContinueLoop = True Then

                        Dim TypeForm As String = "Gabungan"
                        Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value
                        Dim NoTax As String = oForm.Items.Item("txtNoFP").Specific.value

                        Dim oRec As SAPbobsCOM.Recordset
                        Dim oRecUpdate As SAPbobsCOM.Recordset
                        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        Dim Query As String
                        Dim QueryUpdate As String

                        Dim DateQuery As Date
                        Dim DateString As String

                        If oSQLConnection.ServerType = "SQL" Then
                            Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','" & NoTax & "','" & DocNumReferences & "' "
                        Else
                            Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','" & NoTax & "','" & DocNumReferences & "' ) "
                        End If

                        Try
                            oRec.DoQuery(Query)

                            If oRec.RecordCount > 0 Then
                                'Ada Invoice yang nomor fp nya harus di hapus
                                Try
                                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False)
                                    oProgBar.Value = 0
                                Catch ex As Exception
                                End Try
                                For i As Integer = 0 To oRec.RecordCount - 1
                                    If ContinueLoop = True Then
                                        DateQuery = oRec.Fields.Item("DocDate").Value
                                        DateString = DateQuery.ToString("yyyyMMdd")

                                        'ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0", "", "", "", "", "", TypeForm, True)
                                        'If ContinueLoop = False Then
                                        '    Exit For
                                        'End If

                                        oRec.MoveNext()
                                    End If
                                    Try
                                        oProgBar.Value = i
                                        oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                                    Catch ex As Exception
                                    End Try
                                Next
                            End If

                            Try
                                oProgBar.Stop()
                                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                oProgBar = Nothing
                            Catch exa As Exception
                            End Try

                            If ContinueLoop = True Then
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                                        oSBOApplication.ActivateMenuItem("1304")
                                        oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                                    End If
                                Catch ex As Exception
                                    oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                                End Try
                            Else
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                    End If
                                Catch ex As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End If

                        Catch ex As Exception
                            Try
                                oProgBar.Stop()
                                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                oProgBar = Nothing
                            Catch exa As Exception
                            End Try
                            Try
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                            Catch exn As Exception
                            End Try
                            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End Try
                    End If
                End If

            ElseIf oForm.UniqueID = "frmOffFKGUNGGUNG" Then

                If oSBOApplication.MessageBox("Are you sure to Cancel this document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

                    oUserInput = New UserInput(oSBOApplication, oSBOCompany)
                    Notes = oUserInput.ShowInput("Cancel Notes", "Reason for Cancel this Document")
                    oUserInput = Nothing

                    '----------------------------Get DocEntry-----------------------------------------

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNum.Value & "'")
                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    '----------------------------UPDATE Cancel Flag UDO-----------------------------------------
                    Try
                        'get company service
                        oCmpSrv = oSBOCompany.GetCompanyService()
                        oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                        oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                        oGeneralParams.SetProperty("DocEntry", DocEntry)
                        oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                        ' Header Data
                        oGeneralData.SetProperty("U_DOCSTAT", "C")
                        oGeneralData.SetProperty("U_NOTES", Notes)

                        oGeneralService.Update(oGeneralData)
                        ContinueLoop = True
                    Catch ex As Exception
                        ContinueLoop = False
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        Try
                            If oSBOCompany.InTransaction Then
                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                            End If
                        Catch exn As Exception
                        End Try
                    End Try

                    '----------------------------UPDATE Invoice-----------------------------------------
                    If ContinueLoop = True Then
                        Dim TypeForm As String = "Gunggung"
                        Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value

                        Dim oRec As SAPbobsCOM.Recordset
                        Dim oRecUpdate As SAPbobsCOM.Recordset
                        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        Dim Query As String
                        Dim QueryUpdate As String
                        Dim DateQuery As Date
                        Dim DateString As String

                        If oSQLConnection.ServerType = "SQL" Then
                            Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','','" & DocNumReferences & "' "
                        Else
                            Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','','" & DocNumReferences & "' ) "
                        End If

                        Try
                            oRec.DoQuery(Query)

                            If oRec.RecordCount > 0 Then
                                'Ada Invoice yang nomor fp nya harus di hapus
                                Try
                                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False)
                                    oProgBar.Value = 0
                                Catch ex As Exception
                                End Try
                                For i As Integer = 0 To oRec.RecordCount - 1
                                    If ContinueLoop = True Then
                                        DateQuery = oRec.Fields.Item("DocDate").Value
                                        DateString = DateQuery.ToString("yyyyMMdd")

                                        'ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0", "", "", "", "", "", TypeForm, True)
                                        'If ContinueLoop = False Then
                                        '    Exit For
                                        'End If

                                        oRec.MoveNext()
                                    End If
                                    Try
                                        oProgBar.Value = i
                                        oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                                    Catch ex As Exception
                                    End Try
                                Next
                            End If

                            Try
                                oProgBar.Stop()
                                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                oProgBar = Nothing
                            Catch exa As Exception
                            End Try
                            If ContinueLoop = True Then
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                                        oSBOApplication.ActivateMenuItem("1304")
                                        oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                                    End If
                                Catch ex As Exception
                                    oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                                End Try
                            Else
                                Try
                                    If oSBOCompany.InTransaction Then
                                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                    End If
                                Catch ex As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End If

                        Catch ex As Exception
                            Try
                                oProgBar.Stop()
                                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                                oProgBar = Nothing
                            Catch exa As Exception
                            End Try
                            Try
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                            Catch exn As Exception
                            End Try
                            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End Try
                    End If
                End If
            End If
        End If
    End Sub


    'Public Sub MenuEvent_Handler_CANCEL(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
    '    BubbleEvent = True
    '    If pVal.BeforeAction = False Then
    '        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
    '        Dim DocNum As SAPbouiCOM.EditText = oForm.Items.Item("DocNum").Specific
    '        Dim ContinueLoop As Boolean = True
    '        Dim oProgBar As SAPbouiCOM.ProgressBar
    '        Dim Notes As SAPbouiCOM.EditText = oForm.Items.Item("txtNotes").Specific
    '        If Notes.Value.Length < 5 Then
    '            If oForm.UniqueID = "frmOffFKMASSAL" Then
    '                If oSBOApplication.MessageBox("Are you sure to Cancel this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

    '                    If Not oSBOCompany.InTransaction Then
    '                        oSBOCompany.StartTransaction()
    '                    End If

    '                    Dim TypeForm As String = "Massal"
    '                    Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value

    '                    Dim oRec As SAPbobsCOM.Recordset
    '                    Dim oRecUpdate As SAPbobsCOM.Recordset
    '                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    Dim Query As String
    '                    Dim QueryUpdate As String
    '                    Dim DateQuery As Date
    '                    Dim DateString As String

    '                    If oSQLConnection.ServerType = "SQL" Then
    '                        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','','" & DocNumReferences & "' "
    '                    Else
    '                        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','','" & DocNumReferences & "' ) "
    '                    End If

    '                    Try
    '                        oRec.DoQuery(Query)

    '                        If oRec.RecordCount > 0 Then
    '                            'Ada Invoice yang nomor fp nya harus di hapus
    '                            Try
    '                                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False)
    '                                oProgBar.Value = 0
    '                            Catch ex As Exception
    '                            End Try

    '                            For i As Integer = 0 To oRec.RecordCount - 1
    '                                If ContinueLoop = True Then
    '                                    DateQuery = Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
    '                                    DateString = DateQuery.ToString("yyyyMMdd")

    '                                    ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0")
    '                                    If ContinueLoop = False Then
    '                                        Exit For
    '                                    End If

    '                                    'If oSQLConnection.ServerType = "SQL" Then
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    End If
    '                                    'Else
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
    '                                    '                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
    '                                    '                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    End If
    '                                    'End If

    '                                    'oRecUpdate.DoQuery(QueryUpdate)
    '                                    oRec.MoveNext()
    '                                End If

    '                                Try
    '                                    oProgBar.Value = i
    '                                    oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
    '                                Catch ex As Exception
    '                                End Try
    '                            Next
    '                        End If

    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        If ContinueLoop = True Then
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
    '                                    Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'C' " +
    '                                            "WHERE ""DocNum"" = '" & DocNum.Value & "'"
    '                                    oRec.DoQuery(Query)
    '                                    oSBOApplication.ActivateMenuItem("1304")
    '                                    oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
    '                                End If
    '                            Catch ex As Exception
    '                                oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                            End Try
    '                        Else
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                                End If
    '                            Catch ex As Exception
    '                            End Try
    '                            oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                        End If

    '                    Catch ex As Exception
    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        Try
    '                            If oSBOCompany.InTransaction Then
    '                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                            End If
    '                        Catch exn As Exception
    '                        End Try
    '                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                    End Try
    '                End If

    '            ElseIf oForm.UniqueID = "frmOffFKGABUNGAN" Then

    '                If oSBOApplication.MessageBox("Are you sure to Cancel this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

    '                    If Not oSBOCompany.InTransaction Then
    '                        oSBOCompany.StartTransaction()
    '                    End If

    '                    Dim TypeForm As String = "Gabungan"
    '                    Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value
    '                    Dim NoTax As String = oForm.Items.Item("txtNoFP").Specific.value

    '                    Dim oRec As SAPbobsCOM.Recordset
    '                    Dim oRecUpdate As SAPbobsCOM.Recordset
    '                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    Dim Query As String
    '                    Dim QueryUpdate As String

    '                    Dim DateQuery As Date
    '                    Dim DateString As String

    '                    If oSQLConnection.ServerType = "SQL" Then
    '                        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','" & NoTax & "','" & DocNumReferences & "' "
    '                    Else
    '                        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','" & NoTax & "','" & DocNumReferences & "' ) "
    '                    End If

    '                    Try
    '                        oRec.DoQuery(Query)

    '                        If oRec.RecordCount > 0 Then
    '                            'Ada Invoice yang nomor fp nya harus di hapus
    '                            Try
    '                                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False)
    '                                oProgBar.Value = 0
    '                            Catch ex As Exception
    '                            End Try
    '                            For i As Integer = 0 To oRec.RecordCount - 1
    '                                If ContinueLoop = True Then
    '                                    DateQuery = oRec.Fields.Item("DocDate").Value
    '                                    DateString = DateQuery.ToString("yyyyMMdd")

    '                                    ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0")
    '                                    If ContinueLoop = False Then
    '                                        Exit For
    '                                    End If

    '                                    'If oSQLConnection.ServerType = "SQL" Then
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    End If
    '                                    'Else
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    End If
    '                                    'End If

    '                                    'oRecUpdate.DoQuery(QueryUpdate)
    '                                    oRec.MoveNext()
    '                                End If
    '                                Try
    '                                    oProgBar.Value = i
    '                                    oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
    '                                Catch ex As Exception
    '                                End Try
    '                            Next
    '                        End If

    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        If ContinueLoop = True Then
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
    '                                    Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'C' " +
    '                                        "WHERE ""DocNum"" = '" & DocNum.Value & "'"
    '                                    oRec.DoQuery(Query)
    '                                    oSBOApplication.ActivateMenuItem("1304")
    '                                    oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
    '                                End If
    '                            Catch ex As Exception
    '                                oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                            End Try
    '                        Else
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                                End If
    '                            Catch ex As Exception
    '                            End Try
    '                            oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                        End If

    '                    Catch ex As Exception
    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        Try
    '                            If oSBOCompany.InTransaction Then
    '                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                            End If
    '                        Catch exn As Exception
    '                        End Try
    '                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                    End Try


    '                End If
    '            ElseIf oForm.UniqueID = "frmOffFKGUNGGUNG" Then

    '                If oSBOApplication.MessageBox("Are you sure to Cancel this document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

    '                    If Not oSBOCompany.InTransaction Then
    '                        oSBOCompany.StartTransaction()
    '                    End If

    '                    Dim TypeForm As String = "Gunggung"
    '                    Dim DocNumReferences As String = oForm.Items.Item("DocNum").Specific.value

    '                    Dim oRec As SAPbobsCOM.Recordset
    '                    Dim oRecUpdate As SAPbobsCOM.Recordset
    '                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '                    Dim Query As String
    '                    Dim QueryUpdate As String
    '                    Dim DateQuery As Date
    '                    Dim DateString As String

    '                    If oSQLConnection.ServerType = "SQL" Then
    '                        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','','','','" & DocNumReferences & "' "
    '                    Else
    '                        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','','','','" & DocNumReferences & "' ) "
    '                    End If

    '                    Try
    '                        oRec.DoQuery(Query)

    '                        If oRec.RecordCount > 0 Then
    '                            'Ada Invoice yang nomor fp nya harus di hapus
    '                            Try
    '                                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Canceling Invoice ", oRec.RecordCount, False)
    '                                oProgBar.Value = 0
    '                            Catch ex As Exception
    '                            End Try
    '                            For i As Integer = 0 To oRec.RecordCount - 1
    '                                If ContinueLoop = True Then
    '                                    DateQuery = oRec.Fields.Item("DocDate").Value
    '                                    DateString = DateQuery.ToString("yyyyMMdd")

    '                                    ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0")
    '                                    If ContinueLoop = False Then
    '                                        Exit For
    '                                    End If

    '                                    'If oSQLConnection.ServerType = "SQL" Then
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '',  " +
    '                                    '        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' U_SOL_FP_PPN = '', U_SOL_KMK = '', "
    '                                    '    End If
    '                                    'Else
    '                                    '    If oRec.Fields.Item("ObjType").Value = "13" Then
    '                                    '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    Else
    '                                    '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
    '                                    '            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                                    '    End If
    '                                    'End If

    '                                    'oRecUpdate.DoQuery(QueryUpdate)
    '                                    oRec.MoveNext()
    '                                End If
    '                                Try
    '                                    oProgBar.Value = i
    '                                    oProgBar.Text = "Canceling Invoice '" & i & "'/'" & oRec.RecordCount & "'"
    '                                Catch ex As Exception
    '                                End Try
    '                            Next
    '                        End If

    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        If ContinueLoop = True Then
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
    '                                    Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'C' " +
    '                                        "WHERE ""DocNum"" = '" & DocNum.Value & "'"
    '                                    oRec.DoQuery(Query)
    '                                    oSBOApplication.ActivateMenuItem("1304")
    '                                    oSBOApplication.StatusBar.SetText("Cancel Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
    '                                End If
    '                            Catch ex As Exception
    '                                oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                            End Try
    '                        Else
    '                            Try
    '                                If oSBOCompany.InTransaction Then
    '                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                                End If
    '                            Catch ex As Exception
    '                            End Try
    '                            oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                        End If

    '                    Catch ex As Exception
    '                        Try
    '                            oProgBar.Stop()
    '                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
    '                            oProgBar = Nothing
    '                        Catch exa As Exception
    '                        End Try
    '                        Try
    '                            If oSBOCompany.InTransaction Then
    '                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
    '                            End If
    '                        Catch exn As Exception
    '                        End Try
    '                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '                    End Try

    '                End If
    '            End If
    '        Else
    '            oSBOApplication.StatusBar.SetText("Status Notes is Missing, At Least 5 Character", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '        End If
    '    End If
    'End Sub

#End Region

#Region " ItemEvent Handler "

    Public Sub ItemEvent_Handler_eFaktur(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "btnExpPK" And pVal.BeforeAction = False And pVal.ActionSuccess = True And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
            Dim oForm As SAPbouiCOM.Form ' event saat button export di efaktur keluaran biasa
            oForm = oSBOApplication.Forms.Item(FormUID)

            IndexSetup()

            Dim TxtDateFrom As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDFrPK").Specific, SAPbouiCOM.EditText)
            Dim TxtDateTo As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDToPK").Specific, SAPbouiCOM.EditText)
            Dim ChkExported As SAPbouiCOM.CheckBox = CType(oForm.Items.Item("chkIncPK").Specific, SAPbouiCOM.CheckBox)

            Dim DateFrom As Date
            Dim DateTo As Date
            Dim sqlText As String

            'POP UP
            If TxtDateFrom.Value.ToString.Trim = "" Or TxtDateTo.Value.ToString.Trim = "" Then
                oSBOApplication.MessageBox("Date Parameter is Missing")
                Return
            End If

            Dim halo As String = oForm.DataSources.UserDataSources.Item("DFRPK").Value.ToString.Trim
            Dim halo2 As String = oForm.DataSources.UserDataSources.Item("DTOPK").Value.ToString.Trim

            DateFrom = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DFRPK").Value.ToString.Trim)
            DateTo = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DTOPK").Value.ToString.Trim)

            If oSQLConnection.ServerType = "SQL" Then
                sqlText = "EXEC [SOL_FORM_GET_PAJAK_KELUARAN_LIST] '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' "
            Else
                sqlText = "CALL SOL_FORM_GET_PAJAK_KELUARAN_LIST ( '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' )"
            End If

            CreateForm("Pajak Keluaran", "PK", sqlText)
        ElseIf pVal.ItemUID = "btnExpPM" And pVal.BeforeAction = False And pVal.ActionSuccess = True And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
            Dim oForm As SAPbouiCOM.Form ' event saat button export di efaktur pajak Masukan
            oForm = oSBOApplication.Forms.Item(FormUID)

            Dim TxtDateFrom As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDFrPM").Specific, SAPbouiCOM.EditText)
            Dim TxtDateTo As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDToPM").Specific, SAPbouiCOM.EditText)
            Dim ChkExported As SAPbouiCOM.CheckBox = CType(oForm.Items.Item("chkIncPM").Specific, SAPbouiCOM.CheckBox)

            Dim DateFrom As Date
            Dim DateTo As Date
            Dim sqlText As String

            'POP UP
            If TxtDateFrom.Value.ToString.Trim = "" Or TxtDateTo.Value.ToString.Trim = "" Then
                oSBOApplication.MessageBox("Date Parameter is Missing")
                Return
            End If

            DateFrom = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DFRPM").Value)
            DateTo = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DTOPM").Value)

            If oSQLConnection.ServerType = "SQL" Then
                sqlText = "EXEC [SOL_FORM_GET_PAJAK_MASUKAN_LIST] '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' "
            Else
                sqlText = "CALL SOL_FORM_GET_PAJAK_MASUKAN_LIST ( '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' )"
            End If
            CreateForm("Pajak Masukan", "PM", sqlText)
        ElseIf pVal.ItemUID = "btnExpRPK" And pVal.BeforeAction = False And pVal.ActionSuccess = True And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
            Dim oForm As SAPbouiCOM.Form ' event saat button export di efaktur retur keluaran
            oForm = oSBOApplication.Forms.Item(FormUID)

            Dim TxtDateFrom As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDFrRPK").Specific, SAPbouiCOM.EditText)
            Dim TxtDateTo As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDToRPK").Specific, SAPbouiCOM.EditText)
            Dim ChkExported As SAPbouiCOM.CheckBox = CType(oForm.Items.Item("chkIncRPK").Specific, SAPbouiCOM.CheckBox)

            Dim DateFrom As Date
            Dim DateTo As Date
            Dim sqlText As String

            'POP UP
            If TxtDateFrom.Value.ToString.Trim = "" Or TxtDateTo.Value.ToString.Trim = "" Then
                oSBOApplication.MessageBox("Date Parameter is Missing")
                Return
            End If

            DateFrom = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DFRRPK").Value)
            DateTo = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DTORPK").Value)
            If oSQLConnection.ServerType = "SQL" Then
                sqlText = "EXEC [SOL_FORM_GET_RETUR_KELUARAN_LIST] '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' "
            Else
                sqlText = "CALL SOL_FORM_GET_RETUR_KELUARAN_LIST ( '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' )"
            End If


            CreateForm("Retur Pajak Keluaran", "RPK", sqlText)
        ElseIf pVal.ItemUID = "btnExpRPM" And pVal.BeforeAction = False And pVal.ActionSuccess = True And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
            Dim oForm As SAPbouiCOM.Form ' event saat button export di efaktur retur Masukan
            oForm = oSBOApplication.Forms.Item(FormUID)

            Dim TxtDateFrom As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDFrRPM").Specific, SAPbouiCOM.EditText)
            Dim TxtDateTo As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDToRPM").Specific, SAPbouiCOM.EditText)
            Dim ChkExported As SAPbouiCOM.CheckBox = CType(oForm.Items.Item("chkIncRPM").Specific, SAPbouiCOM.CheckBox)

            Dim DateFrom As Date
            Dim DateTo As Date
            Dim sqlText As String

            'POP UP
            If TxtDateFrom.Value.ToString.Trim = "" Or TxtDateTo.Value.ToString.Trim = "" Then
                oSBOApplication.MessageBox("Date Parameter is Missing")
                Return
            End If

            DateFrom = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DFRRPM").Value)
            DateTo = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DTORPM").Value)

            If oSQLConnection.ServerType = "SQL" Then
                sqlText = "EXEC [SOL_FORM_GET_RETUR_MASUKAN_LIST] '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' "
            Else
                sqlText = "CALL SOL_FORM_GET_RETUR_MASUKAN_LIST ( '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' )"
            End If
            CreateForm("Retur Pajak Masukan", "RPM", sqlText)
        ElseIf pVal.ItemUID = "btnExpDLM" And pVal.BeforeAction = False And pVal.ActionSuccess = True And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then 'Tambahan Ricky
            Dim oForm As SAPbouiCOM.Form
            oForm = oSBOApplication.Forms.Item(FormUID)

            Dim TxtDateFrom As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDFrDLM").Specific, SAPbouiCOM.EditText)
            Dim TxtDateTo As SAPbouiCOM.EditText = CType(oForm.Items.Item("dtpPDToDLM").Specific, SAPbouiCOM.EditText)
            Dim ChkExported As SAPbouiCOM.CheckBox = CType(oForm.Items.Item("chkIncDLM").Specific, SAPbouiCOM.CheckBox)

            Dim DateFrom As Date
            Dim DateTo As Date
            Dim sqlText As String

            'POP UP
            If TxtDateFrom.Value.ToString.Trim = "" Or TxtDateTo.Value.ToString.Trim = "" Then
                oSBOApplication.MessageBox("Date Parameter is Missing")
                Return
            End If

            DateFrom = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DFRDLM").Value.ToString.Trim)
            DateTo = convertUIDateToVBDate(oSBOCompany, oForm.DataSources.UserDataSources.Item("DTODLM").Value.ToString.Trim)

            If oSQLConnection.ServerType = "SQL" Then
                sqlText = "EXEC [SOL_FORM_GET_DOK_LAIN_MASUKAN_LIST] '" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "' "
            Else
                sqlText = "CALL SOL_FORM_GET_DOK_LAIN_MASUKAN_LIST ('" + IIf(ChkExported.Checked, "1", "0") + "','" + DateFrom.ToString("yyyyMMdd") + "','" + DateTo.ToString("yyyyMMdd") + "') "
            End If
            CreateForm("Dokumen Lain Masukan", "DLM", sqlText)
        End If
    End Sub

    Public Sub ItemEvent_Handler_LookUp(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "tblData" Then ' SAAT TAMPILAN SETELAH EXPORT DI SEMUA MENU eFAKTUR BIASA


            If pVal.ColUID = "txtChkBox" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_DOUBLE_CLICK Then
                    If pVal.Row = 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)

                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim iRows As Integer = 0

                            oMatrix = oForm.Items.Item("tblData").Specific
                            oForm.Freeze(True)

                            For i As Integer = 1 To oMatrix.RowCount
                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then
                                    iRows += 1
                                End If
                            Next i

                            If iRows <> oMatrix.RowCount Then
                                Dim DS_CHECKBOX As SAPbouiCOM.UserDataSource
                                DS_CHECKBOX = oForm.DataSources.UserDataSources.Item("PKFormChk") 'PKFormChk itu nama field
                                DS_CHECKBOX.Value = "Y"

                                oMatrix.Clear()
                                oMatrix.LoadFromDataSource()
                                oMatrix.AutoResizeColumns()
                            Else
                                Dim DS_CHECKBOX As SAPbouiCOM.UserDataSource
                                DS_CHECKBOX = oForm.DataSources.UserDataSources.Item("PKFormChk")
                                DS_CHECKBOX.Value = "N"

                                oMatrix.Clear()
                                oMatrix.LoadFromDataSource()
                                oMatrix.AutoResizeColumns()
                            End If

                            oForm.Freeze(False)
                        End If
                    End If
                End If
            ElseIf pVal.ColUID = "txtBPJoin" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_KEY_DOWN Then
                    If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                        Dim oForm As SAPbouiCOM.Form
                        oForm = oSBOApplication.Forms.ActiveForm

                        Dim oMatrix As SAPbouiCOM.Matrix
                        Dim iRows As Integer = 0
                        Dim BPCode As SAPbouiCOM.EditText
                        Dim BPName As SAPbouiCOM.EditText

                        oMatrix = oForm.Items.Item("tblData").Specific
                        oForm.Freeze(True)
                        Dim halo As Integer = oMatrix.GetNextSelectedRow(0, SAPbouiCOM.BoOrderType.ot_SelectionOrder)
                        iRows = oMatrix.GetNextSelectedRow(0, SAPbouiCOM.BoOrderType.ot_RowOrder)
                        If pVal.Row > 0 Then

                            BPCode = CType(oMatrix.Columns.Item("txtBPJoin").Cells.Item(pVal.Row).Specific, SAPbouiCOM.EditText)
                            BPName = CType(oMatrix.Columns.Item("txtBPJoinN").Cells.Item(pVal.Row).Specific, SAPbouiCOM.EditText)

                            Dim oRec As SAPbobsCOM.Recordset
                            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                            Dim Query As String
                            If oSQLConnection.ServerType = "SQL" Then
                                'Select Case DISTINCT "U_SOL_BP_CODE", "U_SOL_BP_NAME" FROM "@SOL_FP_BP_LIST"
                                Query = "SELECT DISTINCT ISNULL(""U_SOL_BP_NAME"",'') as ""BP_NAME"" FROM ""@SOL_FP_BP_LIST"" WHERE ""U_SOL_BP_CODE"" = '" & BPCode.Value & "'"
                            Else
                                Query = "SELECT DISTINCT IFNULL(""U_SOL_BP_NAME"",'') as ""BP_NAME"" FROM ""@SOL_FP_BP_LIST""  WHERE ""U_SOL_BP_CODE"" = '" & BPCode.Value & "'"
                            End If

                            Try
                                oRec.DoQuery(Query)
                                BPName.Value = oRec.Fields.Item("BP_NAME").Value
                            Catch ex As Exception
                                Dim errorr As String = ex.Message
                            End Try

                        End If
                        oForm.Freeze(False)
                    End If
                End If
            End If
            'ElseIf pVal.ItemUID = "tblData" Then
            '    If pVal.ColUID = "txtBPJoin" Then

            '    End If
        ElseIf pVal.ItemUID = "btnCancel" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form
                    oForm = oSBOApplication.Forms.Item(FormUID)

                    oForm.Visible = False
                End If
            End If
        ElseIf pVal.ItemUID = "btnGenFP" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then

                    Dim oProgBar As SAPbouiCOM.ProgressBar

                    Dim oForm As SAPbouiCOM.Form
                    oForm = oSBOApplication.Forms.Item(FormUID)

                    Dim Branch As SAPbouiCOM.EditText
                    Branch = oForm.Items.Item("TxtBranch").Specific
                    If Branch.Value <> "" Then

                        Dim oMatrix As SAPbouiCOM.Matrix
                        oMatrix = oForm.Items.Item("tblData").Specific
                        Dim TaxNumberStart As String = ""
                        Dim TaxNumberRunning As String = ""
                        Dim TaxNumberrunStartpref As String = ""
                        Dim TaxNumberrunStart As String = ""
                        Dim TaxNumberrunRunning As String = ""
                        Dim TaxPrefix1 As String = ""
                        Dim TaxPrefix2 As String = ""
                        Dim TaxYear As String = ""
                        Dim ListJoinNo As List(Of String)
                        Dim ListJoinBP As List(Of String)
                        Dim ListKDTrans As List(Of String)
                        Dim ListKDStatus As List(Of String)
                        Dim ListJoinRunningNo As List(Of String)
                        Dim ListJoinFullNo As List(Of String)

                        ListJoinNo = New List(Of String)
                        ListJoinBP = New List(Of String)
                        ListKDTrans = New List(Of String)
                        ListKDStatus = New List(Of String)
                        ListJoinRunningNo = New List(Of String)
                        ListJoinFullNo = New List(Of String)

                        Try
                            oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Checking Data", oMatrix.RowCount, False)
                            oProgBar.Value = 0
                        Catch ex As Exception
                        End Try

                        For i As Integer = 1 To oMatrix.RowCount
                            Try
                                oProgBar.Value = i
                                oProgBar.Text = "Checking Data " & i & "/ " & oMatrix.RowCount & ""
                            Catch ex As Exception
                            End Try
                            If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                Dim value1 As String = CType(oMatrix.Columns.Item(3).Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                Dim value2 As String = CType(oMatrix.Columns.Item(4).Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                Dim value3 As String = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                Dim value4 As String = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                Dim TaxDate As String = CType(oMatrix.Columns.Item(INDEX_TAXDATE_KELUARAN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                Dim NoJoin As String = ""
                                Dim NoJoinBP As String
                                Dim IndexList As Integer = 99999
                                If GenFPTypeGlobal = "2" Then
                                    NoJoin = CType(oMatrix.Columns.Item(7).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                    NoJoinBP = CType(oMatrix.Columns.Item(8).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                End If

                                If ListJoinNo.Contains(NoJoin) = True And NoJoin <> "" Then
                                    IndexList = ListJoinNo.FindIndex(Function(value As String)
                                                                         Return value = NoJoin
                                                                     End Function)
                                End If

                                If TaxYear <> Left(TaxDate, 4) And IndexList = 99999 Then
                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    Dim oRec2 As SAPbobsCOM.Recordset
                                    oRec2 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                                    'Dim halo As String = "CALL SOL_FP_NEXT_SEQUENCE '" & TaxDate & "', '-'"
                                    'oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE ('" & TaxDate & "', '-')")

                                    If oSQLConnection.ServerType = "SQL" Then
                                        oRec.DoQuery("EXEC [dbo].[SOL_FP_NEXT_SEQUENCE2] '" & TaxDate & "', '" & Branch.Value & "'")
                                    Else
                                        Dim halo As String = "CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '-')"
                                        oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch.Value & "')")
                                        'oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE '" & TaxDate & "', '-'")
                                    End If

                                    If (oRec.RecordCount > 0) Then

                                        TaxNumberStart = Right(oRec.Fields.Item(0).Value, 8)
                                        TaxNumberrunStart = Right(oRec.Fields.Item(0).Value, 8)
                                        TaxNumberrunStartpref = Left(oRec.Fields.Item(0).Value, 5)
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                        TaxYear = Left(TaxDate, 4)
                                        TaxPrefix1 = oRec.Fields.Item(0).Value.Substring(0, 3)
                                        TaxPrefix2 = oRec.Fields.Item(0).Value.Substring(3, 2)

                                        Dim Combine As New StringBuilder
                                        Dim Combine2 As New StringBuilder
                                        Combine.Append(value1)
                                        Combine.Append(value2)
                                        Combine.Append(".")
                                        Combine.Append(TaxPrefix1)
                                        Combine.Append("-")
                                        Combine.Append(TaxPrefix2)
                                        Combine.Append(".")
                                        Combine.Append(TaxNumberStart)

                                        Combine2.Append(TaxNumberrunStartpref)
                                        Combine2.Append(TaxNumberrunStart)

                                        'Dim query As String = "CALL SOL_FAKTUR_PAJAK_CHECK ('" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "')"
                                        'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"

                                        'oRec2.DoQuery(query)

                                        If oRec2.RecordCount = 0 Then
                                            oNoRunning.Value = Combine2.ToString
                                            oNoFaktur.Value = Combine.ToString
                                        Else
                                            oNoRunning.Value = ""
                                            oNoFaktur.Value = ""
                                            MessageBox.Show(oRec2.Fields.Item("error_message").Value)
                                        End If
                                        If GenFPTypeGlobal = "2" Then
                                            ListKDTrans.Add(value1)
                                            ListKDStatus.Add(value2)
                                            ListJoinNo.Add(NoJoin)
                                            ListJoinBP.Add(NoJoinBP)
                                            ListJoinRunningNo.Add(Combine2.ToString)
                                            ListJoinFullNo.Add(Combine.ToString)
                                        End If
                                    End If
                                ElseIf TaxYear <> Left(TaxDate, 4) And IndexList <> 99999 Then
                                    Dim oNoRunning As SAPbouiCOM.EditText
                                    oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    Dim oNoFaktur As SAPbouiCOM.EditText
                                    oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    oNoRunning.Value = ListJoinRunningNo(IndexList)
                                    oNoFaktur.Value = ListJoinFullNo(IndexList)
                                ElseIf TaxYear = Left(TaxDate, 4) And IndexList = 99999 Then
                                    Dim oRec3 As SAPbobsCOM.Recordset
                                    oRec3 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                                    If TaxNumberRunning = "" Then
                                        TaxNumberRunning = TaxNumberStart + 1
                                        TaxNumberrunRunning = TaxNumberrunStart + 1
                                    Else
                                        TaxNumberRunning = TaxNumberRunning + 1
                                        TaxNumberrunRunning = TaxNumberrunRunning + 1
                                    End If

                                    Dim LengthTaxRunning As Integer = TaxNumberrunRunning.Length

                                    If LengthTaxRunning < 8 Then
                                        Dim nolnol As New StringBuilder
                                        For a As Integer = 1 To 8 - LengthTaxRunning
                                            nolnol.Append("0")
                                        Next
                                        nolnol.Append(TaxNumberrunRunning)

                                        TaxNumberrunRunning = nolnol.ToString
                                    End If

                                    Dim Combine As New StringBuilder
                                    Dim Combine2 As New StringBuilder

                                    Combine.Append(value1)
                                    Combine.Append(value2)
                                    Combine.Append(".")
                                    Combine.Append(TaxPrefix1)
                                    Combine.Append("-")
                                    Combine.Append(TaxPrefix2)
                                    Combine.Append(".")
                                    'Combine.Append(TaxNumberRunning)
                                    Combine.Append(TaxNumberrunRunning)

                                    Combine2.Append(TaxNumberrunStartpref)
                                    Combine2.Append(TaxNumberrunRunning)

                                    'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"
                                    'oRec3.DoQuery(query)
                                    If oRec3.RecordCount = 0 Then
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoRunning.Value = Combine2.ToString

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoFaktur.Value = Combine.ToString
                                    Else
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoRunning.Value = ""

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoFaktur.Value = ""

                                        MessageBox.Show(oRec3.Fields.Item("error_message").Value)

                                    End If
                                    If GenFPTypeGlobal = "2" Then
                                        ListKDTrans.Add(value1)
                                        ListKDStatus.Add(value2)
                                        ListJoinNo.Add(NoJoin)
                                        ListJoinBP.Add(NoJoinBP)
                                        ListJoinRunningNo.Add(Combine2.ToString)
                                        ListJoinFullNo.Add(Combine.ToString)
                                    End If

                                ElseIf TaxYear = Left(TaxDate, 4) And IndexList <> 99999 Then
                                    Dim oNoRunning As SAPbouiCOM.EditText
                                    oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    Dim oNoFaktur As SAPbouiCOM.EditText
                                    oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    oNoRunning.Value = ListJoinRunningNo(IndexList)
                                    oNoFaktur.Value = ListJoinFullNo(IndexList)
                                End If
                            Else
                                Dim oNoFaktur As SAPbouiCOM.EditText
                                oNoFaktur = CType(oMatrix.Columns.Item(6).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                Dim oNoRunning As SAPbouiCOM.EditText
                                oNoRunning = CType(oMatrix.Columns.Item(5).Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                If oNoFaktur.Value <> "" Then
                                    oNoFaktur.Value = ""
                                    oNoRunning.Value = ""
                                End If
                            End If
                        Next
                        Try
                            oProgBar.Stop()
                            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                            oProgBar = Nothing
                            oSBOApplication.StatusBar.SetText("Generating Faktur Pajak Number Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                            oMatrix.AutoResizeColumns()
                        Catch ex As Exception
                        End Try
                    Else
                        oSBOApplication.MessageBox("Branch is missing!")
                    End If
                End If
            End If
        ElseIf pVal.ItemUID = "btnChoose" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form
                    oForm = oSBOApplication.Forms.Item(FormUID)
                    Dim title As String = oForm.Title.ToString
                    Dim oMatrix As SAPbouiCOM.Matrix
                    oMatrix = oForm.Items.Item("tblData").Specific

                    Dim success As Boolean = True
                    'Isi DocEntry untuk get dan update
                    Dim KeyA As String = ""
                    Dim KeyB As String = ""

                    'Array untuk cek jenis dokumen
                    Dim MyArray() As String = {"13", "18", "14", "19"}
                    'Loop through matrix
                    For i As Integer = 1 To oMatrix.RowCount
                        If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                            If CType(oMatrix.Columns.Item(INDEX_OBJTYPE_KELUARAN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value <> "" Then
                                'Check objType before adding to INDEX_OBJTYPE_KELUARAN

                                'If objType is in the array (AR Invoice, AP Invoice, AR Credit Memo, and AP Credit Memo) fill in KeyA
                                'Else (AR DP and AP DP) fill in KeyB
                                Dim value As String = CType(oMatrix.Columns.Item(INDEX_OBJTYPE_KELUARAN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                Dim result As String = ""
                                result = Array.Find(MyArray, Function(s) s = value)
                                If result IsNot Nothing Then
                                    KeyA += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                Else
                                    KeyB += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                End If
                            Else
                                oSBOApplication.StatusBar.SetText("Tax number cannot be empty at Document Number '" & CType(oMatrix.Columns.Item(9).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value & "'", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                                Exit Sub
                            End If

                        End If
                    Next i

                    'Trim last comma (,) character
                    If KeyA <> "" Then
                        KeyA = Left(KeyA, Len(KeyA) - 1)
                    End If

                    If KeyB <> "" Then
                        KeyB = Left(KeyB, Len(KeyB) - 1)
                    End If

                    'Check active activedocument

                    Dim type As String = CType(oForm.Items.Item("txtType").Specific, SAPbouiCOM.EditText).Value.ToString.Trim


                    If type = "PK" Then 'Pajak Keluaran (A/R Invoice dan A/R DP)
                        If success = True Then
                            getPajakKeluaran(KeyA, KeyB, "Invoice") ' loncat ke getpajakkeluaran dengan typeform Invoice
                        End If
                    ElseIf type = "PM" Then 'Pajak Masukan (A/P Invoice dan A/P DP)
                        getPajakMasukan(KeyA, KeyB)
                    ElseIf type = "RPK" Then 'Retur Keluaran (A/R Credit Memo)
                        getReturKeluaran(KeyA)
                    ElseIf type = "RPM" Then 'Retur Masukan (A/P Credit Memo)
                        getReturMasukan(KeyA)
                    ElseIf type = "DLM" Then 'Dokumen Lain Masukan 'Tambahan Ricky (A/P Invoice dan A/P DP dan A/P Credit Memo)

                        KeyA = ""
                        KeyB = ""

                        Dim APinv = "18"
                        Dim APDPinv = "204"
                        Dim APinvcm = "19"
                        Dim KeyC As String = "" 'Dokumen Lain Masukan Credit memo

                        For i As Integer = 1 To oMatrix.RowCount
                            If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                If CType(oMatrix.Columns.Item(INDEX_OBJTYPE_DOKLAIN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APinv Then
                                    KeyA += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                ElseIf CType(oMatrix.Columns.Item(INDEX_OBJTYPE_DOKLAIN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APDPinv Then
                                    KeyB += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                Else ' ap invoice credit memo - ELSE 'If CType(oMatrix.Columns.Item(INDEX_OBJTYPE).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APinv Then
                                    KeyC += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                End If
                            End If
                        Next i

                        'Trim last comma (,) character
                        'If KeyA <> "" Then
                        '    KeyA = Left(KeyA, Len(KeyA) - 1)
                        'End If

                        'If KeyB <> "" Then
                        '    KeyB = Left(KeyB, Len(KeyB) - 1)
                        'End If

                        'If KeyC <> "" Then
                        '    KeyC = Left(KeyC, Len(KeyC) - 1)
                        'End If

                        'getDokumenLainMasukan(KeyA, KeyB, KeyC)
                    End If
                    If success = True Then
                        oSBOApplication.Forms.Item("frmLookUp").Close()
                        oSBOApplication.StatusBar.SetText("Generating Excel Faktur Pajak Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                    End If
                End If
            End If
        End If
    End Sub

    Public Sub ItemEvent_Handler_ConfigInfo(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "BtnSetup" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED And pVal.BeforeAction = False And pVal.ActionSuccess = True Then
                Dim oForm As SAPbouiCOM.Form
                oForm = oSBOApplication.Forms.ActiveForm 'event saat button start setup di klik

                oSQLConnection.Name = oForm.Items.Item("Server").Specific.value
                oSQLConnection.ServerType = oSBOCompany.DbServerType.ToString
                oSQLConnection.ServerName = oForm.Items.Item("Server").Specific.value
                oSQLConnection.DatabaseName = oSBOCompany.CompanyDB
                oSQLConnection.UserName = oForm.Items.Item("DBUser").Specific.value
                oSQLConnection.Password = oForm.Items.Item("DBPass").Specific.value

                If oSBOCompany.DbServerType = SAPbobsCOM.BoDataServerTypes.dst_HANADB Then
                    oSQLConnection.ServerType = "HANA"
                Else
                    oSQLConnection.ServerType = "SQL"
                End If

                SetupPreferences() ' loncat ke SetupPreferences untuk load semua SP, UDF, UDT, UDO dll di addon
            End If
        End If
    End Sub

#End Region

#Region "EFaktur Gabungan"

    Public Sub ItemEvent_Handler_OffFaktur_GABUNGAN(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "Item_27" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_LOST_FOCUS Then
                If pVal.BeforeAction = False And pVal.ActionSuccess = True Then

                    Dim oForm As SAPbouiCOM.Form
                    Dim oCustomerCode As SAPbouiCOM.EditText
                    Dim oCustomerName As SAPbouiCOM.EditText
                    Dim oBillTo As SAPbouiCOM.EditText
                    Dim oCustomerNPWP As SAPbouiCOM.EditText
                    Dim oCustomerNameNPWP As SAPbouiCOM.EditText
                    Dim oCustomerKTP As SAPbouiCOM.EditText
                    Dim oCustomerAddress As SAPbouiCOM.EditText
                    oForm = oSBOApplication.Forms.Item(pVal.FormUID)
                    oCustomerCode = oForm.Items.Item("txtCSTCD").Specific
                    oCustomerName = oForm.Items.Item("txtCSTNM").Specific
                    oCustomerNPWP = oForm.Items.Item("txtNPWP").Specific
                    oCustomerNameNPWP = oForm.Items.Item("txtNNPWP").Specific
                    oCustomerKTP = oForm.Items.Item("txtKTP").Specific
                    oCustomerAddress = oForm.Items.Item("txtAlmt").Specific
                    oBillTo = oForm.Items.Item("Item_27").Specific
                    Dim oCmbBranch As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbBranch").Specific

                    Dim oRec As SAPbobsCOM.Recordset
                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    If oSQLConnection.ServerType = "SQL" Then
                        Dim Query As String = ("EXEC SOL_FORM_E_FAKTUR_GET_DETAIL_BP '" & oCustomerCode.Value & "', '" & oBillTo.Value & "' ")
                        oRec.DoQuery(Query)
                    Else
                        Dim Query As String = ("CALL SOL_FORM_E_FAKTUR_GET_DETAIL_BP ('" & oCustomerCode.Value & "' , '" & oBillTo.Value & "')")
                        oRec.DoQuery(Query)
                    End If

                    If (oRec.RecordCount > 0) Then
                        oCustomerName.Value = oRec.Fields.Item("CardName").Value
                        oCustomerNameNPWP.Value = oRec.Fields.Item("NameNPWP").Value
                        oCustomerNPWP.Value = oRec.Fields.Item("NPWP").Value
                        oCustomerKTP.Value = oRec.Fields.Item("KTP").Value
                        oCustomerAddress.Value = oRec.Fields.Item("ALAMAT").Value
                    End If

                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    Dim query2 As String = ""
                    If oSQLConnection.ServerType = "SQL" Then
                        query2 = "SELECT ""U_SOL_FP_CABANG"" as ""BRANCH"" FROM CRD1 WHERE CardCode = '" & oCustomerCode.Value & "' AND ""Address"" = '" & oBillTo.Value & "' AND ""AdresType"" ='B' "
                    Else
                        query2 = "SELECT ""U_SOL_FP_CABANG"" as ""BRANCH"" FROM CRD1 where ""CardCode"" = '" & oCustomerCode.Value & "' AND ""Address"" = '" & oBillTo.Value & "' AND ""AdresType"" ='B' "
                    End If
                    Try
                        oRec.DoQuery(query2)
                    Catch ex As Exception
                        Dim errorr As String = ex.Message
                    End Try

                    If oRec.RecordCount > 0 Then

                        If oCmbBranch.ValidValues.Count > 0 Then
                            For i As Integer = 0 To oCmbBranch.ValidValues.Count - 1
                                oCmbBranch.ValidValues.Remove(i, SAPbouiCOM.BoSearchKey.psk_Index)
                                oRec.MoveNext()
                            Next i
                        End If

                        oRec.MoveFirst()
                        For j As Integer = 0 To oRec.RecordCount - 1
                            oCmbBranch.ValidValues.Add((oRec.Fields.Item("BRANCH").Value), (oRec.Fields.Item("BRANCH").Value))
                            oRec.MoveNext()
                        Next j
                        oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    End If


                End If
            End If
        ElseIf pVal.ItemUID = "cmbTrans" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_COMBO_SELECT Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                    Dim oCmbTrans As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTrans").Specific
                    Dim oCmbPPNStat As SAPbouiCOM.ComboBox = oForm.Items.Item("txtPPNStat").Specific
                    If oCmbTrans.Selected.Value = "07" Then
                        Dim Count As Integer = oCmbPPNStat.ValidValues.Count - 1
                        'Do While Count >= 0
                        '    oCmbPPNStat.ValidValues.Remove(Count, SAPbouiCOM.BoSearchKey.psk_Index)
                        '    Count = Count - 1
                        'Loop
                        ClearValidValue(oCmbPPNStat)

                        oCmbPPNStat.ValidValues.Add("", "")
                        oCmbPPNStat.ValidValues.Add("1", "Kawasan Bebas")
                        oCmbPPNStat.ValidValues.Add("2", "Tempat Penimbunan Berikat")
                        oCmbPPNStat.ValidValues.Add("3", "Hibah dan Bantuan Luar Negeri")
                        oCmbPPNStat.ValidValues.Add("4", "Avtur")
                        oCmbPPNStat.ValidValues.Add("6", "Lainnya")
                        oCmbPPNStat.ValidValues.Add("7", "Kontraktor Perjanjian Karya Pengusahaan Pertambangan Batubara Generasi I")
                        oCmbPPNStat.ValidValues.Add("8", "Penyerahan yang PPN-nya Dibebaskan")
                        oCmbPPNStat.ValidValues.Add("9", "Penyerahan Aktiva (Pasal 16D UU PPN)")

                        oCmbPPNStat.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                    ElseIf oCmbTrans.Selected.Value = "08" Then
                        Dim Count As Integer = oCmbPPNStat.ValidValues.Count - 1
                        'Do While Count >= 0
                        '    oCmbPPNStat.ValidValues.Remove(Count, SAPbouiCOM.BoSearchKey.psk_Index)
                        '    Count = Count - 1
                        'Loop

                        ClearValidValue(oCmbPPNStat)

                        oCmbPPNStat.ValidValues.Add("", "")
                        oCmbPPNStat.ValidValues.Add("1", "BKP dan JKP Tertentu")
                        oCmbPPNStat.ValidValues.Add("2", "BKP Tertentu yang Bersifat Strategis")
                        oCmbPPNStat.ValidValues.Add("3", "Jasa Kebandarudaraan")
                        oCmbPPNStat.ValidValues.Add("4", "Lainnya")

                        oCmbPPNStat.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                    Else
                        Try
                            Dim Count As Integer = oCmbPPNStat.ValidValues.Count - 1
                            'Do While Count >= 0
                            '    oCmbPPNStat.ValidValues.Remove(Count, SAPbouiCOM.BoSearchKey.psk_Index)
                            '    Count = Count - 1
                            'Loop
                            oCmbPPNStat.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                            ClearValidValue(oCmbPPNStat)
                        Catch ex As Exception
                        End Try
                    End If
                End If
            End If
        ElseIf pVal.ItemUID = "btnGenFP" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then

                    Dim oForm As SAPbouiCOM.Form
                    oForm = oSBOApplication.Forms.Item(FormUID)

                    Dim TaxNumberStart As String = ""
                    Dim TaxNumberRunning As String = ""
                    Dim TaxNumberrunStartpref As String = ""
                    Dim TaxNumberrunStart As String = ""
                    Dim TaxNumberrunRunning As String = ""
                    Dim TaxPrefix1 As String = ""
                    Dim TaxPrefix2 As String = ""
                    Dim TaxYear As String = ""

                    Dim oNoFP As SAPbouiCOM.EditText
                    oNoFP = CType(oForm.Items.Item("txtNoFP").Specific, SAPbouiCOM.EditText)
                    Dim oNoRun As SAPbouiCOM.EditText
                    oNoRun = CType(oForm.Items.Item("txtNoRun").Specific, SAPbouiCOM.EditText)
                    If oNoFP.Value = "" And oNoRun.Value = "" Then


                        Dim value1 As String = CType(oForm.Items.Item("cmbTrans").Specific, SAPbouiCOM.ComboBox).Value
                        Dim value2 As String = CType(oForm.Items.Item("cmbStatus").Specific, SAPbouiCOM.ComboBox).Value
                        Dim TaxDate As String = CType(oForm.Items.Item("txtDate").Specific, SAPbouiCOM.EditText).Value
                        Dim Branch As String = CType(oForm.Items.Item("cmbBranch").Specific, SAPbouiCOM.ComboBox).Value

                        Dim oRec As SAPbobsCOM.Recordset
                        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                        If oSQLConnection.ServerType = "SQL" Then
                            oRec.DoQuery("EXEC [dbo].[SOL_FP_NEXT_SEQUENCE2] '" & TaxDate & "', '" & Branch & "'")
                        Else
                            Dim Query As String = "CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch.Trim() & "')"
                            oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE2 (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch.Trim() & "')")
                        End If

                        If (oRec.RecordCount > 0) Then
                            Dim halo As String = oRec.Fields.Item(0).Value
                            Dim newrunning As String = IIf(oRec.Fields.Item(0).Value Is Nothing, "", oRec.Fields.Item(0).Value)

                            If newrunning <> "" Then
                                TaxNumberStart = Right(oRec.Fields.Item(0).Value, 8)
                                TaxNumberrunStart = Right(oRec.Fields.Item(0).Value, 8)
                                TaxNumberrunStartpref = Left(oRec.Fields.Item(0).Value, 5)

                                TaxYear = Left(TaxDate, 4)
                                TaxPrefix1 = oRec.Fields.Item(0).Value.Substring(0, 3)
                                TaxPrefix2 = oRec.Fields.Item(0).Value.Substring(3, 2)

                                Dim Combine As New StringBuilder
                                Dim Combine2 As New StringBuilder
                                Combine.Append(value1.Trim())
                                Combine.Append(value2.Trim())
                                Combine.Append(".")
                                Combine.Append(TaxPrefix1.Trim())
                                Combine.Append("-")
                                Combine.Append(TaxPrefix2.Trim())
                                Combine.Append(".")
                                Combine.Append(TaxNumberStart.Trim())

                                Combine2.Append(TaxNumberrunStartpref.Trim())
                                Combine2.Append(TaxNumberrunStart.Trim())

                                oNoRun.Value = Combine2.ToString
                                oNoFP.Value = Combine.ToString

                            Else
                                oSBOApplication.MessageBox("Running Number FP Cannot Find or has Exceeded, Check Setting Faktur Pajak")
                            End If

                        Else
                            oSBOApplication.StatusBar.SetText("Tax date not found at Numbering Setting Faktur Pajak", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End If
                    Else
                        'oSBOApplication.StatusBar.SetText("No Running FP & No Faktur Pajak is not Empty!", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End If
                End If
            End If
        ElseIf pVal.ItemUID = "tblData" Then
            If pVal.ColUID = "txtChkBox" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED And Not (pVal.InnerEvent) Then
                    If pVal.Row > 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                            Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                            If oMatrix.Item.Enabled = True Then
                                Dim TotalDPP As SAPbouiCOM.EditText = oForm.Items.Item("txtDPP").Specific
                                Dim TotalPPN As SAPbouiCOM.EditText = oForm.Items.Item("txtPPN").Specific
                                Dim TotalDocument As SAPbouiCOM.EditText = oForm.Items.Item("txtTotal").Specific
                                Dim RowDPP As SAPbouiCOM.EditText = oMatrix.Columns.Item("DPP").Cells.Item(pVal.Row).Specific
                                Dim RowPPN As SAPbouiCOM.EditText = oMatrix.Columns.Item("PPN").Cells.Item(pVal.Row).Specific

                                Dim DecTotalDPP As Decimal = 0
                                Dim DecTotalPPN As Decimal = 0
                                Dim DecTotalDOC As Decimal = 0
                                Dim DecRowDPP As Decimal = 0
                                Dim DecRowPPN As Decimal = 0
                                Dim TotalDPPNew As Decimal = 0
                                Dim TotalPPNNew As Decimal = 0
                                Dim TotalDocNew As Decimal = 0

                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(pVal.Row).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                    'DecTotalDPP = ConTLocalSNF(TotalDPP.Value)
                                    'DecTotalPPN = ConTLocalSNF(TotalPPN.Value)
                                    'DecTotalDOC = ConTLocalSNF(TotalDocument.Value)

                                    'DecRowDPP = ConTLocalSNF(RowDPP.Value)
                                    'DecRowPPN = ConTLocalSNF(RowPPN.Value)

                                    DecTotalDPP = SBONumbertoDecimal(TotalDPP.Value)
                                    DecTotalPPN = SBONumbertoDecimal(TotalPPN.Value)
                                    DecTotalDOC = SBONumbertoDecimal(TotalDocument.Value)

                                    DecRowDPP = SBONumbertoDecimal(RowDPP.Value)
                                    DecRowPPN = SBONumbertoDecimal(RowPPN.Value)

                                    TotalDPPNew = DecTotalDPP + DecRowDPP
                                    TotalPPNNew = DecTotalPPN + DecRowPPN
                                    TotalDocNew = DecTotalDOC + (DecRowDPP + DecRowPPN)

                                    'TotalDPP.Value = ConFLocalSNF(TotalDPPNew)
                                    'TotalPPN.Value = ConFLocalSNF(TotalPPNNew)
                                    'TotalDocument.Value = ConFLocalSNF(TotalDocNew)

                                    TotalDPP.Value = DecimalToSBONumber(TotalDPPNew)
                                    TotalPPN.Value = DecimalToSBONumber(TotalPPNNew)
                                    TotalDocument.Value = DecimalToSBONumber(TotalDocNew)
                                Else

                                    'DecTotalDPP = ConTLocalSNF(TotalDPP.Value)
                                    'DecTotalPPN = ConTLocalSNF(TotalPPN.Value)
                                    'DecTotalDOC = ConTLocalSNF(TotalDocument.Value)

                                    'DecRowDPP = ConTLocalSNF(RowDPP.Value)
                                    'DecRowPPN = ConTLocalSNF(RowPPN.Value)

                                    DecTotalDPP = SBONumbertoDecimal(TotalDPP.Value)
                                    DecTotalPPN = SBONumbertoDecimal(TotalPPN.Value)
                                    DecTotalDOC = SBONumbertoDecimal(TotalDocument.Value)

                                    DecRowDPP = SBONumbertoDecimal(RowDPP.Value)
                                    DecRowPPN = SBONumbertoDecimal(RowPPN.Value)

                                    TotalDPPNew = DecTotalDPP - DecRowDPP
                                    TotalPPNNew = DecTotalPPN - DecRowPPN
                                    TotalDocNew = DecTotalDOC - (DecRowDPP + DecRowPPN)

                                    'TotalDPP.Value = ConFLocalSNF(TotalDPPNew)
                                    'TotalPPN.Value = ConFLocalSNF(TotalPPNNew)
                                    'TotalDocument.Value = ConFLocalSNF(TotalDocNew)


                                    TotalDPP.Value = DecimalToSBONumber(TotalDPPNew)
                                    TotalPPN.Value = DecimalToSBONumber(TotalPPNNew)
                                    TotalDocument.Value = DecimalToSBONumber(TotalDocNew)

                                End If
                            End If
                        End If
                    End If
                ElseIf pVal.EventType = SAPbouiCOM.BoEventTypes.et_DOUBLE_CLICK Then
                    If pVal.Row = 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)

                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim iRows As Integer = 0

                            oMatrix = oForm.Items.Item("tblData").Specific

                            If oMatrix.Item.Enabled = True Then
                                oForm.Freeze(True)

                                oMatrix.FlushToDataSource()

                                For i As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                    If oDBSOL_FPGB_DT.GetValue("U_SELECT", i) = "Y" Then
                                        iRows += 1
                                    End If
                                Next i

                                If iRows <> oMatrix.RowCount Then
                                    For n As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                        oDBSOL_FPGB_DT.SetValue("U_SELECT", n, "Y")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                Else
                                    For n As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                        oDBSOL_FPGB_DT.SetValue("U_SELECT", n, "N")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                End If

                                CalculateHeaderAmountGB(FormUID)

                                oForm.Freeze(False)
                            End If
                        End If
                    End If
                End If
            ElseIf pVal.ColUID = "DOCEN" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_MATRIX_LINK_PRESSED Then
                    If pVal.BeforeAction = True Then
                        BubbleEvent = False
                        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                        Try
                            If oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13a" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "18a" Then
                                oSBOApplication.OpenForm(18, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            Else
                                oSBOApplication.OpenForm(203, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            End If
                        Catch ex As Exception
                            oSBOApplication.MessageBox(ex.Message)
                        Finally
                            releaseObject(oForm)
                            releaseObject(oMatrix)
                        End Try
                    End If
                End If
            End If

        ElseIf pVal.ItemUID = "1" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then

                Dim oForm As SAPbouiCOM.Form
                Dim oDefaultButton As SAPbouiCOM.Button
                Dim Desc As String
                Dim oMatrix As SAPbouiCOM.Matrix
                Dim Checking As Boolean
                oForm = oSBOApplication.Forms.Item(FormUID)
                oMatrix = oForm.Items.Item("tblData").Specific
                oDefaultButton = oForm.Items.Item("1").Specific
                Desc = oDefaultButton.Caption.ToString
                Try
                    If Desc = "Add" Then
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True Then
                            Try
                                If oSBOApplication.MessageBox("Are you sure to Add this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                    oForm.Freeze(True)
                                    oMatrix.FlushToDataSource()
                                    Dim a As Integer = oDBSOL_FPGB_DT.Size - 1
                                    Do While a >= 0
                                        If oDBSOL_FPGB_DT.GetValue("U_SELECT", a) = "N" Then
                                            oDBSOL_FPGB_DT.RemoveRecord(a)
                                        End If
                                        a = a - 1
                                    Loop

                                    a = oDBSOL_FPGB_DT.Size - 1
                                    For N As Integer = 0 To a
                                        oDBSOL_FPGB_DT.SetValue("LineId", N, N + 1)
                                    Next

                                    oMatrix.LoadFromDataSource()

                                    'oDBSOL_FPGB_HD.SetValue("U_CHKINVNO", 0, "N")
                                    'oDBSOL_FPGB_HD.SetValue("U_INVNOFR", 0, "")
                                    'oDBSOL_FPGB_HD.SetValue("U_INVNOTO", 0, "")
                                    'oDBSOL_FPGB_HD.SetValue("U_CHKINVDT", 0, "N")
                                    'oDBSOL_FPGB_HD.SetValue("U_INVDTFT", 0, "")
                                    'oDBSOL_FPGB_HD.SetValue("U_INVDTTO", 0, "")
                                    'oDBSOL_FPGB_HD.SetValue("U_CHKEXP", 0, "N")
                                    GlobalDocNumGabungan = oForm.Items.Item("DocNum").Specific.value
                                    BubbleEvent = True
                                    oForm.Freeze(False)
                                Else
                                    BubbleEvent = False
                                End If

                            Catch ex As Exception
                                oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Try
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""


                                If GlobalDocNumGabungan <> "" Then

                                    'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '            """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '            """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '            """U_CHKEXP"" = 'N' " +
                                    '            "WHERE ""DocNum"" = '" & GlobalDocNumGabungan & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & GlobalDocNumGabungan & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)


                                    oForm.Freeze(True)
                                    'UpdateFPINVOICE(GlobalDocNumGabungan, "Gabungan")
                                    oForm.Freeze(False)

                                    'oSBOApplication.ActivateMenuItem("1291")

                                End If
                                GlobalDocNumGabungan = ""

                                '-----------------------------------------------------------------------------
                                'Dim oMtx1 As SAPbouiCOM.Matrix
                                'oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                'Query = "SELECT (MAX(""DocNum"")+1) as ""NewNum"" from ""@SOL_FP_TRX_GB_HD"""
                                'oRec.DoQuery(Query)
                                'If oRec.RecordCount > 0 Then
                                '    oDBSOL_FPGB_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                                'End If

                                'Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")

                                'oDBSOL_FPGB_HD.SetValue("U_DOCSTAT", 0, "N")
                                'oDBSOL_FPGB_HD.SetValue("U_TAXDATE", 0, datenow)
                                'oDBSOL_FPGB_HD.SetValue("U_DOCDATE", 0, datenow)

                                'Dim oCmbBranch As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbBranch").Specific
                                'Dim oCmbTrans As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTrans").Specific
                                'Dim oCmbStatus As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbStatus").Specific
                                'oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                                'oCmbTrans.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                                'oCmbStatus.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                                'oMtx1 = oForm.Items.Item("tblData").Specific
                                'CheckStatusGabungan()
                                'oMtx1.AutoResizeColumns()


                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If

                    ElseIf Desc = "Update" Or Desc = "OK" Then
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True And Desc = "Update" Then
                            If oSBOApplication.MessageBox("Are you sure to Update this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                oForm.Freeze(True)

                                Dim oStatus As SAPbouiCOM.ComboBox
                                oStatus = oForm.Items.Item("txtDocStat").Specific

                                If oStatus.Value.Trim() = "N" Or oStatus.Value.Trim() = "F" Then
                                    Dim DocNum As String
                                    DocNum = oForm.Items.Item("DocNum").Specific.value
                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                    Dim Query As String = ""

                                    'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '            """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '            """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '            """U_CHKEXP"" = 'N' " +
                                    '        "WHERE ""DocNum"" = '" & DocNum.Trim() & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNum.Trim() & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)
                                End If

                                oMatrix.FlushToDataSource()
                                Dim a As Integer = oDBSOL_FPGB_DT.Size - 1
                                Do While a >= 0
                                    If oDBSOL_FPGB_DT.GetValue("U_SELECT", a) = "N" Then
                                        oDBSOL_FPGB_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For N As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                    oDBSOL_FPGB_DT.SetValue("LineId", N, N + 1)
                                Next

                                oMatrix.LoadFromDataSource()

                                oDBSOL_FPGB_HD.SetValue("U_CHKINVNO", 0, "N")
                                oDBSOL_FPGB_HD.SetValue("U_INVNOFR", 0, "")
                                oDBSOL_FPGB_HD.SetValue("U_INVNOTO", 0, "")
                                oDBSOL_FPGB_HD.SetValue("U_CHKINVDT", 0, "N")
                                oDBSOL_FPGB_HD.SetValue("U_INVDTFT", 0, "")
                                oDBSOL_FPGB_HD.SetValue("U_INVDTTO", 0, "")
                                oDBSOL_FPGB_HD.SetValue("U_CHKEXP", 0, "N")

                                GlobalDocNumGabungan = oForm.Items.Item("DocNum").Specific.value
                                BubbleEvent = True
                                oForm.Freeze(False)
                            Else
                                BubbleEvent = False
                            End If
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Try
                                oForm.Freeze(True)

                                If GlobalDocNumGabungan <> "" Then
                                    'UpdateFPINVOICE(GlobalDocNumGabungan, "Gabungan")
                                End If
                                GlobalDocNumGabungan = ""
                                oForm.Freeze(False)
                                'oSBOApplication.ActivateMenuItem("1291")
                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If
                    End If
                Catch ex As Exception
                    Try
                        oForm.Freeze(False)
                    Catch exa As Exception
                    End Try
                    BubbleEvent = False
                    oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                End Try
            End If

        ElseIf pVal.ItemUID = "btnSearch" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form
                    Dim oMatrix As SAPbouiCOM.Matrix

                    Dim oCustomerCode As SAPbouiCOM.EditText

                    Dim oChkINVNO As SAPbouiCOM.CheckBox
                    Dim oChkINVFROM As SAPbouiCOM.EditText
                    Dim oChkINVTO As SAPbouiCOM.EditText

                    Dim oChkINVDT As SAPbouiCOM.CheckBox
                    Dim oChkDATEFROM As SAPbouiCOM.EditText
                    Dim oChkDATETO As SAPbouiCOM.EditText
                    Dim DateFrom As Date
                    Dim DateTo As Date

                    Dim oBillTo As SAPbouiCOM.EditText

                    Dim oChkOFF As SAPbouiCOM.CheckBox
                    Dim sqlText As String
                    Dim WhereStatementOINV As New StringBuilder
                    Dim WhereStatementODPI As New StringBuilder
                    Dim unionInclude As New StringBuilder
                    Dim AddedStatement As Integer = 0
                    Dim Exportedvalue As String

                    Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    oForm = oSBOApplication.Forms.Item(FormUID)
                    oMatrix = oForm.Items.Item("tblData").Specific

                    oCustomerCode = oForm.Items.Item("txtCSTCD").Specific

                    oChkINVNO = oForm.Items.Item("chkINVNO").Specific
                    oChkINVFROM = oForm.Items.Item("txtFRINVNO").Specific
                    oChkINVTO = oForm.Items.Item("txtTOINVNO").Specific

                    oChkINVDT = oForm.Items.Item("chkINVDT").Specific
                    oChkDATEFROM = oForm.Items.Item("txtFRINVDT").Specific
                    oChkDATETO = oForm.Items.Item("txtTOINVDT").Specific

                    Dim StringDateFrom As String = oForm.Items.Item("txtFRINVDT").Specific.Value.ToString.Trim
                    Dim StringDateTo As String = oForm.Items.Item("txtTOINVDT").Specific.Value.ToString.Trim

                    ' Dim branch As String = oForm.Items.Item("cmbBranch").Specific.Value.ToString.Trim

                    oBillTo = oForm.Items.Item("Item_27").Specific

                    oChkOFF = oForm.Items.Item("chkOFF").Specific
                    If oChkOFF.Checked = True Then
                        Exportedvalue = "1"
                    Else
                        Exportedvalue = "0"
                    End If
                    If oCustomerCode.Value <> "" Then
                        Try
                            '----------------------------------Create Where Statement-----------------------------------------------
                            oForm.Freeze(True)
                            Dim SelectedDocEntryARINV As New StringBuilder
                            Dim SelectedDocEntryARDPINV As New StringBuilder

                            SelectedDocEntryARINV.Append("0")
                            SelectedDocEntryARDPINV.Append("0")

                            oMatrix.FlushToDataSource()

                            If oDBSOL_FPGB_DT.Size - 1 >= 0 Then

                                Dim a As Integer = oDBSOL_FPGB_DT.Size - 1

                                Do While a >= 0
                                    If oDBSOL_FPGB_DT.GetValue("U_SELECT", a) <> "Y" Then
                                        oDBSOL_FPGB_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For b As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                    If oDBSOL_FPGB_DT.GetValue("U_DOCTYPE", b) = "13" Then
                                        SelectedDocEntryARINV.Append("," + oDBSOL_FPGB_DT.GetValue("U_DOCEN", b).ToString)
                                    Else
                                        SelectedDocEntryARDPINV.Append("," + oDBSOL_FPGB_DT.GetValue("U_DOCEN", b).ToString)
                                    End If
                                    oDBSOL_FPGB_DT.SetValue("LineId", b, b + 1)
                                Next
                            End If

                            '----------------------------------Create Where Statement-----------------------------------------------

                            WhereStatementOINV.Append("WHERE ")
                            WhereStatementODPI.Append("WHERE ")

                            If oSQLConnection.ServerType = "SQL" Then
                                unionInclude.Append("
                                   WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_GB_DT"" T1
								        INNER JOIN 
								        ""@SOL_FP_TRX_GB_HD"" T2
								        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
								        WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C''
                                     )

                                ")
                            Else
                                unionInclude.Append("
                                   WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_GB_DT"" T1
								        INNER JOIN 
								        ""@SOL_FP_TRX_GB_HD"" T2
								        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
								        WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C''
                                      )
                                ")
                            End If



                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" (OINV.""CardCode"" = ''" & oCustomerCode.Value & "'') AND  (OINV.""PayToCode"" = ''" & oBillTo.Value & "'') AND ")
                                WhereStatementODPI.Append(" (ODPI.""CardCode"" = ''" & oCustomerCode.Value & "'') AND (ODPI.""PayToCode"" = ''" & oBillTo.Value & "'') AND")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" (OINV.""CardCode"" = ''" & oCustomerCode.Value & "'') AND (OINV.""PayToCode"" = ''" & oBillTo.Value & "'') AND")
                                WhereStatementODPI.Append(" (ODPI.""CardCode"" = ''" & oCustomerCode.Value & "'') AND (ODPI.""PayToCode"" = ''" & oBillTo.Value & "'') AND")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkINVNO.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVDT.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OINV.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OINV.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" ISNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" IFNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            'If oChkOFF.Checked = True Then
                            '    If oSQLConnection.ServerType = "SQL" Then
                            '        WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                            '        WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                            '        AddedStatement = AddedStatement + 1
                            '    Else
                            '        WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                            '        WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                            '        AddedStatement = AddedStatement + 1
                            '    End If
                            'Else
                            '    If oSQLConnection.ServerType = "SQL" Then
                            '        WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ISNULL(OINV.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                            '        WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ISNULL(ODPI.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                            '        AddedStatement = AddedStatement + 1
                            '    Else
                            '        WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND IFNULL(OINV.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                            '        WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND IFNULL(ODPI.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                            '        AddedStatement = AddedStatement + 1
                            '    End If
                            'End If
                            If oChkOFF.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                    WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                    WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'Else
                            '    WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''2'' ")
                                WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''2'' ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''2'' ")
                                WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''2'' ")
                                AddedStatement = AddedStatement + 1
                            End If

                            Dim FinalWhareStatement As String = WhereStatementOINV.ToString

                            '----------------------------------Execute Query-----------------------------------------------

                            If oSQLConnection.ServerType = "SQL" Then
                                sqlText = "EXEC SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "' "
                            Else
                                sqlText = "CALL SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "')"
                            End If

                            oRec.DoQuery(sqlText)

                            '----------------------------------Insert data to matrix-----------------------------------------------

                            Dim DocDate As Date
                            Dim TaxDate As Date

                            If oRec.RecordCount > 0 Then
                                'oDBSOL_FPGB_DT.Clear()
                                'oMatrix.Clear()

                                'If oDBSOL_FPGB_DT.Size - 1 > 0 Then
                                '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                                '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                                'End If

                                If oRec.RecordCount > 0 Then
                                    For x As Integer = 0 To oRec.RecordCount - 1
                                        'If oDBSOL_FPGB_DT.Size = 0 Then
                                        '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                                        '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                                        'End If

                                        oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                                        oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1

                                        Dim RowMax As Integer = oDBSOL_FPGB_DT.Size - 1

                                        DocDate = oRec.Fields.Item("DocDate").Value
                                        TaxDate = oRec.Fields.Item("TaxDate").Value

                                        oDBSOL_FPGB_DT.SetValue("LineId", RowMax, RowMax + 1)
                                        oDBSOL_FPGB_DT.SetValue("U_SELECT", RowMax, "N")
                                        oDBSOL_FPGB_DT.SetValue("U_DOCTYPE", RowMax, oRec.Fields.Item("ObjType").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_DOCEN", RowMax, oRec.Fields.Item("DocEntry").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_DOCNUM", RowMax, oRec.Fields.Item("DocNum").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_REFNO", RowMax, oRec.Fields.Item("NumAtCard").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_DOCDATE", RowMax, DocDate.ToString("yyyyMMdd"))
                                        oDBSOL_FPGB_DT.SetValue("U_TAXDATE", RowMax, TaxDate.ToString("yyyyMMdd"))
                                        oDBSOL_FPGB_DT.SetValue("U_DOCCURR", RowMax, oRec.Fields.Item("Currency").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_DPP", RowMax, oRec.Fields.Item("DPP").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_PPN", RowMax, oRec.Fields.Item("PPN").Value)
                                        oDBSOL_FPGB_DT.SetValue("U_DOCTOT", RowMax, oRec.Fields.Item("DocTotal").Value)

                                        oRec.MoveNext()

                                        'If x < oRec.RecordCount - 1 Then
                                        '    oDBSOL_FPGB_DT.InsertRecord(oDBSOL_FPGB_DT.Size)
                                        '    oDBSOL_FPGB_DT.Offset = oDBSOL_FPGB_DT.Size - 1
                                        'End If
                                        '----------------------------------------------------------------------------------
                                    Next

                                    For N As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
                                        oDBSOL_FPGB_DT.SetValue("LineId", N, N + 1)
                                    Next

                                End If
                                oMatrix.LoadFromDataSource()
                            Else

                                oMatrix.LoadFromDataSource()
                                oSBOApplication.StatusBar.SetText("Invoice not Found!", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End If

                            oForm.Freeze(False)
                        Catch ex As Exception
                            oForm.Freeze(False)
                            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End Try
                    Else
                        oSBOApplication.StatusBar.SetText("Customer information is Missing!", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End If

                End If
            End If
        ElseIf pVal.ItemUID = "btnChoose" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Try
                        If oSBOApplication.MessageBox("Are you sure to Export this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)
                            Dim oDocNum As SAPbouiCOM.EditText
                            oDocNum = oForm.Items.Item("DocNum").Specific
                            Dim title As String = oForm.Title.ToString
                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim success As Boolean = True
                            oMatrix = oForm.Items.Item("tblData").Specific

                            'Isi DocEntry untuk get dan update
                            Dim KeyA As String = ""
                            Dim KeyB As String = ""

                            'Array untuk cek jenis dokumen
                            Dim MyArray() As String = {"13", "18", "14", "19"}
                            'Loop through matrix
                            For i As Integer = 1 To oMatrix.RowCount
                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                    If CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value <> "" Then
                                        'Check objType before adding to INDEX_OBJTYPE_KELUARAN

                                        'If objType is in the array (AR Invoice, AP Invoice, AR Credit Memo, and AP Credit Memo) fill in KeyA
                                        'Else (AR DP and AP DP) fill in KeyB
                                        Dim value As String = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                        Dim result As String = ""
                                        If value = "13a" Then
                                            value = "13"
                                        End If
                                        result = Array.Find(MyArray, Function(s) s = value)
                                        If result IsNot Nothing Then
                                            KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        Else
                                            KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        End If
                                    Else
                                        oSBOApplication.StatusBar.SetText("Tax number is Missing'" & CType(oMatrix.Columns.Item(9).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value & "'", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                                        Exit Sub
                                    End If

                                End If
                            Next i

                            'Trim last comma (,) character
                            If KeyA <> "" Then
                                KeyA = Left(KeyA, Len(KeyA) - 1)
                            End If

                            If KeyB <> "" Then
                                KeyB = Left(KeyB, Len(KeyB) - 1)
                            End If

                            'Check active activedocument


                            getPajakKeluaran(KeyA, KeyB, "Gabungan") ' loncat ke getpajakkeluaran dengan typeform Gabungan


                            'If oDBSOL_FPGB_HD.GetValue("U_DOCSTAT", 0) <> "L" Then
                            If (GlobalVar.ExportedFile = True) Then
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""
                                'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'E' " +
                                '                "WHERE ""DocNum"" = '" & oDocNum.Value & "'"
                                'oRec.DoQuery(Query)

                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntry As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData

                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & oDocNum.Value & "'")
                                DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntry)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "E")
                                oGeneralService.Update(oGeneralData)

                            End If

                            'End If

                            oSBOApplication.ActivateMenuItem("1304")

                            If (GlobalVar.ExportedFile = True) Then
                                oSBOApplication.StatusBar.SetText("Success Export CSV", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                            ElseIf (GlobalVar.ExportedFile = False) Then
                                oSBOApplication.StatusBar.SetText("Cancel Export CSV", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                            End If

                        End If
                    Catch ex As Exception
                        oSBOApplication.MessageBox(ex.Message)
                    End Try
                End If
            End If
        End If
    End Sub

    Public Sub DataEvent_Handler_Gabungan(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
        If BusinessObjectInfo.EventType = SAPbouiCOM.BoEventTypes.et_FORM_DATA_LOAD Then
            If BusinessObjectInfo.BeforeAction = False And BusinessObjectInfo.ActionSuccess = True Then
                CheckStatusGabungan()
            End If
        End If
    End Sub

    Private Sub CheckStatusGabungan()
        Dim oFormFPGabungan As SAPbouiCOM.Form
        Dim oMatrix As SAPbouiCOM.Matrix
        Dim oDefaultButton As SAPbouiCOM.Button
        Dim oStatus As SAPbouiCOM.ComboBox
        Dim status As String

        oFormFPGabungan = oSBOApplication.Forms.Item("frmOffFKGABUNGAN")
        oMatrix = oFormFPGabungan.Items.Item("tblData").Specific
        oDefaultButton = oFormFPGabungan.Items.Item("1").Specific
        oStatus = oFormFPGabungan.Items.Item("txtDocStat").Specific
        Try
            oFormFPGabungan.Freeze(True)

            If oStatus.Value = "N" Then

                oFormFPGabungan.Items.Item("haha").Click()
                oFormFPGabungan.Items.Item("txtCSTCD").Enabled = True
                oFormFPGabungan.Items.Item("txtCSTNM").Enabled = False
                oFormFPGabungan.Items.Item("txtNNPWP").Enabled = True
                oFormFPGabungan.Items.Item("txtNPWP").Enabled = True
                oFormFPGabungan.Items.Item("txtKTP").Enabled = True
                oFormFPGabungan.Items.Item("txtAlmt").Enabled = True
                oFormFPGabungan.Items.Item("chkINVNO").Enabled = True
                oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = True
                oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = True
                oFormFPGabungan.Items.Item("chkINVDT").Enabled = True
                oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = True
                oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = True
                oFormFPGabungan.Items.Item("chkOFF").Enabled = True
                oFormFPGabungan.Items.Item("txtRemark").Enabled = True
                oFormFPGabungan.Items.Item("txtNotes").Enabled = False
                oFormFPGabungan.Items.Item("DocNum").Enabled = False
                oFormFPGabungan.Items.Item("txtDocDate").Enabled = True
                oFormFPGabungan.Items.Item("txtDocStat").Enabled = False
                oFormFPGabungan.Items.Item("txtDate").Enabled = True
                oFormFPGabungan.Items.Item("cmbBranch").Enabled = False
                oFormFPGabungan.Items.Item("cmbTrans").Enabled = True
                oFormFPGabungan.Items.Item("cmbStatus").Enabled = True
                oFormFPGabungan.Items.Item("txtNoRun").Enabled = True
                oFormFPGabungan.Items.Item("txtNoFP").Enabled = True
                oFormFPGabungan.Items.Item("txtPPNStat").Enabled = True
                oFormFPGabungan.Items.Item("txtKMK").Enabled = True
                oFormFPGabungan.Items.Item("txtDPP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPN").Enabled = False
                oFormFPGabungan.Items.Item("txtTotal").Enabled = False
                oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = True

                oFormFPGabungan.Items.Item("btnGenFP").Enabled = True
                oFormFPGabungan.Items.Item("btnSearch").Enabled = True
                oFormFPGabungan.Items.Item("btnChoose").Enabled = False
                oFormFPGabungan.Items.Item("1").Enabled = True

                oFormFPGabungan.Items.Item("txtNNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtKTP").Enabled = False
                oFormFPGabungan.Items.Item("txtAlmt").Enabled = False



                oMatrix.Item.Enabled = True

                oFormFPGabungan.Items.Item("txtCSTCD").Click()

            ElseIf oStatus.Value = "O" Or oStatus.Value = "F" Then

                oFormFPGabungan.Items.Item("haha").Click()
                oFormFPGabungan.Items.Item("txtCSTCD").Enabled = False
                oFormFPGabungan.Items.Item("txtCSTNM").Enabled = False
                oFormFPGabungan.Items.Item("txtNNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtKTP").Enabled = False
                oFormFPGabungan.Items.Item("txtAlmt").Enabled = False
                oFormFPGabungan.Items.Item("chkINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = False
                oFormFPGabungan.Items.Item("chkINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = False
                oFormFPGabungan.Items.Item("chkOFF").Enabled = False
                oFormFPGabungan.Items.Item("txtRemark").Enabled = False
                oFormFPGabungan.Items.Item("txtNotes").Enabled = False
                oFormFPGabungan.Items.Item("DocNum").Enabled = False
                oFormFPGabungan.Items.Item("txtDocDate").Enabled = False
                oFormFPGabungan.Items.Item("txtDocStat").Enabled = False
                oFormFPGabungan.Items.Item("txtDate").Enabled = False
                oFormFPGabungan.Items.Item("cmbBranch").Enabled = False
                oFormFPGabungan.Items.Item("cmbTrans").Enabled = False
                oFormFPGabungan.Items.Item("cmbStatus").Enabled = False
                oFormFPGabungan.Items.Item("txtNoRun").Enabled = False
                oFormFPGabungan.Items.Item("txtNoFP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPNStat").Enabled = False
                oFormFPGabungan.Items.Item("txtKMK").Enabled = False
                oFormFPGabungan.Items.Item("txtDPP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPN").Enabled = False
                oFormFPGabungan.Items.Item("txtTotal").Enabled = False
                oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = False

                oFormFPGabungan.Items.Item("btnGenFP").Enabled = False
                oFormFPGabungan.Items.Item("btnSearch").Enabled = False
                oFormFPGabungan.Items.Item("btnChoose").Enabled = True
                oFormFPGabungan.Items.Item("1").Enabled = True
                oFormFPGabungan.Items.Item("Item_27").Enabled = False

                oMatrix.Item.Enabled = False

                oFormFPGabungan.Items.Item("txtCSTCD").Click()


                'oFormFPGabungan.Items.Item("haha").Click()
                'oFormFPGabungan.Items.Item("txtCSTCD").Enabled = True
                'oFormFPGabungan.Items.Item("txtCSTNM").Enabled = False
                'oFormFPGabungan.Items.Item("txtNNPWP").Enabled = True
                'oFormFPGabungan.Items.Item("txtNPWP").Enabled = True
                'oFormFPGabungan.Items.Item("txtKTP").Enabled = True
                'oFormFPGabungan.Items.Item("txtAlmt").Enabled = True
                'oFormFPGabungan.Items.Item("chkINVNO").Enabled = True
                'oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = True
                'oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = True
                'oFormFPGabungan.Items.Item("chkINVDT").Enabled = True
                'oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = True
                'oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = True
                'oFormFPGabungan.Items.Item("chkOFF").Enabled = True
                'oFormFPGabungan.Items.Item("txtRemark").Enabled = True
                'oFormFPGabungan.Items.Item("txtNotes").Enabled = False
                'oFormFPGabungan.Items.Item("DocNum").Enabled = False
                'oFormFPGabungan.Items.Item("txtDocDate").Enabled = True
                'oFormFPGabungan.Items.Item("txtDocStat").Enabled = False
                'oFormFPGabungan.Items.Item("txtDate").Enabled = True
                'oFormFPGabungan.Items.Item("cmbBranch").Enabled = True
                'oFormFPGabungan.Items.Item("cmbTrans").Enabled = True
                'oFormFPGabungan.Items.Item("cmbStatus").Enabled = True
                'oFormFPGabungan.Items.Item("txtNoRun").Enabled = True
                'oFormFPGabungan.Items.Item("txtNoFP").Enabled = True
                'oFormFPGabungan.Items.Item("txtPPNStat").Enabled = True
                'oFormFPGabungan.Items.Item("txtKMK").Enabled = True
                'oFormFPGabungan.Items.Item("txtDPP").Enabled = False
                'oFormFPGabungan.Items.Item("txtPPN").Enabled = False
                'oFormFPGabungan.Items.Item("txtTotal").Enabled = False
                'oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = True

                'oFormFPGabungan.Items.Item("btnGenFP").Enabled = True
                'oFormFPGabungan.Items.Item("btnSearch").Enabled = True
                'oFormFPGabungan.Items.Item("btnChoose").Enabled = True
                'oFormFPGabungan.Items.Item("1").Enabled = True

                'oMatrix.Item.Enabled = True

                'oFormFPGabungan.Items.Item("txtCSTCD").Click()

            ElseIf oStatus.Value = "L" Or oStatus.Value = "E" Then

                oFormFPGabungan.Items.Item("haha").Click()
                oFormFPGabungan.Items.Item("txtCSTCD").Enabled = False
                oFormFPGabungan.Items.Item("txtCSTNM").Enabled = False
                oFormFPGabungan.Items.Item("txtNNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtKTP").Enabled = False
                oFormFPGabungan.Items.Item("txtAlmt").Enabled = False
                'oFormFPGabungan.Items.Item("txtADDR").Enabled = False
                oFormFPGabungan.Items.Item("chkINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = False
                oFormFPGabungan.Items.Item("chkINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = False
                oFormFPGabungan.Items.Item("chkOFF").Enabled = False
                oFormFPGabungan.Items.Item("txtRemark").Enabled = False
                oFormFPGabungan.Items.Item("txtNotes").Enabled = False
                oFormFPGabungan.Items.Item("DocNum").Enabled = False
                oFormFPGabungan.Items.Item("txtDocDate").Enabled = False
                oFormFPGabungan.Items.Item("txtDocStat").Enabled = False
                oFormFPGabungan.Items.Item("txtDate").Enabled = False
                oFormFPGabungan.Items.Item("cmbBranch").Enabled = False
                oFormFPGabungan.Items.Item("cmbTrans").Enabled = False
                oFormFPGabungan.Items.Item("cmbStatus").Enabled = False
                oFormFPGabungan.Items.Item("txtNoRun").Enabled = False
                oFormFPGabungan.Items.Item("txtNoFP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPNStat").Enabled = False
                oFormFPGabungan.Items.Item("txtKMK").Enabled = False
                oFormFPGabungan.Items.Item("txtDPP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPN").Enabled = False
                oFormFPGabungan.Items.Item("txtTotal").Enabled = False
                oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = False

                oFormFPGabungan.Items.Item("btnGenFP").Enabled = False
                oFormFPGabungan.Items.Item("btnSearch").Enabled = False
                oFormFPGabungan.Items.Item("btnChoose").Enabled = True
                oFormFPGabungan.Items.Item("1").Enabled = True
                oFormFPGabungan.Items.Item("Item_27").Enabled = False

                oMatrix.Item.Enabled = False

                oFormFPGabungan.Items.Item("txtCSTCD").Click()

            ElseIf oStatus.Value = "C" Then

                oFormFPGabungan.Items.Item("haha").Click()
                oFormFPGabungan.Items.Item("txtCSTCD").Enabled = False
                oFormFPGabungan.Items.Item("txtCSTNM").Enabled = False
                oFormFPGabungan.Items.Item("txtNNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtNPWP").Enabled = False
                oFormFPGabungan.Items.Item("txtKTP").Enabled = False
                oFormFPGabungan.Items.Item("txtAlmt").Enabled = False
                'oFormFPGabungan.Items.Item("txtADDR").Enabled = False
                oFormFPGabungan.Items.Item("chkINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = False
                oFormFPGabungan.Items.Item("chkINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = False
                oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = False
                oFormFPGabungan.Items.Item("chkOFF").Enabled = False
                oFormFPGabungan.Items.Item("txtRemark").Enabled = False
                oFormFPGabungan.Items.Item("txtNotes").Enabled = False
                oFormFPGabungan.Items.Item("DocNum").Enabled = False
                oFormFPGabungan.Items.Item("txtDocDate").Enabled = False
                oFormFPGabungan.Items.Item("txtDocStat").Enabled = False
                oFormFPGabungan.Items.Item("txtDate").Enabled = False
                oFormFPGabungan.Items.Item("cmbBranch").Enabled = False
                oFormFPGabungan.Items.Item("cmbTrans").Enabled = False
                oFormFPGabungan.Items.Item("cmbStatus").Enabled = False
                oFormFPGabungan.Items.Item("txtNoRun").Enabled = False
                oFormFPGabungan.Items.Item("txtNoFP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPNStat").Enabled = False
                oFormFPGabungan.Items.Item("txtKMK").Enabled = False
                oFormFPGabungan.Items.Item("txtDPP").Enabled = False
                oFormFPGabungan.Items.Item("txtPPN").Enabled = False
                oFormFPGabungan.Items.Item("txtTotal").Enabled = False
                oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = False

                oFormFPGabungan.Items.Item("btnGenFP").Enabled = False
                oFormFPGabungan.Items.Item("btnSearch").Enabled = False
                oFormFPGabungan.Items.Item("btnChoose").Enabled = False
                oFormFPGabungan.Items.Item("1").Enabled = True
                oFormFPGabungan.Items.Item("Item_27").Enabled = False

                oMatrix.Item.Enabled = False

                oFormFPGabungan.Items.Item("txtCSTCD").Click()
            End If

            oFormFPGabungan.Freeze(False)
        Catch ex As Exception
            oFormFPGabungan.Freeze(False)
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub EnableAlFieldGabungan()
        Try
            Dim oXMLDoc As New XmlDocument
            Dim oFormFPGabungan As SAPbouiCOM.Form
            Dim oMatrix As SAPbouiCOM.Matrix

            oFormFPGabungan = oSBOApplication.Forms.Item("frmOffFKGABUNGAN")
            oMatrix = oFormFPGabungan.Items.Item("tblData").Specific

            oFormFPGabungan.Items.Item("haha").Click()
            oFormFPGabungan.Items.Item("txtCSTCD").Enabled = True
            oFormFPGabungan.Items.Item("txtCSTNM").Enabled = True
            oFormFPGabungan.Items.Item("txtNNPWP").Enabled = True
            oFormFPGabungan.Items.Item("txtNPWP").Enabled = True
            oFormFPGabungan.Items.Item("txtKTP").Enabled = True
            oFormFPGabungan.Items.Item("txtAlmt").Enabled = True
            oFormFPGabungan.Items.Item("chkINVNO").Enabled = True
            oFormFPGabungan.Items.Item("txtFRINVNO").Enabled = True
            oFormFPGabungan.Items.Item("txtTOINVNO").Enabled = True
            oFormFPGabungan.Items.Item("chkINVDT").Enabled = True
            oFormFPGabungan.Items.Item("txtFRINVDT").Enabled = True
            oFormFPGabungan.Items.Item("txtTOINVDT").Enabled = True
            oFormFPGabungan.Items.Item("chkOFF").Enabled = True
            oFormFPGabungan.Items.Item("txtRemark").Enabled = True
            oFormFPGabungan.Items.Item("txtNotes").Enabled = True
            oFormFPGabungan.Items.Item("DocNum").Enabled = True
            oFormFPGabungan.Items.Item("txtDocDate").Enabled = True
            oFormFPGabungan.Items.Item("txtDocStat").Enabled = True
            oFormFPGabungan.Items.Item("txtDate").Enabled = True
            oFormFPGabungan.Items.Item("cmbBranch").Enabled = True
            oFormFPGabungan.Items.Item("cmbTrans").Enabled = True
            oFormFPGabungan.Items.Item("cmbStatus").Enabled = True
            oFormFPGabungan.Items.Item("txtNoRun").Enabled = True
            oFormFPGabungan.Items.Item("txtNoFP").Enabled = True
            oFormFPGabungan.Items.Item("txtPPNStat").Enabled = True
            oFormFPGabungan.Items.Item("txtKMK").Enabled = True
            oFormFPGabungan.Items.Item("txtDPP").Enabled = True
            oFormFPGabungan.Items.Item("txtPPN").Enabled = True
            oFormFPGabungan.Items.Item("txtTotal").Enabled = True
            oFormFPGabungan.Items.Item("txtDUKUNG").Enabled = True

            oFormFPGabungan.Items.Item("btnGenFP").Enabled = False
            oFormFPGabungan.Items.Item("btnSearch").Enabled = False
            oFormFPGabungan.Items.Item("btnChoose").Enabled = False
            oFormFPGabungan.Items.Item("1").Enabled = True

            oMatrix.Item.Enabled = False

            oFormFPGabungan.Items.Item("txtCSTCD").Click()

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try

    End Sub

    Public Sub CalculateHeaderAmountGB(ByVal FormUID As String)
        Dim oForm As SAPbouiCOM.Form
        oForm = oSBOApplication.Forms.Item(FormUID)

        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
        Dim iRows As Integer = 0

        oMatrix.FlushToDataSource()

        Dim DPPTemp As Decimal
        Dim PPNTemp As Decimal

        oMatrix = oForm.Items.Item("tblData").Specific

        For i As Integer = 0 To oDBSOL_FPGB_DT.Size - 1
            If oDBSOL_FPGB_DT.GetValue("U_SELECT", i) = "Y" Then

                'DPPTemp = DPPTemp + ConTLocalSNF(oDBSOL_FPGB_DT.GetValue("U_DPP", i))
                'PPNTemp = PPNTemp + ConTLocalSNF(oDBSOL_FPGB_DT.GetValue("U_PPN", i))

                DPPTemp = DPPTemp + SBONumbertoDecimal(oDBSOL_FPGB_DT.GetValue("U_DPP", i))
                PPNTemp = PPNTemp + SBONumbertoDecimal(oDBSOL_FPGB_DT.GetValue("U_PPN", i))

                'DPPTemp = DPPTemp + ConTLocalSNF(colDPP.Value)
                'PPNTemp = PPNTemp + ConTLocalSNF(colPPN.Value)

            End If
        Next i

        oDBSOL_FPGB_HD.SetValue("U_TDPP", 0, DPPTemp)
        oDBSOL_FPGB_HD.SetValue("U_TPPN", 0, PPNTemp)
        oDBSOL_FPGB_HD.SetValue("U_DOCTOT", 0, (DPPTemp + PPNTemp))
    End Sub

    Public Sub RightClickEvent_GB(ByRef eventinfo As SAPbouiCOM.ContextMenuInfo, ByRef bubbleEvent As Boolean)

        If eventinfo.ItemUID <> "tblData" And eventinfo.ItemUID <> "tblSummary" Then
            If eventinfo.BeforeAction = True And eventinfo.ActionSuccess = False Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm

                Dim Status As SAPbouiCOM.ComboBox = oForm.Items.Item("txtDocStat").Specific

                Dim oMenus As SAPbouiCOM.Menus
                Dim oMenuItem As SAPbouiCOM.MenuItem
                Dim oCreationPackage As SAPbouiCOM.MenuCreationParams

                oCreationPackage = oSBOApplication.CreateObject(SAPbouiCOM.BoCreatableObjectType.cot_MenuCreationParams)
                oCreationPackage.Type = SAPbouiCOM.BoMenuType.mt_STRING

                oMenuItem = oSBOApplication.Menus.Item("1280")
                oMenus = oMenuItem.SubMenus

                If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")

                If Status.Selected.Value = "O" Then
                    'If (oMenus.Exists("CLS") = False) Then
                    '    oCreationPackage.UniqueID = "CLS"
                    '    oCreationPackage.String = "Close Document"
                    '    oCreationPackage.Position = 1
                    '    oCreationPackage.Enabled = True
                    '    oMenus.AddEx(oCreationPackage)
                    'End If
                    If (oMenus.Exists("CNC") = False) Then
                        oCreationPackage.UniqueID = "CNC"
                        oCreationPackage.String = "Cancel Document"
                        oCreationPackage.Position = 2
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If
                ElseIf Status.Selected.Value = "E" Then
                    If (oMenus.Exists("CLS") = False) Then
                        oCreationPackage.UniqueID = "CLS"
                        oCreationPackage.String = "Close Document"
                        oCreationPackage.Position = 1
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If

                    Dim oRec As SAPbobsCOM.Recordset
                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRec.DoQuery("SELECT 1 FROM OUSR WHERE ""USER_CODE"" = '" & oSBOCompany.UserName & "' AND ""U_SOL_FP_ROLE"" = '1' ")

                    If (oMenus.Exists("CNC") = False) And oRec.RecordCount > 0 Then
                        oCreationPackage.UniqueID = "CNC"
                        oCreationPackage.String = "Cancel Document"
                        oCreationPackage.Position = 2
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If

                Else
                    If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                    If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")
                End If
            End If
        End If
    End Sub

#End Region

#Region "EFaktur Gunggung"

    Public Sub ItemEvent_Handler_OffFaktur_GUNGGUNG(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "tblData" Then
            If pVal.ColUID = "txtChkBox" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                    If pVal.Row > 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                            Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                            If oMatrix.Item.Enabled = True Then
                                Dim TotalDPP As SAPbouiCOM.EditText = oForm.Items.Item("txtDPP").Specific
                                Dim TotalPPN As SAPbouiCOM.EditText = oForm.Items.Item("txtPPN").Specific
                                Dim TotalDocument As SAPbouiCOM.EditText = oForm.Items.Item("txtTotal").Specific
                                Dim RowDPP As SAPbouiCOM.EditText = oMatrix.Columns.Item("DPP").Cells.Item(pVal.Row).Specific
                                Dim RowPPN As SAPbouiCOM.EditText = oMatrix.Columns.Item("PPN").Cells.Item(pVal.Row).Specific

                                Dim DecTotalDPP As Decimal = 0
                                Dim DecTotalPPN As Decimal = 0
                                Dim DecTotalDOC As Decimal = 0
                                Dim DecRowDPP As Decimal = 0
                                Dim DecRowPPN As Decimal = 0
                                Dim TotalDPPNew As Decimal = 0
                                Dim TotalPPNNew As Decimal = 0
                                Dim TotalDocNew As Decimal = 0

                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(pVal.Row).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                    'DecTotalDPP = ConTLocalSNF(TotalDPP.Value)
                                    'DecTotalPPN = ConTLocalSNF(TotalPPN.Value)
                                    'DecTotalDOC = ConTLocalSNF(TotalDocument.Value)

                                    'DecRowDPP = ConTLocalSNF(RowDPP.Value)
                                    'DecRowPPN = ConTLocalSNF(RowPPN.Value)

                                    DecTotalDPP = SBONumbertoDecimal(TotalDPP.Value)
                                    DecTotalPPN = SBONumbertoDecimal(TotalPPN.Value)
                                    DecTotalDOC = SBONumbertoDecimal(TotalDocument.Value)

                                    DecRowDPP = SBONumbertoDecimal(RowDPP.Value)
                                    DecRowPPN = SBONumbertoDecimal(RowPPN.Value)

                                    TotalDPPNew = DecTotalDPP + DecRowDPP
                                    TotalPPNNew = DecTotalPPN + DecRowPPN
                                    TotalDocNew = DecTotalDOC + (DecRowDPP + DecRowPPN)

                                    'TotalDPP.Value = ConFLocalSNF(TotalDPPNew)
                                    'TotalPPN.Value = ConFLocalSNF(TotalPPNNew)
                                    'TotalDocument.Value = ConFLocalSNF(TotalDocNew)
                                    TotalDPP.Value = DecimalToSBONumber(TotalDPPNew)
                                    TotalPPN.Value = DecimalToSBONumber(TotalPPNNew)
                                    TotalDocument.Value = DecimalToSBONumber(TotalDocNew)

                                Else

                                    'DecTotalDPP = ConTLocalSNF(TotalDPP.Value)
                                    'DecTotalPPN = ConTLocalSNF(TotalPPN.Value)
                                    'DecTotalDOC = ConTLocalSNF(TotalDocument.Value)

                                    'DecRowDPP = ConTLocalSNF(RowDPP.Value)
                                    'DecRowPPN = ConTLocalSNF(RowPPN.Value)

                                    DecTotalDPP = SBONumbertoDecimal(TotalDPP.Value)
                                    DecTotalPPN = SBONumbertoDecimal(TotalPPN.Value)
                                    DecTotalDOC = SBONumbertoDecimal(TotalDocument.Value)

                                    DecRowDPP = SBONumbertoDecimal(RowDPP.Value)
                                    DecRowPPN = SBONumbertoDecimal(RowPPN.Value)

                                    TotalDPPNew = DecTotalDPP - DecRowDPP
                                    TotalPPNNew = DecTotalPPN - DecRowPPN
                                    TotalDocNew = DecTotalDOC - (DecRowDPP + DecRowPPN)

                                    'TotalDPP.Value = ConFLocalSNF(TotalDPPNew)
                                    'TotalPPN.Value = ConFLocalSNF(TotalPPNNew)
                                    'TotalDocument.Value = ConFLocalSNF(TotalDocNew)

                                    TotalDPP.Value = DecimalToSBONumber(TotalDPPNew)
                                    TotalPPN.Value = DecimalToSBONumber(TotalPPNNew)
                                    TotalDocument.Value = DecimalToSBONumber(TotalDocNew)
                                End If
                            End If
                        End If
                    End If
                ElseIf pVal.EventType = SAPbouiCOM.BoEventTypes.et_DOUBLE_CLICK Then
                    If pVal.Row = 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)

                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim iRows As Integer = 0

                            oMatrix = oForm.Items.Item("tblData").Specific

                            If oMatrix.Item.Enabled = True Then
                                oForm.Freeze(True)

                                oMatrix.FlushToDataSource()

                                For i As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                    If oDBSOL_FPGG_DT.GetValue("U_SELECT", i) = "Y" Then
                                        iRows += 1
                                    End If
                                Next i

                                If iRows <> oMatrix.RowCount Then
                                    For n As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                        oDBSOL_FPGG_DT.SetValue("U_SELECT", n, "Y")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                Else
                                    For n As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                        oDBSOL_FPGG_DT.SetValue("U_SELECT", n, "N")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                End If

                                CalculateHeaderAmountGG(FormUID)

                                oForm.Freeze(False)
                            End If
                        End If
                    End If
                End If
            ElseIf pVal.ColUID = "DOCEN" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_MATRIX_LINK_PRESSED Then
                    If pVal.BeforeAction = True Then
                        BubbleEvent = False
                        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                        Try
                            If oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13a" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            Else
                                oSBOApplication.OpenForm(203, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            End If
                        Catch ex As Exception
                            oSBOApplication.MessageBox(ex.Message)
                        Finally
                            releaseObject(oForm)
                            releaseObject(oMatrix)
                        End Try
                    End If
                End If
            ElseIf pVal.ColUID = "DTBRANCH" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_COMBO_SELECT Then
                    If pVal.BeforeAction = False Then
                        BubbleEvent = False
                        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                        Try
                            oDBSOL_FPMS_DT.SetValue("U_NORUN", pVal.Row, "")
                            oDBSOL_FPMS_DT.SetValue("U_NOFP", pVal.Row, "")
                        Catch ex As Exception
                            oSBOApplication.MessageBox(ex.Message)
                        Finally
                            releaseObject(oForm)
                            releaseObject(oMatrix)
                        End Try
                    End If
                End If
            End If
        ElseIf pVal.ItemUID = "1" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                Dim oForm As SAPbouiCOM.Form
                Dim oDefaultButton As SAPbouiCOM.Button
                Dim Desc As String
                Dim oMatrix As SAPbouiCOM.Matrix
                oForm = oSBOApplication.Forms.Item(FormUID)
                oMatrix = oForm.Items.Item("tblData").Specific
                oDefaultButton = oForm.Items.Item("1").Specific
                Desc = oDefaultButton.Caption.ToString
                Try
                    If Desc = "Add" Then
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True Then
                            If oSBOApplication.MessageBox("Are you sure to Add this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                oForm.Freeze(True)
                                oMatrix.FlushToDataSource()
                                Dim a As Integer = oDBSOL_FPGG_DT.Size - 1
                                Do While a >= 0
                                    If oDBSOL_FPGG_DT.GetValue("U_SELECT", a) = "N" Then
                                        oDBSOL_FPGG_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For N As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                    oDBSOL_FPGG_DT.SetValue("LineId", N, N + 1)
                                Next
                                oMatrix.LoadFromDataSource()

                                'oDBSOL_FPGG_HD.SetValue("U_CHKCST", 0, "N")
                                'oDBSOL_FPGG_HD.SetValue("U_CSTFR", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_CSTTO", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_CHKINVNO", 0, "N")
                                'oDBSOL_FPGG_HD.SetValue("U_INVNOFR", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_INVNOTO", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_CHKINVDT", 0, "N")
                                'oDBSOL_FPGG_HD.SetValue("U_INVDTFT", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_INVDTTO", 0, "")
                                'oDBSOL_FPGG_HD.SetValue("U_CHKEXP", 0, "N")

                                GlobalDocNumGunggung = oForm.Items.Item("DocNum").Specific.value
                                BubbleEvent = True
                                oForm.Freeze(False)
                            Else
                                BubbleEvent = False
                            End If
                        Else
                            BubbleEvent = False
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Try
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""
                                If GlobalDocNumGunggung <> "" Then

                                    'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '            """U_CHKCST"" = 'N', ""U_CSTFR"" = '',""U_CSTTO"" = '' , " +
                                    '            """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '            """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '            """U_CHKEXP"" = 'N' " +
                                    '            "WHERE ""DocNum"" = '" & GlobalDocNumGunggung & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & GlobalDocNumGunggung & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)

                                    oForm.Freeze(True)
                                    'UpdateFPINVOICE(GlobalDocNumGunggung, "Gunggung")
                                    oForm.Freeze(False)

                                    'oSBOApplication.ActivateMenuItem("1291")
                                End If
                                GlobalDocNumGunggung = ""

                                '-----------------------------------------------------------------------------
                                'Dim oMtx1 As SAPbouiCOM.Matrix
                                'oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                'Query = "SELECT (MAX(""DocNum"")+1) as ""NewNum"" from ""@SOL_FP_TRX_GG_HD"""
                                'oRec.DoQuery(Query)
                                'If oRec.RecordCount > 0 Then
                                '    oDBSOL_FPGG_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                                'End If

                                'Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")
                                'Dim Month As String = System.DateTime.Now.ToString("MM")
                                'Dim Year As String = System.DateTime.Now.ToString("yyyy")

                                'oDBSOL_FPGG_HD.SetValue("U_DOCSTAT", 0, "N")
                                'oDBSOL_FPGG_HD.SetValue("U_DOCDATE", 0, datenow)
                                'oDBSOL_FPGG_HD.SetValue("U_MP_M", 0, Month)
                                'oDBSOL_FPGG_HD.SetValue("U_MP_Y", 0, Year)

                                'oMtx1 = oForm.Items.Item("tblData").Specific
                                'CheckStatusGunggung()
                                'oMtx1.AutoResizeColumns()
                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If

                    ElseIf Desc = "Update" Or Desc = "OK" Then
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True And Desc = "Update" Then
                            If oSBOApplication.MessageBox("Are you sure to Update this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                oForm.Freeze(True)


                                Dim oStatus As SAPbouiCOM.ComboBox
                                oStatus = oForm.Items.Item("txtDocStat").Specific

                                If oStatus.Value.Trim() = "N" Or oStatus.Value.Trim() = "F" Then
                                    Dim DocNum As String
                                    DocNum = oForm.Items.Item("DocNum").Specific.value
                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                    Dim Query As String = ""

                                    'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '            """U_CHKCST"" = 'N', ""U_CSTFR"" = '',""U_CSTTO"" = '' , " +
                                    '            """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '            """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '            """U_CHKEXP"" = 'N' " +
                                    '        "WHERE ""DocNum"" = '" & DocNum.Trim() & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNum.Trim() & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)

                                End If

                                oMatrix.FlushToDataSource()
                                Dim a As Integer = oDBSOL_FPGG_DT.Size - 1
                                Do While a >= 0
                                    If oDBSOL_FPGG_DT.GetValue("U_SELECT", a) = "N" Then
                                        oDBSOL_FPGG_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For N As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                    oDBSOL_FPGG_DT.SetValue("LineId", N, N + 1)
                                Next

                                oMatrix.LoadFromDataSource()

                                oDBSOL_FPGG_HD.SetValue("U_CHKINVNO", 0, "N")
                                oDBSOL_FPGG_HD.SetValue("U_INVNOFR", 0, "")
                                oDBSOL_FPGG_HD.SetValue("U_INVNOTO", 0, "")
                                oDBSOL_FPGG_HD.SetValue("U_CHKINVDT", 0, "N")
                                oDBSOL_FPGG_HD.SetValue("U_INVDTFT", 0, "")
                                oDBSOL_FPGG_HD.SetValue("U_INVDTTO", 0, "")
                                oDBSOL_FPGG_HD.SetValue("U_CHKEXP", 0, "N")

                                GlobalDocNumGunggung = oForm.Items.Item("DocNum").Specific.value
                                BubbleEvent = True
                                oForm.Freeze(False)
                            Else
                                BubbleEvent = False
                            End If
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Try
                                oForm.Freeze(True)

                                If GlobalDocNumGunggung <> "" Then
                                    'UpdateFPINVOICE(GlobalDocNumGunggung, "Gunggung")
                                End If
                                GlobalDocNumGunggung = ""
                                oForm.Freeze(False)
                                'oSBOApplication.ActivateMenuItem("1291")
                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If
                    End If
                Catch ex As Exception
                    Try
                        oForm.Freeze(False)
                    Catch exa As Exception

                    End Try
                    BubbleEvent = False
                    oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                End Try
            End If

        ElseIf pVal.ItemUID = "btnSearch" Then ' WHEN SAAT BUTTON SEARCH DI KLIK
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then

                    Dim oForm As SAPbouiCOM.Form
                    Dim oMatrix As SAPbouiCOM.Matrix

                    Dim oChkCST As SAPbouiCOM.CheckBox
                    Dim oChkCSTFROM As SAPbouiCOM.EditText
                    Dim oChkCSTTO As SAPbouiCOM.EditText

                    Dim oChkINVNO As SAPbouiCOM.CheckBox
                    Dim oChkINVFROM As SAPbouiCOM.EditText
                    Dim oChkINVTO As SAPbouiCOM.EditText

                    Dim oChkINVDT As SAPbouiCOM.CheckBox
                    Dim oChkDATEFROM As SAPbouiCOM.EditText
                    Dim oChkDATETO As SAPbouiCOM.EditText
                    Dim DateFrom As Date
                    Dim DateTo As Date

                    Dim oChkOFF As SAPbouiCOM.CheckBox
                    Dim sqlText As String
                    Dim WhereStatementOINV As New StringBuilder ' buat variable wherestatementOINV untuk manggil data dari OINV dan (stringbuilder = bisa nambah string)
                    Dim WhereStatementODPI As New StringBuilder
                    Dim unionInclude As New StringBuilder
                    Dim AddedStatement As Integer = 0 'buat variable
                    Dim Exportedvalue As String ' buat variable EXported untuk cek invoice yang sudah ada no FP

                    Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    oForm = oSBOApplication.Forms.Item(FormUID)
                    oMatrix = oForm.Items.Item("tblData").Specific 'table/matrix di detail

                    oChkCST = oForm.Items.Item("chkCST").Specific 'ceklis customer
                    oChkCSTFROM = oForm.Items.Item("txtCSTFR").Specific 'customer from
                    oChkCSTTO = oForm.Items.Item("txtCSTTO").Specific 'customer to

                    oChkINVNO = oForm.Items.Item("chkINVNO").Specific 'ceklis invoice no
                    oChkINVFROM = oForm.Items.Item("txtFRINVNO").Specific ' invoice no from
                    oChkINVTO = oForm.Items.Item("txtTOINVNO").Specific 'invoice no to

                    oChkINVDT = oForm.Items.Item("chkINVDT").Specific ' ceklis invoice date
                    oChkDATEFROM = oForm.Items.Item("txtFRINVDT").Specific ' invoice date from
                    oChkDATETO = oForm.Items.Item("txtTOINVDT").Specific ' invoice date to

                    Dim StringDateFrom As String = oForm.Items.Item("txtFRINVDT").Specific.Value.ToString.Trim ' buat variable date from (dari invoice date from diatas)
                    Dim StringDateTo As String = oForm.Items.Item("txtTOINVDT").Specific.Value.ToString.Trim ' buat variable date to (dari invoice date to diatas)

                    oChkOFF = oForm.Items.Item("chkOFF").Specific ' ceklis include invoice yang udh ada no FP
                    If oChkOFF.Checked = True Then ' jika di ceklis include invoice yang udh ada no FP
                        Exportedvalue = "1" ' exported value nya jadi 1
                    Else ' jika tidak di ceklis
                        Exportedvalue = "0" ' exported value nya 0
                    End If
                    Try
                        '----------------------------------Create Where Statement-----------------------------------------------
                        oForm.Freeze(True)
                        Dim SelectedDocEntryARINV As New StringBuilder 'buat variable select docentry A/r Invoice pakai StringBuilder
                        Dim SelectedDocEntryARDPINV As New StringBuilder 'buat variable select docentry A/r DP Invoice

                        SelectedDocEntryARINV.Append("0") ' diatur ke 0
                        SelectedDocEntryARDPINV.Append("0")

                        oMatrix.FlushToDataSource()
                        Dim hahaaa As Integer = oDBSOL_FPGG_DT.Size
                        Dim hahb As Integer = oDBSOL_FPGG_DT.Offset

                        If oDBSOL_FPGG_DT.Size - 1 >= 0 Then

                            Dim a As Integer = oDBSOL_FPGG_DT.Size - 1

                            Do While a >= 0
                                If oDBSOL_FPGG_DT.GetValue("U_SELECT", a) <> "Y" Then ' jika select di table di ceklis dia remove record
                                    oDBSOL_FPGG_DT.RemoveRecord(a)
                                End If
                                a = a - 1
                            Loop

                            Dim hahaaaa As Integer = oDBSOL_FPGG_DT.Size
                            Dim hahba As Integer = oDBSOL_FPGG_DT.Offset

                            For b As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                If oDBSOL_FPGG_DT.GetValue("U_DOCTYPE", b) = "13" Then ' jika doc type nya 13 jadi A/R Invoice dan ambil value doc entry
                                    SelectedDocEntryARINV.Append("," + oDBSOL_FPGG_DT.GetValue("U_DOCEN", b).ToString)
                                Else ' jika bukan 13 dia A/R DP Invoice
                                    SelectedDocEntryARDPINV.Append("," + oDBSOL_FPGG_DT.GetValue("U_DOCEN", b).ToString)
                                End If
                                oDBSOL_FPGG_DT.SetValue("LineId", b, b + 1) 'nomer di table
                            Next
                        End If

                        '----------------------------------Create Where Statement-----------------------------------------------

                        WhereStatementOINV.Append("WHERE ") 'tambahin string WHERE di variable wherestatementOINV
                        WhereStatementODPI.Append("WHERE ")

                        If oSQLConnection.ServerType = "SQL" Then
                            unionInclude.Append("
                                    WHERE X1.""DocEntry""  NOT IN (
                                        select ISNULL(T1.""U_DOCEN"",0) FROM ""@SOL_FP_TRX_GG_DT"" T1
								        INNER JOIN 
								        ""@SOL_FP_TRX_GG_HD"" T2
								        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
								        WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C''
                                    )
                                ")
                        Else
                            unionInclude.Append("
                                    WHERE X1.""DocEntry""  NOT IN (
                                        select IFNULL(T1.""U_DOCEN"",0) FROM ""@SOL_FP_TRX_GG_DT"" T1
								        INNER JOIN 
								        ""@SOL_FP_TRX_GG_HD"" T2
								        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
								        WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C''
                                    )
                                ")
                        End If


                        If oChkCST.Checked = True Then ' jika customer di ceklis 
                            If oSQLConnection.ServerType = "SQL" Then ' jika server type SQL
                                WhereStatementOINV.Append(" (OINV.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ") ' dia panggil data A/R Invoice dari customer from sampe customer to
                                WhereStatementODPI.Append(" (ODPI.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ") ' dia panggil data A/R DP Invoice dari customer from sampe customer to
                                AddedStatement = AddedStatement + 1
                            Else ' jika servernya HANA
                                WhereStatementOINV.Append(" (OINV.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                WhereStatementODPI.Append(" (ODPI.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            End If
                        End If

                        If oChkINVNO.Checked = True Then ' jika inovice no di ceklis
                            If oSQLConnection.ServerType = "SQL" Then ' JIKA SQL
                                WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ") 'manggil data A/R Invoice dari invoice no from k sampe invoice no to
                                WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            Else ' JIKA HANA
                                WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            End If
                        End If

                        If oChkINVDT.Checked = True Then 'jika invoice date di ceklis
                            If oSQLConnection.ServerType = "SQL" Then 'JIKa SQL
                                WhereStatementOINV.Append(" (OINV.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ") ' manggil data A/R Invoice dari date from sampe date to
                                WhereStatementODPI.Append(" (ODPI.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            Else ' jika hana
                                WhereStatementOINV.Append(" (OINV.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                WhereStatementODPI.Append(" (ODPI.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            End If
                        End If

                        If oSQLConnection.ServerType = "SQL" Then ' JIka SQL
                            WhereStatementOINV.Append(" ISNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ") ' JIka kosong/ NULL docEntry di isi 0 DAN tidak dimasukan kedalam variable SelectedDocEntryARINV
                            WhereStatementODPI.Append(" ISNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                            AddedStatement = AddedStatement + 1
                        Else ' JIKA HANA
                            WhereStatementOINV.Append(" IFNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ") ' JIka kosong/ NULL docEntry di isi 0 DAN tidak dimasukan kedalam variable SelectedDocEntryARINV
                            WhereStatementODPI.Append(" IFNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                            AddedStatement = AddedStatement + 1
                        End If

                        'If oChkOFF.Checked = True Then
                        '    If oSQLConnection.ServerType = "SQL" Then
                        '        WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                        '        WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                        '        AddedStatement = AddedStatement + 1
                        '    Else
                        '        WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                        '        WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                        '        AddedStatement = AddedStatement + 1
                        '    End If
                        'Else
                        '    If oSQLConnection.ServerType = "SQL" Then
                        '        WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ISNULL(OINV.""U_SOL_FP_REF_NO"", '''') = '''' AND  ")
                        '        WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ISNULL(ODPI.""U_SOL_FP_REF_NO"", '''') = '''' AND  ")
                        '        AddedStatement = AddedStatement + 1
                        '    Else
                        '        WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND IFNULL(OINV.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                        '        WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND IFNULL(ODPI.""U_SOL_FP_REF_NO"", '''') = '''' AND ")
                        '        AddedStatement = AddedStatement + 1
                        '    End If
                        'End If



                        '----------------------------------------------DISINI CEK untuk Invoice yang udah ada FP(udah dibuat gunggung) / tidak nya

                        If oChkOFF.Checked = True Then ' jika di ceklis include invoice yang udh ada no FP
                            If oSQLConnection.ServerType = "SQL" Then ' JIKA SQL
                                WhereStatementOINV.Append(" ''1'' = ''1'' AND ") ' DIA ambil data yang U_SOL_FP_FULL_NO & U_SOL_FP_REF_NO  ada isi nya
                                WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" ''1'' = ''1'' AND ") ' DIA ambil data yang U_SOL_FP_FULL_NO & U_SOL_FP_REF_NO  ada isi nya
                                WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                AddedStatement = AddedStatement + 1
                            End If
                        Else ' JIKA include invoice no FP TIDAK di ceklis
                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ") ' DIA ambil data yg U_SOL_FP_FULL_NO & U_SOL_FP_REF_NO Ga ada isinya
                                WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ") ' DIA ambil data yg U_SOL_FP_FULL_NO & U_SOL_FP_REF_NO Ga ada isinya
                                WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                AddedStatement = AddedStatement + 1
                            End If
                        End If

                        'If oSQLConnection.ServerType = "SQL" Then
                        '    WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                        '    WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                        '    AddedStatement = AddedStatement + 1
                        'Else
                        '    WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                        '    WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                        '    AddedStatement = AddedStatement + 1
                        'End If

                        If oSQLConnection.ServerType = "SQL" Then
                            WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''3'' ")
                            WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''3'' ")
                            AddedStatement = AddedStatement + 1
                        Else
                            WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''3'' ")
                            WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''3'' ")
                            AddedStatement = AddedStatement + 1
                        End If

                        Dim FinalWhareStatement As String = WhereStatementOINV.ToString ' BUAT Variable buat final statement where diatas CUMA A/R Invoice

                        '----------------------------------Execute Query-----------------------------------------------


                        'NAH SETELAH BUAT yang tadi WhareStatment di atas Where yang tadi di masukin dibawah/ digabungin buat manggil DATA NYA LEWAT SP 

                        If oSQLConnection.ServerType = "SQL" Then ' JIKa SQL
                            sqlText = "EXEC [SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG] '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "'  " ' MANGGIL SP dengan gabunging wharestatement yang tadi diatas
                        Else ' JIKA HANA
                            sqlText = "CALL SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "' )" ' MANGGIL SP dengan gabunging wharestatement yang tadi diatas
                        End If

                        oRec.DoQuery(sqlText)

                        '----------------------------------Insert data to matrix-----------------------------------------------

                        Dim DocDate As Date
                        Dim TaxDate As Date

                        If oRec.RecordCount > 0 Then
                            'oDBSOL_FPGG_DT.Clear()
                            'oMatrix.Clear()

                            If oRec.RecordCount > 0 Then
                                For x As Integer = 0 To oRec.RecordCount - 1
                                    'If oDBSOL_FPGG_DT.Size = 0 Then
                                    '    Dim haloa As String = oDBSOL_FPGG_DT.GetValue("U_DOCTYPE", 0)
                                    '    If oDBSOL_FPGG_DT.GetValue("U_DOCTYPE", 0) <> "" Then
                                    '        oDBSOL_FPGG_DT.InsertRecord(oDBSOL_FPGG_DT.Size)
                                    '        oDBSOL_FPGG_DT.Offset = oDBSOL_FPGG_DT.Size - 1
                                    '    End If
                                    'ElseIf oDBSOL_FPGG_DT.Size - 1 > 0 Then
                                    '    oDBSOL_FPGG_DT.InsertRecord(oDBSOL_FPGG_DT.Size)
                                    '    oDBSOL_FPGG_DT.Offset = oDBSOL_FPGG_DT.Size - 1
                                    'End If
                                    oDBSOL_FPGG_DT.InsertRecord(oDBSOL_FPGG_DT.Size)
                                    oDBSOL_FPGG_DT.Offset = oDBSOL_FPGG_DT.Size - 1

                                    Dim RowMax As Integer = oDBSOL_FPGG_DT.Size - 1

                                    DocDate = oRec.Fields.Item("DocDate").Value ' buat variable tangga buat set tanggal ke formatnya
                                    TaxDate = oRec.Fields.Item("TaxDate").Value

                                    oDBSOL_FPGG_DT.SetValue("LineId", RowMax, RowMax + 1) ' PROSES MASUKIN DATA KE MATRIx/Detail di gunggung
                                    oDBSOL_FPGG_DT.SetValue("U_SELECT", RowMax, "N")
                                    oDBSOL_FPGG_DT.SetValue("U_DOCTYPE", RowMax, oRec.Fields.Item("ObjType").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_DOCEN", RowMax, oRec.Fields.Item("DocEntry").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_DOCNUM", RowMax, oRec.Fields.Item("DocNum").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_CSTCD", RowMax, oRec.Fields.Item("CardCode").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_CSTNM", RowMax, oRec.Fields.Item("CardName").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_REFNO", RowMax, oRec.Fields.Item("NumAtCard").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_DOCDATE", RowMax, DocDate.ToString("yyyyMMdd"))
                                    oDBSOL_FPGG_DT.SetValue("U_TAXDATE", RowMax, TaxDate.ToString("yyyyMMdd"))
                                    oDBSOL_FPGG_DT.SetValue("U_DOCCURR", RowMax, oRec.Fields.Item("Currency").Value)
                                    oDBSOL_FPGG_DT.SetValue("U_DPP", RowMax, Utils.WindowsToSBONumber(oRec.Fields.Item("DPP").Value))
                                    oDBSOL_FPGG_DT.SetValue("U_PPN", RowMax, Utils.WindowsToSBONumber(oRec.Fields.Item("PPN").Value))
                                    oDBSOL_FPGG_DT.SetValue("U_DOCTOT", RowMax, Utils.WindowsToSBONumber(oRec.Fields.Item("DocTotal").Value))

                                    oRec.MoveNext()

                                    'If x < oRec.RecordCount - 1 Then
                                    '    oDBSOL_FPGG_DT.InsertRecord(oDBSOL_FPGG_DT.Size)
                                    '    oDBSOL_FPGG_DT.Offset = oDBSOL_FPGG_DT.Size - 1
                                    'End If
                                    '----------------------------------------------------------------------------------
                                Next

                                For N As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
                                    oDBSOL_FPGG_DT.SetValue("LineId", N, N + 1)
                                Next
                            End If
                            oMatrix.LoadFromDataSource() ' setelah looping data diatas, NI BARU LOAD KE DETAIL
                        Else ' JIKA INVOICE TIDAK ADA 

                            oMatrix.LoadFromDataSource()
                            oSBOApplication.StatusBar.SetText("Invoice not Found!", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End If

                        oForm.Freeze(False)

                    Catch ex As Exception
                        oForm.Freeze(False)
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try
                End If
            End If
        ElseIf pVal.ItemUID = "btnChoose" Then ' FUNGSI EXPORT TO CSV
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Try
                        If oSBOApplication.MessageBox("Are you sure to Export this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)
                            Dim oDocNum As SAPbouiCOM.EditText
                            oDocNum = oForm.Items.Item("DocNum").Specific
                            Dim title As String = oForm.Title.ToString
                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim success As Boolean = True
                            oMatrix = oForm.Items.Item("tblData").Specific

                            'Isi DocEntry untuk get dan update
                            Dim KeyA As String = ""
                            Dim KeyB As String = ""

                            'Array untuk cek jenis dokumen
                            Dim MyArray() As String = {"13", "18", "14", "19"}
                            'Loop through matrix
                            For i As Integer = 1 To oMatrix.RowCount
                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then
                                    If CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value <> "" Then
                                        'Check objType before adding to INDEX_OBJTYPE_KELUARAN

                                        'If objType is in the array (AR Invoice, AP Invoice, AR Credit Memo, and AP Credit Memo) fill in KeyA
                                        'Else (AR DP and AP DP) fill in KeyB
                                        Dim value As String = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                        Dim result As String = ""
                                        result = Array.Find(MyArray, Function(s) s = value)
                                        If result IsNot Nothing Then
                                            KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        Else
                                            KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        End If
                                    End If
                                End If
                            Next i

                            'Trim last comma (,) character
                            If KeyA <> "" Then
                                KeyA = Left(KeyA, Len(KeyA) - 1)
                            End If

                            If KeyB <> "" Then
                                KeyB = Left(KeyB, Len(KeyB) - 1)
                            End If

                            'Check active activedocument

                            'updateAR(KeyA, KeyB)

                            If oDBSOL_FPGG_HD.GetValue("U_DOCSTAT", 0) <> "L" Then
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""
                                'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'E' " +
                                '            "WHERE ""DocNum"" = '" & oDocNum.Value & "'"
                                'oRec.DoQuery(Query)

                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntry As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData

                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & oDocNum.Value & "'")
                                DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntry)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "E")
                                oGeneralService.Update(oGeneralData)
                            End If

                            oSBOApplication.ActivateMenuItem("1304")

                            oSBOApplication.StatusBar.SetText("Export document Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)

                        End If
                    Catch ex As Exception
                        oSBOApplication.MessageBox(ex.Message)
                    End Try
                End If
            End If
        End If
    End Sub

    Public Sub DataEvent_Handler_Gunggung(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
        If BusinessObjectInfo.EventType = SAPbouiCOM.BoEventTypes.et_FORM_DATA_LOAD Then
            If BusinessObjectInfo.BeforeAction = False And BusinessObjectInfo.ActionSuccess = True Then
                CheckStatusGunggung()
            End If
        End If
    End Sub

    Private Sub CheckStatusGunggung()
        Dim oFormFPGunggung As SAPbouiCOM.Form
        Dim oMatrix As SAPbouiCOM.Matrix
        Dim oDefaultButton As SAPbouiCOM.Button
        Dim oStatus As SAPbouiCOM.ComboBox
        Dim status As String

        oFormFPGunggung = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG")
        oMatrix = oFormFPGunggung.Items.Item("tblData").Specific
        oDefaultButton = oFormFPGunggung.Items.Item("1").Specific
        oStatus = oFormFPGunggung.Items.Item("txtDocStat").Specific
        Try
            oFormFPGunggung.Freeze(True)

            If oStatus.Value = "N" Then

                oFormFPGunggung.Items.Item("haha").Click()
                oFormFPGunggung.Items.Item("chkCST").Enabled = True
                oFormFPGunggung.Items.Item("txtCSTFR").Enabled = True
                oFormFPGunggung.Items.Item("txtCSTTO").Enabled = True
                oFormFPGunggung.Items.Item("chkINVNO").Enabled = True
                oFormFPGunggung.Items.Item("txtFRINVNO").Enabled = True
                oFormFPGunggung.Items.Item("txtTOINVNO").Enabled = True
                oFormFPGunggung.Items.Item("chkINVDT").Enabled = True
                oFormFPGunggung.Items.Item("txtFRINVDT").Enabled = True
                oFormFPGunggung.Items.Item("txtTOINVDT").Enabled = True
                oFormFPGunggung.Items.Item("chkOFF").Enabled = True
                oFormFPGunggung.Items.Item("txtRemark").Enabled = True
                oFormFPGunggung.Items.Item("txtNotes").Enabled = False
                oFormFPGunggung.Items.Item("DocNum").Enabled = False
                oFormFPGunggung.Items.Item("txtDocDate").Enabled = True
                oFormFPGunggung.Items.Item("txtDocStat").Enabled = False
                oFormFPGunggung.Items.Item("txtDPP").Enabled = False
                oFormFPGunggung.Items.Item("txtPPN").Enabled = False
                oFormFPGunggung.Items.Item("txtTotal").Enabled = False

                oFormFPGunggung.Items.Item("txtMPM").Enabled = True
                oFormFPGunggung.Items.Item("txtMPY").Enabled = True

                oFormFPGunggung.Items.Item("btnSearch").Enabled = True

                oFormFPGunggung.Items.Item("1").Enabled = True

                oMatrix.Item.Enabled = True

                oFormFPGunggung.Items.Item("txtRemark").Click()

            ElseIf oStatus.Value = "O" Or oStatus.Value = "E" Or oStatus.Value = "F" Then

                oFormFPGunggung.Items.Item("haha").Click()
                oFormFPGunggung.Items.Item("chkCST").Enabled = False
                oFormFPGunggung.Items.Item("txtCSTFR").Enabled = False
                oFormFPGunggung.Items.Item("txtCSTTO").Enabled = False
                oFormFPGunggung.Items.Item("chkINVNO").Enabled = False
                oFormFPGunggung.Items.Item("txtFRINVNO").Enabled = False
                oFormFPGunggung.Items.Item("txtTOINVNO").Enabled = False
                oFormFPGunggung.Items.Item("chkINVDT").Enabled = False
                oFormFPGunggung.Items.Item("txtFRINVDT").Enabled = False
                oFormFPGunggung.Items.Item("txtTOINVDT").Enabled = False
                oFormFPGunggung.Items.Item("chkOFF").Enabled = False
                oFormFPGunggung.Items.Item("txtRemark").Enabled = False
                oFormFPGunggung.Items.Item("txtNotes").Enabled = False
                oFormFPGunggung.Items.Item("DocNum").Enabled = False
                oFormFPGunggung.Items.Item("txtDocDate").Enabled = False
                oFormFPGunggung.Items.Item("txtDocStat").Enabled = False
                oFormFPGunggung.Items.Item("txtDPP").Enabled = False
                oFormFPGunggung.Items.Item("txtPPN").Enabled = False
                oFormFPGunggung.Items.Item("txtTotal").Enabled = False

                oFormFPGunggung.Items.Item("txtMPM").Enabled = False
                oFormFPGunggung.Items.Item("txtMPY").Enabled = False

                oFormFPGunggung.Items.Item("btnSearch").Enabled = False
                oFormFPGunggung.Items.Item("1").Enabled = True

                oMatrix.Item.Enabled = True

                oFormFPGunggung.Items.Item("txtRemark").Click()

            ElseIf oStatus.Value = "C" Or oStatus.Value = "L" Then

                oFormFPGunggung.Items.Item("haha").Click()
                oFormFPGunggung.Items.Item("chkCST").Enabled = False
                oFormFPGunggung.Items.Item("txtCSTFR").Enabled = False
                oFormFPGunggung.Items.Item("txtCSTTO").Enabled = False
                oFormFPGunggung.Items.Item("chkINVNO").Enabled = False
                oFormFPGunggung.Items.Item("txtFRINVNO").Enabled = False
                oFormFPGunggung.Items.Item("txtTOINVNO").Enabled = False
                oFormFPGunggung.Items.Item("chkINVDT").Enabled = False
                oFormFPGunggung.Items.Item("txtFRINVDT").Enabled = False
                oFormFPGunggung.Items.Item("txtTOINVDT").Enabled = False
                oFormFPGunggung.Items.Item("chkOFF").Enabled = False
                oFormFPGunggung.Items.Item("txtRemark").Enabled = False
                oFormFPGunggung.Items.Item("txtNotes").Enabled = False
                oFormFPGunggung.Items.Item("DocNum").Enabled = False
                oFormFPGunggung.Items.Item("txtDocDate").Enabled = False
                oFormFPGunggung.Items.Item("txtDocStat").Enabled = False
                oFormFPGunggung.Items.Item("txtDPP").Enabled = False
                oFormFPGunggung.Items.Item("txtPPN").Enabled = False
                oFormFPGunggung.Items.Item("txtTotal").Enabled = False

                oFormFPGunggung.Items.Item("txtMPM").Enabled = False
                oFormFPGunggung.Items.Item("txtMPY").Enabled = False

                oFormFPGunggung.Items.Item("btnSearch").Enabled = False
                oFormFPGunggung.Items.Item("1").Enabled = True

                oMatrix.Item.Enabled = False

                oFormFPGunggung.Items.Item("txtRemark").Click()

            End If

            oFormFPGunggung.Freeze(False)
        Catch ex As Exception
            oFormFPGunggung.Freeze(False)
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub EnableAlFieldGunggung()
        Try
            Dim oXMLDoc As New XmlDocument
            Dim oFormFPGunggung As SAPbouiCOM.Form
            Dim oMatrix As SAPbouiCOM.Matrix

            oFormFPGunggung = oSBOApplication.Forms.Item("frmOffFKGUNGGUNG")
            oMatrix = oFormFPGunggung.Items.Item("tblData").Specific

            oFormFPGunggung.Items.Item("haha").Click()

            oFormFPGunggung.Items.Item("chkCST").Enabled = True
            oFormFPGunggung.Items.Item("txtCSTFR").Enabled = True
            oFormFPGunggung.Items.Item("txtCSTTO").Enabled = True
            oFormFPGunggung.Items.Item("chkINVNO").Enabled = True
            oFormFPGunggung.Items.Item("txtFRINVNO").Enabled = True
            oFormFPGunggung.Items.Item("txtTOINVNO").Enabled = True
            oFormFPGunggung.Items.Item("chkINVDT").Enabled = True
            oFormFPGunggung.Items.Item("txtFRINVDT").Enabled = True
            oFormFPGunggung.Items.Item("txtTOINVDT").Enabled = True
            oFormFPGunggung.Items.Item("chkOFF").Enabled = True
            oFormFPGunggung.Items.Item("txtRemark").Enabled = True
            oFormFPGunggung.Items.Item("txtNotes").Enabled = True
            oFormFPGunggung.Items.Item("DocNum").Enabled = True
            oFormFPGunggung.Items.Item("txtDocDate").Enabled = True
            oFormFPGunggung.Items.Item("txtDocStat").Enabled = True
            oFormFPGunggung.Items.Item("txtDPP").Enabled = True
            oFormFPGunggung.Items.Item("txtPPN").Enabled = True
            oFormFPGunggung.Items.Item("txtTotal").Enabled = True
            oFormFPGunggung.Items.Item("txtMPM").Enabled = True
            oFormFPGunggung.Items.Item("txtMPY").Enabled = True

            oFormFPGunggung.Items.Item("btnSearch").Enabled = False
            oFormFPGunggung.Items.Item("1").Enabled = True

            oMatrix.Item.Enabled = False

            oFormFPGunggung.Items.Item("txtRemark").Click()

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try

    End Sub

    Public Sub CalculateHeaderAmountGG(ByVal FormUID As String)
        Dim oForm As SAPbouiCOM.Form
        oForm = oSBOApplication.Forms.Item(FormUID)

        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
        Dim iRows As Integer = 0

        oMatrix.FlushToDataSource()

        Dim DPPTemp As Decimal
        Dim PPNTemp As Decimal

        oMatrix = oForm.Items.Item("tblData").Specific

        For i As Integer = 0 To oDBSOL_FPGG_DT.Size - 1
            If oDBSOL_FPGG_DT.GetValue("U_SELECT", i) = "Y" Then

                'DPPTemp = DPPTemp + ConTLocalSNF(oDBSOL_FPGG_DT.GetValue("U_DPP", i))
                'PPNTemp = PPNTemp + ConTLocalSNF(oDBSOL_FPGG_DT.GetValue("U_PPN", i))

                DPPTemp = DPPTemp + SBONumbertoDecimal(oDBSOL_FPGG_DT.GetValue("U_DPP", i))
                PPNTemp = PPNTemp + SBONumbertoDecimal(oDBSOL_FPGG_DT.GetValue("U_PPN", i))

                'DPPTemp = DPPTemp + ConTLocalSNF(colDPP.Value)
                'PPNTemp = PPNTemp + ConTLocalSNF(colPPN.Value)

            End If
        Next i

        oDBSOL_FPGG_HD.SetValue("U_TDPP", 0, DPPTemp)
        oDBSOL_FPGG_HD.SetValue("U_TPPN", 0, PPNTemp)
        oDBSOL_FPGG_HD.SetValue("U_DOCTOT", 0, (DPPTemp + PPNTemp))
    End Sub

    Public Sub RightClickEvent_GG(ByRef eventinfo As SAPbouiCOM.ContextMenuInfo, ByRef bubbleEvent As Boolean)

        If eventinfo.ItemUID <> "tblData" And eventinfo.ItemUID <> "tblSummary" Then
            If eventinfo.BeforeAction = True And eventinfo.ActionSuccess = False Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm

                Dim Status As SAPbouiCOM.ComboBox = oForm.Items.Item("txtDocStat").Specific

                Dim oMenus As SAPbouiCOM.Menus
                Dim oMenuItem As SAPbouiCOM.MenuItem
                Dim oCreationPackage As SAPbouiCOM.MenuCreationParams

                oCreationPackage = oSBOApplication.CreateObject(SAPbouiCOM.BoCreatableObjectType.cot_MenuCreationParams)
                oCreationPackage.Type = SAPbouiCOM.BoMenuType.mt_STRING

                oMenuItem = oSBOApplication.Menus.Item("1280")
                oMenus = oMenuItem.SubMenus

                If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")

                If Status.Selected.Value = "O" Or Status.Selected.Value = "E" Then
                    If (oMenus.Exists("cls") = False) Then
                        oCreationPackage.UniqueID = "CLS"
                        oCreationPackage.String = "Close Document"
                        oCreationPackage.Position = 1
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If
                    If (oMenus.Exists("CNC") = False) Then
                        oCreationPackage.UniqueID = "CNC"
                        oCreationPackage.String = "Cancel Document"
                        oCreationPackage.Position = 2
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If
                Else
                    If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                    If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")
                End If
            End If
        End If
    End Sub

#End Region

#Region "EFaktur Massal"

    Public Sub ItemEvent_Handler_OffFaktur_MASSAL(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.ItemUID = "tblData" Then
            If pVal.ColUID = "txtChkBox" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_DOUBLE_CLICK Then
                    If pVal.Row = 0 Then
                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)

                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim iRows As Integer = 0

                            oMatrix = oForm.Items.Item("tblData").Specific
                            If oMatrix.Item.Enabled = True Then

                                oForm.Freeze(True)

                                oMatrix.FlushToDataSource()

                                For i As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    If oDBSOL_FPMS_DT.GetValue("U_SELECT", i) = "Y" Then
                                        iRows += 1
                                    End If
                                Next i

                                If iRows <> oMatrix.RowCount Then
                                    For n As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                        oDBSOL_FPMS_DT.SetValue("U_SELECT", n, "Y")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                Else
                                    For n As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                        oDBSOL_FPMS_DT.SetValue("U_SELECT", n, "N")
                                    Next

                                    oMatrix.LoadFromDataSource()
                                End If

                                oForm.Freeze(False)

                            End If
                        End If
                    End If
                End If
            ElseIf pVal.ColUID = "DOCEN" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_MATRIX_LINK_PRESSED Then
                    If pVal.BeforeAction = True Then
                        BubbleEvent = False
                        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                        Try
                            If oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "203" Then
                                oSBOApplication.OpenForm(203, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "18" Then
                                oSBOApplication.OpenForm(18, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "18a" Then
                                oSBOApplication.OpenForm(18, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "19" Then
                                oSBOApplication.OpenForm(19, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "14" Then
                                oSBOApplication.OpenForm(14, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "204" Then
                                oSBOApplication.OpenForm(204, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            ElseIf oMatrix.Columns.Item("DOCTYPE").Cells.Item(pVal.Row).Specific.Value = "13a" Then
                                oSBOApplication.OpenForm(13, "", oMatrix.Columns.Item("DOCEN").Cells.Item(pVal.Row).Specific.Value)
                            End If
                        Catch ex As Exception
                            oSBOApplication.MessageBox(ex.Message)
                        Finally
                            releaseObject(oForm)
                            releaseObject(oMatrix)
                        End Try
                    End If
                End If
            ElseIf pVal.ColUID = "DTBRANCH" Then
                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_COMBO_SELECT Then
                    If pVal.BeforeAction = False Then
                        BubbleEvent = False
                        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
                        Try
                            oDBSOL_FPMS_DT.SetValue("U_NORUN", pVal.Row, "")
                            oDBSOL_FPMS_DT.SetValue("U_NOFP", pVal.Row, "")
                        Catch ex As Exception
                            oSBOApplication.MessageBox(ex.Message)
                        Finally
                            releaseObject(oForm)
                            releaseObject(oMatrix)
                        End Try
                    End If
                End If
            End If
        ElseIf pVal.ItemUID = "1" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                Dim oForm As SAPbouiCOM.Form
                Dim oDefaultButton As SAPbouiCOM.Button
                Dim Desc As String
                Dim oMatrix As SAPbouiCOM.Matrix
                oForm = oSBOApplication.Forms.Item(FormUID)
                oMatrix = oForm.Items.Item("tblData").Specific
                oDefaultButton = oForm.Items.Item("1").Specific
                Desc = oDefaultButton.Caption.ToString
                Try
                    If Desc = "Add" Then ' Event saat button Add di klik
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True Then ' SEBELUM ACTION SUCCESS
                            If oSBOApplication.MessageBox("Are you sure to Add this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                oForm.Freeze(True)
                                oMatrix.FlushToDataSource()
                                Dim a As Integer = oDBSOL_FPMS_DT.Size - 1
                                Do While a >= 0
                                    If oDBSOL_FPMS_DT.GetValue("U_SELECT", a) = "N" Then
                                        'If oDBSOL_FPMS_DT.GetValue("U_SELECT", a) = "N" Or oDBSOL_FPMS_DT.GetValue("U_NOFP", a) = "" Then
                                        oDBSOL_FPMS_DT.SetValue("U_SELECT", a, "N")
                                        oDBSOL_FPMS_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For N As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    oDBSOL_FPMS_DT.SetValue("LineId", N, N + 1)
                                Next
                                oMatrix.LoadFromDataSource()

                                oDBSOL_FPMS_HD.SetValue("U_CHKCST", 0, "N")
                                oDBSOL_FPMS_HD.SetValue("U_CSTFR", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CSTTO", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CHKINVNO", 0, "N")
                                oDBSOL_FPMS_HD.SetValue("U_INVNOFR", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_INVNOTO", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CHKINVDT", 0, "N")
                                oDBSOL_FPMS_HD.SetValue("U_INVDTFT", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_INVDTTO", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CHKEXP", 0, "N")


                                GlobalDocNumMassal = oForm.Items.Item("DocNum").Specific.value
                                BubbleEvent = True
                                oForm.Freeze(False)
                            Else
                                BubbleEvent = False
                            End If
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then ' SESUDAH ACTION SUCCESS
                            Try
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""
                                If GlobalDocNumMassal <> "" Then

                                    'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '        """U_CHKCST"" = 'N', ""U_CSTFR"" = '',""U_CSTTO"" = '' , " +
                                    '        """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '        """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '        """U_CHKEXP"" = 'N' " +
                                    '        "WHERE ""DocNum"" = '" & GlobalDocNumMassal & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & GlobalDocNumMassal & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)


                                    oForm.Freeze(True)
                                    'UpdateFPINVOICE(GlobalDocNumMassal, "Massal")
                                    oForm.Freeze(False)
                                    'oSBOApplication.ActivateMenuItem("1291")
                                End If

                                GlobalDocNumMassal = ""

                                '-----------------------------------------------------------------------------
                                'Dim oMtx1 As SAPbouiCOM.Matrix
                                'oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                'Query = "SELECT (MAX(""DocNum"")+1) as ""NewNum"" from ""@SOL_FP_TRX_MS_HD"""
                                'oRec.DoQuery(Query)
                                'If oRec.RecordCount > 0 Then
                                '    oDBSOL_FPMS_HD.SetValue("DocNum", 0, Convert.ToString(IIf(oRec.Fields.Item("NewNum").Value = Nothing, 1, oRec.Fields.Item("NewNum").Value)))
                                'End If

                                'Dim datenow As String = System.DateTime.Now.ToString("yyyMMdd")
                                'Dim Month As String = System.DateTime.Now.ToString("MM")
                                'Dim Year As String = System.DateTime.Now.ToString("yyyy")
                                'Dim oCmbBranch As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbBranch").Specific
                                'oCmbBranch.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                                'oDBSOL_FPMS_HD.SetValue("U_DOCSTAT", 0, "N")
                                'oDBSOL_FPMS_HD.SetValue("U_DOCDATE", 0, datenow)

                                'oMtx1 = oForm.Items.Item("tblData").Specific
                                'CheckStatusMassal()
                                'oMtx1.AutoResizeColumns()
                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If

                    ElseIf Desc = "Update" Or Desc = "OK" Then
                        If pVal.ActionSuccess = False And pVal.BeforeAction = True And Desc = "Update" Then
                            If oSBOApplication.MessageBox("Are you sure to Update this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                oForm.Freeze(True)

                                Dim oStatus As SAPbouiCOM.ComboBox
                                oStatus = oForm.Items.Item("txtDocStat").Specific

                                If oStatus.Value.Trim() = "N" Or oStatus.Value.Trim() = "F" Then
                                    Dim DocNum As String
                                    DocNum = oForm.Items.Item("DocNum").Specific.value
                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                    Dim Query As String = ""

                                    'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'O', " +
                                    '        """U_CHKCST"" = 'N', ""U_CSTFR"" = '',""U_CSTTO"" = '' , " +
                                    '        """U_CHKINVNO"" = 'N', ""U_INVNOFR"" = '',""U_INVNOTO"" = '' , " +
                                    '        """U_CHKINVDT"" = 'N', ""U_INVDTFT"" = '',""U_INVDTTO"" = '' , " +
                                    '        """U_CHKEXP"" = 'N' " +
                                    '        "WHERE ""DocNum"" = '" & DocNum.Trim() & "'"
                                    'oRec.DoQuery(Query)

                                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                                    Dim DocEntry As Integer
                                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                                    Dim oGeneralService As SAPbobsCOM.GeneralService
                                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                    Dim oGeneralData As SAPbobsCOM.GeneralData

                                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNum.Trim() & "'")
                                    DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                    oCmpSrv = oSBOCompany.GetCompanyService()
                                    oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                    oGeneralParams.SetProperty("DocEntry", DocEntry)
                                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                    ' Header Data
                                    oGeneralData.SetProperty("U_DOCSTAT", "O")
                                    oGeneralService.Update(oGeneralData)

                                End If

                                oMatrix.FlushToDataSource()

                                Dim a As Integer = oDBSOL_FPMS_DT.Size - 1
                                Do While a >= 0
                                    If oDBSOL_FPMS_DT.GetValue("U_SELECT", a) = "N" Or oDBSOL_FPMS_DT.GetValue("U_NOFP", a) = "" Then
                                        oDBSOL_FPMS_DT.SetValue("U_SELECT", a, "N")
                                        oDBSOL_FPMS_DT.RemoveRecord(a)
                                    End If
                                    a = a - 1
                                Loop

                                For N As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    oDBSOL_FPMS_DT.SetValue("LineId", N, N + 1)
                                Next

                                oMatrix.LoadFromDataSource()

                                oDBSOL_FPMS_HD.SetValue("U_CHKINVNO", 0, "N")
                                oDBSOL_FPMS_HD.SetValue("U_INVNOFR", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_INVNOTO", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CHKINVDT", 0, "N")
                                oDBSOL_FPMS_HD.SetValue("U_INVDTFT", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_INVDTTO", 0, "")
                                oDBSOL_FPMS_HD.SetValue("U_CHKEXP", 0, "N")
                                'oDBSOL_FPMS_HD.SetValue("U_CHKINVDT", 0, "Y")
                                GlobalDocNumMassal = oForm.Items.Item("DocNum").Specific.value
                                BubbleEvent = True
                                oForm.Freeze(False)
                            Else
                                BubbleEvent = False
                            End If
                        End If

                        If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                            Try
                                oForm.Freeze(True)

                                If GlobalDocNumMassal <> "" Then
                                    'UpdateFPINVOICE(GlobalDocNumMassal, "Massal")
                                End If


                                GlobalDocNumMassal = ""
                                oForm.Freeze(False)
                                'oSBOApplication.ActivateMenuItem("1291")
                            Catch ex As Exception
                                Try
                                    oForm.Freeze(False)
                                Catch exa As Exception
                                End Try
                                oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                            End Try
                        End If
                    End If
                Catch ex As Exception
                    Try
                        oForm.Freeze(False)
                    Catch exa As Exception

                    End Try
                    BubbleEvent = False
                    oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                End Try
            End If

        ElseIf pVal.ItemUID = "cmbBranch" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_COMBO_SELECT And pVal.ItemChanged = True Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form
                    Dim oMatrix As SAPbouiCOM.Matrix
                    Dim oBranch As SAPbouiCOM.ComboBox
                    oForm = oSBOApplication.Forms.ActiveForm
                    oMatrix = oForm.Items.Item("tblData").Specific
                    oBranch = oForm.Items.Item("cmbBranch").Specific
                    Try
                        oForm.Freeze(True)
                        oMatrix.FlushToDataSource()
                        Dim cntFP As Integer = 0
                        For a As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                            If oDBSOL_FPMS_DT.GetValue("U_NORUN", a) <> "" And oDBSOL_FPMS_DT.GetValue("U_NOFP", a) <> "" Then
                                cntFP = cntFP + 1
                            End If
                        Next
                        If cntFP > 0 Then
                            If oSBOApplication.MessageBox("Do you want to remove all Generated FP Number?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then
                                For a As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    oDBSOL_FPMS_DT.SetValue("U_DTBRANCH", a, oBranch.Value)
                                    oDBSOL_FPMS_DT.SetValue("U_NORUN", a, "")
                                    oDBSOL_FPMS_DT.SetValue("U_NOFP", a, "")
                                Next
                            Else
                                For a As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    If oDBSOL_FPMS_DT.GetValue("U_NOFP", a) = "" And oDBSOL_FPMS_DT.GetValue("U_DOCTYPE", a) <> "" Then
                                        oDBSOL_FPMS_DT.SetValue("U_DTBRANCH", a, oBranch.Value)
                                    End If
                                Next
                            End If
                        Else
                            For a As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                If oDBSOL_FPMS_DT.GetValue("U_NOFP", a) = "" And oDBSOL_FPMS_DT.GetValue("U_DOCTYPE", a) <> "" Then
                                    oDBSOL_FPMS_DT.SetValue("U_DTBRANCH", a, oBranch.Value)
                                End If
                            Next
                        End If

                        oMatrix.LoadFromDataSource()
                        oForm.Freeze(False)
                    Catch ex As Exception
                        oForm.Freeze(False)
                        oSBOApplication.StatusBar.SetText(ex.Message.ToString, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try
                End If
            End If
        ElseIf pVal.ItemUID = "btnSearch" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Dim oForm As SAPbouiCOM.Form
                    Dim oMatrix As SAPbouiCOM.Matrix

                    Dim oChkCST As SAPbouiCOM.CheckBox
                    Dim oChkCSTFROM As SAPbouiCOM.EditText
                    Dim oChkCSTTO As SAPbouiCOM.EditText

                    Dim oChkINVNO As SAPbouiCOM.CheckBox
                    Dim oChkINVFROM As SAPbouiCOM.EditText
                    Dim oChkINVTO As SAPbouiCOM.EditText

                    Dim oChkINVDT As SAPbouiCOM.CheckBox
                    Dim oChkDATEFROM As SAPbouiCOM.EditText
                    Dim oChkDATETO As SAPbouiCOM.EditText

                    Dim oChkOFF As SAPbouiCOM.CheckBox
                    Dim sqlText As String
                    Dim WhereStatementOINV As New StringBuilder
                    Dim WhereStatementODPI As New StringBuilder
                    Dim unionInclude As New StringBuilder
                    Dim AddedStatement As Integer = 0
                    Dim Exportedvalue As String
                    Dim CbBranch As String

                    Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                    oForm = oSBOApplication.Forms.Item(FormUID)
                    oMatrix = oForm.Items.Item("tblData").Specific

                    oChkCST = oForm.Items.Item("chkCST").Specific
                    oChkCSTFROM = oForm.Items.Item("txtCSTFR").Specific
                    oChkCSTTO = oForm.Items.Item("txtCSTTO").Specific

                    oChkINVNO = oForm.Items.Item("chkINVNO").Specific
                    oChkINVFROM = oForm.Items.Item("txtFRINVNO").Specific
                    oChkINVTO = oForm.Items.Item("txtTOINVNO").Specific

                    oChkINVDT = oForm.Items.Item("chkINVDT").Specific
                    oChkDATEFROM = oForm.Items.Item("txtFRINVDT").Specific
                    oChkDATETO = oForm.Items.Item("txtTOINVDT").Specific
                    CbBranch = oForm.Items.Item("cmbBranch").Specific.value

                    Dim TipeFp = oForm.Items.Item("cmbTypeFP").Specific.value
                    Dim JenisFp = oForm.Items.Item("cmbJnsFp").Specific.value

                    Dim StringDateFrom As String = oForm.Items.Item("txtFRINVDT").Specific.Value.ToString.Trim
                    Dim StringDateTo As String = oForm.Items.Item("txtTOINVDT").Specific.Value.ToString.Trim

                    Dim oChkIncludeExported As SAPbouiCOM.CheckBox = oForm.Items.Item("Item_4").Specific

                    oChkOFF = oForm.Items.Item("chkOFF").Specific
                    If oChkOFF.Checked = True Then
                        Exportedvalue = "1"
                    Else
                        Exportedvalue = "0"
                    End If

                    '----------------------------------Create Where Statement-----------------------------------------------
                    Try
                        oForm.Freeze(True)

                        Dim SelectedDocEntryARINV As New StringBuilder
                        Dim SelectedDocEntryARDPINV As New StringBuilder

                        SelectedDocEntryARINV.Append("0")
                        SelectedDocEntryARDPINV.Append("0")

                        oMatrix.FlushToDataSource()
                        'Dim hahaaa As Integer = oDBSOL_FPMS_DT.Size
                        'Dim hahb As Integer = oDBSOL_FPMS_DT.Offset

                        If oDBSOL_FPMS_DT.Size - 1 >= 0 Then

                            Dim a As Integer = oDBSOL_FPMS_DT.Size - 1

                            Do While a >= 0
                                If oDBSOL_FPMS_DT.GetValue("U_SELECT", a) <> "Y" Then
                                    oDBSOL_FPMS_DT.RemoveRecord(a)
                                End If
                                a = a - 1
                            Loop

                            'Dim hahaaaa As Integer = oDBSOL_FPMS_DT.Size
                            'Dim hahba As Integer = oDBSOL_FPMS_DT.Offset

                            For b As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                If oDBSOL_FPMS_DT.GetValue("U_DOCTYPE", b) = "13" Then
                                    SelectedDocEntryARINV.Append("," + oDBSOL_FPMS_DT.GetValue("U_DOCEN", b).ToString)
                                Else
                                    SelectedDocEntryARDPINV.Append("," + oDBSOL_FPMS_DT.GetValue("U_DOCEN", b).ToString)
                                End If
                                oDBSOL_FPMS_DT.SetValue("LineId", b, b + 1)
                            Next
                        End If

                        '----------------------------------Create Where Statement-----------------------------------------------

                        If (UCase(TipeFp) = "MASSAL") Or ((UCase(TipeFp) = "ON INVOICE" And UCase(JenisFp) = "PAJAK KELUARAN")) Then

                            WhereStatementOINV.Append("WHERE ")
                            WhereStatementODPI.Append("WHERE ")

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" (ISNULL(OINV.""U_SOL_FP_BRANCH"",'''')  = ''" & CbBranch & "'') AND ")
                                WhereStatementODPI.Append(" (ISNULL(ODPI.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" (IFNULL(OINV.""U_SOL_FP_BRANCH"",'''')  = ''" & CbBranch & "'') AND ")
                                WhereStatementODPI.Append(" (IFNULL(ODPI.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                                        WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                            WHERE (T2.""U_DOCSTAT"" = ''L''  )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                        ) AND X1.""RunningNo"" IS NOT NULL
                                    ")

                                End If
                            Else
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                                                
                                         WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                            WHERE ( T2.""U_DOCSTAT"" = ''L''  )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                         ) AND X1.""RunningNo"" IS NOT NULL
    
                                    ")

                                End If
                            End If


                            If unionInclude.Length = 0 Then

                                If oSQLConnection.ServerType = "SQL" Then
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                                            WHERE X1.""DocEntry"" || X1.""ObjType""   IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                                --WHERE ( T2.""U_DOCSTAT"" = ''O''  )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                                WHERE (T2.""U_DOCSTAT"" in (''E''))  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NOT NULL
                                        ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                           WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                             ) AND X1.""RunningNo"" IS NOT NULL

                                        ")
                                    Else

                                        unionInclude.Append("
                                           WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''O'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                             )  AND X1.""RunningNo"" IS NULL

                                        ")

                                    End If
                                Else
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                                                
                                       WHERE X1.""DocEntry"" || X1.""ObjType""   IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                            -- WHERE ( T2.""U_DOCSTAT"" = ''O''  )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E''))  AND T2.""U_DOCSTAT"" <> ''C'' 
                                         ) AND X1.""RunningNo"" IS NOT NULL
    
                                    ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                           WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            )  AND X1.""RunningNo"" IS NOT NULL
                                        ")
                                    Else
                                        unionInclude.Append("
                                           WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''13'' OR  ""U_DOCTYPE"" =''13a'' OR  ""U_DOCTYPE"" =''203'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            )  AND X1.""RunningNo"" IS NULL
                                        ")

                                    End If
                                End If


                            End If


                            If oChkCST.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OINV.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OINV.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVNO.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OINV.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVDT.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OINV.""U_SOL_PPN_DATE"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""U_SOL_PPN_DATE"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OINV.""U_SOL_PPN_DATE"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPI.""U_SOL_PPN_DATE"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" ISNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(OINV.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" IFNULL(ODPI.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkOFF.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If oSQLConnection.ServerType = "SQL" Then
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                Else
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                End If
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    WhereStatementOINV.Append(" ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'Else
                            '    WhereStatementOINV.Append(" IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(OINV.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ODPI.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'End If


                            If oSQLConnection.ServerType = "SQL" Then
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''1'' ")
                                    WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''0'' ")
                                    WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''1'' ")
                                    WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" OINV.""U_SOL_FP_TYPE"" = ''0'' ")
                                    WhereStatementODPI.Append(" ODPI.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            Dim FinalWhareStatement As String = WhereStatementOINV.ToString

                            '----------------------------------Execute Query-----------------------------------------------

                            If oSQLConnection.ServerType = "SQL" Then
                                sqlText = "EXEC [SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG] '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "' "
                            Else
                                sqlText = "CALL SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "',' " + unionInclude.ToString + "' )"
                            End If

                        End If


                        '----------------------------------------------------------------------------------------------------------------------------------------------
                        '   ==================================================== PAJAK MASUKAN ===================================================================
                        '----------------------------------------------------------------------------------------------------------------------------------------------
                        If (UCase(TipeFp) = "ON INVOICE" And UCase(JenisFp) = "PAJAK MASUKAN") Then
                            WhereStatementOINV.Append("WHERE ")
                            WhereStatementODPI.Append("WHERE ")


                            If oSQLConnection.ServerType = "SQL" Then
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                        
                                     WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" =''204'')
                                        WHERE (T2.""U_DOCSTAT"" = ''L'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                    ) AND X1.""RunningNo"" IS NOT NULL
    
                                    ")

                                End If
                            Else
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                                        
                                    WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                        WHERE (T2.""U_DOCSTAT"" = ''L'')  AND T2.""U_DOCSTAT"" <> ''C'' 
                                    ) AND X1.""RunningNo"" IS NOT NULL

                                    ")

                                End If

                            End If



                            If unionInclude.Length = 0 Then

                                If oSQLConnection.ServerType = "SQL" Then
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                        
                                              WHERE X1.""DocEntry"" || X1.""ObjType""  IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                                --WHERE (T2.""U_DOCSTAT"" = ''O'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                                WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NOT NULL
    
                                        ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                            WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NOT NULL

                                        ")
                                    Else
                                        unionInclude.Append("
                                             WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" =''18a'' OR ""U_DOCTYPE"" =''204'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NULL

                                        ")
                                    End If
                                Else
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                                        
                                        WHERE X1.""DocEntry"" || X1.""ObjType""  IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                            --WHERE (T2.""U_DOCSTAT"" = ''O'')  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                        ) AND X1.""RunningNo"" IS NOT NULL

                                    ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                              WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NOT NULL

                                        ")
                                    Else
                                        unionInclude.Append("
                                              WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND (""U_DOCTYPE"" =''18'' OR ""U_DOCTYPE"" = ''18a'' OR ""U_DOCTYPE"" =''204'')
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            ) AND X1.""RunningNo"" IS NULL

                                        ")
                                    End If

                                End If

                            End If




                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" (ISNULL(OPCH.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'' ) AND ")
                                WhereStatementODPI.Append(" (ISNULL(ODPO.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'' ) AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" (IFNULL(OPCH.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'') AND ")
                                WhereStatementODPI.Append(" (IFNULL(ODPO.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'') AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkCST.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OPCH.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OPCH.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVNO.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OPCH.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OPCH.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVDT.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (OPCH.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (OPCH.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    WhereStatementODPI.Append(" (ODPO.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(OPCH.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" ISNULL(ODPO.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(OPCH.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                WhereStatementODPI.Append(" IFNULL(ODPO.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARDPINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkOFF.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    WhereStatementODPI.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If oSQLConnection.ServerType = "SQL" Then
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" ISNULL(OPCH.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        WhereStatementODPI.Append(" ISNULL(ODPO.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                Else
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" IFNULL(OPCH.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        WhereStatementODPI.Append(" IFNULL(ODPO.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                End If
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    WhereStatementOINV.Append(" ISNULL(OPCH.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(OPCH.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" ISNULL(ODPO.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ODPO.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'Else
                            '    WhereStatementOINV.Append(" IFNULL(OPCH.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(OPCH.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    WhereStatementODPI.Append(" IFNULL(ODPO.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ODPO.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'End If


                            If oSQLConnection.ServerType = "SQL" Then
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" OPCH.""U_SOL_FP_TYPE"" = ''1'' ")
                                    WhereStatementODPI.Append(" ODPO.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" OPCH.""U_SOL_FP_TYPE"" = ''0'' ")
                                    WhereStatementODPI.Append(" ODPO.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" OPCH.""U_SOL_FP_TYPE"" = ''1'' ")
                                    WhereStatementODPI.Append(" ODPO.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" OPCH.""U_SOL_FP_TYPE"" = ''0'' ")
                                    WhereStatementODPI.Append(" ODPO.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            Dim FinalWhareStatement As String = WhereStatementOINV.ToString

                            '----------------------------------Execute Query-----------------------------------------------

                            If oSQLConnection.ServerType = "SQL" Then
                                sqlText = "EXEC [SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE] '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "' "
                            Else
                                sqlText = "CALL SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "' )"
                            End If


                        End If


                        '----------------------------------------------------------------------------------------------------------------------------------------------
                        '   ==================================================== RETUR PAJAK KELUARAN ============================================================
                        '----------------------------------------------------------------------------------------------------------------------------------------------


                        If (UCase(TipeFp) = "ON INVOICE" And UCase(JenisFp) = "RETUR PAJAK KELUARAN") Then

                            WhereStatementOINV.Append("WHERE ")

                            If oSQLConnection.ServerType = "SQL" Then
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("

                                        WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                        WHERE (T2.""U_DOCSTAT"" = ''L'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                      ) AND X1.""RunningNo"" IS NOT NULL

                                    ")

                                End If
                            Else
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("

                                        WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                        WHERE (T2.""U_DOCSTAT"" = ''L'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                    ) AND X1.""RunningNo"" IS NOT NULL

                                    ")

                                End If
                            End If



                            If unionInclude.Length = 0 Then

                                If oSQLConnection.ServerType = "SQL" Then
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("

                                            WHERE X1.""DocEntry"" || X1.""ObjType""   IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                            --WHERE (T2.""U_DOCSTAT"" = ''O'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                          ) AND X1.""RunningNo"" IS NOT NULL

                                    ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                              WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                              ) AND X1.""RunningNo"" IS NOT NULL


                                        ")
                                    Else
                                        unionInclude.Append("
                                              WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                              ) AND X1.""RunningNo"" IS NULL


                                        ")
                                    End If
                                Else
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("

                                            WHERE X1.""DocEntry"" || X1.""ObjType""  IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                            --WHERE (T2.""U_DOCSTAT"" = ''O'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                        ) AND X1.""RunningNo"" IS NOT NULL

                                    ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("

                                              WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            )AND X1.""RunningNo"" IS NOT NULL
                                        ")
                                    Else
                                        unionInclude.Append("

                                               WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''14''
                                                WHERE (T2.""U_DOCSTAT"" = ''L'' OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            )AND X1.""RunningNo"" IS NULL
                                        ")
                                    End If
                                End If

                            End If


                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" (ISNULL(ORIN.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'')  AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" (IFNULL(ORIN.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'')  AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkCST.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORIN.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORIN.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVNO.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORIN.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORIN.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVDT.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORIN.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORIN.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(ORIN.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(ORIN.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkOFF.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If oSQLConnection.ServerType = "SQL" Then
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" ISNULL(ORIN.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                Else
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" IFNULL(ORIN.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                End If
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    WhereStatementOINV.Append(" ISNULL(ORIN.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ORIN.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'Else
                            '    WhereStatementOINV.Append(" IFNULL(ORIN.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ORIN.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'End If


                            If oSQLConnection.ServerType = "SQL" Then
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" ORIN.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ORIN.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" ORIN.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ORIN.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            Dim FinalWhareStatement As String = WhereStatementOINV.ToString

                            '----------------------------------Execute Query-----------------------------------------------

                            If oSQLConnection.ServerType = "SQL" Then
                                sqlText = "EXEC [SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE] '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "'"
                            Else
                                sqlText = "CALL SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "')"
                            End If


                        End If

                        '----------------------------------------------------------------------------------------------------------------------------------------------
                        '   ==================================================== RETUR PAJAK MARSUKAN ============================================================
                        '----------------------------------------------------------------------------------------------------------------------------------------------

                        If (UCase(TipeFp) = "ON INVOICE" And UCase(JenisFp) = "RETUR PAJAK MASUKAN") Then
                            WhereStatementOINV.Append("WHERE ")

                            If oSQLConnection.ServerType = "SQL" Then
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                                        WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                        WHERE (T2.""U_DOCSTAT"" = ''L'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                      ) AND X1.""RunningNo"" IS NOT NULL
                                    ")

                                End If
                            Else
                                If oChkIncludeExported.Checked = True And oChkOFF.Checked = True Then
                                    unionInclude.Append("
                                        WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                        SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                        INNER JOIN 
                                        ""@SOL_FP_TRX_MS_HD"" T2
                                        ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                        WHERE ( T2.""U_DOCSTAT"" = ''L'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                     ) AND X1.""RunningNo"" IS NOT NULL
                                    ")

                                End If

                            End If



                            If unionInclude.Length = 0 Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                                            WHERE X1.""DocEntry"" || X1.""ObjType""   IN (
                                            SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                            --WHERE (T2.""U_DOCSTAT"" = ''O'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                          ) AND X1.""RunningNo"" IS NOT NULL
                                        ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                               WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                              ) AND X1.""RunningNo"" IS NOT NULL
                                        ")
                                    Else
                                        unionInclude.Append("
                                               WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                                SELECT ISNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1 
                                                INNER JOIN 
                                                ""@SOL_FP_TRX_MS_HD"" T2
                                                ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                                WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                              ) AND X1.""RunningNo"" IS NULL
                                        ")
                                    End If
                                Else
                                    If oChkIncludeExported.Checked = True Then
                                        unionInclude.Append("
                                             WHERE X1.""DocEntry"" || X1.""ObjType""   IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                            --WHERE ( T2.""U_DOCSTAT"" = ''O'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                            WHERE (T2.""U_DOCSTAT"" in (''E'')) AND T2.""U_DOCSTAT"" <> ''C'' 
                                         )AND X1.""RunningNo"" IS NOT NULL
                                    ")
                                    ElseIf oChkOFF.Checked = True Then
                                        unionInclude.Append("
                                           WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                            WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                         )AND X1.""RunningNo"" IS NOT NULL
                                     ")
                                    Else
                                        unionInclude.Append("
                                          WHERE X1.""DocEntry"" || X1.""ObjType""  NOT IN (
                                            SELECT IFNULL(T1.""U_DOCEN"",0)||T1.""U_DOCTYPE"" FROM ""@SOL_FP_TRX_MS_DT"" T1
                                            INNER JOIN 
                                            ""@SOL_FP_TRX_MS_HD"" T2
                                            ON T1.""DocEntry"" = T2.""DocEntry""  AND T1.""U_DOCTYPE"" = ''19''
                                            WHERE (T2.""U_DOCSTAT"" = ''L''  OR T2.""U_DOCSTAT"" = ''E'' )  AND T2.""U_DOCSTAT"" <> ''C'' 
                                         )AND X1.""RunningNo"" IS NULL
                                     ")
                                    End If

                                End If
                            End If


                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" (ISNULL(ORPC.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'' ) AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" (IFNULL(ORPC.""U_SOL_FP_BRANCH"",'''') = ''" & CbBranch & "'' ) AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkCST.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORPC.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORPC.""CardCode"" BETWEEN ''" & oChkCSTFROM.Value & "'' AND ''" & oChkCSTTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVNO.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORPC.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORPC.""DocNum"" BETWEEN ''" & oChkINVFROM.Value & "'' AND ''" & oChkINVTO.Value & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oChkINVDT.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" (ORPC.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" (ORPC.""DocDate"" BETWEEN ''" & StringDateFrom & "'' AND ''" & StringDateTo & "'') AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            If oSQLConnection.ServerType = "SQL" Then
                                WhereStatementOINV.Append(" ISNULL(ORPC.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            Else
                                WhereStatementOINV.Append(" IFNULL(ORPC.""DocEntry"", ''0'') NOT IN (" & SelectedDocEntryARINV.ToString & ") AND ")
                                AddedStatement = AddedStatement + 1
                            End If

                            If oChkOFF.Checked = True Then
                                If oSQLConnection.ServerType = "SQL" Then
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ''1'' = ''1'' AND ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If oSQLConnection.ServerType = "SQL" Then
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" ISNULL(ORPC.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                Else
                                    If TipeFp = "Massal" Then
                                        WhereStatementOINV.Append(" IFNULL(ORPC.""U_SOL_FP_FULL_NO"", '''') = '''' AND ")
                                        AddedStatement = AddedStatement + 1
                                    End If
                                End If
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    WhereStatementOINV.Append(" ISNULL(ORPC.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN ISNULL(ORPC.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'Else
                            '    WhereStatementOINV.Append(" IFNULL(ORPC.""U_SOL_EXPORTED"", ''0'') = (CASE ''" & Exportedvalue & "'' WHEN 1 THEN IFNULL(ORPC.""U_SOL_EXPORTED"", ''0'') ELSE ''" & Exportedvalue & "'' END) AND ")
                            '    AddedStatement = AddedStatement + 1
                            'End If


                            If oSQLConnection.ServerType = "SQL" Then
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" ORPC.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ORPC.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            Else
                                If TipeFp = "Massal" Then
                                    WhereStatementOINV.Append(" ORPC.""U_SOL_FP_TYPE"" = ''1'' ")
                                    AddedStatement = AddedStatement + 1
                                Else
                                    WhereStatementOINV.Append(" ORPC.""U_SOL_FP_TYPE"" = ''0'' ")
                                    AddedStatement = AddedStatement + 1
                                End If
                            End If

                            Dim FinalWhareStatement As String = WhereStatementOINV.ToString

                            '----------------------------------Execute Query-----------------------------------------------

                            If oSQLConnection.ServerType = "SQL" Then
                                sqlText = "EXEC [SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE] '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "'"
                            Else
                                sqlText = "CALL SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE ( '" + WhereStatementOINV.ToString + "','" + WhereStatementODPI.ToString + "' ,' " + unionInclude.ToString + "')"
                            End If

                        End If



                        oRec.DoQuery(sqlText)

                        '----------------------------------Insert data to matrix-----------------------------------------------

                        Dim DocDate As Date
                        Dim TaxDate As Date

                        If oRec.RecordCount > 0 Then
                            'oDBSOL_FPGG_DT.Clear()
                            'oMatrix.Clear()

                            If oRec.RecordCount > 0 Then
                                For x As Integer = 0 To oRec.RecordCount - 1

                                    oDBSOL_FPMS_DT.InsertRecord(oDBSOL_FPMS_DT.Size)
                                    oDBSOL_FPMS_DT.Offset = oDBSOL_FPMS_DT.Size - 1

                                    Dim RowMax As Integer = oDBSOL_FPMS_DT.Size - 1

                                    DocDate = oRec.Fields.Item("DocDate").Value
                                    TaxDate = oRec.Fields.Item("TaxDate").Value

                                    oDBSOL_FPMS_DT.SetValue("LineId", RowMax, RowMax + 1)
                                    oDBSOL_FPMS_DT.SetValue("U_SELECT", RowMax, "N")
                                    oDBSOL_FPMS_DT.SetValue("U_DTBRANCH", RowMax, IIf(oRec.Fields.Item("Branch").Value = "", CbBranch, oRec.Fields.Item("Branch").Value))
                                    oDBSOL_FPMS_DT.SetValue("U_KDTRANS", RowMax, oRec.Fields.Item("TransCode").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_KDSTATUS", RowMax, oRec.Fields.Item("StatusCode").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_NORUN", RowMax, oRec.Fields.Item("RunningNo").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_NOFP", RowMax, oRec.Fields.Item("FullNo").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_KDDUKUNG", RowMax, oRec.Fields.Item("KodeDokumenPendukung").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_EXPORT", RowMax, oRec.Fields.Item("Exported").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_DOCTYPE", RowMax, oRec.Fields.Item("ObjType").Value)
                                    'oDBSOL_FPMS_DT.SetValue("U_DOCTYPE", RowMax, 18)
                                    Dim a = oRec.Fields.Item("DocEntry").Value
                                    oDBSOL_FPMS_DT.SetValue("U_DOCEN", RowMax, oRec.Fields.Item("DocEntry").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_DOCNUM", RowMax, oRec.Fields.Item("DocNum").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_CSTCD", RowMax, oRec.Fields.Item("CardCode").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_CSTNM", RowMax, oRec.Fields.Item("CardName").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_REFNO", RowMax, oRec.Fields.Item("NumAtCard").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_DOCDATE", RowMax, DocDate.ToString("yyyyMMdd"))
                                    oDBSOL_FPMS_DT.SetValue("U_TAXDATE", RowMax, TaxDate.ToString("yyyyMMdd"))
                                    oDBSOL_FPMS_DT.SetValue("U_DOCCURR", RowMax, oRec.Fields.Item("Currency").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_DPP", RowMax, oRec.Fields.Item("DPP").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_PPN", RowMax, oRec.Fields.Item("PPN").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_DOCTOT", RowMax, oRec.Fields.Item("DocTotal").Value)

                                    oDBSOL_FPMS_DT.SetValue("U_NNPWP", RowMax, oRec.Fields.Item("NNPWP").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_NPWP", RowMax, oRec.Fields.Item("NPWP").Value)
                                    'oDBSOL_FPMS_DT.SetValue("U_KTP", RowMax, oRec.Fields.Item("KTP").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_ALAMAT", RowMax, oRec.Fields.Item("FPAlamat").Value)

                                    oDBSOL_FPMS_DT.SetValue("U_KMK", RowMax, oRec.Fields.Item("U_KMK").Value)

                                    Dim KDDUKUNG = oRec.Fields.Item("DocNum").Value


                                    Dim oRec2 As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

                                    Dim DocType = oRec.Fields.Item("ObjType").Value.ToString()

                                    Dim queryHeader

                                    If (DocType = "13" Or DocType = "13a") Then
                                        queryHeader = "SELECT ""U_SOL_FP_FACILITY"", ""PayToCode"" FROM OINV WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "'"
                                    ElseIf DocType = "203" Then
                                        queryHeader = "SELECT  ""U_SOL_FP_FACILITY"", ""PayToCode"" FROM ODPI WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "'"
                                    ElseIf DocType = "19" Then
                                        queryHeader = "SELECT  ""U_SOL_FP_FACILITY"", ""PayToCode"" FROM ORPC WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "'"
                                    End If

                                    oRec2.DoQuery(queryHeader)



                                    Dim oFormFKMS As SAPbouiCOM.Form
                                    oFormFKMS = oSBOApplication.Forms.ActiveForm
                                    Dim oMatrixDetail As SAPbouiCOM.Matrix
                                    oMatrixDetail = oFormFKMS.Items.Item("tblData").Specific
                                    Dim nomorRef As String = oRec.Fields.Item("ObjType").Value.ToString() + "#" + oRec.Fields.Item("DocNum").Value.ToString() + "#" + oRec.Fields.Item("DocEntry").Value.ToString()

                                    Dim oRec3 As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                    Dim CRD1 = "SELECT * FROM CRD1 WHERE ""CardCode"" = '" & oRec.Fields.Item("CardCode").Value & "' And ""Address"" = '" & oRec2.Fields.Item("PayToCode").Value & "' "
                                    oRec3.DoQuery(CRD1)

                                    Dim Nik
                                    Dim otherNik
                                    Dim idTKU
                                    Dim jenisID

                                    If (oRec3.Fields.Item("U_SOL_FP_NPWP").Value.ToString() <> "") Then
                                        Nik = oRec3.Fields.Item("U_SOL_FP_NPWP").Value.ToString().Substring(0, 16)
                                        idTKU = oRec3.Fields.Item("U_SOL_FP_NPWP").Value.ToString()
                                        otherNik = "-"
                                        jenisID = "TIN"
                                    ElseIf (oRec3.Fields.Item("U_SOL_FP_KTP").Value.ToString() <> "") Then
                                        Nik = oRec3.Fields.Item("U_SOL_FP_KTP").Value.ToString().Substring(0, 16)
                                        idTKU = "0000000000000000"
                                        otherNik = oRec3.Fields.Item("U_SOL_FP_KTP").Value.ToString()
                                        jenisID = "National ID"
                                    ElseIf (oRec3.Fields.Item("U_SOL_NO_PASPORT").Value.ToString() <> "") Then
                                        Nik = "0000000000000000"
                                        idTKU = "000000"
                                        otherNik = oRec3.Fields.Item("U_SOL_NO_PASPORT").Value.ToString()
                                        jenisID = "Other ID"
                                    ElseIf (oRec3.Fields.Item("U_SOL_NO_OTHER").Value.ToString() <> "") Then
                                        Nik = "0000000000000000"
                                        idTKU = "000000"
                                        otherNik = oRec3.Fields.Item("U_SOL_NO_OTHER").Value.ToString()
                                        jenisID = "Other ID"
                                    End If




                                    oDBSOL_FPMS_DT.SetValue("U_CAPFAS", RowMax, oRec2.Fields.Item("U_SOL_FP_FACILITY").Value)
                                    oDBSOL_FPMS_DT.SetValue("U_REFNO", RowMax, nomorRef)
                                    oDBSOL_FPMS_DT.SetValue("U_JNSIDPB", RowMax, jenisID)
                                    oDBSOL_FPMS_DT.SetValue("U_NPWP", RowMax, idTKU)
                                    oDBSOL_FPMS_DT.SetValue("U_NODOCPB", RowMax, otherNik)
                                    oDBSOL_FPMS_DT.SetValue("U_IDTKUPB", RowMax, idTKU)

                                    Try
                                        If oRec.Fields.Item("KodeDokumenPendukung").Value IsNot Nothing And oRec.Fields.Item("KodeDokumenPendukung").Value.ToString.Length > 0 Then
                                            KDDUKUNG = oRec.Fields.Item("KodeDokumenPendukung").Value
                                        End If
                                    Catch ex As Exception

                                    End Try

                                    'oDBSOL_FPMS_DT.SetValue("U_KDDUKUNG", RowMax, KDDUKUNG)
                                    oDBSOL_FPMS_DT.SetValue("U_PPNSTAT", RowMax, oRec.Fields.Item("U_PPNSTAT").Value)
                                    oRec.MoveNext()

                                    '----------------------------------------------------------------------------------
                                Next

                                For N As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
                                    oDBSOL_FPMS_DT.SetValue("LineId", N, N + 1)
                                Next
                            End If
                            oMatrix.LoadFromDataSource()
                        Else

                            oMatrix.LoadFromDataSource()
                            oSBOApplication.StatusBar.SetText("Invoice not Found!", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End If
                        oForm.Freeze(False)
                    Catch ex As Exception
                        oForm.Freeze(False)
                        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                    End Try
                End If
            End If
        ElseIf pVal.ItemUID = "btnGenFP" Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then

                    Dim oProgBar As SAPbouiCOM.ProgressBar

                    Dim oForm As SAPbouiCOM.Form
                    oForm = oSBOApplication.Forms.Item(FormUID)

                    Dim oMatrix As SAPbouiCOM.Matrix
                    oMatrix = oForm.Items.Item("tblData").Specific
                    Dim TaxNumberStart As String = ""
                    Dim TaxNumberRunning As String = ""
                    Dim TaxNumberrunStartpref As String = ""
                    Dim TaxNumberrunStart As String = ""
                    Dim TaxNumberrunRunning As String = ""
                    Dim TaxPrefix1 As String = ""
                    Dim TaxPrefix2 As String = ""
                    Dim TaxYear As String = ""
                    Dim lastnumber As String = ""
                    Dim counterLoop As Integer = 1

                    Try
                        oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Checking Data", oMatrix.RowCount, False)
                        oProgBar.Value = 0
                    Catch ex As Exception
                    End Try

                    For i As Integer = 1 To oMatrix.RowCount
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Checking Data " & i & "/ " & oMatrix.RowCount & ""
                        Catch ex As Exception
                        End Try

                        'Jika Status New
                        If oForm.Items.Item("txtDocStat").Specific.value = "N" Then
                            If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                Dim Branch As String = CType(oMatrix.Columns.Item("DTBRANCH").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                Dim KDTRANS As String = CType(oMatrix.Columns.Item("KDTRANS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                Dim KDSTATUS As String = CType(oMatrix.Columns.Item("KDSTATUS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                Dim TaxDate As String = CType(oMatrix.Columns.Item("TAXDATE").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                Dim NoJoin As String = ""
                                Dim NoJoinBP As String
                                Dim IndexList As Integer = 99999

                                Dim NORUN As String = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value


                                Dim taxDateString As String = Left(TaxDate, 4)

                                If TaxYear <> Left(TaxDate, 4) And IndexList = 99999 And NORUN = "" Then
                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                    Dim oRec2 As SAPbobsCOM.Recordset
                                    oRec2 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                                    If oSQLConnection.ServerType = "SQL" Then
                                        oRec.DoQuery("EXEC [dbo].[SOL_FP_NEXT_SEQUENCE2] '" & TaxDate & "', '" & Branch & "'")
                                    Else
                                        Dim halo As String = "CALL SOL_FP_NEXT_SEQUENCE2 (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')"
                                        oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE2 (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')")
                                    End If

                                    If (oRec.RecordCount > 0) Then
                                        Dim halo As String = oRec.Fields.Item(0).Value
                                        Dim newrunning As String = IIf(oRec.Fields.Item(0).Value Is Nothing, "", oRec.Fields.Item(0).Value)

                                        If lastnumber = newrunning And newrunning <> "" Then


                                            Dim found As Boolean = False

                                            Do While found = False And counterLoop <= 100 'RG -> ubah param ini buat pengecekan lebih lanjut

                                                Dim first = Left(newrunning, 5)
                                                Dim last = Right(newrunning, 8)
                                                Dim PlusLastNumber = last + (counterLoop - 1)
                                                Dim combined As String = first & PlusLastNumber.ToString().PadLeft(8, "0")
                                                newrunning = combined



                                                If oSQLConnection.ServerType = "SQL" Then
                                                    Dim a = "
                                                        SELECT * FROM ""@SOL_FP_SETUP""
                                                        WHERE '" & PlusLastNumber.ToString().PadLeft(8, "0") & "' BETWEEN ""U_SOL_FP_NO_SS3"" AND ""U_SOL_FP_NO_ES3""
                                                        AND '" & TaxDate & "' BETWEEN ""U_SOL_START_ACTIVE_DATE"" AND ""U_SOL_END_ACTIVE_DATE""
                                                        AND ""U_SOL_FP_BRANCH"" = '" & Branch & "'

                                                    "

                                                    oRec.DoQuery("
                                                        SELECT * FROM ""@SOL_FP_SETUP""
                                                        WHERE '" & PlusLastNumber.ToString().PadLeft(8, "0") & "' BETWEEN ""U_SOL_FP_NO_SS3"" AND ""U_SOL_FP_NO_ES3""
                                                        AND '" & TaxDate & "' BETWEEN ""U_SOL_START_ACTIVE_DATE"" AND ""U_SOL_END_ACTIVE_DATE""
                                                        AND ""U_SOL_FP_BRANCH"" = '" & Branch & "'

                                                    ")
                                                Else
                                                    oRec.DoQuery("
                                                        SELECT * FROM ""@SOL_FP_SETUP""
                                                        WHERE '" & PlusLastNumber.ToString().PadLeft(8, "0") & "' BETWEEN ""U_SOL_FP_NO_SS3"" AND ""U_SOL_FP_NO_ES3""
                                                        AND '" & TaxDate & "' BETWEEN ""U_SOL_START_ACTIVE_DATE"" AND ""U_SOL_END_ACTIVE_DATE""
                                                        AND ""U_SOL_FP_BRANCH"" = '" & Branch & "'
                                                    ")
                                                End If


                                                If (oRec.RecordCount > 0) Then

                                                    oRec.DoQuery("
                                                        SELECT ""U_NORUN"" FROM ""@SOL_FP_TRX_GB_HD""
                                                        WHERE ""U_NORUN"" = '" + newrunning + "' AND ""U_DOCSTAT"" <> 'C'
                                                        UNION 
                                                        SELECT T0.""U_NORUN"" FROM ""@SOL_FP_TRX_MS_DT"" T0
                                                        INNER JOIN ""@SOL_FP_TRX_MS_HD"" T1
                                                        ON T0.""DocEntry"" = T1.""DocEntry""
                                                        WHERE T0.""U_NORUN"" = '" + newrunning + "' AND T1.""U_DOCSTAT"" <> 'C' 
                                                        UNION
                                                        SELECT ""U_SOL_FP_RUNNING_NO"" FROM ""OINV""
                                                        WHERE ""U_SOL_FP_RUNNING_NO"" = '" + newrunning + "'
                                                    ")

                                                    If oRec.RecordCount > 1 Then

                                                        counterLoop = counterLoop + 1

                                                    Else
                                                        found = True
                                                        Exit Do
                                                    End If

                                                Else
                                                    oSBOApplication.MessageBox("Running Number FP Cannot Find or has Exceeded, Check Setting Faktur Pajak")
                                                    Exit For
                                                End If

                                            Loop


                                            If found = False Then

                                                TaxYear = Left(TaxDate, 4)
                                                If oSQLConnection.ServerType = "SQL" Then
                                                    oRec.DoQuery("EXEC [dbo].[SOL_FP_NEXT_SEQUENCE] '" & TaxDate & "', '" & Branch & "'")
                                                Else
                                                    Dim halo2 As String = "CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')"
                                                    oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')")
                                                End If

                                                Dim halo3 As String = oRec.Fields.Item(0).Value
                                                newrunning = IIf(oRec.Fields.Item(0).Value Is Nothing, "", oRec.Fields.Item(0).Value)
                                                If (lastnumber = newrunning) Then
                                                    newrunning = newrunning + 1
                                                End If

                                            End If

                                        Else
                                            lastnumber = newrunning
                                        End If

                                        If newrunning <> "" Then

                                            'TaxNumberStart = Right(oRec.Fields.Item(0).Value, 8) //biar baca dari newrunning aja
                                            'TaxNumberrunStart = Right(oRec.Fields.Item(0).Value, 8) //biar baca dari newrunning aja
                                            'TaxNumberrunStartpref = Left(oRec.Fields.Item(0).Value, 5) //biar baca dari newrunning aja
                                            TaxNumberStart = Right(newrunning, 8)
                                            TaxNumberrunStart = Right(newrunning, 8)
                                            TaxNumberrunStartpref = Left(newrunning, 5)
                                            Dim oNoRunning As SAPbouiCOM.EditText
                                            oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                            Dim oNoFaktur As SAPbouiCOM.EditText
                                            oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                            'TaxYear = Left(TaxDate, 4) // buat ngatasin nomer yg belum kepakai
                                            'TaxPrefix1 = oRec.Fields.Item(0).Value.Substring(0, 3) //biar baca dari newrunning aja
                                            'TaxPrefix2 = oRec.Fields.Item(0).Value.Substring(3, 2) //biar baca dari newrunning aja
                                            TaxPrefix1 = newrunning.Substring(0, 3)
                                            TaxPrefix2 = newrunning.Substring(3, 2)

                                            Dim Combine As New StringBuilder
                                            Dim Combine2 As New StringBuilder
                                            Combine.Append(KDTRANS.Trim())
                                            Combine.Append(KDSTATUS.Trim())
                                            Combine.Append(".")
                                            Combine.Append(TaxPrefix1.Trim())
                                            Combine.Append("-")
                                            Combine.Append(TaxPrefix2.Trim())
                                            Combine.Append(".")
                                            Combine.Append(TaxNumberStart.Trim())

                                            Combine2.Append(TaxNumberrunStartpref.Trim())
                                            Combine2.Append(TaxNumberrunStart.Trim())

                                            'Dim query As String = "CALL SOL_FAKTUR_PAJAK_CHECK ('" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "')"
                                            'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"

                                            'oRec2.DoQuery(query)

                                            If oRec2.RecordCount = 0 Then
                                                oNoRunning.Value = Combine2.ToString
                                                oNoFaktur.Value = Combine.ToString
                                            Else
                                                oNoRunning.Value = ""
                                                oNoFaktur.Value = ""
                                                MessageBox.Show(oRec2.Fields.Item("error_message").Value)
                                            End If

                                            counterLoop = counterLoop + 1
                                        Else
                                            oSBOApplication.MessageBox("Running Number FP Cannot Find or has Exceeded, Check Setting Faktur Pajak")
                                            Exit For
                                        End If
                                    End If
                                ElseIf TaxYear <> Left(TaxDate, 4) And IndexList <> 99999 And NORUN = "" Then
                                    Dim oNoRunning As SAPbouiCOM.EditText
                                    oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    Dim oNoFaktur As SAPbouiCOM.EditText
                                    oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                ElseIf TaxYear = Left(TaxDate, 4) And IndexList = 99999 Then
                                    Dim oRec3 As SAPbobsCOM.Recordset
                                    oRec3 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)


                                    Dim oRec As SAPbobsCOM.Recordset
                                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)


                                    If TaxNumberRunning = "" Then
                                        TaxNumberRunning = TaxNumberStart + 1
                                        TaxNumberrunRunning = TaxNumberrunStart + 1
                                    Else
                                        TaxNumberRunning = TaxNumberRunning + 1
                                        TaxNumberrunRunning = TaxNumberrunRunning + 1
                                    End If

                                    Dim halo = "select ""U_SOL_FP_NO_ES3"" from ""@SOL_FP_SETUP"" WHERE ""U_SOL_FP_YEAR"" = '" & Left(TaxDate, 4) & "' AND ""U_SOL_FP_BRANCH"" = '" & Branch & "'  order by ""DocEntry"" desc --  and TO_DECIMAL(""U_SOL_FP_NO_ES3"") < TO_DECIMAL('" & TaxNumberRunning & "') "
                                    oRec.DoQuery("select top 1 ""U_SOL_FP_NO_ES3"" from ""@SOL_FP_SETUP"" WHERE ""U_SOL_FP_YEAR"" = '" & Left(TaxDate, 4) & "' AND ""U_SOL_FP_BRANCH"" = '" & Branch & "'  order by ""DocEntry"" desc -- and ""U_SOL_FP_NO_ES3"" < '" & TaxNumberRunning & "' ")

                                    If Integer.Parse(oRec.Fields.Item("U_SOL_FP_NO_ES3").Value) < Integer.Parse(TaxNumberRunning) Then
                                        oSBOApplication.MessageBox("Running Number FP Cannot Find or has Exceeded, Please Check Setting Faktur Pajak")
                                        Exit For
                                    End If

                                    Dim LengthTaxRunning As Integer = TaxNumberrunRunning.Length

                                    If LengthTaxRunning < 8 Then
                                        Dim nolnol As New StringBuilder
                                        For a As Integer = 1 To 8 - LengthTaxRunning
                                            nolnol.Append("0")
                                        Next
                                        nolnol.Append(TaxNumberrunRunning)

                                        TaxNumberrunRunning = nolnol.ToString
                                    End If

                                    Dim Combine As New StringBuilder
                                    Dim Combine2 As New StringBuilder

                                    Combine.Append(KDTRANS)
                                    Combine.Append(KDSTATUS)
                                    Combine.Append(".")
                                    Combine.Append(TaxPrefix1)
                                    Combine.Append("-")
                                    Combine.Append(TaxPrefix2)
                                    Combine.Append(".")
                                    'Combine.Append(TaxNumberRunning)
                                    Combine.Append(TaxNumberrunRunning)

                                    Combine2.Append(TaxNumberrunStartpref)
                                    Combine2.Append(TaxNumberrunRunning)

                                    'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"
                                    'oRec3.DoQuery(query)
                                    If oRec3.RecordCount = 0 Then
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoRunning.Value = Combine2.ToString

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoFaktur.Value = Combine.ToString
                                    Else
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoRunning.Value = ""

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                        oNoFaktur.Value = ""

                                        MessageBox.Show(oRec3.Fields.Item("error_message").Value)

                                    End If

                                ElseIf TaxYear = Left(TaxDate, 4) And IndexList <> 99999 And NORUN = "" Then
                                    Dim oNoRunning As SAPbouiCOM.EditText
                                    oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    Dim oNoFaktur As SAPbouiCOM.EditText
                                    oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                End If
                            End If

                            'Jika Status Selain New
                        Else
                            If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then
                                If CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = "" Then

                                    Dim Branch As String = CType(oMatrix.Columns.Item("DTBRANCH").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                    Dim KDTRANS As String = CType(oMatrix.Columns.Item("KDTRANS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                    Dim KDSTATUS As String = CType(oMatrix.Columns.Item("KDSTATUS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                    Dim TaxDate As String = CType(oMatrix.Columns.Item("TAXDATE").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
                                    Dim NoJoin As String = ""
                                    Dim NoJoinBP As String
                                    Dim IndexList As Integer = 99999

                                    If TaxYear <> Left(TaxDate, 4) And IndexList = 99999 Then
                                        Dim oRec As SAPbobsCOM.Recordset
                                        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                        Dim oRec2 As SAPbobsCOM.Recordset
                                        oRec2 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                                        If oSQLConnection.ServerType = "SQL" Then
                                            oRec.DoQuery("EXEC [dbo].[SOL_FP_NEXT_SEQUENCE2] '" & TaxDate & "', '" & Branch & "'")
                                        Else
                                            Dim halo As String = "CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')"
                                            oRec.DoQuery("CALL SOL_FP_NEXT_SEQUENCE (TO_TIMESTAMP('" & TaxDate & "', 'YYYYMMDD'), '" & Branch & "')")
                                        End If

                                        If (oRec.RecordCount > 0) Then
                                            Dim halo As String = oRec.Fields.Item(0).Value
                                            Dim newrunning As String = IIf(oRec.Fields.Item(0).Value Is Nothing, "", oRec.Fields.Item(0).Value)

                                            If newrunning <> "" Then

                                                TaxNumberStart = Right(oRec.Fields.Item(0).Value, 8)
                                                TaxNumberrunStart = Right(oRec.Fields.Item(0).Value, 8)
                                                TaxNumberrunStartpref = Left(oRec.Fields.Item(0).Value, 5)
                                                Dim oNoRunning As SAPbouiCOM.EditText
                                                oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                                Dim oNoFaktur As SAPbouiCOM.EditText
                                                oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                                TaxYear = Left(TaxDate, 4)
                                                TaxPrefix1 = oRec.Fields.Item(0).Value.Substring(0, 3)
                                                TaxPrefix2 = oRec.Fields.Item(0).Value.Substring(3, 2)

                                                Dim Combine As New StringBuilder
                                                Dim Combine2 As New StringBuilder
                                                Combine.Append(KDTRANS)
                                                Combine.Append(KDSTATUS)
                                                Combine.Append(".")
                                                Combine.Append(TaxPrefix1)
                                                Combine.Append("-")
                                                Combine.Append(TaxPrefix2)
                                                Combine.Append(".")
                                                Combine.Append(TaxNumberStart)

                                                Combine2.Append(TaxNumberrunStartpref)
                                                Combine2.Append(TaxNumberrunStart)

                                                'Dim query As String = "CALL SOL_FAKTUR_PAJAK_CHECK ('" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "')"
                                                'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"

                                                'oRec2.DoQuery(query)

                                                If oRec2.RecordCount = 0 Then
                                                    oNoRunning.Value = Combine2.ToString
                                                    oNoFaktur.Value = Combine.ToString
                                                Else
                                                    oNoRunning.Value = ""
                                                    oNoFaktur.Value = ""
                                                    MessageBox.Show(oRec2.Fields.Item("error_message").Value)
                                                End If

                                            Else
                                                oSBOApplication.MessageBox("Running Number FP Cannot Find or has Exceeded, Check Setting Faktur Pajak")
                                                Exit For
                                            End If
                                        End If
                                    ElseIf TaxYear <> Left(TaxDate, 4) And IndexList <> 99999 Then
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    ElseIf TaxYear = Left(TaxDate, 4) And IndexList = 99999 Then
                                        Dim oRec3 As SAPbobsCOM.Recordset
                                        oRec3 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                                        If TaxNumberRunning = "" Then
                                            TaxNumberRunning = TaxNumberStart + 1
                                            TaxNumberrunRunning = TaxNumberrunStart + 1
                                        Else
                                            TaxNumberRunning = TaxNumberRunning + 1
                                            TaxNumberrunRunning = TaxNumberrunRunning + 1
                                        End If

                                        Dim LengthTaxRunning As Integer = TaxNumberrunRunning.Length

                                        If LengthTaxRunning < 8 Then
                                            Dim nolnol As New StringBuilder
                                            For a As Integer = 1 To 8 - LengthTaxRunning
                                                nolnol.Append("0")
                                            Next
                                            nolnol.Append(TaxNumberrunRunning)

                                            TaxNumberrunRunning = nolnol.ToString
                                        End If

                                        Dim Combine As New StringBuilder
                                        Dim Combine2 As New StringBuilder

                                        Combine.Append(KDTRANS)
                                        Combine.Append(KDSTATUS)
                                        Combine.Append(".")
                                        Combine.Append(TaxPrefix1)
                                        Combine.Append("-")
                                        Combine.Append(TaxPrefix2)
                                        Combine.Append(".")
                                        'Combine.Append(TaxNumberRunning)
                                        Combine.Append(TaxNumberrunRunning)

                                        Combine2.Append(TaxNumberrunStartpref)
                                        Combine2.Append(TaxNumberrunRunning)

                                        'Dim query As String = "EXEC [dbo].[SOL_FAKTUR_PAJAK_CHECK] '" & Combine2.ToString & "','" & Combine.ToString & "','" & TaxPrefix2.ToString & "','" & TaxPrefix1.ToString & "','','" & TaxDate.ToString & "'"
                                        'oRec3.DoQuery(query)
                                        If oRec3.RecordCount = 0 Then
                                            Dim oNoRunning As SAPbouiCOM.EditText
                                            oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                            oNoRunning.Value = Combine2.ToString

                                            Dim oNoFaktur As SAPbouiCOM.EditText
                                            oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                            oNoFaktur.Value = Combine.ToString
                                        Else
                                            Dim oNoRunning As SAPbouiCOM.EditText
                                            oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                            oNoRunning.Value = ""

                                            Dim oNoFaktur As SAPbouiCOM.EditText
                                            oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)
                                            oNoFaktur.Value = ""

                                            MessageBox.Show(oRec3.Fields.Item("error_message").Value)

                                        End If

                                    ElseIf TaxYear = Left(TaxDate, 4) And IndexList <> 99999 Then
                                        Dim oNoRunning As SAPbouiCOM.EditText
                                        oNoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                        Dim oNoFaktur As SAPbouiCOM.EditText
                                        oNoFaktur = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText)

                                    End If
                                End If
                            End If
                        End If

                    Next
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                        oSBOApplication.StatusBar.SetText("Generating Faktur Pajak Number Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                        oMatrix.AutoResizeColumns()
                        oMatrix.FlushToDataSource()
                    Catch ex As Exception
                    End Try
                    oMatrix.FlushToDataSource()
                End If
            End If
        ElseIf pVal.ItemUID = "btnChoose" Then ' FUNGSI EXPORT TO CSV
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                    Try
                        If oSBOApplication.MessageBox("Are you sure to Export this Document?" & Chr(13) & oAP, 2, "Yes", "No") = 1 Then

                            Dim oForm As SAPbouiCOM.Form
                            oForm = oSBOApplication.Forms.Item(FormUID)
                            Dim oDocNum As SAPbouiCOM.EditText
                            oDocNum = oForm.Items.Item("DocNum").Specific
                            Dim title As String = oForm.Title.ToString
                            Dim oMatrix As SAPbouiCOM.Matrix
                            Dim success As Boolean = True
                            oMatrix = oForm.Items.Item("tblData").Specific

                            'Isi DocEntry untuk get dan update
                            Dim KeyA As String = ""
                            Dim KeyB As String = ""

                            'Array untuk cek jenis dokumen
                            Dim MyArray() As String = {"13", "18", "14", "19"}
                            'Loop through matrix
                            For i As Integer = 1 To oMatrix.RowCount
                                If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then
                                    If CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value <> "" Then
                                        'Check objType before adding to INDEX_OBJTYPE_KELUARAN

                                        'If objType is in the array (AR Invoice, AP Invoice, AR Credit Memo, and AP Credit Memo) fill in KeyA
                                        'Else (AR DP and AP DP) fill in KeyB
                                        Dim value As String = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
                                        Dim result As String = ""
                                        If value = "13a" Then
                                            value = "13"
                                        End If
                                        If value = "18a" Then
                                            value = "18"
                                        End If
                                        result = Array.Find(MyArray, Function(s) s = value)
                                        If result IsNot Nothing Then
                                            KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        Else
                                            KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        End If
                                    End If
                                End If
                            Next i

                            'Trim last comma (,) character
                            If KeyA <> "" Then
                                KeyA = Left(KeyA, Len(KeyA) - 1)
                            End If

                            If KeyB <> "" Then
                                KeyB = Left(KeyB, Len(KeyB) - 1)
                            End If

                            'Check active activedocument

                            'updateAR(KeyA, KeyB)

                            Dim oCmbTypeFP As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTypeFP").Specific
                            Dim oCmbJnsFp As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbJnsFp").Specific
                            Dim Type = "Massal"
                            If oCmbTypeFP.Value.ToString() <> "Massal" Then

                                Dim jenisFp = oCmbJnsFp.Value.ToString()
                                If jenisFp = "Pajak Keluaran" Then
                                    Type = "PK"
                                ElseIf jenisFp = "Pajak Masukan" Then
                                    Type = "PM"
                                ElseIf jenisFp = "Retur Pajak Keluaran" Then
                                    Type = "RPK"
                                ElseIf jenisFp = "Retur Pajak Masukan" Then
                                    Type = "RPM"
                                End If
                            End If


                            If Type = "PK" Then 'Pajak Keluaran (A/R Invoice dan A/R DP)
                                If success = True Then
                                    getPajakKeluaran(KeyA, KeyB, "Invoice") ' loncat ke getpajakkeluaran dengan typeform Invoice
                                End If
                            ElseIf Type = "PM" Then 'Pajak Masukan (A/P Invoice dan A/P DP)
                                getPajakMasukan(KeyA, KeyB)
                            ElseIf Type = "RPK" Then 'Retur Keluaran (A/R Credit Memo)
                                getReturKeluaran(KeyA)
                            ElseIf Type = "RPM" Then 'Retur Masukan (A/P Credit Memo)
                                getReturMasukan(KeyA)
                            ElseIf Type = "DLM" Then 'Dokumen Lain Masukan 'Tambahan Ricky (A/P Invoice dan A/P DP dan A/P Credit Memo)

                                KeyA = ""
                                KeyB = ""

                                Dim APinv = "18"
                                Dim APDPinv = "204"
                                Dim APinvcm = "19"
                                Dim KeyC As String = "" 'Dokumen Lain Masukan Credit memo

                                For i As Integer = 1 To oMatrix.RowCount
                                    If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

                                        If CType(oMatrix.Columns.Item(INDEX_OBJTYPE_DOKLAIN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APinv Then
                                            KeyA += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        ElseIf CType(oMatrix.Columns.Item(INDEX_OBJTYPE_DOKLAIN).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APDPinv Then
                                            KeyB += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        Else ' ap invoice credit memo - ELSE 'If CType(oMatrix.Columns.Item(INDEX_OBJTYPE).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value = APinv Then
                                            KeyC += CType(oMatrix.Columns.Item(INDEX_DOCENTRY).Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
                                        End If
                                    End If
                                Next i

                                'Trim last comma (,) character
                                'If KeyA <> "" Then
                                '    KeyA = Left(KeyA, Len(KeyA) - 1)
                                'End If

                                'If KeyB <> "" Then
                                '    KeyB = Left(KeyB, Len(KeyB) - 1)
                                'End If

                                'If KeyC <> "" Then
                                '    KeyC = Left(KeyC, Len(KeyC) - 1)
                                'End If

                                'getDokumenLainMasukan(KeyA, KeyB, KeyC)
                            ElseIf Type = "Massal" Then
                                getPajakKeluaran(KeyA, KeyB, "Massal") ' loncat ke getpajakkeluaran dengan typeform Massal

                            End If




                            If oDBSOL_FPMS_HD.GetValue("U_DOCSTAT", 0) <> "L" And GlobalVar.ExportedFile = True Then
                                Dim oRec As SAPbobsCOM.Recordset
                                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                                Dim Query As String = ""
                                'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'E' " + ' @SOL_FP_TRX_MS_HD = table header form pajak Massal (UDT)
                                '        "WHERE ""DocNum"" = '" & oDocNum.Value & "'"
                                'oRec.DoQuery(Query)
                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntry As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData


                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & oDocNum.Value & "'")
                                DocEntry = oRecDocEntry.Fields.Item("DocEntry").Value

                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntry)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "E")
                                oGeneralService.Update(oGeneralData)
                            End If

                            'oSBOApplication.ActivateMenuItem("1304")

                            If (GlobalVar.ExportedFile = True) Then
                                oSBOApplication.StatusBar.SetText("Success Export CSV", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                            ElseIf (GlobalVar.ExportedFile = False) Then
                                oSBOApplication.StatusBar.SetText("Cancel Export CSV", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                            End If


                        End If
                    Catch ex As Exception
                        oSBOApplication.MessageBox(ex.Message)
                    End Try
                End If
            End If
        ElseIf pVal.ItemUID = "cmbTypeFP" Then
            If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                Dim oForm As SAPbouiCOM.Form
                oForm = oSBOApplication.Forms.Item(FormUID)



                Dim oStatus = oForm.Items.Item("txtDocStat").Specific
                If oStatus.value = "N" Or oStatus.value = "O" Then

                    oForm.Items.Item("cmbJnsFp").Enabled = False

                    oForm.Items.Item("btnGenFP").Enabled = True

                    Dim oCmbTypeFP As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbTypeFP").Specific
                    Dim oChbxIncludeFP As SAPbouiCOM.CheckBox = oForm.Items.Item("chkOFF").Specific
                    Dim oChbxExported As SAPbouiCOM.CheckBox = oForm.Items.Item("Item_4").Specific

                    oChbxIncludeFP.Checked = True
                    oChbxExported.Checked = True




                    If (oCmbTypeFP.ValidValues.Count > 0) Then
                        If (oCmbTypeFP.Value.ToString() <> "Massal") Then

                            oChbxIncludeFP.Checked = True
                            oChbxExported.Checked = False

                            Dim oCmbJenisFaktur As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbJnsFp").Specific
                            If (oCmbJenisFaktur.Value.Count > 0) Then
                                oCmbJenisFaktur.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                            End If

                            oForm.Items.Item("cmbJnsFp").Enabled = True
                            oForm.Items.Item("btnGenFP").Enabled = False
                        End If

                        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific

                        If (oCmbTypeFP.Value.ToString() <> "Massal") Then
                            oChbxIncludeFP.Checked = True
                            oChbxExported.Checked = False

                            oMatrix.Columns.Item("KDTRANS").Editable = False
                            oMatrix.Columns.Item("PPNSTAT").Editable = False
                            oMatrix.Columns.Item("KMK").Editable = False
                            oMatrix.Columns.Item("KDDUK").Editable = False
                        Else
                            Dim oCmbJenisFaktur As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbJnsFp").Specific
                            Try
                                oCmbJenisFaktur.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)
                            Catch ex As Exception

                            End Try

                            oChbxIncludeFP.Checked = False
                            oChbxExported.Checked = False
                            Dim a = oChbxExported.Checked.ToString

                            oMatrix.Columns.Item("KDTRANS").Editable = True
                            oMatrix.Columns.Item("PPNSTAT").Editable = True
                            oMatrix.Columns.Item("KMK").Editable = True
                            oMatrix.Columns.Item("KDDUK").Editable = True

                        End If

                        Dim oCmbJnsFp As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbJnsFp").Specific
                        If (oCmbJnsFp.Value.ToString() = "Pajak Masukan" Or oCmbJnsFp.Value.ToString() = "Retur Pajak Masukan") Then
                            oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Vendor Code"
                            oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Vendor Name"
                        Else
                            oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Customer Code"
                            oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Customer Name"
                        End If

                    End If


                End If


            End If

        ElseIf pVal.ItemUID = "cmbJnsFp" Then

            If pVal.ActionSuccess = True And pVal.BeforeAction = False Then
                Dim oForm As SAPbouiCOM.Form
                oForm = oSBOApplication.Forms.Item(FormUID)

                Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific

                Dim oCmbJnsFp As SAPbouiCOM.ComboBox = oForm.Items.Item("cmbJnsFp").Specific

                If (oCmbJnsFp.Value.ToString() = "Pajak Masukan" Or oCmbJnsFp.Value.ToString() = "Retur Pajak Masukan") Then
                    oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Vendor Code"
                    oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Vendor Name"
                Else
                    oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Customer Code"
                    oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Customer Name"
                End If
            End If


        End If
    End Sub

    Public Sub DataEvent_Handler_Massal(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
        If BusinessObjectInfo.EventType = SAPbouiCOM.BoEventTypes.et_FORM_DATA_LOAD Then
            If BusinessObjectInfo.BeforeAction = False And BusinessObjectInfo.ActionSuccess = True Then
                CheckStatusMassal()
            End If
        End If
    End Sub

    Private Sub CheckStatusMassal()
        Dim oFormFPMassal As SAPbouiCOM.Form
        Dim oMatrix As SAPbouiCOM.Matrix
        Dim oDefaultButton As SAPbouiCOM.Button
        Dim oStatus As SAPbouiCOM.ComboBox
        Dim status As String

        oFormFPMassal = oSBOApplication.Forms.Item("frmOffFKMASSAL")
        oMatrix = oFormFPMassal.Items.Item("tblData").Specific
        oDefaultButton = oFormFPMassal.Items.Item("1").Specific
        oStatus = oFormFPMassal.Items.Item("txtDocStat").Specific
        Try
            oFormFPMassal.Freeze(True)

            If oStatus.Value = "N" Then

                oFormFPMassal.Items.Item("haha").Click()
                oFormFPMassal.Items.Item("chkCST").Enabled = True
                oFormFPMassal.Items.Item("txtCSTFR").Enabled = True
                oFormFPMassal.Items.Item("txtCSTTO").Enabled = True
                oFormFPMassal.Items.Item("chkINVNO").Enabled = True
                oFormFPMassal.Items.Item("txtFRINVNO").Enabled = True
                oFormFPMassal.Items.Item("txtTOINVNO").Enabled = True
                oFormFPMassal.Items.Item("chkINVDT").Enabled = True
                oFormFPMassal.Items.Item("txtFRINVDT").Enabled = True
                oFormFPMassal.Items.Item("txtTOINVDT").Enabled = True
                oFormFPMassal.Items.Item("chkOFF").Enabled = True
                oFormFPMassal.Items.Item("txtRemark").Enabled = True
                oFormFPMassal.Items.Item("txtNotes").Enabled = False
                oFormFPMassal.Items.Item("DocNum").Enabled = False
                oFormFPMassal.Items.Item("txtDocDate").Enabled = True
                oFormFPMassal.Items.Item("txtDocStat").Enabled = False
                oFormFPMassal.Items.Item("cmbBranch").Enabled = True

                oFormFPMassal.Items.Item("btnSearch").Enabled = True
                oFormFPMassal.Items.Item("btnGenFP").Enabled = True
                oFormFPMassal.Items.Item("btnChoose").Enabled = False
                oFormFPMassal.Items.Item("1").Enabled = True

                oFormFPMassal.Items.Item("cmbJnsFp").Enabled = True
                oFormFPMassal.Items.Item("cmbTypeFP").Enabled = True

                oMatrix.Item.Enabled = True
                oMatrix.Columns.Item("EXPORT").Visible = False
                oFormFPMassal.Items.Item("Item_4").Enabled = True
                oFormFPMassal.Items.Item("txtCSTFR").Click()
                oMatrix.Columns.Item("DTBRANCH").Editable = False
                oMatrix.Columns.Item("KDSTATUS").Editable = False
                oMatrix.Columns.Item("NNPWP").Editable = False
                oMatrix.Columns.Item("NPWP").Editable = False
                oMatrix.Columns.Item("Alamat").Editable = False
                oMatrix.Columns.Item("NORUN").Editable = False
                oMatrix.Columns.Item("NOFP").Editable = False


                oMatrix.Columns.Item("KDTRANS").Editable = True
                oMatrix.Columns.Item("PPNSTAT").Editable = True
                oMatrix.Columns.Item("KMK").Editable = True
                oMatrix.Columns.Item("KDDUK").Editable = True

                oMatrix.Columns.Item("CapFas").Editable = False
                oMatrix.Columns.Item("JnsIdPb").Editable = False
                oMatrix.Columns.Item("NoDocPb").Editable = False
                oMatrix.Columns.Item("IDTKUPb").Editable = False


            ElseIf oStatus.Value = "O" Or oStatus.Value = "F" Then

                oFormFPMassal.Items.Item("haha").Click()
                oFormFPMassal.Items.Item("chkCST").Enabled = False
                oFormFPMassal.Items.Item("txtCSTFR").Enabled = False
                oFormFPMassal.Items.Item("txtCSTTO").Enabled = False
                oFormFPMassal.Items.Item("chkINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVNO").Enabled = True
                oFormFPMassal.Items.Item("txtTOINVNO").Enabled = False
                oFormFPMassal.Items.Item("chkINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtTOINVDT").Enabled = False
                oFormFPMassal.Items.Item("chkOFF").Enabled = False
                oFormFPMassal.Items.Item("txtRemark").Enabled = False
                oFormFPMassal.Items.Item("txtNotes").Enabled = False
                oFormFPMassal.Items.Item("DocNum").Enabled = False
                oFormFPMassal.Items.Item("txtDocDate").Enabled = False
                oFormFPMassal.Items.Item("txtDocStat").Enabled = False
                oFormFPMassal.Items.Item("cmbBranch").Enabled = False

                oFormFPMassal.Items.Item("btnSearch").Enabled = False

                'If (oFormFPMassal.Items.Item("cmbTypeFP").Specific.value = "On Invoice") Then
                oFormFPMassal.Items.Item("btnGenFP").Enabled = False
                'Else
                '    oFormFPMassal.Items.Item("btnGenFP").Enabled = True
                'End If

                oFormFPMassal.Items.Item("btnChoose").Enabled = True
                oFormFPMassal.Items.Item("1").Enabled = True

                oFormFPMassal.Items.Item("cmbJnsFp").Enabled = False
                oFormFPMassal.Items.Item("cmbTypeFP").Enabled = False


                oMatrix.Item.Enabled = False
                oMatrix.Columns.Item("EXPORT").Visible = False
                oFormFPMassal.Items.Item("Item_4").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtCSTFR").Click()

                oMatrix.Columns.Item("CapFas").Editable = False
                oMatrix.Columns.Item("JnsIdPb").Editable = False
                oMatrix.Columns.Item("NoDocPb").Editable = False
                oMatrix.Columns.Item("IDTKUPb").Editable = False

            ElseIf oStatus.Value = "L" Or oStatus.Value = "E" Then

                oFormFPMassal.Items.Item("haha").Click()
                oFormFPMassal.Items.Item("chkCST").Enabled = False
                oFormFPMassal.Items.Item("txtCSTFR").Enabled = False
                oFormFPMassal.Items.Item("txtCSTTO").Enabled = False
                oFormFPMassal.Items.Item("chkINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtTOINVNO").Enabled = False
                oFormFPMassal.Items.Item("chkINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtTOINVDT").Enabled = False
                oFormFPMassal.Items.Item("chkOFF").Enabled = False
                oFormFPMassal.Items.Item("txtRemark").Enabled = False
                oFormFPMassal.Items.Item("txtNotes").Enabled = False
                oFormFPMassal.Items.Item("DocNum").Enabled = False
                oFormFPMassal.Items.Item("txtDocDate").Enabled = False
                oFormFPMassal.Items.Item("txtDocStat").Enabled = False
                oFormFPMassal.Items.Item("cmbBranch").Enabled = False

                oFormFPMassal.Items.Item("btnSearch").Enabled = False
                oFormFPMassal.Items.Item("btnGenFP").Enabled = False
                oFormFPMassal.Items.Item("btnChoose").Enabled = True
                oFormFPMassal.Items.Item("1").Enabled = True

                oFormFPMassal.Items.Item("cmbTypeFP").Enabled = False
                oFormFPMassal.Items.Item("cmbJnsFp").Enabled = False
                oFormFPMassal.Items.Item("Item_4").Enabled = False

                oMatrix.Columns.Item("CapFas").Editable = False
                oMatrix.Columns.Item("JnsIdPb").Editable = False
                oMatrix.Columns.Item("NoDocPb").Editable = False
                oMatrix.Columns.Item("IDTKUPb").Editable = False

                oMatrix.Item.Enabled = False
                oMatrix.Columns.Item("EXPORT").Visible = False

                oFormFPMassal.Items.Item("txtCSTFR").Click()

            ElseIf oStatus.Value = "C" Then

                oFormFPMassal.Items.Item("haha").Click()
                oFormFPMassal.Items.Item("chkCST").Enabled = False
                oFormFPMassal.Items.Item("txtCSTFR").Enabled = False
                oFormFPMassal.Items.Item("txtCSTTO").Enabled = False
                oFormFPMassal.Items.Item("chkINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVNO").Enabled = False
                oFormFPMassal.Items.Item("txtTOINVNO").Enabled = False
                oFormFPMassal.Items.Item("chkINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtFRINVDT").Enabled = False
                oFormFPMassal.Items.Item("txtTOINVDT").Enabled = False
                oFormFPMassal.Items.Item("chkOFF").Enabled = False
                oFormFPMassal.Items.Item("txtRemark").Enabled = False
                oFormFPMassal.Items.Item("txtNotes").Enabled = False
                oFormFPMassal.Items.Item("DocNum").Enabled = False
                oFormFPMassal.Items.Item("txtDocDate").Enabled = False
                oFormFPMassal.Items.Item("txtDocStat").Enabled = False
                oFormFPMassal.Items.Item("cmbBranch").Enabled = False

                oFormFPMassal.Items.Item("btnSearch").Enabled = False
                oFormFPMassal.Items.Item("btnGenFP").Enabled = False
                oFormFPMassal.Items.Item("btnChoose").Enabled = False
                oFormFPMassal.Items.Item("1").Enabled = True

                oFormFPMassal.Items.Item("cmbTypeFP").Enabled = False
                oFormFPMassal.Items.Item("cmbJnsFp").Enabled = False

                oFormFPMassal.Items.Item("Item_4").Enabled = False

                oMatrix.Item.Enabled = False

                oMatrix.Columns.Item("CapFas").Editable = False
                oMatrix.Columns.Item("JnsIdPb").Editable = False
                oMatrix.Columns.Item("NoDocPb").Editable = False
                oMatrix.Columns.Item("IDTKUPb").Editable = False

                oMatrix.Columns.Item("EXPORT").Visible = False

                oFormFPMassal.Items.Item("txtCSTFR").Click()
            End If


            Dim oCmbJnsFp As SAPbouiCOM.ComboBox = oFormFPMassal.Items.Item("cmbJnsFp").Specific

            If (oCmbJnsFp.Value.ToString() = "Pajak Masukan" Or oCmbJnsFp.Value.ToString() = "Retur Pajak Masukan") Then
                oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Vendor Code"
                oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Vendor Name"
            Else
                oMatrix.Columns.Item("CSTCD").TitleObject.Caption = "Customer Code"
                oMatrix.Columns.Item("CSTNM").TitleObject.Caption = "Customer Name"
            End If


            oFormFPMassal.Freeze(False)
        Catch ex As Exception
            oFormFPMassal.Freeze(False)
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Public Sub EnableAlFieldMassal()
        Try
            Dim oXMLDoc As New XmlDocument
            Dim oFormFPMassal As SAPbouiCOM.Form
            Dim oMatrix As SAPbouiCOM.Matrix

            oFormFPMassal = oSBOApplication.Forms.Item("frmOffFKMASSAL")
            oMatrix = oFormFPMassal.Items.Item("tblData").Specific

            oFormFPMassal.Items.Item("haha").Click()
            oFormFPMassal.Items.Item("chkCST").Enabled = True
            oFormFPMassal.Items.Item("txtCSTFR").Enabled = True
            oFormFPMassal.Items.Item("txtCSTTO").Enabled = True
            oFormFPMassal.Items.Item("chkINVNO").Enabled = True
            oFormFPMassal.Items.Item("txtFRINVNO").Enabled = True
            oFormFPMassal.Items.Item("txtTOINVNO").Enabled = True
            oFormFPMassal.Items.Item("chkINVDT").Enabled = True
            oFormFPMassal.Items.Item("txtFRINVDT").Enabled = True
            oFormFPMassal.Items.Item("txtTOINVDT").Enabled = True
            oFormFPMassal.Items.Item("chkOFF").Enabled = True
            oFormFPMassal.Items.Item("txtRemark").Enabled = True
            oFormFPMassal.Items.Item("txtNotes").Enabled = True
            oFormFPMassal.Items.Item("DocNum").Enabled = True
            oFormFPMassal.Items.Item("txtDocDate").Enabled = True
            oFormFPMassal.Items.Item("txtDocStat").Enabled = True
            oFormFPMassal.Items.Item("cmbBranch").Enabled = True

            oFormFPMassal.Items.Item("btnSearch").Enabled = False
            oFormFPMassal.Items.Item("btnGenFP").Enabled = False
            oFormFPMassal.Items.Item("btnChoose").Enabled = False
            oFormFPMassal.Items.Item("1").Enabled = True

            oMatrix.Item.Enabled = True
            oMatrix.Columns.Item("EXPORT").Visible = False

            oFormFPMassal.Items.Item("txtCSTFR").Click()

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try

    End Sub

    Public Sub CalculateHeaderAmountMS(ByVal FormUID As String)
        Dim oForm As SAPbouiCOM.Form
        oForm = oSBOApplication.Forms.Item(FormUID)

        Dim oMatrix As SAPbouiCOM.Matrix = oForm.Items.Item("tblData").Specific
        Dim iRows As Integer = 0

        oMatrix.FlushToDataSource()

        Dim DPPTemp As Decimal
        Dim PPNTemp As Decimal

        oMatrix = oForm.Items.Item("tblData").Specific

        For i As Integer = 0 To oDBSOL_FPMS_DT.Size - 1
            If oDBSOL_FPMS_DT.GetValue("U_SELECT", i) = "Y" Then

                'DPPTemp = DPPTemp + ConTLocalSNF(oDBSOL_FPMS_DT.GetValue("U_DPP", i))
                'PPNTemp = PPNTemp + ConTLocalSNF(oDBSOL_FPMS_DT.GetValue("U_PPN", i))

                DPPTemp = DPPTemp + SBONumbertoDecimal(oDBSOL_FPMS_DT.GetValue("U_DPP", i))
                PPNTemp = PPNTemp + SBONumbertoDecimal(oDBSOL_FPMS_DT.GetValue("U_PPN", i))

                'DPPTemp = DPPTemp + ConTLocalSNF(colDPP.Value)
                'PPNTemp = PPNTemp + ConTLocalSNF(colPPN.Value)

            End If
        Next i

        oDBSOL_FPMS_HD.SetValue("U_TDPP", 0, DPPTemp)
        oDBSOL_FPMS_HD.SetValue("U_TPPN", 0, PPNTemp)
        oDBSOL_FPMS_HD.SetValue("U_DOCTOT", 0, (DPPTemp + PPNTemp))
    End Sub

    Public Sub RightClickEvent_MS(ByRef eventinfo As SAPbouiCOM.ContextMenuInfo, ByRef bubbleEvent As Boolean)

        If eventinfo.ItemUID <> "tblData" And eventinfo.ItemUID <> "tblSummary" Then
            If eventinfo.BeforeAction = True And eventinfo.ActionSuccess = False Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm

                Dim Status As SAPbouiCOM.ComboBox = oForm.Items.Item("txtDocStat").Specific

                Dim oMenus As SAPbouiCOM.Menus
                Dim oMenuItem As SAPbouiCOM.MenuItem
                Dim oCreationPackage As SAPbouiCOM.MenuCreationParams

                oCreationPackage = oSBOApplication.CreateObject(SAPbouiCOM.BoCreatableObjectType.cot_MenuCreationParams)
                oCreationPackage.Type = SAPbouiCOM.BoMenuType.mt_STRING

                oMenuItem = oSBOApplication.Menus.Item("1280")
                oMenus = oMenuItem.SubMenus

                If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")

                If Status.Selected.Value = "O" Then
                    'If (oMenus.Exists("CLS") = False) Then
                    '    oCreationPackage.UniqueID = "CLS"
                    '    oCreationPackage.String = "Close Document"
                    '    oCreationPackage.Position = 1
                    '    oCreationPackage.Enabled = True
                    '    oMenus.AddEx(oCreationPackage)
                    'End If
                    If (oMenus.Exists("CNC") = False) Then
                        oCreationPackage.UniqueID = "CNC"
                        oCreationPackage.String = "Cancel Document"
                        oCreationPackage.Position = 2
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If
                ElseIf Status.Selected.Value = "E" Then
                    If (oMenus.Exists("CLS") = False) Then
                        oCreationPackage.UniqueID = "CLS"
                        oCreationPackage.String = "Close Document"
                        oCreationPackage.Position = 1
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If


                    Dim oRec As SAPbobsCOM.Recordset
                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRec.DoQuery("SELECT 1 FROM OUSR WHERE ""USER_CODE"" = '" & oSBOCompany.UserName & "' AND ""U_SOL_FP_ROLE"" = '1' ")

                    If (oMenus.Exists("CNC") = False) And oRec.RecordCount > 0 Then
                        oCreationPackage.UniqueID = "CNC"
                        oCreationPackage.String = "Cancel Document"
                        oCreationPackage.Position = 2
                        oCreationPackage.Enabled = True
                        oMenus.AddEx(oCreationPackage)
                    End If


                Else
                    If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
                    If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")
                End If
            End If
        End If
    End Sub

#End Region


#Region "EFaktur Masukan"

    Sub ItemEventHandler_PurchaseScanFP(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If pVal.EventType = SAPbouiCOM.BoEventTypes.et_FORM_LOAD And pVal.BeforeAction = False Then
            Dim oForm = oSBOApplication.Forms.Item(pVal.FormUID)
            ''Add New Button
            'Dim oNewItem = oForm.Items.Add("btnScan", SAPbouiCOM.BoFormItemTypes.it_BUTTON)
            'Dim oItem = oForm.Items.Item("2") 'Cancel button
            'oNewItem.Height = oItem.Height 'same height
            'oNewItem.Width = oItem.Width + 50
            'oNewItem.Top = oItem.Top 'same top
            'oNewItem.Left = oItem.Left + 75 'add to the left so its positioned next to Cancel
            'Dim oButton As SAPbouiCOM.Button = CType(oNewItem.Specific, SAPbouiCOM.Button)
            'oButton.Caption = "Scan Barcode FP"

        ElseIf pVal.ItemUID = "btnScan" And pVal.BeforeAction = False And pVal.EventType = SAPbouiCOM.BoEventTypes.et_CLICK Then

            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(pVal.FormUID)
            ParentFormUniqueID = oForm.UniqueID
            Dim oXMLDoc As New XmlDocument

            'Check apakah form scanner sedang ada yg terbuka
            Dim formExist As Boolean = False
            Try
                oForm = oSBOApplication.Forms.Item("frmScanFP")
                formExist = True
                oForm.Select()
            Catch ex As Exception
                formExist = False
            End Try
            If formExist Then
                BubbleEvent = False
                Return
            Else
                oXMLDoc.Load("eFakturScan.srf")
                oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
            End If


            ''Membuka form scanner
            'Dim newForm As New ScannerForm(parentDT, oItemDT, "23", "1", "10")
            'newForm.Show()
            'newForm.mtxScanned.LoadFromDataSource()
        End If
    End Sub

    Sub ItemEventHandler_eFakturScan(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)

        If pVal.ItemUID = "btnSearch" And pVal.BeforeAction = False And pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then

            Try
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(pVal.FormUID)
                Dim URL As SAPbouiCOM.EditText = oForm.Items.Item("txtURL").Specific
                Dim oFormParent As SAPbouiCOM.Form = oSBOApplication.Forms.Item(ParentFormUniqueID)
                Dim oformParentUDF As SAPbouiCOM.Form = oSBOApplication.Forms.Item(oFormParent.UDFFormUID)

                Dim KodeTransaksiFP As SAPbouiCOM.ComboBox = oformParentUDF.Items.Item("U_SOL_FP_TRX_CODE").Specific
                Dim KodeStatusFP As SAPbouiCOM.ComboBox = oformParentUDF.Items.Item("U_SOL_FP_STATUS_CODE").Specific
                Dim NomorFP As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_FP_RUNNING_NO").Specific
                Dim FullNomorFP As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_FP_FULL_NO").Specific
                Dim TanggalFP As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_PPN_DATE").Specific
                'Dim TipeScan As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_EFAKTUR_SCAN_TYPE").Specific
                'Dim DPPFP As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_EFAKTUR_SCAN_DPP").Specific
                'Dim PPNFP As SAPbouiCOM.EditText = oformParentUDF.Items.Item("U_SOL_EFAKTUR_SCAN_PPN").Specific
                Dim DateFP As DateTime
                If URL.Value = "" Then
                    oSBOApplication.MessageBox("URL Cannot Empty!")
                Else

                    Dim ds As DataSet = New DataSet("XmlData")
                    Try
                        'Try to read the XML from the URL
                        ds.ReadXml(URL.Value)
                    Catch ex As Exception
                        Console.WriteLine(ex.Message)
                    Finally
                        oForm.Close()
                    End Try

                    For Each row As DataRow In ds.Tables(0).Rows

                        Try
                            KodeTransaksiFP.Select(row.Item("kdJenisTransaksi"), SAPbouiCOM.BoSearchKey.psk_ByValue)
                        Catch ex As Exception
                        End Try

                        Try
                            KodeStatusFP.Select(row.Item("fgPengganti"), SAPbouiCOM.BoSearchKey.psk_ByValue)
                        Catch ex As Exception
                        End Try
                        Try
                            NomorFP.Value = row.Item("nomorFaktur")
                        Catch ex As Exception
                        End Try
                        Try
                            DateFP = Convert.ToDateTime(row.Item("tanggalFaktur"))
                            TanggalFP.Value = DateFP.ToString("yyyyMMdd")
                        Catch ex As Exception
                        End Try

                        Try
                            Dim NomorFPS As String = NomorFP.Value
                            FullNomorFP.Value = KodeTransaksiFP.Selected.Value + KodeStatusFP.Selected.Value + "." + NomorFPS.Substring(0, 3) + "-" + NomorFPS.Substring(3, 2) + "." + NomorFPS.Substring(5, 8)

                        Catch ex As Exception
                        End Try

                        'Console.WriteLine(row.Item("kdJenisTransaksi"))
                        'Console.WriteLine(row.Item("fgPengganti"))
                        'Console.WriteLine(row.Item("nomorFaktur"))
                        'Console.WriteLine(row.Item("tanggalFaktur"))
                        'Console.WriteLine(row.Item("jumlahDpp"))
                        'Console.WriteLine(row.Item("jumlahPpn"))
                    Next
                    oSBOApplication.MessageBox("Complete Scan Barcode FP!")
                End If
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try

        ElseIf pVal.ItemUID = "btnCancel" And pVal.BeforeAction = False And pVal.EventType = SAPbouiCOM.BoEventTypes.et_CLICK Then
            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(pVal.FormUID)
            oForm.Close()
        End If
    End Sub


#End Region

#Region " FormDataEvent Handler "

    Public Sub FormDataEvent_Handler(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
    End Sub

#End Region

#Region " RighClickEvent Handler "

    Public Sub RightClickEvent_Handler(ByRef eventInfo As SAPbouiCOM.ContextMenuInfo, ByRef BubbleEvent As Boolean)

        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm

        Dim oMenus As SAPbouiCOM.Menus
        Dim oMenuItem As SAPbouiCOM.MenuItem
        Dim oCreationPackage As SAPbouiCOM.MenuCreationParams

        oMenuItem = oSBOApplication.Menus.Item("1280")
        oMenus = oMenuItem.SubMenus
        If (oMenus.Exists("CLS")) Then oMenus.RemoveEx("CLS")
        If (oMenus.Exists("CNC")) Then oMenus.RemoveEx("CNC")
    End Sub

#End Region

#Region "Global Function "

    Public Class WindowWrapper
        Implements System.Windows.Forms.IWin32Window
        Private _hwnd As IntPtr

        Public Sub New(ByVal handle As IntPtr)
            _hwnd = handle
        End Sub

        Public ReadOnly Property Handle() As System.IntPtr Implements System.Windows.Forms.IWin32Window.Handle
            Get
                Return _hwnd
            End Get
        End Property

    End Class

    Public Sub IndexSetup()

        Try
            INDEX_DOCENTRY = 2
            INDEX_OBJTYPE_KELUARAN = 4
            INDEX_TAXDATE_KELUARAN = 6

            INDEX_DOCENTRY_OFF_1ON1 = 7
            INDEX_OBJTYPE_KELUARAN_OFF_1ON1 = 9
            INDEX_TAXDATE_KELUARAN_OFF_1ON1 = 11
            INDEX_RUNNING_KELUARAN_OFF_1ON1 = 4
            INDEX_NO_FAKTUR_KELUARAN_OFF_1ON1 = 5
            INDEX_KODE_TRANS_OFF_1ON1 = 2
            INDEX_KODE_STATUS_OFF_1ON1 = 3

            INDEX_OBJTYPE_KELUARAN_OFF_GABUNGAN = 2
            INDEX_DOCENTRY_OFF_GABUNGAN = 3
            INDEX_TAXDATE_KELUARAN_OFF_GABUNGAN = 11
            INDEX_RUNNING_KELUARAN_OFF_GABUNGAN = 2
            INDEX_NO_FAKTUR_KELUARAN_OFF_GABUNGAN = 3
            INDEX_DPP_KELUARAN_OFF_GABUNGAN = 18
            INDEX_PPH_KELUARAN_OFF_GABUNGAN = 17
            INDEX_KODE_BP_OFF_1ON1 = 4
            INDEX_KODE_NAME_OFF_1ON1 = 5

            INDEX_DOCENTRY_OFF_GUNGGUNG = 5
            INDEX_OBJTYPE_KELUARAN_OFF_GUNGGUNG = 7
            INDEX_TAXDATE_KELUARAN_OFF_GUNGGUNG = 9
            INDEX_RUNNING_KELUARAN_OFF_GUNGGUNG = 2
            INDEX_NO_FAKTUR_KELUARAN_OFF_GUNGGUNG = 3

            'INDEX_DOCENTRY_OFF_1ON1 = 8
            'INDEX_OBJTYPE_KELUARAN_OFF_1ON1 = 10
            'INDEX_TAXDATE_KELUARAN_OFF_1ON1 = 12
            'INDEX_RUNNING_KELUARAN_OFF_1ON1 = 5
            'INDEX_NO_FAKTUR_KELUARAN_OFF_1ON1 = 6

            'INDEX_DOCENTRY_OFF_GABUNGAN = 8
            'INDEX_OBJTYPE_KELUARAN_OFF_GABUNGAN = 10
            'INDEX_TAXDATE_KELUARAN_OFF_GABUNGAN = 12
            'INDEX_RUNNING_KELUARAN_OFF_GABUNGAN = 3
            'INDEX_NO_FAKTUR_KELUARAN_OFF_GABUNGAN = 4

            'INDEX_DOCENTRY_OFF_GUNGGUNG = 6
            'INDEX_OBJTYPE_KELUARAN_OFF_GUNGGUNG = 8
            'INDEX_TAXDATE_KELUARAN_OFF_GUNGGUNG = 10
            'INDEX_RUNNING_KELUARAN_OFF_GUNGGUNG = 3
            'INDEX_NO_FAKTUR_KELUARAN_OFF_GUNGGUNG = 4

            INDEX_DOCENTRY_ELSE = 2
            INDEX_OBJTYPE_KELUARAN_ELSE = 4
            INDEX_OBJTYPE_MASUKAN = 4
            INDEX_OBJTYPE_DOKLAIN = 7

        Catch ex As Exception
            Dim errorr As String = ex.Message
        End Try
    End Sub

    Private Sub SaveToFile(ByVal fileNameParam As String, ByVal saveDataParam As String)
        Try
            GlobalVar.ExportedFile = False

            Dim MyWindow As WindowWrapper = Nothing
            Dim MyProcs() As Process

            MyProcs = Process.GetProcessesByName("SAP Business One")

            If MyProcs.Length = 1 Then
                MyWindow = New WindowWrapper(MyProcs(0).MainWindowHandle)
            End If

            Dim fileSaver = New System.Windows.Forms.SaveFileDialog
            With fileSaver
                '.Filter = "CSV ( *.csv )|*.csv"
                .Filter = "xml ( *.xml )|*.xml"
                '.Filter = "Excel Files|*.xlsx;*.xls;*.xlsm"
                .FilterIndex = 2
                .InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.Personal)
                .Title = "Save File"
                .RestoreDirectory = True
                .FileName = fileNameParam
            End With

            Dim myStream As Stream

            If fileSaver.ShowDialog(CType(MyWindow, IWin32Window)) = Windows.Forms.DialogResult.OK Then
                myStream = fileSaver.OpenFile()
                If (myStream IsNot Nothing) Then
                    'Code to write the stream goes here.
                    Dim byteToSave As Byte()
                    byteToSave = New System.Text.UTF8Encoding().GetBytes(saveDataParam)
                    myStream.Write(byteToSave, 0, byteToSave.Length)
                    myStream.Close()

                    GlobalVar.ExportedFile = True
                End If
            End If
        Catch
        End Try
    End Sub

    Public Function CreateForm(ByVal title As String, ByVal type As String, ByVal sql As String) As SAPbouiCOM.Form
        Dim oForm As SAPbouiCOM.Form
        Dim FormExist As Boolean = False
        Dim oItem As SAPbouiCOM.Item
        Dim oMatrix As SAPbouiCOM.Matrix
        Dim oTextType As SAPbouiCOM.EditText
        Dim oButtonChoose As SAPbouiCOM.Button
        Dim oButtonCancel As SAPbouiCOM.Button
        Dim oButtonGen As SAPbouiCOM.Button
        Dim oStatBranch As SAPbouiCOM.StaticText
        Dim oTxtBranch As SAPbouiCOM.EditText
        Dim GenFPType As String = ""

        'Check if the form already exist
        Try
            oForm = oSBOApplication.Forms.Item("frmLookUp")
            FormExist = True
        Catch ex As Exception
            FormExist = False
        End Try

        If Not FormExist Then
            'Form not exist -> add and customize
            'Add form and set the UI
            oForm = oSBOApplication.Forms.Add("frmLookUp", SAPbouiCOM.BoFormTypes.ft_Sizable)
            With oForm
                .AutoManaged = False
                .Height = 300
                .Left = 370
                .Title = title
                .Top = 88
                .Width = 800
            End With

            'Button Choose
            oItem = oForm.Items.Add("btnChoose", SAPbouiCOM.BoFormItemTypes.it_BUTTON)
            With oItem
                .Height = 19
                .Left = 16
                .Top = 232
                .Width = 75
            End With

            oButtonChoose = oItem.Specific
            With oButtonChoose
                .Caption = "Generate Excel"
            End With

            'Button Cancel
            oItem = oForm.Items.Add("btnCancel", SAPbouiCOM.BoFormItemTypes.it_BUTTON)
            With oItem
                .Height = 19
                .Left = 96
                .Top = 232
                .Width = 75
            End With

            oButtonCancel = oItem.Specific
            With oButtonCancel
                .Caption = "Cancel"
            End With

            'Add Matrix and set the UI
            oItem = oForm.Items.Add("tblData", SAPbouiCOM.BoFormItemTypes.it_MATRIX)
            With oItem
                .Height = 210
                .Left = 16
                .Top = 16
                .Width = 760
                .Enabled = True
            End With

            oMatrix = oItem.Specific
            oMatrix.SelectionMode = SAPbouiCOM.BoMatrixSelect.ms_Auto


            'Text Type
            Dim oTT As SAPbouiCOM.Item
            oTT = oForm.Items.Add("txtType", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            With oTT
                .Height = 0
                .Left = 0
                .Top = 0
                .Width = 0
            End With

            oTextType = oTT.Specific
            With oTextType
                .Value = type
            End With

            'oTT.Visible = False
        Else
            oForm = oSBOApplication.Forms.Item("frmLookUp")
            oButtonChoose = oForm.Items.Item("btnChoose").Specific
            oButtonCancel = oForm.Items.Item("btnCancel").Specific
            oMatrix = oForm.Items.Item("tblData").Specific
            'Reload title
            oForm.Title = title
            'Reload Type
            CType(oForm.Items.Item("txtType").Specific, SAPbouiCOM.EditText).Value = type
        End If

        oForm.Visible = True
        'Load Matrix

        fillTable(sql, oForm, oMatrix, type, GenFPType)

        oForm.DefButton = "btnChoose"

        Return oForm
    End Function

    Private Sub updateAR(ByVal DocEntAR As String, ByVal DocEntARDP As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRecDP As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim ContinueLoop As Boolean = True
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRecDP = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Update A/R Invoice
        If DocEntAR <> "" Then
            'Dim SqlQuery As String = "SELECT ""DocEntry"" " &
            '                "FROM OINV " +
            '                "WHERE " +
            '                "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
            '                "(OINV.""DocEntry"" IN (" & DocEntAR & "))"

            'Dim HanaQuery As String = "SELECT ""DocEntry"" " &
            '                "FROM OINV " +
            '                "WHERE " +
            '                "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
            '                "(OINV.""DocEntry"" IN (" & DocEntAR & "))"

            'If oSQLConnection.ServerType = "SQL" Then
            '    oRec.DoQuery(SqlQuery)
            'Else
            '    oRec.DoQuery(HanaQuery)
            'End If

            If (oRec.RecordCount > 0) Then
                Try
                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AR Invoice ", oRec.RecordCount, False)
                    oProgBar.Value = 0
                Catch ex As Exception
                End Try

                Dim i As Integer = 0

                Try
                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    While (Not oRec.EoF)
                        Dim DocEntry As String
                        DocEntry = oRec.Fields.Item("DocEntry").Value


                        Dim oDoc As SAPbobsCOM.Documents
                        oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oInvoices)

                        If oDoc.GetByKey(DocEntry) Then
                            'oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                            Dim iErrCode As Integer = 0
                            Dim sErrMsg As String = ""

                            If oDoc.Update() <> 0 Then
                                oSBOCompany.GetLastError(iErrCode, sErrMsg)
                                oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                                ContinueLoop = False
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                                Exit While
                            End If
                        End If

                        i += 1
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Updating AR Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                        Catch ex As Exception
                        End Try
                        oRec.MoveNext()
                    End While

                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try

                    GC.Collect()
                    oRec = Nothing
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                    End If
                Catch ex As Exception
                    oSBOApplication.MessageBox("Error while updating")
                    ContinueLoop = False
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                    End If
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try
                    GC.Collect()
                End Try
            End If
        End If

        '------------------------------------------------------------------Update A/R Down Payment Invoice
        If DocEntARDP <> "" And ContinueLoop = True Then
            'Dim SqlQuery As String = "SELECT ""DocEntry"" " &
            '                "FROM ODPI " +
            '                "WHERE " +
            '                "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
            '                "(ODPI.""DocEntry"" IN (" & DocEntARDP & "))"

            'Dim HanaQuery As String = "SELECT ""DocEntry"" " &
            '                "FROM ODPI " +
            '                "WHERE " +
            '                "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
            '                "(ODPI.""DocEntry"" IN (" & DocEntARDP & "))"

            'If oSQLConnection.ServerType = "SQL" Then
            '    oRecDP.DoQuery(SqlQuery)
            'Else
            '    oRecDP.DoQuery(HanaQuery)
            'End If

            If (oRecDP.RecordCount > 0) Then
                Try
                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AR DP Invoice ", oRecDP.RecordCount, False)
                    oProgBar.Value = 0
                Catch ex As Exception
                End Try

                Dim i As Integer = 0

                Try

                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    While (Not oRecDP.EoF)
                        Dim DocEntry As String
                        DocEntry = oRecDP.Fields.Item("DocEntry").Value

                        Dim oDoc As SAPbobsCOM.Documents
                        oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oDownPayments)

                        If oDoc.GetByKey(DocEntry) Then
                            'oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                            Dim iErrCode As Integer = 0
                            Dim sErrMsg As String = ""

                            If oDoc.Update() <> 0 Then
                                oSBOCompany.GetLastError(iErrCode, sErrMsg)
                                oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                                ContinueLoop = False
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                                Exit While
                            End If
                        End If

                        i += 1
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Updating AR DP Invoice '" & i & "'/'" & oRecDP.RecordCount & "'"
                        Catch ex As Exception
                        End Try
                        oRecDP.MoveNext()
                    End While

                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try

                    GC.Collect()

                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                    End If
                Catch ex As Exception
                    oSBOApplication.MessageBox("Error while updating")
                    ContinueLoop = False
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                    End If
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try
                    GC.Collect()
                End Try
            End If

        End If


    End Sub

    Private Sub updateAP(ByVal DocEntAP As String, ByVal DocEntAPDP As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRecDP As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim ContinueLoop As Boolean = True
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRecDP = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Update A/R Invoice
        If DocEntAP <> "" Then
            Dim SqlQuery As String = "SELECT ""DocEntry"" " &
                            "FROM OPCH " +
                            "WHERE " +
                            "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAP & "))"

            Dim HanaQuery As String = "SELECT ""DocEntry"" " &
                            "FROM OPCH " +
                            "WHERE " +
                            "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAP & "))"

            If oSQLConnection.ServerType = "SQL" Then
                oRec.DoQuery(SqlQuery)
            Else
                oRec.DoQuery(HanaQuery)
            End If

            If (oRec.RecordCount > 0) Then
                Try
                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AP Invoice ", oRec.RecordCount, False)
                    oProgBar.Value = 0
                Catch ex As Exception
                End Try

                Dim i As Integer = 0

                Try
                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    While (Not oRec.EoF)
                        Dim DocEntry As String
                        DocEntry = oRec.Fields.Item("DocEntry").Value


                        Dim oDoc As SAPbobsCOM.Documents
                        oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oPurchaseInvoices)

                        If oDoc.GetByKey(DocEntry) Then
                            oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                            Dim iErrCode As Integer = 0
                            Dim sErrMsg As String = ""

                            If oDoc.Update() <> 0 Then
                                oSBOCompany.GetLastError(iErrCode, sErrMsg)
                                oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                                ContinueLoop = False
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                                Exit While
                            End If
                        End If

                        i += 1
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Updating AP Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                        Catch ex As Exception
                        End Try
                        oRec.MoveNext()
                    End While

                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try

                    GC.Collect()
                    oRec = Nothing
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                    End If
                Catch ex As Exception
                    oSBOApplication.MessageBox("Error while updating")
                    ContinueLoop = False
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                    End If
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try
                    GC.Collect()
                End Try
            End If
        End If

        '------------------------------------------------------------------Update A/P Down Payment Invoice
        If DocEntAPDP <> "" And ContinueLoop = True Then
            Dim SqlQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ODPO " +
                            "WHERE " +
                            "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAPDP & "))"

            Dim HanaQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ODPO " +
                            "WHERE " +
                            "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAPDP & "))"

            If oSQLConnection.ServerType = "SQL" Then
                oRecDP.DoQuery(SqlQuery)
            Else
                oRecDP.DoQuery(HanaQuery)
            End If

            If (oRecDP.RecordCount > 0) Then
                Try
                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AP DP Invoice ", oRecDP.RecordCount, False)
                    oProgBar.Value = 0
                Catch ex As Exception
                End Try

                Dim i As Integer = 0

                Try

                    If Not oSBOCompany.InTransaction Then
                        oSBOCompany.StartTransaction()
                    End If

                    While (Not oRecDP.EoF)
                        Dim DocEntry As String
                        DocEntry = oRecDP.Fields.Item("DocEntry").Value

                        Dim oDoc As SAPbobsCOM.Documents
                        oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oPurchaseDownPayments)

                        If oDoc.GetByKey(DocEntry) Then
                            oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                            Dim iErrCode As Integer = 0
                            Dim sErrMsg As String = ""

                            If oDoc.Update() <> 0 Then
                                oSBOCompany.GetLastError(iErrCode, sErrMsg)
                                oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                                ContinueLoop = False
                                If oSBOCompany.InTransaction Then
                                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                                End If
                                Exit While
                            End If
                        End If

                        i += 1
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Updating AP DP Invoice '" & i & "'/'" & oRecDP.RecordCount & "'"
                        Catch ex As Exception
                        End Try
                        oRecDP.MoveNext()
                    End While

                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try

                    GC.Collect()

                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                    End If
                Catch ex As Exception
                    oSBOApplication.MessageBox("Error while updating")
                    ContinueLoop = False
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                    End If
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try
                    GC.Collect()
                End Try
            End If
        End If
    End Sub

    Private Sub updateARCM(ByVal DocEntARCM As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim ContinueLoop As Boolean = True
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Update A/R Credit Memo
        If DocEntARCM <> "" Then

            Dim SqlQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ORIN " +
                            "WHERE " +
                            "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntARCM & "))"

            Dim HanaQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ORIN " +
                            "WHERE " +
                            "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntARCM & "))"

            If oSQLConnection.ServerType = "SQL" Then
                oRec.DoQuery(SqlQuery)
            Else
                oRec.DoQuery(HanaQuery)
            End If

        End If

        If (oRec.RecordCount > 0) Then
            Try
                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AR Credit Memo ", oRec.RecordCount, False)
                oProgBar.Value = 0
            Catch ex As Exception
            End Try

            Dim i As Integer = 0

            Try
                If Not oSBOCompany.InTransaction Then
                    oSBOCompany.StartTransaction()
                End If

                While (Not oRec.EoF)
                    Dim DocEntry As String
                    DocEntry = oRec.Fields.Item("DocEntry").Value

                    Dim oDoc As SAPbobsCOM.Documents
                    oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oCreditNotes)

                    If oDoc.GetByKey(DocEntry) Then
                        oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                        Dim iErrCode As Integer = 0
                        Dim sErrMsg As String = ""

                        If oDoc.Update() <> 0 Then
                            oSBOCompany.GetLastError(iErrCode, sErrMsg)
                            oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                            ContinueLoop = False
                            If oSBOCompany.InTransaction Then
                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                            End If
                            Exit While
                        End If
                    End If

                    i += 1
                    Try
                        oProgBar.Value = i
                        oProgBar.Text = "Updating AR Credit Memo '" & i & "'/'" & oRec.RecordCount & "'"
                    Catch ex As Exception
                    End Try
                    oRec.MoveNext()
                End While

                Try
                    oProgBar.Stop()
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                    oProgBar = Nothing
                Catch exa As Exception
                End Try

                GC.Collect()
                oRec = Nothing
                If oSBOCompany.InTransaction Then
                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                End If
            Catch ex As Exception
                oSBOApplication.MessageBox("Error while updating")
                ContinueLoop = False
                If oSBOCompany.InTransaction Then
                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                End If
                Try
                    oProgBar.Stop()
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                    oProgBar = Nothing
                Catch exa As Exception
                End Try
                GC.Collect()
            End Try
        End If
    End Sub

    Private Sub updateAPCM(ByVal DocEntAPCM As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim ContinueLoop As Boolean = True
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Update A/R Credit Memo
        If DocEntAPCM <> "" Then

            Dim SqlQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ORPC " +
                            "WHERE " +
                            "ISNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAPCM & "))"

            Dim HanaQuery As String = "SELECT ""DocEntry"" " &
                            "FROM ORPC " +
                            "WHERE " +
                            "IFNULL(""U_SOL_EXPORTED"",0) != 1 AND " &
                            "(""DocEntry"" IN (" & DocEntAPCM & "))"

            If oSQLConnection.ServerType = "SQL" Then
                oRec.DoQuery(SqlQuery)
            Else
                oRec.DoQuery(HanaQuery)
            End If

        End If

        If (oRec.RecordCount > 0) Then
            Try
                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating AP Credit Memo ", oRec.RecordCount, False)
                oProgBar.Value = 0
            Catch ex As Exception
            End Try

            Dim i As Integer = 0

            Try
                If Not oSBOCompany.InTransaction Then
                    oSBOCompany.StartTransaction()
                End If

                While (Not oRec.EoF)
                    Dim DocEntry As String
                    DocEntry = oRec.Fields.Item("DocEntry").Value

                    Dim oDoc As SAPbobsCOM.Documents
                    oDoc = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oPurchaseCreditNotes)

                    If oDoc.GetByKey(DocEntry) Then
                        oDoc.UserFields.Fields.Item("U_SOL_EXPORTED").Value = "1"

                        Dim iErrCode As Integer = 0
                        Dim sErrMsg As String = ""

                        If oDoc.Update() <> 0 Then
                            oSBOCompany.GetLastError(iErrCode, sErrMsg)
                            oSBOApplication.MessageBox(iErrCode.ToString + " : " + sErrMsg)
                            ContinueLoop = False
                            If oSBOCompany.InTransaction Then
                                oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                            End If
                            Exit While
                        End If
                    End If

                    i += 1
                    Try
                        oProgBar.Value = i
                        oProgBar.Text = "Updating AP Credit Memo '" & i & "'/'" & oRec.RecordCount & "'"
                    Catch ex As Exception
                    End Try
                    oRec.MoveNext()
                End While

                Try
                    oProgBar.Stop()
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                    oProgBar = Nothing
                Catch exa As Exception
                End Try

                GC.Collect()
                oRec = Nothing
                If oSBOCompany.InTransaction Then
                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                End If
            Catch ex As Exception
                oSBOApplication.MessageBox("Error while updating")
                ContinueLoop = False
                If oSBOCompany.InTransaction Then
                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                End If
                Try
                    oProgBar.Stop()
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                    oProgBar = Nothing
                Catch exa As Exception
                End Try
                GC.Collect()
            End Try
        End If
    End Sub

    Private Sub getPajakKeluaran(ByVal DocEntAR As String, ByVal DocEntARDP As String, ByVal TypeForm As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        Dim strQry As String
        If DocEntAR = "" And DocEntARDP = "" Then
            oSBOApplication.MessageBox("Choose at least 1 data")
            Return
        Else

            If oSQLConnection.ServerType = "SQL" Then
                If TypeForm = "Invoice" Then
                    strQry = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN  '" & DocEntAR & "','" & DocEntARDP & "' "
                ElseIf TypeForm = "Massal" Then
                    strQry = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN  '" & DocEntAR & "','" & DocEntARDP & "' "
                ElseIf TypeForm = "Gabungan" Then
                    strQry = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB  '" & DocEntAR & "','" & DocEntARDP & "' "
                ElseIf TypeForm = "Gunggung" Then
                    strQry = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GG  '" & DocEntAR & "','" & DocEntARDP & "' "
                End If
            Else
                If TypeForm = "Invoice" Then
                    strQry = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN ( '" & DocEntAR & "','" & DocEntARDP & "' )"
                ElseIf TypeForm = "Massal" Then
                    strQry = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN ( '" & DocEntAR & "','" & DocEntARDP & "' )"
                ElseIf TypeForm = "Gabungan" Then
                    strQry = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB ( '" & DocEntAR & "','" & DocEntARDP & "' )"
                ElseIf TypeForm = "Gunggung" Then
                    strQry = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GG ( '" & DocEntAR & "','" & DocEntARDP & "' )" ' TIDAK DIJALAN KAN TIDAK EXPORT CSV
                End If

            End If


        End If

        If (TypeForm = "Massal" Or TypeForm = "Gabungan") Then
            QueryToJSONKeluaran(strQry)
        Else
            oRec.DoQuery(strQry)

            If oRec.RecordCount > 3 Then
                Dim CSVString As String
                CSVString = ""

                oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Counting", oRec.RecordCount, False)
                oProgBar.Value = 0

                Dim p As Integer = 0

                While (Not oRec.EoF)
                    p += 1

                    Dim recIndex As Integer

                    For recIndex = 1 To oRec.Fields.Count - 1
                        CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & ","
                    Next

                    CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & vbNewLine

                    oProgBar.Value = p
                    oRec.MoveNext()
                End While

                oProgBar.Stop()
                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                oProgBar = Nothing
                GC.Collect()

                Dim fileName As String
                fileName = "PajakKeluaran_" +
                        Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                        "_" +
                        Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

                Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, CSVString))
                thread.SetApartmentState(ApartmentState.STA)

                Try
                    thread.Start()
                    While (Not thread.IsAlive) ' Wait for thread to get started
                    End While
                    Thread.Sleep(1)           ' Wait a sec more
                    thread.Join()

                    'Update document A/R Invoice dan A/R DP Invoice
                    'updateAR(DocEntAR, DocEntARDP)
                Catch ex As Exception
                    oSBOApplication.MessageBox(ex.Message)
                End Try
            Else
                oSBOApplication.MessageBox("Data not Found")
            End If

        End If



    End Sub

    Private Sub getPajakMasukan(ByVal DocEntAP As String, ByVal DocEntAPDP As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        Dim sqlquery = ""
        If DocEntAP = "" And DocEntAPDP = "" Then
            oSBOApplication.MessageBox("Choose at least 1 data")
            Return
        Else

            If oSQLConnection.ServerType = "SQL" Then
                sqlquery = "EXEC SOL_FORM_E_FAKTUR_PAJAK_MASUKAN  '" & DocEntAP & "','" & DocEntAPDP & "' "
            Else
                sqlquery = "CALL SOL_FORM_E_FAKTUR_PAJAK_MASUKAN ( '" & DocEntAP & "','" & DocEntAPDP & "' )"
            End If

        End If



        oRec.DoQuery(sqlquery)

        If oRec.RecordCount > 1 Then
            Dim CSVString As String
            CSVString = ""
            oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Counting", oRec.RecordCount, False)
            oProgBar.Value = 0

            Dim p As Integer = 0

            While (Not oRec.EoF)
                p += 1

                Dim recIndex As Integer

                For recIndex = 1 To oRec.Fields.Count - 1
                    CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & ","
                Next

                CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & vbNewLine
                oProgBar.Value = p
                oRec.MoveNext()
            End While

            oProgBar.Stop()
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
            oProgBar = Nothing
            GC.Collect()

            Dim fileName As String
            fileName = "PajakMasukan_" +
                    Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                    "_" +
                    Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

            Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, CSVString))
            thread.SetApartmentState(ApartmentState.STA)

            Try
                thread.Start()
                While (Not thread.IsAlive) ' Wait for thread to get started
                End While
                Thread.Sleep(1)           ' Wait a sec more
                thread.Join()
                'Update document A/R Invoice dan A/R DP Invoice
                'updateAP(DocEntAP, DocEntAPDP)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try
        Else
            oSBOApplication.MessageBox("Data not Found")
        End If
    End Sub

    Private Sub getReturKeluaran(ByVal DocEntARCM As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim sqlQuery
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        If DocEntARCM = "" Then
            oSBOApplication.MessageBox("Choose at least 1 data")
            Return
        Else

            If oSQLConnection.ServerType = "SQL" Then
                'oRec.DoQuery("EXEC SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN  '" & DocEntARCM & "' ") 
                sqlQuery = "EXEC SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN  '" & DocEntARCM & "' "
            Else
                'oRec.DoQuery("CALL SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN ( '" & DocEntARCM & "' )")
                sqlQuery = "CALL SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN ( '" & DocEntARCM & "' )"
            End If

        End If

        'QueryToJSONReturKeluaran(sqlQuery)
        oRec.DoQuery(sqlQuery)

        If oRec.RecordCount > 1 Then
            Dim CSVString As String
            CSVString = ""

            oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Counting", oRec.RecordCount, False)
            oProgBar.Value = 0

            Dim p As Integer = 0

            While (Not oRec.EoF)
                p += 1
                Dim recIndex As Integer

                For recIndex = 1 To oRec.Fields.Count - 1
                    CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & ","
                Next

                CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & vbNewLine
                oProgBar.Value = p
                oRec.MoveNext()
            End While

            oProgBar.Stop()
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
            oProgBar = Nothing
            GC.Collect()

            Dim fileName As String
            fileName = "ReturKeluaran_" +
                    Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                    "_" +
                    Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

            Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, CSVString))
            thread.SetApartmentState(ApartmentState.STA)

            Try
                thread.Start()
                While (Not thread.IsAlive) ' Wait for thread to get started
                End While
                Thread.Sleep(1)           ' Wait a sec more
                thread.Join()
                'Update A/R Credit Memo
                'updateARCM(DocEntARCM)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try
        Else
            oSBOApplication.MessageBox("Data not Found")
        End If
    End Sub

    Private Sub getReturMasukan(ByVal DocEntAPCM As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        Dim sqlquery = ""

        If DocEntAPCM = "" Then
            oSBOApplication.MessageBox("Choose at least 1 data")
            Return
        Else
            If oSQLConnection.ServerType = "SQL" Then
                sqlquery = "EXEC SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN  '" & DocEntAPCM & "' "
            Else
                sqlquery = "CALL SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN ( '" & DocEntAPCM & "' )"
            End If
        End If

        QueryToJSONReturMasukan(sqlquery)


        'If oRec.RecordCount > 1 Then
        '    Dim CSVString As String
        '    CSVString = ""

        '    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Counting", oRec.RecordCount, False)
        '    oProgBar.Value = 0

        '    Dim p As Integer = 0

        '    While (Not oRec.EoF)
        '        p += 1
        '        Dim recIndex As Integer

        '        For recIndex = 1 To oRec.Fields.Count - 1
        '            CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & ","
        '        Next

        '        CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & vbNewLine
        '        oProgBar.Value = p
        '        oRec.MoveNext()
        '    End While

        '    oProgBar.Stop()
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
        '    oProgBar = Nothing
        '    GC.Collect()

        '    Dim fileName As String
        '    fileName = "ReturMasukan_" +
        '            Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
        '            "_" +
        '            Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

        '    Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, CSVString))
        '    thread.SetApartmentState(ApartmentState.STA)

        '    Try
        '        thread.Start()
        '        While (Not thread.IsAlive) ' Wait for thread to get started
        '        End While
        '        Thread.Sleep(1)           ' Wait a sec more
        '        thread.Join()
        '        'Update A/P Credit Memo
        '        'updateAPCM(DocEntAPCM)
        '    Catch ex As Exception
        '        oSBOApplication.MessageBox(ex.Message)
        '    End Try
        'Else
        '    oSBOApplication.MessageBox("Data not Found")
        'End If
    End Sub

    Private Sub getDokumenLainMasukan(ByVal DocEntAP As String, ByVal DocEntAPDP As String, ByVal DocEntAPCM As String) 'Tambahan Ricky
        Dim oRec As SAPbobsCOM.Recordset
        Dim oProgBar As SAPbouiCOM.ProgressBar

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        If DocEntAP = "" And DocEntAPDP = "" Then
            oSBOApplication.MessageBox("Choose at least 1 data")
            Return
        Else
            If oSQLConnection.ServerType = "SQL" Then
                oRec.DoQuery("EXEC SOL_FORM_E_FAKTUR_DOK_LAIN_MASUKAN '" & DocEntAP & "','" & DocEntAPDP & "','" & DocEntAPCM & "'")
            Else
                oRec.DoQuery("CALL SOL_FORM_E_FAKTUR_DOK_LAIN_MASUKAN ('" & DocEntAP & "','" & DocEntAPDP & "','" & DocEntAPCM & "')")
            End If
        End If

        If oRec.RecordCount > 1 Then
            Dim CSVString As String
            CSVString = ""
            oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Counting", oRec.RecordCount, False)
            oProgBar.Value = 0

            Dim p As Integer = 0

            While (Not oRec.EoF)
                p += 1

                Dim recIndex As Integer

                For recIndex = 1 To oRec.Fields.Count - 1
                    CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & ","
                Next

                CSVString = CSVString & oRec.Fields.Item(recIndex.ToString).Value & vbNewLine
                oProgBar.Value = p
                oRec.MoveNext()
            End While

            oProgBar.Stop()
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
            oProgBar = Nothing
            GC.Collect()

            Dim fileName As String
            fileName = "DokLainMasukan_" +
                    Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                    "_" +
                    Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

            Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, CSVString))
            thread.SetApartmentState(ApartmentState.STA)

            Try
                thread.Start()
                While (Not thread.IsAlive) ' Wait for thread to get started
                End While
                Thread.Sleep(1)           ' Wait a sec more
                thread.Join()
                'Update document A/R Invoice dan A/R DP Invoice
                'updateAP(DocEntAP, DocEntAPDP)
                'updateAPCM(DocEntAPCM)

            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try
        Else
            oSBOApplication.MessageBox("Data not Found")
        End If
    End Sub

    Private Sub UpdateFPINVOICE(ByVal DocNumParam As String, ByVal TypeForm As String) ' EVENT Untuk Update INVOICE

        Dim oProgBar As SAPbouiCOM.ProgressBar
        Dim ObjTypeDoc As String
        Dim KdTrans As String ' INI Semua buat variable untuk nampung value
        Dim KdStatus As String
        Dim NoRunning As String
        Dim NoTax As String
        Dim NoTaxGabungan As String
        Dim DocEntry As String
        Dim FPDate As String
        Dim FPDatee As Date
        Dim BPCodeCodeJoin As String = ""
        Dim BPCodeNameJoin As String = ""
        Dim branch As String = ""
        Dim DocNumReferences As String = ""
        Dim docnum As String = ""
        Dim PPNSTATUS As String = ""
        Dim KMK As String = ""
        Dim NAMANPWP As String = ""
        Dim NPWP As String = ""
        Dim KTP As String = ""
        Dim Alamat As String = ""
        Dim KodeDokumenPendukung As String = ""

        Dim KeyA As String = ""
        Dim KeyB As String = ""
        Dim QueryCheck As String = ""

        Try

            Dim oRecTransaction As SAPbobsCOM.Recordset
            Dim oRecCheck As SAPbobsCOM.Recordset
            oRecTransaction = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRecCheck = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            Dim QueryGetTransaction As String = ""

            If oSQLConnection.ServerType = "SQL" Then
                QueryGetTransaction = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL '" & TypeForm & "','" & DocNumParam & "'"
            Else
                QueryGetTransaction = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL ('" & TypeForm & "','" & DocNumParam & "')" 'Panggil SP untuk Pilih Field/ Select field sesuai TypeFP (Massal,gabungan,gunggung)
            End If
            oRecTransaction.DoQuery(QueryGetTransaction)
            'Array untuk cek jenis dokumen
            Dim MyArray() As String = {"13", "18", "14", "19"}
            Dim ContinueLoop As Boolean = True

            If Not oSBOCompany.InTransaction Then
                oSBOCompany.StartTransaction()
            End If

            If oRecTransaction.RecordCount > 0 Then
                Try
                    oProgBar = oSBOApplication.StatusBar.CreateProgressBar("Updating Invoice ", oRecTransaction.RecordCount, False) ' Tampil status Bar
                    oProgBar.Value = 0
                Catch ex As Exception
                End Try
                For i As Integer = 1 To oRecTransaction.RecordCount
                    If ContinueLoop = True Then
                        If oRecTransaction.Fields.Item("U_SELECT").Value = "Y" Then ' Cek yang di Select atau di ceklis 

                            Dim result As String = ""

                            If TypeForm = "Massal" Then ' JIKA MASSAL
                                DocNumReferences = DocNumParam
                                docnum = oRecTransaction.Fields.Item("U_DOCNUM").Value ' SET Variable sementara = Value di UDF (INI SEMUA)
                                ObjTypeDoc = oRecTransaction.Fields.Item("U_DOCTYPE").Value
                                KdTrans = oRecTransaction.Fields.Item("U_KDTRANS").Value
                                KdStatus = oRecTransaction.Fields.Item("U_KDSTATUS").Value
                                NoRunning = oRecTransaction.Fields.Item("U_NORUN").Value
                                NoTax = oRecTransaction.Fields.Item("U_NOFP").Value
                                DocEntry = oRecTransaction.Fields.Item("U_DOCEN").Value
                                branch = oRecTransaction.Fields.Item("U_DTBRANCH").Value
                                PPNSTATUS = oRecTransaction.Fields.Item("U_PPNSTAT").Value
                                KMK = oRecTransaction.Fields.Item("U_KMK").Value
                                NPWP = oRecTransaction.Fields.Item("U_NPWP").Value
                                NAMANPWP = oRecTransaction.Fields.Item("U_NNPWP").Value
                                'KTP = oRecTransaction.Fields.Item("U_KTP").Value
                                Alamat = oRecTransaction.Fields.Item("U_ALAMAT").Value
                                KodeDokumenPendukung = oRecTransaction.Fields.Item("U_KDDUKUNG").Value

                                'FPDatee = Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
                                'FPDate = FPDatee.ToString("yyyyMMdd")
                                FPDatee = oRecTransaction.Fields.Item("U_TAXDATE").Value
                                FPDate = FPDatee.ToString("yyyyMMdd")
                                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
                                If result IsNot Nothing Then
                                    KeyA += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                Else
                                    KeyB += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                End If

                            ElseIf TypeForm = "Gabungan" Then ' JIKA GABUNGAN
                                DocNumReferences = DocNumParam
                                docnum = oRecTransaction.Fields.Item("U_DOCNUM").Value ' SET Variable sementara = Value di UDF (INI SEMUA)
                                ObjTypeDoc = oRecTransaction.Fields.Item("U_DOCTYPE").Value
                                KdTrans = oRecTransaction.Fields.Item("U_TRANSCD").Value
                                KdStatus = oRecTransaction.Fields.Item("U_STATUSCD").Value
                                NoRunning = oRecTransaction.Fields.Item("U_NORUN").Value
                                NoTax = oRecTransaction.Fields.Item("U_NOFP").Value
                                NoTaxGabungan = oRecTransaction.Fields.Item("U_NOFP").Value
                                DocEntry = oRecTransaction.Fields.Item("U_DOCEN").Value
                                FPDatee = oRecTransaction.Fields.Item("U_TAXDATEHD").Value
                                FPDate = FPDatee.ToString("yyyyMMdd")
                                BPCodeCodeJoin = oRecTransaction.Fields.Item("U_CSTCD").Value
                                BPCodeNameJoin = oRecTransaction.Fields.Item("U_CSTNM").Value
                                branch = oRecTransaction.Fields.Item("U_BRANCH").Value
                                PPNSTATUS = oRecTransaction.Fields.Item("U_PPNSTAT").Value
                                KMK = oRecTransaction.Fields.Item("U_KMK").Value
                                NPWP = oRecTransaction.Fields.Item("U_NPWP").Value
                                NAMANPWP = oRecTransaction.Fields.Item("U_NNPWP").Value
                                'KTP = oRecTransaction.Fields.Item("U_KTP").Value
                                Alamat = oRecTransaction.Fields.Item("U_ALAMAT").Value
                                KodeDokumenPendukung = oRecTransaction.Fields.Item("U_KDDUKUNG").Value


                                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
                                If result IsNot Nothing Then
                                    KeyA += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                Else
                                    KeyB += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                End If

                            ElseIf TypeForm = "Gunggung" Then ' JIKA GUNGGUNG
                                DocNumReferences = DocNumParam
                                ObjTypeDoc = oRecTransaction.Fields.Item("U_DOCTYPE").Value ' SET Variable sementara = Value di UDF NOTE:gunggung sedikit karna ga ada NO FP
                                DocEntry = oRecTransaction.Fields.Item("U_DOCEN").Value

                                Dim Tgl As String = "01"
                                Dim Bulan As String = oRecTransaction.Fields.Item("U_MP_M").Value
                                Dim Tahun As String = oRecTransaction.Fields.Item("U_MP_Y").Value

                                'Dim PaymentDateSAP As Date = New DateTime(Tahun, Bulan, Tgl)
                                'Dim halo As String = New DateTime(Tahun, Bulan, Tgl).ToString
                                FPDatee = Date.ParseExact(Tgl + "/" + Bulan + "/" + Tahun, "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
                                FPDate = New Date(Tahun, Bulan, Tgl).ToString("yyyyMMdd")
                                BPCodeCodeJoin = ""
                                BPCodeNameJoin = ""

                                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
                                If result IsNot Nothing Then
                                    KeyA += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                Else
                                    KeyB += oRecTransaction.Fields.Item("U_DOCEN").Value + ","
                                End If
                            End If


                            '--------------------------------Set Current No FP to Invoice------------------------------------------------
                            Dim oRecUpdateINV As SAPbobsCOM.Recordset
                            oRecUpdateINV = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                            Dim queryUpdateINV As String = ""
                            If TypeForm = "Massal" Then
                                '-----------------------Check---------------------------------- ISI SEMUA UDF DI INVOICE DENGAN DATA YANG ADA DI Add ON
                                If ObjTypeDoc = "13" Then ' JIKA DIA A/R INVOice
                                    QueryCheck = "SELECT 1 FROM OINV " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '1' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '" & NoTax & "' AND " +
                                             "U_SOL_FP_RUNNING_NO = '" & NoRunning & "' AND U_SOL_FP_TRX_CODE = '" & KdTrans & "' AND U_SOL_FP_PPN = '" & PPNSTATUS & "' AND U_SOL_KMK = '" & KMK & "' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '" & KdStatus & "' AND U_SOL_FP_BRANCH = '" & branch & "' AND U_SOL_FP_KD_PENDUKUNG = '" & KodeDokumenPendukung & "' AND U_SOL_BP_JOIN = '' AND U_SOL_BPNAME_JOIN = '' "
                                Else ' JIKA DIA A/R DP INVOICE
                                    QueryCheck = "SELECT 1 FROM ODPI " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '1' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '" & NoTax & "' AND " +
                                             "U_SOL_FP_RUNNING_NO = '" & NoRunning & "' AND U_SOL_FP_TRX_CODE = '" & KdTrans & "' AND U_SOL_FP_PPN = '" & PPNSTATUS & "' AND U_SOL_KMK = '" & KMK & "' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '" & KdStatus & "' AND U_SOL_FP_BRANCH = '" & branch & "' AND U_SOL_FP_KD_PENDUKUNG = '" & KodeDokumenPendukung & "' AND U_SOL_BP_JOIN = '' AND U_SOL_BPNAME_JOIN = '' "
                                End If
                                oRecCheck.DoQuery(QueryCheck)
                                '--------------------------------------------------------------
                                If oRecCheck.RecordCount = 0 Then
                                    ' ContinueLoop = UpdateUDFInvoice(DocEntry, docnum, ObjTypeDoc, DocNumReferences, "1", FPDatee, NoTax, NoRunning, KdTrans, KdStatus, PPNSTATUS, KMK, branch, "", "", "", NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)
                                End If

                                If ContinueLoop = False Then
                                    Exit For
                                End If

                                'If ObjTypeDoc = "13" Then
                                '    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '1', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_FP_PPN = '" & PPNSTATUS & "', U_SOL_KMK = '" & KMK & "',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'Else
                                '    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '1', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_FP_PPN = '" & PPNSTATUS & "', U_SOL_KMK = '" & KMK & "',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'End If
                            ElseIf TypeForm = "Gabungan" Then
                                '-----------------------Check----------------------------------
                                If ObjTypeDoc = "13" Then
                                    QueryCheck = "SELECT 1 FROM OINV " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '2' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '" & NoTax & "' AND " +
                                             "U_SOL_FP_RUNNING_NO = '" & NoRunning & "' AND U_SOL_FP_TRX_CODE = '" & KdTrans & "' AND U_SOL_FP_PPN = '" & PPNSTATUS & "' AND U_SOL_KMK = '" & KMK & "' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '" & KdStatus & "' AND U_SOL_FP_BRANCH = '" & branch & "' AND U_SOL_PPN_DATE = '" & FPDate & "' AND U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "' AND U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' "
                                Else
                                    QueryCheck = "SELECT 1 FROM ODPI " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '2' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '" & NoTax & "' AND " +
                                             "U_SOL_FP_RUNNING_NO = '" & NoRunning & "' AND U_SOL_FP_TRX_CODE = '" & KdTrans & "' AND U_SOL_FP_PPN = '" & PPNSTATUS & "' AND U_SOL_KMK = '" & KMK & "' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '" & KdStatus & "' AND U_SOL_FP_BRANCH = '" & branch & "' AND U_SOL_PPN_DATE = '" & FPDate & "' AND U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "' AND U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' "
                                End If
                                oRecCheck.DoQuery(QueryCheck)
                                '--------------------------------------------------------------
                                If oRecCheck.RecordCount = 0 Then
                                    'ContinueLoop = UpdateUDFInvoice(DocEntry, docnum, ObjTypeDoc, DocNumReferences, "2", FPDatee, NoTax, NoRunning, KdTrans, KdStatus, PPNSTATUS, KMK, branch, BPCodeCodeJoin, BPCodeNameJoin, "", NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)
                                End If

                                If ContinueLoop = False Then
                                    Exit For
                                End If

                                'If ObjTypeDoc = "13" Then
                                '    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '2', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_PPN_DATE = '" & FPDate & "', U_SOL_FP_PPN = '" & PPNSTATUS & "', U_SOL_KMK = '" & KMK & "',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "', U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'Else
                                '    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '2', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_PPN_DATE = '" & FPDate & "', U_SOL_FP_PPN = '" & PPNSTATUS & "', U_SOL_KMK = '" & KMK & "',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "', U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'End If
                            ElseIf TypeForm = "Gunggung" Then
                                '-----------------------Check----------------------------------
                                If ObjTypeDoc = "13" Then
                                    QueryCheck = "SELECT 1 FROM OINV " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '3' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '' AND " +
                                             "U_SOL_FP_RUNNING_NO = '' AND U_SOL_FP_TRX_CODE = '01' AND U_SOL_FP_PPN = '' AND U_SOL_KMK = '' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '0' AND U_SOL_FP_BRANCH = '' AND U_SOL_PPN_DATE = '" & FPDate & "' AND U_SOL_BP_JOIN = '' AND U_SOL_BPNAME_JOIN = '' "
                                Else
                                    QueryCheck = "SELECT 1 FROM ODPI " +
                                             "WHERE ""DocEntry"" = '" & DocEntry & "' AND U_SOL_FP_TYPE = '3' AND U_SOL_FP_REF_NO = '" & DocNumReferences & "' AND U_SOL_FP_FULL_NO = '' AND " +
                                             "U_SOL_FP_RUNNING_NO = '' AND U_SOL_FP_TRX_CODE = '01' AND U_SOL_FP_PPN = '' AND U_SOL_KMK = '' AND   " +
                                             "U_SOL_FP_STATUS_CODE = '0' AND U_SOL_FP_BRANCH = '' AND U_SOL_PPN_DATE = '" & FPDate & "' AND U_SOL_BP_JOIN = '' AND U_SOL_BPNAME_JOIN = '' "
                                End If
                                oRecCheck.DoQuery(QueryCheck)
                                '--------------------------------------------------------------
                                If oRecCheck.RecordCount = 0 Then
                                    ' ContinueLoop = UpdateUDFInvoice(DocEntry, docnum, ObjTypeDoc, DocNumReferences, "3", FPDatee, "", "", "01", "0", "", "", "", "", "", "", "", "", "", "", "", TypeForm)
                                End If
                                If ContinueLoop = False Then
                                    Exit For
                                End If

                                'If ObjTypeDoc = "13" Then
                                '    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '3', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & FPDate & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'Else
                                '    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '3', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & FPDate & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',   " +
                                '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
                                'End If
                            End If

                            'Try
                            '    oRecUpdateINV.DoQuery(queryUpdateINV)
                            'Catch ex As Exception
                            '    Dim errorr As String = ex.Message
                            'End Try
                        End If

                        oRecTransaction.MoveNext()
                    End If
                    Try
                        oProgBar.Value = i
                        oProgBar.Text = "Updating Invoice '" & i & "'/'" & oRecTransaction.RecordCount & "'"
                    Catch ex As Exception
                    End Try
                Next
            End If

            '-------------------------------Check No FP to Invoice-------------------------------------------------
            If ContinueLoop = True Then

                If TypeForm = "Massal" Then
                    DocNumReferences = DocNumParam
                    NoTax = ""
                ElseIf TypeForm = "Gabungan" Then
                    DocNumReferences = DocNumParam
                    NoTax = NoTaxGabungan
                ElseIf TypeForm = "Gunggung" Then
                    DocNumReferences = DocNumParam
                    NoTax = ""
                End If

                'Trim last comma (,) character
                If KeyA <> "" Then
                    KeyA = Left(KeyA, Len(KeyA) - 1)
                End If

                If KeyB <> "" Then
                    KeyB = Left(KeyB, Len(KeyB) - 1)
                End If

                Dim oRec As SAPbobsCOM.Recordset
                Dim oRecUpdate As SAPbobsCOM.Recordset
                oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                Dim Query As String
                Dim QueryUpdate As String
                Dim DateQuery As Date
                Dim DateString As String

                If oSQLConnection.ServerType = "SQL" Then
                    Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' "
                Else
                    Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' ) "
                End If

                oRec.DoQuery(Query)

                If oRec.RecordCount > 0 Then
                    Try
                        oProgBar.Value = 0
                        oProgBar.Text = "Cleaning Invoice " & oRec.RecordCount & "'"
                    Catch ex As Exception
                    End Try
                    'Ada Invoice yang nomor fp nya harus di hapus
                    For i As Integer = 0 To oRec.RecordCount - 1
                        DateQuery = oRec.Fields.Item("DocDate").Value
                        DateString = DateQuery.ToString("yyyyMMdd")

                        If TypeForm = "Massal" Then

                            DateQuery = Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo)
                            DateString = DateQuery.ToString("yyyyMMdd")

                            ' ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0", NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)
                            If ContinueLoop = False Then
                                Exit For
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    If oRec.Fields.Item("ObjType").Value = "13" Then
                            '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
                            '                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    Else
                            '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
                            '                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    End If
                            'Else
                            '    If oRec.Fields.Item("ObjType").Value = "13" Then
                            '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
                            '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    Else
                            '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_FP_PPN = '', U_SOL_KMK = '', " +
                            '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    End If
                            'End If
                        Else

                            'ContinueLoop = UpdateUDFInvoice(oRec.Fields.Item("DocEntry").Value, oRec.Fields.Item("DocNum").Value, oRec.Fields.Item("ObjType").Value, "", "0", DateQuery, "", "", "01", "0", "", "", "", "", "", "0", NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)
                            If ContinueLoop = False Then
                                Exit For
                            End If

                            'If oSQLConnection.ServerType = "SQL" Then
                            '    If oRec.Fields.Item("ObjType").Value = "13" Then
                            '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
                            '                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    Else
                            '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
                            '                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    End If
                            'Else
                            '    If oRec.Fields.Item("ObjType").Value = "13" Then
                            '        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
                            '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    Else
                            '        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "', U_SOL_FP_PPN = '', U_SOL_KMK = '',  " +
                            '                        "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
                            '    End If
                            'End If
                        End If

                        'oRecUpdate.DoQuery(QueryUpdate)
                        oRec.MoveNext()
                        Try
                            oProgBar.Value = i
                            oProgBar.Text = "Cleaning Invoice '" & i & "'/'" & oRec.RecordCount & "'"
                        Catch ex As Exception
                        End Try
                    Next
                End If
                Try
                    Try
                        oProgBar.Stop()
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                        oProgBar = Nothing
                    Catch exa As Exception
                    End Try
                    If oSBOCompany.InTransaction Then
                        Try
                            oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_Commit)
                            oSBOApplication.StatusBar.SetText("Update FP on Invoice Success", SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
                        Catch ex As Exception
                            '-----------------------------------------
                            If TypeForm = "Massal" Then
                                'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'F' " +
                                '"WHERE ""DocNum"" = '" & DocNumParam & "'"
                                'oRec.DoQuery(Query)

                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntrys As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData

                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value


                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntrys)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "F")
                                oGeneralService.Update(oGeneralData)

                            ElseIf TypeForm = "Gabungan" Then
                                'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'F' " +
                                '"WHERE ""DocNum"" = '" & DocNumParam & "'"
                                'oRec.DoQuery(Query)

                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntrys As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData

                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntrys)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "F")
                                oGeneralService.Update(oGeneralData)


                            ElseIf TypeForm = "Gunggung" Then
                                'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'F' " +
                                '"WHERE ""DocNum"" = '" & DocNumParam & "'"
                                'oRec.DoQuery(Query)

                                Dim oRecDocEntry As SAPbobsCOM.Recordset
                                Dim DocEntrys As Integer
                                Dim oCmpSrv As SAPbobsCOM.CompanyService
                                Dim oGeneralService As SAPbobsCOM.GeneralService
                                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                                Dim oGeneralData As SAPbobsCOM.GeneralData

                                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                                oCmpSrv = oSBOCompany.GetCompanyService()
                                oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                                oGeneralParams.SetProperty("DocEntry", DocEntrys)
                                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                                ' Header Data
                                oGeneralData.SetProperty("U_DOCSTAT", "F")
                                oGeneralService.Update(oGeneralData)
                            End If
                            '-----------------------------------------
                            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                        End Try
                    End If
                Catch ex As Exception
                    oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                End Try
            Else
                Try
                    oProgBar.Stop()
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                    oProgBar = Nothing
                Catch exa As Exception
                End Try
                '-----------------------------------------
                Dim oRec As SAPbobsCOM.Recordset
                oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
                Dim Query As String = ""

                If TypeForm = "Massal" Then
                    'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'F' " +
                    '            "WHERE ""DocNum"" = '" & DocNumParam & "'"
                    'oRec.DoQuery(Query)

                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                    Dim DocEntrys As Integer
                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                    Dim oGeneralService As SAPbobsCOM.GeneralService
                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                    Dim oGeneralData As SAPbobsCOM.GeneralData

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                    DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                    oCmpSrv = oSBOCompany.GetCompanyService()
                    oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                    oGeneralParams.SetProperty("DocEntry", DocEntrys)
                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                    ' Header Data
                    oGeneralData.SetProperty("U_DOCSTAT", "F")
                    oGeneralService.Update(oGeneralData)

                ElseIf TypeForm = "Gabungan" Then
                    'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'F' " +
                    '            "WHERE ""DocNum"" = '" & DocNumParam & "'"
                    'oRec.DoQuery(Query)

                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                    Dim DocEntrys As Integer
                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                    Dim oGeneralService As SAPbobsCOM.GeneralService
                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                    Dim oGeneralData As SAPbobsCOM.GeneralData

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                    DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                    oCmpSrv = oSBOCompany.GetCompanyService()
                    oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                    oGeneralParams.SetProperty("DocEntry", DocEntrys)
                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                    ' Header Data
                    oGeneralData.SetProperty("U_DOCSTAT", "F")
                    oGeneralService.Update(oGeneralData)

                ElseIf TypeForm = "Gunggung" Then
                    'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'F' " +
                    '            "WHERE ""DocNum"" = '" & DocNumParam & "'"
                    'oRec.DoQuery(Query)

                    Dim oRecDocEntry As SAPbobsCOM.Recordset
                    Dim DocEntrys As Integer
                    Dim oCmpSrv As SAPbobsCOM.CompanyService
                    Dim oGeneralService As SAPbobsCOM.GeneralService
                    Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                    Dim oGeneralData As SAPbobsCOM.GeneralData

                    oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                    DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                    oCmpSrv = oSBOCompany.GetCompanyService()
                    oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                    oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                    oGeneralParams.SetProperty("DocEntry", DocEntrys)
                    oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                    ' Header Data
                    oGeneralData.SetProperty("U_DOCSTAT", "F")
                    oGeneralService.Update(oGeneralData)
                End If
                '-----------------------------------------
                oSBOApplication.StatusBar.SetText(errorMessage, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
                Try
                    If oSBOCompany.InTransaction Then
                        oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                    End If
                Catch ex As Exception
                End Try
            End If
        Catch ex As Exception
            Try
                oProgBar.Stop()
                System.Runtime.InteropServices.Marshal.ReleaseComObject(oProgBar)
                oProgBar = Nothing
            Catch exa As Exception
            End Try

            '-----------------------------------------
            Dim oRec As SAPbobsCOM.Recordset
            oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
            Dim Query As String = ""

            If TypeForm = "Massal" Then
                'Query = "UPDATE ""@SOL_FP_TRX_MS_HD"" SET ""U_DOCSTAT"" = 'F' " +
                '                "WHERE ""DocNum"" = '" & DocNumParam & "'"
                'oRec.DoQuery(Query)

                Dim oRecDocEntry As SAPbobsCOM.Recordset
                Dim DocEntrys As Integer
                Dim oCmpSrv As SAPbobsCOM.CompanyService
                Dim oGeneralService As SAPbobsCOM.GeneralService
                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                Dim oGeneralData As SAPbobsCOM.GeneralData

                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_MS_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                oCmpSrv = oSBOCompany.GetCompanyService()
                oGeneralService = oCmpSrv.GetGeneralService("FPMS")
                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                oGeneralParams.SetProperty("DocEntrys", DocEntrys)
                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                ' Header Data
                oGeneralData.SetProperty("U_DOCSTAT", "F")
                oGeneralService.Update(oGeneralData)

            ElseIf TypeForm = "Gabungan" Then
                'Query = "UPDATE ""@SOL_FP_TRX_GB_HD"" SET ""U_DOCSTAT"" = 'F' " +
                '                "WHERE ""DocNum"" = '" & DocNumParam & "'"
                'oRec.DoQuery(Query)

                Dim oRecDocEntry As SAPbobsCOM.Recordset
                Dim DocEntrys As Integer
                Dim oCmpSrv As SAPbobsCOM.CompanyService
                Dim oGeneralService As SAPbobsCOM.GeneralService
                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                Dim oGeneralData As SAPbobsCOM.GeneralData

                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GB_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                oCmpSrv = oSBOCompany.GetCompanyService()
                oGeneralService = oCmpSrv.GetGeneralService("FPGB")
                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                oGeneralParams.SetProperty("DocEntry", DocEntrys)
                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                ' Header Data
                oGeneralData.SetProperty("U_DOCSTAT", "F")
                oGeneralService.Update(oGeneralData)

            ElseIf TypeForm = "Gunggung" Then
                'Query = "UPDATE ""@SOL_FP_TRX_GG_HD"" SET ""U_DOCSTAT"" = 'F' " +
                '                "WHERE ""DocNum"" = '" & DocNumParam & "'"
                'oRec.DoQuery(Query)

                Dim oRecDocEntry As SAPbobsCOM.Recordset
                Dim DocEntrys As Integer
                Dim oCmpSrv As SAPbobsCOM.CompanyService
                Dim oGeneralService As SAPbobsCOM.GeneralService
                Dim oGeneralParams As SAPbobsCOM.GeneralDataParams
                Dim oGeneralData As SAPbobsCOM.GeneralData

                oRecDocEntry = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                oRecDocEntry.DoQuery("SELECT ""DocEntry"" FROM ""@SOL_FP_TRX_GG_HD"" WHERE ""DocNum"" = '" & DocNumParam & "'")
                DocEntrys = oRecDocEntry.Fields.Item("DocEntry").Value

                oCmpSrv = oSBOCompany.GetCompanyService()
                oGeneralService = oCmpSrv.GetGeneralService("FPGG")
                oGeneralParams = oGeneralService.GetDataInterface(SAPbobsCOM.GeneralServiceDataInterfaces.gsGeneralDataParams)
                oGeneralParams.SetProperty("DocEntry", DocEntrys)
                oGeneralData = oGeneralService.GetByParams(oGeneralParams)
                ' Header Data
                oGeneralData.SetProperty("U_DOCSTAT", "F")
                oGeneralService.Update(oGeneralData)
            End If
            '-----------------------------------------
            oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
            Try
                If oSBOCompany.InTransaction Then
                    oSBOCompany.EndTransaction(SAPbobsCOM.BoWfTransOpt.wf_RollBack)
                End If
            Catch exa As Exception
            End Try
        End Try

    End Sub

    Private Function UpdateUDFInvoice(ByVal DocEntry As String,
                                      ByVal DocNum As String,
                                      ByVal ObjType As Integer,
                                      ByVal DocReference As String,
                                      ByVal FPType As String,
                                      ByVal TaxDate As Date,
                                      ByVal NoTax As String,
                                      ByVal NoRunning As String,
                                      ByVal KdTrans As String,
                                      ByVal KdStatus As String,
                                      ByVal PPNStatus As String,
                                      ByVal KMK As String,
                                      ByVal Branch As String,
                                      ByVal BPJoin As String,
                                      ByVal BPJoinName As String,
                                      ByVal Exported As String,
                                      ByVal NPWP As String,
                                      ByVal NAMANPWP As String,
                                      ByVal KTP As String,
                                      ByVal Alamat As String,
                                      ByVal KodeDokumenPendukung As String,
                                      ByVal TypeForm As String,
                                      Optional ByVal Cancel As Boolean = False
        ) As Boolean

        Dim sReturn As Boolean = True
        Dim iErrCode As Integer = 0
        Dim sErrMsg As String = ""
        'Dim FPDate As String = TaxDate.ToString("yyyyMMdd")

        Dim oInvoice As SAPbobsCOM.Documents
        oInvoice = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oInvoices)
        Dim oDPInvoice As SAPbobsCOM.Documents
        oDPInvoice = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oDownPayments)


        If ObjType = "13" Then
            'Update AR Invoice
            If oInvoice.GetByKey(DocEntry) Then
                oInvoice.UserFields.Fields.Item("U_SOL_FP_TYPE").Value = FPType
                oInvoice.UserFields.Fields.Item("U_SOL_FP_REF_NO").Value = DocReference
                oInvoice.UserFields.Fields.Item("U_SOL_FP_FULL_NO").Value = NoTax
                oInvoice.UserFields.Fields.Item("U_SOL_FP_RUNNING_NO").Value = NoRunning
                oInvoice.UserFields.Fields.Item("U_SOL_FP_TRX_CODE").Value = KdTrans
                oInvoice.UserFields.Fields.Item("U_SOL_FP_STATUS_CODE").Value = KdStatus
                oInvoice.UserFields.Fields.Item("U_SOL_FP_PPN").Value = PPNStatus
                oInvoice.UserFields.Fields.Item("U_SOL_KMK").Value = KMK
                oInvoice.UserFields.Fields.Item("U_SOL_FP_BRANCH").Value = Branch
                oInvoice.UserFields.Fields.Item("U_SOL_BP_JOIN").Value = BPJoin
                oInvoice.UserFields.Fields.Item("U_SOL_BPNAME_JOIN").Value = BPJoinName
                If TaxDate <> Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo) Then
                    oInvoice.UserFields.Fields.Item("U_SOL_PPN_DATE").Value = TaxDate
                End If
                If Exported <> "" Then
                    oInvoice.UserFields.Fields.Item("U_SOL_EXPORTED").Value = Exported
                End If

                'Update by Teguh Adi Wibowo, untuk yg cancel kolom dibawah ini tidak perlu diupdate
                If (Cancel = False) Then
                    oInvoice.UserFields.Fields.Item("U_SOL_NPWPNM").Value = NAMANPWP
                    oInvoice.UserFields.Fields.Item("U_SOL_FP_NPWP").Value = NPWP
                    'oInvoice.UserFields.Fields.Item("U_SOL_FP_NIK").Value = KTP
                    oInvoice.UserFields.Fields.Item("U_SOL_FP_ALAMAT").Value = Alamat
                    oInvoice.UserFields.Fields.Item("U_SOL_FP_KD_PENDUKUNG").Value = KodeDokumenPendukung
                End If


                'If FPType <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_TYPE").Value = FPType
                'End If
                'If DocReference <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_REF_NO").Value = DocReference
                'End If
                'If NoTax <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_FULL_NO").Value = NoTax
                'End If
                'If NoRunning <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_RUNNING_NO").Value = NoRunning
                'End If
                'If KdTrans <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_TRX_CODE").Value = KdTrans
                'End If
                'If KdStatus <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_STATUS_CODE").Value = KdStatus
                'End If
                'If PPNStatus <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_PPN").Value = PPNStatus
                'End If
                'If KMK <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_KMK").Value = KMK
                'End If
                'If Branch <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_FP_BRANCH").Value = Branch
                'End If
                'If BPJoin <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_BP_JOIN").Value = BPJoin
                'End If
                'If BPJoinName <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_BPNAME_JOIN").Value = BPJoinName
                'End If
                'If TaxDate <> "" Then
                '    oInvoice.UserFields.Fields.Item("U_SOL_PPN_DATE").Value = TaxDate
                'End If



                'DISABLED UPDATE INVOICE

                'If oInvoice.Update() <> 0 Then
                '    oSBOCompany.GetLastError(iErrCode, sErrMsg)
                '    sReturn = False
                '    errorMessage = (iErrCode.ToString + " : " + sErrMsg)
                'Else

                '    'InsertToLog(DocEntry, DocNum, ObjType, DocReference, FPType, TaxDate, NoTax, NoRunning, KdTrans, KdStatus, PPNStatus, KMK, Branch, BPJoin, BPJoinName, Exported, NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)

                '    sReturn = True
                'End If
            Else
                sReturn = False
                errorMessage = "Cannot Find Document"
            End If
        Else
            'Update AR Down Payment Invoice
            If oDPInvoice.GetByKey(DocEntry) Then
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_TYPE").Value = FPType
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_REF_NO").Value = DocReference
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_FULL_NO").Value = NoTax
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_RUNNING_NO").Value = NoRunning
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_TRX_CODE").Value = KdTrans
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_STATUS_CODE").Value = KdStatus
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_PPN").Value = PPNStatus
                oDPInvoice.UserFields.Fields.Item("U_SOL_KMK").Value = KMK
                oDPInvoice.UserFields.Fields.Item("U_SOL_FP_BRANCH").Value = Branch
                oDPInvoice.UserFields.Fields.Item("U_SOL_BP_JOIN").Value = BPJoin
                oDPInvoice.UserFields.Fields.Item("U_SOL_BPNAME_JOIN").Value = BPJoinName
                If TaxDate <> Date.ParseExact("01/01/2000", "dd/MM/yyyy", System.Globalization.DateTimeFormatInfo.InvariantInfo) Then
                    oDPInvoice.UserFields.Fields.Item("U_SOL_PPN_DATE").Value = TaxDate
                End If
                'If Exported <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_EXPORTED").Value = Exported
                'End If

                'Update by Teguh Adi Wibowo, untuk yg cancel kolom dibawah ini tidak perlu diupdate
                If (Cancel = False) Then
                    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_NPWP").Value = NPWP
                    'oDPInvoice.UserFields.Fields.Item("U_SOL_FP_NIK").Value = KTP
                    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_ALAMAT").Value = Alamat
                    oInvoice.UserFields.Fields.Item("U_SOL_FP_KD_PENDUKUNG").Value = KodeDokumenPendukung
                End If

                'If FPType <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_TYPE").Value = FPType
                'End If
                'If DocReference <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_REF_NO").Value = DocReference
                'End If
                'If NoTax <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_FULL_NO").Value = NoTax
                'End If
                'If NoRunning <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_RUNNING_NO").Value = NoRunning
                'End If
                'If KdTrans <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_TRX_CODE").Value = KdTrans
                'End If
                'If KdStatus <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_STATUS_CODE").Value = KdStatus
                'End If
                'If PPNStatus <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_PPN").Value = PPNStatus
                'End If
                'If KMK <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_KMK").Value = KMK
                'End If
                'If Branch <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_FP_BRANCH").Value = Branch
                'End If
                'If BPJoin <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_BP_JOIN").Value = BPJoin
                'End If
                'If BPJoinName <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_BPNAME_JOIN").Value = BPJoinName
                'End If
                'If TaxDate <> "" Then
                '    oDPInvoice.UserFields.Fields.Item("U_SOL_PPN_DATE").Value = TaxDate
                'End If



                'DISABLED UPDATE INVOICE

                'If oDPInvoice.Update() <> 0 Then
                '    oSBOCompany.GetLastError(iErrCode, sErrMsg)
                '    sReturn = False
                '    errorMessage = (iErrCode.ToString + " : " + sErrMsg)
                'Else

                '    'InsertToLog(DocEntry, DocNum, ObjType, DocReference, FPType, TaxDate, NoTax, NoRunning, KdTrans, KdStatus, PPNStatus, KMK, Branch, BPJoin, BPJoinName, Exported, NPWP, NAMANPWP, KTP, Alamat, KodeDokumenPendukung, TypeForm)

                '    sReturn = True
                'End If
            Else
                sReturn = False
                errorMessage = "Cannot Find Document"
            End If
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oInvoice)
        System.Runtime.InteropServices.Marshal.ReleaseComObject(oDPInvoice)
        GC.Collect()
        Return sReturn
    End Function
    Private Sub InsertToLog(ByVal DocEntry As Integer,
                                      ByVal DocNum As String,
                                      ByVal ObjType As Integer,
                                      ByVal DocReference As String,
                                      ByVal FPType As String,
                                      ByVal TaxDate As Date,
                                      ByVal NoTax As String,
                                      ByVal NoRunning As String,
                                      ByVal KdTrans As String,
                                      ByVal KdStatus As String,
                                      ByVal PPNStatus As String,
                                      ByVal KMK As String,
                                      ByVal Branch As String,
                                      ByVal BPJoin As String,
                                      ByVal BPJoinName As String,
                                      ByVal Exported As String,
                                      ByVal NPWP As String,
                                      ByVal NAMANPWP As String,
                                      ByVal KTP As String,
                                      ByVal Alamat As String,
                                      ByVal KodeDokumenPendukung As String,
                                      ByVal TypeForm As String) 'Tambahan Ryan


        Try
            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
            Dim oRec As SAPbobsCOM.Recordset = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)
            Dim DateTax As String = TaxDate.ToString("yyyy-MM-dd")
            Dim QueryInsert As String
            Dim state As String

            If oForm.Mode = SAPbouiCOM.BoFormMode.fm_ADD_MODE Then
                state = "New Add"
            Else
                state = "Update"
            End If


            If oSQLConnection.ServerType = "SQL" Then
                QueryInsert = ("EXEC SOL_E_FAKTUR_INSERT_LOG '" & state & "',
                                                                      '" & state & " Invoice by " & TypeForm & "',
                                                                       '" & oSBOCompany.UserName & "',
                                                                      '" & DocEntry & "',
                                                                      '" & DocNum & "', 
                                                                      '" & ObjType & "',
                                                                      '" & DocReference & "', 
                                                                      '" & FPType & "',
                                                                      '" & DateTax & "',
                                                                      '" & NoTax & "',
                                                                      '" & NoRunning & "', 
                                                                      '" & KdTrans & "',
                                                                      '" & KdStatus & "',
                                                                      '" & PPNStatus & "',
                                                                      '" & KMK & "',
                                                                      '" & Branch & "',
                                                                      '" & BPJoin & "',
                                                                      '" & BPJoinName & "',
                                                                      '" & Exported & "',
                                                                      '" & NPWP & "',
                                                                      '" & NAMANPWP.Replace("'", "''") & "',
                                                                      '" & KTP & "',
                                                                      '" & Alamat & "',
                                                                      '" & KodeDokumenPendukung & "'")
            Else
                QueryInsert = ("CALL SOL_E_FAKTUR_INSERT_LOG ('" & state & "',
                                                                      '" & state & " Invoice by " & TypeForm & "',
                                                                       '" & oSBOCompany.UserName & "',
                                                                      '" & DocEntry & "',
                                                                      '" & DocNum & "', 
                                                                      '" & ObjType & "',
                                                                      '" & DocReference & "', 
                                                                      '" & FPType & "',
                                                                      '" & DateTax & "',
                                                                      '" & NoTax & "',
                                                                      '" & NoRunning & "', 
                                                                      '" & KdTrans & "',
                                                                      '" & KdStatus & "',
                                                                      '" & PPNStatus & "',
                                                                      '" & KMK & "',
                                                                      '" & Branch & "',
                                                                      '" & BPJoin & "',
                                                                      '" & BPJoinName & "',
                                                                      '" & Exported & "',
                                                                      '" & NPWP & "',
                                                                      '" & NAMANPWP.Replace("'", "''") & "',
                                                                      '" & KTP & "',
                                                                      '" & Alamat & "',
                                                                      '" & KodeDokumenPendukung & "')")
            End If
            oRec.DoQuery(QueryInsert)

        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    'Private Sub UpdateNoFP(ByVal formUID As String, ByVal TypeForm As String)
    '    Dim oProgBar As SAPbouiCOM.ProgressBar

    '    Dim oForm As SAPbouiCOM.Form
    '    oForm = oSBOApplication.Forms.Item(formUID)

    '    Dim oMatrix As SAPbouiCOM.Matrix
    '    oMatrix = oForm.Items.Item("tblData").Specific

    '    Dim ObjTypeDoc As String
    '    Dim KdTrans As String
    '    Dim KdStatus As String
    '    Dim NoRunning As String
    '    Dim NoTax As String
    '    Dim DocEntry As String
    '    Dim FPDate As String
    '    Dim BPCodeCodeJoin As String = ""
    '    Dim BPCodeNameJoin As String = ""
    '    Dim branch As String = ""
    '    Dim DocNumReferences As String = ""
    '    Dim docnum As String = ""
    '    Dim KeyA As String = ""
    '    Dim KeyB As String = ""

    '    'Array untuk cek jenis dokumen
    '    Dim MyArray() As String = {"13", "18", "14", "19"}

    '    For i As Integer = 1 To oMatrix.RowCount

    '        If CType(oMatrix.Columns.Item("txtChkBox").Cells.Item(i).Specific, SAPbouiCOM.CheckBox).Checked = True Then

    '            Dim result As String = ""

    '            If TypeForm = "Massal" Then
    '                DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '                ObjTypeDoc = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
    '                KdTrans = CType(oMatrix.Columns.Item("KDTRANS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
    '                KdStatus = CType(oMatrix.Columns.Item("KDSTATUS").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
    '                NoRunning = CType(oMatrix.Columns.Item("NORUN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
    '                NoTax = CType(oMatrix.Columns.Item("NOFP").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
    '                DocEntry = CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value
    '                branch = CType(oMatrix.Columns.Item("DTBRANCH").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value

    '                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
    '                If result IsNot Nothing Then
    '                    KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                Else
    '                    KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                End If

    '            ElseIf TypeForm = "Gabungan" Then
    '                DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '                docnum = CType(oMatrix.Columns.Item("DOCNUM").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value '4
    '                ObjTypeDoc = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value '2
    '                KdTrans = oForm.Items.Item("cmbTrans").Specific.value
    '                KdStatus = oForm.Items.Item("cmbStatus").Specific.value
    '                NoRunning = oForm.Items.Item("txtNoRun").Specific.value
    '                NoTax = oForm.Items.Item("txtNoFP").Specific.value
    '                DocEntry = CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value '3
    '                FPDate = oForm.Items.Item("txtDate").Specific.value
    '                BPCodeCodeJoin = oForm.Items.Item("txtCSTCD").Specific.value
    '                BPCodeNameJoin = oForm.Items.Item("txtCSTNM").Specific.value
    '                branch = oForm.Items.Item("cmbBranch").Specific.value

    '                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
    '                If result IsNot Nothing Then
    '                    KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                Else
    '                    KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                End If

    '            ElseIf TypeForm = "Gunggung" Then
    '                DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '                ObjTypeDoc = CType(oMatrix.Columns.Item("DOCTYPE").Cells.Item(i).Specific, SAPbouiCOM.ComboBox).Value
    '                DocEntry = CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value

    '                Dim Tgl As String = "01"
    '                Dim Bulan As String = oForm.Items.Item("txtMPM").Specific.value
    '                Dim Tahun As String = oForm.Items.Item("txtMPY").Specific.value

    '                'Dim PaymentDateSAP As Date = New DateTime(Tahun, Bulan, Tgl)
    '                'Dim halo As String = New DateTime(Tahun, Bulan, Tgl).ToString

    '                FPDate = New Date(Tahun, Bulan, Tgl).ToString("yyyyMMdd")
    '                BPCodeCodeJoin = ""
    '                BPCodeNameJoin = ""

    '                result = Array.Find(MyArray, Function(s) s = ObjTypeDoc)
    '                If result IsNot Nothing Then
    '                    KeyA += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                Else
    '                    KeyB += CType(oMatrix.Columns.Item("DOCEN").Cells.Item(i).Specific, SAPbouiCOM.EditText).Value + ","
    '                End If
    '            End If


    '            '--------------------------------Set Current No FP to Invoice------------------------------------------------
    '            Dim oRecUpdateINV As SAPbobsCOM.Recordset
    '            oRecUpdateINV = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '            Dim queryUpdateINV As String = ""
    '            If TypeForm = "Massal" Then
    '                If ObjTypeDoc = "13" Then
    '                    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '1', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                Else
    '                    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '1', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                End If
    '            ElseIf TypeForm = "Gabungan" Then
    '                If ObjTypeDoc = "13" Then
    '                    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '2', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_PPN_DATE = '" & FPDate & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "', U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                Else
    '                    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '2', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '" & NoTax & "', U_SOL_FP_RUNNING_NO = '" & NoRunning & "', U_SOL_FP_TRX_CODE = '" & KdTrans & "', U_SOL_PPN_DATE = '" & FPDate & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '" & KdStatus & "', U_SOL_FP_BRANCH = '" & branch & "', U_SOL_BP_JOIN = '" & BPCodeCodeJoin & "', U_SOL_BPNAME_JOIN = '" & BPCodeNameJoin & "' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                End If
    '            ElseIf TypeForm = "Gunggung" Then
    '                If ObjTypeDoc = "13" Then
    '                    queryUpdateINV = "UPDATE OINV SET U_SOL_FP_TYPE = '3', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & FPDate & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                Else
    '                    queryUpdateINV = "UPDATE ODPI SET U_SOL_FP_TYPE = '3', U_SOL_FP_REF_NO = '" & DocNumReferences & "', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & FPDate & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '' WHERE ""DocEntry"" = '" & DocEntry & "'"
    '                End If
    '            End If

    '            Try
    '                oRecUpdateINV.DoQuery(queryUpdateINV)
    '            Catch ex As Exception
    '                Dim errorr As String = ex.Message
    '            End Try
    '        End If
    '    Next

    '    '-------------------------------Check No FP to Invoice-------------------------------------------------
    '    If TypeForm = "Massal" Then
    '        DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '        NoTax = ""
    '    ElseIf TypeForm = "Gabungan" Then
    '        DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '        NoTax = oForm.Items.Item("txtNoFP").Specific.value
    '    ElseIf TypeForm = "Gunggung" Then
    '        DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '        NoTax = ""
    '    End If

    '    'Trim last comma (,) character
    '    If KeyA <> "" Then
    '        KeyA = Left(KeyA, Len(KeyA) - 1)
    '    End If

    '    If KeyB <> "" Then
    '        KeyB = Left(KeyB, Len(KeyB) - 1)
    '    End If

    '    Dim oRec As SAPbobsCOM.Recordset
    '    Dim oRecUpdate As SAPbobsCOM.Recordset
    '    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    Dim Query As String
    '    Dim QueryUpdate As String
    '    Dim DateQuery As Date
    '    Dim DateString As String

    '    If oSQLConnection.ServerType = "SQL" Then
    '        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' "
    '    Else
    '        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' ) "
    '    End If

    '    Try
    '        oRec.DoQuery(Query)

    '        If oRec.RecordCount > 0 Then
    '            'Ada Invoice yang nomor fp nya harus di hapus
    '            For i As Integer = 0 To oRec.RecordCount - 1
    '                DateQuery = oRec.Fields.Item("DocDate").Value
    '                DateString = DateQuery.ToString("yyyyMMdd")

    '                If TypeForm = "Massal" Then
    '                    If oSQLConnection.ServerType = "SQL" Then
    '                        If oRec.Fields.Item("ObjType").Value = "13" Then
    '                            QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        Else
    '                            QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        End If
    '                    Else
    '                        If oRec.Fields.Item("ObjType").Value = "13" Then
    '                            QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01',  " +
    '                                                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        Else
    '                            QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', " +
    '                                                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        End If
    '                    End If
    '                Else
    '                    If oSQLConnection.ServerType = "SQL" Then
    '                        If oRec.Fields.Item("ObjType").Value = "13" Then
    '                            QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        Else
    '                            QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "',  " +
    '                                            "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        End If
    '                    Else
    '                        If oRec.Fields.Item("ObjType").Value = "13" Then
    '                            QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "',  " +
    '                                                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        Else
    '                            QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '" & DateString & "',  " +
    '                                                "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '                        End If
    '                    End If
    '                End If


    '                oRecUpdate.DoQuery(QueryUpdate)
    '                oRec.MoveNext()
    '            Next
    '        End If
    '    Catch ex As Exception
    '        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '    End Try

    '    '------------------------------------------------------------------------------------------------------


    '    'If TypeForm = "Gabungan" Then

    '    '    DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '    '    NoTax = oForm.Items.Item("txtNoFP").Specific.value

    '    '    'Trim last comma (,) character
    '    '    If KeyA <> "" Then
    '    '        KeyA = Left(KeyA, Len(KeyA) - 1)
    '    '    End If

    '    '    If KeyB <> "" Then
    '    '        KeyB = Left(KeyB, Len(KeyB) - 1)
    '    '    End If

    '    '    Dim oRec As SAPbobsCOM.Recordset
    '    '    Dim oRecUpdate As SAPbobsCOM.Recordset
    '    '    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    '    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    '    Dim Query As String
    '    '    Dim QueryUpdate As String

    '    '    If oSQLConnection.ServerType = "SQL" Then
    '    '        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' "
    '    '    Else
    '    '        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' ) "
    '    '    End If

    '    '    Try
    '    '        oRec.DoQuery(Query)

    '    '        If oRec.RecordCount > 0 Then
    '    '            'Ada Invoice yang nomor fp nya harus di hapus
    '    '            For i As Integer = 0 To oRec.RecordCount - 1
    '    '                If oSQLConnection.ServerType = "SQL" Then
    '    '                    If oRec.Fields.Item("ObjType").Value = "13" Then
    '    '                        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '',  " +
    '    '                                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    Else
    '    '                        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '',  " +
    '    '                                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    End If
    '    '                Else
    '    '                    If oRec.Fields.Item("ObjType").Value = "13" Then
    '    '                        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '', U_SOL_PPN_DATE = '',  " +
    '    '                                        "U_SOL_FP_STATUS_CODE = '', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    Else
    '    '                        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '', U_SOL_PPN_DATE = '',  " +
    '    '                                        "U_SOL_FP_STATUS_CODE = '', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    End If
    '    '                End If

    '    '                oRecUpdate.DoQuery(QueryUpdate)
    '    '                oRec.MoveNext()
    '    '            Next
    '    '        End If
    '    '    Catch ex As Exception
    '    '        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '    '    End Try
    '    'ElseIf TypeForm = "Gunggung"
    '    '    DocNumReferences = oForm.Items.Item("DocNum").Specific.value
    '    '    NoTax = ""

    '    '    'Trim last comma (,) character
    '    '    If KeyA <> "" Then
    '    '        KeyA = Left(KeyA, Len(KeyA) - 1)
    '    '    End If

    '    '    If KeyB <> "" Then
    '    '        KeyB = Left(KeyB, Len(KeyB) - 1)
    '    '    End If

    '    '    Dim oRec As SAPbobsCOM.Recordset
    '    '    Dim oRecUpdate As SAPbobsCOM.Recordset
    '    '    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    '    oRecUpdate = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
    '    '    Dim Query As String
    '    '    Dim QueryUpdate As String

    '    '    If oSQLConnection.ServerType = "SQL" Then
    '    '        Query = "EXEC SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' "
    '    '    Else
    '    '        Query = "CALL SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK ( '" & TypeForm & "','" & KeyA & "','" & KeyB & "','" & NoTax & "','" & DocNumReferences & "' ) "
    '    '    End If

    '    '    Try
    '    '        oRec.DoQuery(Query)

    '    '        If oRec.RecordCount > 0 Then
    '    '            'Ada Invoice yang nomor fp nya harus di hapus
    '    '            For i As Integer = 0 To oRec.RecordCount - 1
    '    '                If oSQLConnection.ServerType = "SQL" Then
    '    '                    If oRec.Fields.Item("ObjType").Value = "13" Then
    '    '                        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '',  " +
    '    '                                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    Else
    '    '                        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '01', U_SOL_PPN_DATE = '',  " +
    '    '                                    "U_SOL_FP_STATUS_CODE = '0', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    End If
    '    '                Else
    '    '                    If oRec.Fields.Item("ObjType").Value = "13" Then
    '    '                        QueryUpdate = "UPDATE OINV SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '', U_SOL_PPN_DATE = '',  " +
    '    '                                        "U_SOL_FP_STATUS_CODE = '', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    Else
    '    '                        QueryUpdate = "UPDATE ODPI SET U_SOL_FP_TYPE = '', U_SOL_FP_REF_NO = '', U_SOL_FP_FULL_NO = '', U_SOL_FP_RUNNING_NO = '', U_SOL_FP_TRX_CODE = '', U_SOL_PPN_DATE = '',  " +
    '    '                                        "U_SOL_FP_STATUS_CODE = '', U_SOL_FP_BRANCH = '', U_SOL_BP_JOIN = '', U_SOL_BPNAME_JOIN = '', U_SOL_EXPORTED = '0' WHERE ""DocEntry"" = '" & oRec.Fields.Item("DocEntry").Value & "' "
    '    '                    End If
    '    '                End If

    '    '                oRecUpdate.DoQuery(QueryUpdate)
    '    '                oRec.MoveNext()
    '    '            Next
    '    '        End If
    '    '    Catch ex As Exception
    '    '        oSBOApplication.StatusBar.SetText(ex.Message, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Error)
    '    '    End Try
    '    'End If
    '    '-------------------------------Check No FP to Invoice-------------------------------------------------
    'End Sub

    Private Sub fillTable(ByVal sql As String, ByRef oForm As SAPbouiCOM.Form, ByRef oMatrix As SAPbouiCOM.Matrix, ByVal type As String, ByVal GenFPType As String)
        oMatrix.Clear()

        oForm.Freeze(True)

        Dim columnCount As Integer = oMatrix.Columns.Count

        For i As Integer = columnCount - 1 To 0 Step -1
            oMatrix.Columns.Remove(i)
        Next

        Dim DS_TABLE As SAPbouiCOM.DataTable

        Try
            DS_TABLE = oForm.DataSources.DataTables.Item("DATA")
        Catch ex As Exception
            DS_TABLE = oForm.DataSources.DataTables.Add("DATA")
        End Try

        DS_TABLE.ExecuteQuery(sql)
        '----------------------------------------------------------------
        Dim DS_CHECKBOX As SAPbouiCOM.UserDataSource

        Try
            DS_CHECKBOX = oForm.DataSources.UserDataSources.Item("PKFormChk")
        Catch ex As Exception
            DS_CHECKBOX = oForm.DataSources.UserDataSources.Add("PKFormChk", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
        End Try

        DS_CHECKBOX.Value = "N"
        '----------------------------------------------------------------
        'Dim DS_CHECKBOX2 As SAPbouiCOM.UserDataSource

        'Try
        '    DS_CHECKBOX2 = oForm.DataSources.UserDataSources.Item("PKFormChk2")
        'Catch ex As Exception
        '    DS_CHECKBOX2 = oForm.DataSources.UserDataSources.Add("PKFormChk2", SAPbouiCOM.BoDataType.dt_SHORT_TEXT, 1)
        'End Try

        'DS_CHECKBOX2.Value = "N"
        '----------------------------------------------------------------
        Dim DS_VALUE1 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE1 = oForm.DataSources.UserDataSources.Item("PKFormKdT")
        Catch ex As Exception
            DS_VALUE1 = oForm.DataSources.UserDataSources.Add("PKFormKdT", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE1.Value = "01"
        '----------------------------------------------------------------
        Dim DS_VALUE2 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE2 = oForm.DataSources.UserDataSources.Item("PKFormKdS")
        Catch ex As Exception
            DS_VALUE2 = oForm.DataSources.UserDataSources.Add("PKFormKdS", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE2.Value = "0"
        '----------------------------------------------------------------
        Dim DS_VALUE3 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE3 = oForm.DataSources.UserDataSources.Item("PKFormNoP")
        Catch ex As Exception
            DS_VALUE3 = oForm.DataSources.UserDataSources.Add("PKFormNoP", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE3.Value = ""
        '----------------------------------------------------------------
        Dim DS_VALUE4 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE4 = oForm.DataSources.UserDataSources.Item("PKJoinFP")
        Catch ex As Exception
            DS_VALUE4 = oForm.DataSources.UserDataSources.Add("PKJoinFP", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE4.Value = ""
        '----------------------------------------------------------------
        Dim DS_VALUE5 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE5 = oForm.DataSources.UserDataSources.Item("PKJoinBP")
        Catch ex As Exception
            DS_VALUE5 = oForm.DataSources.UserDataSources.Add("PKJoinBP", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE5.Value = ""

        '----------------------------------------------------------------
        Dim DS_VALUE6 As SAPbouiCOM.UserDataSource

        Try
            DS_VALUE6 = oForm.DataSources.UserDataSources.Item("PKJoinBPn")
        Catch ex As Exception
            DS_VALUE6 = oForm.DataSources.UserDataSources.Add("PKJoinBPn", SAPbouiCOM.BoDataType.dt_LONG_TEXT, 254)
        End Try

        DS_VALUE6.Value = ""

        '----------------------------------------------------------------

        oMatrix.Columns.Add("#", SAPbouiCOM.BoFormItemTypes.it_EDIT)

        Dim colSelect As SAPbouiCOM.Column
        colSelect = oMatrix.Columns.Add("txtChkBox", SAPbouiCOM.BoFormItemTypes.it_CHECK_BOX)
        colSelect.TitleObject.Caption = "Selection"
        colSelect.ValOn = "Y"
        colSelect.ValOff = "N"
        colSelect.Editable = True
        colSelect.DataBind.SetBound(True, "", "PKFormChk")
        '----------------------------------------------------------------
        If type = "PK" And GenFPType = "1" Then

            'Dim colGen As SAPbouiCOM.Column
            'colGen = oMatrix.Columns.Add("txtChkBox2", SAPbouiCOM.BoFormItemTypes.it_CHECK_BOX)
            'colGen.TitleObject.Caption = "Generate No FP"
            'colGen.ValOn = "Y"
            'colGen.ValOff = "N"
            'colGen.Editable = True
            'colGen.DataBind.SetBound(True, "", "PKFormChk2")

            '----------------------------------------------------------------
            Dim colKodeTrans As SAPbouiCOM.Column
            colKodeTrans = oMatrix.Columns.Add("txtKdT", SAPbouiCOM.BoFormItemTypes.it_COMBO_BOX)
            colKodeTrans.TitleObject.Caption = "Kode Transaksi"
            colKodeTrans.ValidValues.Add("01", "01")
            colKodeTrans.ValidValues.Add("02", "02")
            colKodeTrans.ValidValues.Add("03", "03")
            colKodeTrans.ValidValues.Add("04", "04")
            colKodeTrans.ValidValues.Add("05", "05")
            colKodeTrans.ValidValues.Add("06", "06")
            colKodeTrans.ValidValues.Add("07", "07")
            colKodeTrans.ValidValues.Add("08", "08")
            colKodeTrans.ValidValues.Add("09", "09")
            colKodeTrans.Editable = True
            colKodeTrans.DataBind.SetBound(True, "", "PKFormKdT")


            '----------------------------------------------------------------
            Dim colKodeStatus As SAPbouiCOM.Column
            colKodeStatus = oMatrix.Columns.Add("txtKdS", SAPbouiCOM.BoFormItemTypes.it_COMBO_BOX)
            colKodeStatus.TitleObject.Caption = "Kode Status"
            colKodeStatus.ValidValues.Add("0", "Normal")
            colKodeStatus.ValidValues.Add("1", "Penggantian")
            colKodeStatus.Editable = True
            colKodeStatus.DataBind.SetBound(True, "", "PKFormKdS")

            '----------------------------------------------------------------
            Dim colNoRunning As SAPbouiCOM.Column
            colNoRunning = oMatrix.Columns.Add("txtNoRun", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoRunning.TitleObject.Caption = "No Running"
            colNoRunning.Editable = True
            colNoRunning.DataBind.SetBound(True, "", "PKFormNoP")

            '----------------------------------------------------------------
            Dim colNoPajak As SAPbouiCOM.Column
            colNoPajak = oMatrix.Columns.Add("txtNoPajak", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoPajak.TitleObject.Caption = "No Pajak"
            colNoPajak.Editable = True
            colNoPajak.DataBind.SetBound(True, "", "PKFormNoP")

        ElseIf type = "PK" And GenFPType = "2" Then

            'Dim colGen As SAPbouiCOM.Column
            'colGen = oMatrix.Columns.Add("txtChkBox2", SAPbouiCOM.BoFormItemTypes.it_CHECK_BOX)
            'colGen.TitleObject.Caption = "Generate No FP"
            'colGen.ValOn = "Y"
            'colGen.ValOff = "N"
            'colGen.Editable = True
            'colGen.DataBind.SetBound(True, "", "PKFormChk2")

            '----------------------------------------------------------------
            Dim colNoRunning As SAPbouiCOM.Column
            colNoRunning = oMatrix.Columns.Add("txtNoRun", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoRunning.TitleObject.Caption = "No Running"
            colNoRunning.Editable = False
            colNoRunning.DataBind.SetBound(True, "", "PKFormNoP")
            '----------------------------------------------------------------
            Dim colNoPajak As SAPbouiCOM.Column
            colNoPajak = oMatrix.Columns.Add("txtNoPajak", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoPajak.TitleObject.Caption = "No Pajak"
            colNoPajak.Editable = False
            colNoPajak.DataBind.SetBound(True, "", "PKFormNoP")
            '----------------------------------------------------------------
            Dim colJoinBP As SAPbouiCOM.Column
            colJoinBP = oMatrix.Columns.Add("txtBPJoin", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colJoinBP.TitleObject.Caption = "BP Join Pajak"
            colJoinBP.Editable = False
            colJoinBP.DataBind.SetBound(True, "", "PKJoinBP")
            '----------------------------------------------------------------
            Dim colJoinBPn As SAPbouiCOM.Column
            colJoinBPn = oMatrix.Columns.Add("txtBPJoinN", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colJoinBPn.TitleObject.Caption = "BP Name Join Pajak"
            colJoinBPn.Editable = False
            colJoinBPn.DataBind.SetBound(True, "", "PKJoinBPn")
        ElseIf type = "PK" And GenFPType = "3" Then

            'Dim colGen As SAPbouiCOM.Column
            'colGen = oMatrix.Columns.Add("txtChkBox2", SAPbouiCOM.BoFormItemTypes.it_CHECK_BOX)
            'colGen.TitleObject.Caption = "Generate No FP"
            'colGen.ValOn = "Y"
            'colGen.ValOff = "N"
            'colGen.Editable = True
            'colGen.DataBind.SetBound(True, "", "PKFormChk2")

            '----------------------------------------------------------------
            Dim colNoRunning As SAPbouiCOM.Column
            colNoRunning = oMatrix.Columns.Add("txtNoRun", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoRunning.TitleObject.Caption = "No Running"
            colNoRunning.Editable = False
            colNoRunning.DataBind.SetBound(True, "", "PKFormNoP")
            '----------------------------------------------------------------
            Dim colNoPajak As SAPbouiCOM.Column
            colNoPajak = oMatrix.Columns.Add("txtNoPajak", SAPbouiCOM.BoFormItemTypes.it_EDIT)
            colNoPajak.TitleObject.Caption = "No Pajak"
            colNoPajak.Editable = False
            colNoPajak.DataBind.SetBound(True, "", "PKFormNoP")

        End If
        '----------------------------------------------------------------

        columnCount = DS_TABLE.Columns.Count

        For i As Integer = 0 To columnCount - 1
            Dim columnName As String = DS_TABLE.Columns.Item(i).Name

            Dim col As SAPbouiCOM.Column
            col = oMatrix.Columns.Add("col_" + (i + 1).ToString, SAPbouiCOM.BoFormItemTypes.it_EDIT)

            col.TitleObject.Caption = columnName
            col.Editable = False
        Next

        oMatrix.Columns.Item("txtChkBox").DataBind.SetBound(True, "", "PKFormChk")

        For i As Integer = 0 To columnCount - 1
            Dim columnName As String = DS_TABLE.Columns.Item(i).Name
            oMatrix.Columns.Item("col_" + (i + 1).ToString).DataBind.Bind("DATA", columnName)
        Next

        oMatrix.Clear()
        oMatrix.LoadFromDataSource()
        oMatrix.AutoResizeColumns()
        oForm.Freeze(False)
    End Sub

    Private Sub FilterSwitchBP(ByVal CFL_UID As String, ByVal FormUID As String, Optional ByVal RowID As Integer = -1)
        Try

            Dim oCFLs As SAPbouiCOM.ChooseFromListCollection
            Dim oCons As SAPbouiCOM.Conditions
            Dim oCon As SAPbouiCOM.Condition
            Dim oForm As SAPbouiCOM.Form

            oForm = oSBOApplication.Forms.Item(FormUID)
            oCFLs = oForm.ChooseFromLists

            Dim oCFL As SAPbouiCOM.ChooseFromList
            oCFL = oCFLs.Item(CFL_UID)
            oCons = oCFL.GetConditions

            If CFL_UID = "CFL_BP" Then
                If oCons.Count = 0 Then
                    oCon = oCons.Add()
                    'oCon = oCons.Add()
                End If

                oCon = oCons.Item(0)
                oCon.Alias = "CardType"
                oCon.Operation = SAPbouiCOM.BoConditionOperation.co_EQUAL
                oCon.Relationship = SAPbouiCOM.BoConditionRelationship.cr_NONE
                oCon.CondVal = "C"
                oCFL.SetConditions(oCons)

                'oCon = oCons.Item(1)
                'oCon.Alias = "GroupCode"
                'oCon.Operation = SAPbouiCOM.BoConditionOperation.co_NOT_EQUAL
                'oCon.Relationship = SAPbouiCOM.BoConditionRelationship.cr_NONE
                'oCon.CondVal = "104"
                'oCFL.SetConditions(oCons)
            End If

        Catch ex As Exception

        End Try

    End Sub

    Public Function ConTLocalSNF(ByVal sValue As String) As String
        'Convert To Local System Numeric Format From SAP B1
        Dim sReturn As String = ""
        Dim sLocalSystemDecimalSeparator As String
        Dim sCurrentDecimalSeparator As String
        Dim oAdminInfo As SAPbobsCOM.AdminInfo = oSBOCompany.GetCompanyService.GetAdminInfo
        sCurrentDecimalSeparator = oAdminInfo.DecimalSeparator

        sLocalSystemDecimalSeparator = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator

        For Each a As Char In sValue
            If a = sCurrentDecimalSeparator Then
                sReturn = sReturn + sLocalSystemDecimalSeparator
            ElseIf (a >= "0"c And a <= "9"c) Or a = "-" Then
                sReturn = sReturn + a
            End If
        Next

        Return sReturn
    End Function

    Public Function ConFLocalSNF(ByVal sValue As String) As String
        'Convert To SAP B1 From Local System Numeric Format
        Dim sReturn As String = ""
        Dim sLocalSystemDecimalSeparator As String
        Dim sCurrentDecimalSeparator As String
        Dim oAdminInfo As SAPbobsCOM.AdminInfo = oSBOCompany.GetCompanyService.GetAdminInfo
        sCurrentDecimalSeparator = oAdminInfo.DecimalSeparator

        sLocalSystemDecimalSeparator = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator

        For Each a As Char In sValue
            If a = sLocalSystemDecimalSeparator Then
                sReturn = sReturn + sCurrentDecimalSeparator
            ElseIf (a >= "0"c And a <= "9"c) Or a = "-" Then
                sReturn = sReturn + a
            End If
        Next

        Return sReturn
    End Function

    'DECIMAL & DOUBLE TO SBO NUMBER
    Public Function DecimalToSBONumber(ByVal sValue As Decimal) As String
        Dim sReturn As String = ""
        Dim WindowsDecimalSeparator As String = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator
        sReturn = Convert.ToString(sValue).Replace(Convert.ToString(WindowsDecimalSeparator), ".")
        Return sReturn
    End Function

    Public Function DoubleToSBONumber(ByVal sValue As Double) As String
        Dim sReturn As String = ""
        Dim WindowsDecimalSeparator As String = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator
        sReturn = Convert.ToString(sValue).Replace(",", ".")
        Return sReturn
    End Function

    'SBO NUMBER TO DECIMAL & DOUBLE
    Public Function SBONumbertoDecimal(ByVal sValue As String) As Decimal
        Dim sReturn As String = ""
        Dim WindowsDecimalSeparator As String = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator
        sReturn = Convert.ToString(sValue).Replace(Convert.ToString(WindowsDecimalSeparator), ".")
        sReturn = Convert.ToDecimal(sValue.ToString.Replace(".", WindowsDecimalSeparator))
        Return sReturn
    End Function

    Public Function SBONumbertoDouble(ByVal sValue As String) As Double
        Dim sReturn As String = ""
        Dim WindowsDecimalSeparator As String = System.Windows.Forms.Application.CurrentCulture.NumberFormat.NumberDecimalSeparator
        sReturn = Double.Parse(sValue)
        Return sReturn
    End Function


    '//DECIMAL & DOUBLE TO SBO NUMBER
    'Public Static String DecimalToSBONumber(Decimal value)
    '{
    '    String RetVal;
    '    String WindowsDecimalSeparator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
    '    RetVal = Convert.ToString(value).Replace(Convert.ToChar(WindowsDecimalSeparator), '.');
    '    Return RetVal;
    '}

    'Public Static String DoubleToSBONumber(Double value)
    '{
    '    String RetVal;
    '    String WindowsDecimalSeparator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
    '    RetVal = Convert.ToString(value).Replace(',', '.');
    '    Return RetVal;
    '}

    '//SBO NUMBER TO DECIMAL & DOUBLE
    'Public Static Decimal SBONumbertoDecimal(String value)
    '{
    '    Decimal RetVal;
    '    String WindowsDecimalSeparator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
    '    RetVal = Convert.ToDecimal(value.Replace(".", WindowsDecimalSeparator));
    '    Return RetVal;
    '}

    'Public Static Double SBONumbertoDouble(String value)
    '{
    '    Double RetVal;
    '    RetVal = double.Parse(value, System.Globalization.CultureInfo.InvariantCulture);
    '    Return RetVal;
    '}

    Private Function CRSetup(ByVal TypeCode As String, ByVal RPTFile As String, ByVal oForm As SAPbouiCOM.Form) As String
        Try
            Dim oRec As SAPbobsCOM.Recordset
            oRec = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset)

            oRec.DoQuery("SELECT ""CODE"" FROM ""RTYP"" WHERE ""NAME"" = '" + TypeCode + "'")
            If oRec.RecordCount > 0 Then
                Return oRec.Fields.Item("CODE").Value()
            End If

            Dim cryRpt As ReportDocument = New CrystalReport(RPTFile, oSBOCompany).buildCrystalReportDocument.finishCrystalReportDocument
            Dim ReportName As String = cryRpt.SummaryInfo.ReportTitle

            If IsNothing(ReportName) Then
                ReportName = ""
            End If

            If ReportName.Trim = "" Then
                ReportName = cryRpt.FileName

                Dim si As Integer = ReportName.LastIndexOf(System.IO.Path.DirectorySeparatorChar)
                If si >= 0 Then
                    ReportName = ReportName.Substring(si + 1, ReportName.Length - si - 1).Trim
                Else
                    ReportName = ReportName.Substring(9, ReportName.Length - 9).Trim
                End If

                si = ReportName.ToLower.LastIndexOf(".rpt")
                If si >= 0 Then
                    ReportName = ReportName.Substring(0, si).Trim
                End If
            End If

            Dim rptTypeService As SAPbobsCOM.ReportTypesService
            rptTypeService = oSBOCompany.GetCompanyService().GetBusinessService(SAPbobsCOM.ServiceTypes.ReportTypesService)

            Dim newType As SAPbobsCOM.ReportType
            newType = rptTypeService.GetDataInterface(SAPbobsCOM.ReportTypesServiceDataInterfaces.rtsReportType)
            newType.TypeName = TypeCode
            newType.AddonName = TypeCode
            newType.AddonFormType = TypeCode
            newType.MenuID = TypeCode

            Dim newTypeParam As SAPbobsCOM.ReportTypeParams = rptTypeService.AddReportType(newType)

            Dim rptService As SAPbobsCOM.ReportLayoutsService
            rptService = oSBOCompany.GetCompanyService().GetBusinessService(SAPbobsCOM.ServiceTypes.ReportLayoutsService)

            Dim newReport As SAPbobsCOM.ReportLayout
            newReport = rptService.GetDataInterface(SAPbobsCOM.ReportLayoutsServiceDataInterfaces.rlsdiReportLayout)
            newReport.Author = oSBOCompany.UserName
            newReport.Category = SAPbobsCOM.ReportLayoutCategoryEnum.rlcCrystal
            newReport.Name = ReportName
            newReport.TypeCode = newTypeParam.TypeCode

            Dim newReportParam As SAPbobsCOM.ReportLayoutParams = rptService.AddReportLayout(newReport)

            newType = rptTypeService.GetReportType(newTypeParam)
            newType.DefaultReportLayout = newReportParam.LayoutCode
            rptTypeService.UpdateReportType(newType)

            Dim oBlobParams As SAPbobsCOM.BlobParams
            oBlobParams = oSBOCompany.GetCompanyService().GetDataInterface(SAPbobsCOM.CompanyServiceDataInterfaces.csdiBlobParams)
            oBlobParams.Table = "RDOC"
            oBlobParams.Field = "Template"

            Dim oKeySegment As SAPbobsCOM.BlobTableKeySegment = oBlobParams.BlobTableKeySegments.Add()
            oKeySegment.Name = "DocCode"
            oKeySegment.Value = newReportParam.LayoutCode

            Dim oFile As FileStream = New FileStream(RPTFile, System.IO.FileMode.Open)

            Dim fileSize As Long = oFile.Length
            Dim buf(fileSize) As Byte
            oFile.Read(buf, 0, fileSize)
            oFile.Dispose()

            Dim oBlob As SAPbobsCOM.Blob
            oBlob = oSBOCompany.GetCompanyService().GetDataInterface(SAPbobsCOM.CompanyServiceDataInterfaces.csdiBlob)
            oBlob.Content = Convert.ToBase64String(buf, 0, fileSize)
            oSBOCompany.GetCompanyService().SetBlob(oBlobParams, oBlob)

            Return newType.TypeCode
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try

        Return Nothing
    End Function

    Public Shared Sub releaseObject(ByVal obj As Object)
        Try
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj)
            obj = Nothing
        Catch ex As Exception
            obj = Nothing
        Finally
            GC.Collect()
        End Try
    End Sub
    Public Sub ClearValidValue(ByRef Cbo As SAPbouiCOM.ComboBox)
        For i As Integer = Cbo.ValidValues.Count - 1 To 0 Step -1
            Cbo.ValidValues.Remove(i, SAPbouiCOM.BoSearchKey.psk_Index)
        Next
    End Sub

#End Region

#Region "SetupFP"

    Public Sub SetupPreferences()
        Try
            Dim oUFields As SAPbobsCOM.UserFieldsMD
            Dim oRec As SAPbobsCOM.Recordset
            Dim lRetCode As Integer = 0
            Dim lErrCode As Integer = 0
            Dim sErrMsg As String = ""
            Dim bIsContinue As Boolean = True
            Dim SetupEFaktur As String = ""
            Dim FirstRun As Boolean = False

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT " & ControlChars.Quote & "TableID" & ControlChars.Quote &
                         " FROM CUFD WHERE " & ControlChars.Quote & "TableID" & ControlChars.Quote & " = 'OADM' AND " &
                         ControlChars.Quote & "AliasID" & ControlChars.Quote & " = 'SOL_EFAKTUR_SETUP'")

            If oRec.RecordCount = 0 Then
                bIsContinue = True
            Else
                bIsContinue = False
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            oRec = Nothing
            GC.Collect()

            If bIsContinue Then
                oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
                oUFields.TableName = "OADM"
                oUFields.Name = "SOL_EFAKTUR_SETUP" ' buat UDF di table OADM
                oUFields.Description = "eFaktur Setup"
                oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
                oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
                oUFields.EditSize = 5
                oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

                oUFields.ValidValues.Value = "N"
                oUFields.ValidValues.Description = "No" 'buat valid value dengan value Y dan N
                oUFields.ValidValues.Add()

                oUFields.ValidValues.Value = "Y"
                oUFields.ValidValues.Description = "Yes"
                oUFields.ValidValues.Add()

                oUFields.DefaultValue = "Y"

                lRetCode = oUFields.Add()
                If lRetCode <> 0 Then
                    oSBOCompany.GetLastError(lErrCode, sErrMsg)
                    oSBOApplication.MessageBox(lErrCode.ToString & " : " & sErrMsg)
                Else
                    FirstRun = True
                End If
                System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
                oUFields = Nothing
                GC.Collect()
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT ""U_SOL_EFAKTUR_SETUP"" FROM OADM")

            If oRec.RecordCount > 0 Then
                bIsContinue = True
                SetupEFaktur = IIf((oRec.Fields.Item("U_SOL_EFAKTUR_SETUP").Value = ""), "Y", oRec.Fields.Item("U_SOL_EFAKTUR_SETUP").Value)
            Else
                bIsContinue = False
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            oRec = Nothing
            GC.Collect()

            If SetupEFaktur = "Y" Or FirstRun = True Then ' jika eFaktur Setup nya Y dia akan jalanin ini 
                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Extract SP Query")
                ExctractSPQuery()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Creating UDT for Setting Faktur Pajak")
                AddUDTFPSetup()

                '--------------------------------------------------------------------------------------------------------------------------------------

                Try
                    updateProgress("Creating UDF for Setting Faktur Pajak")
                    AddUDFFPSetup()
                Catch ex As Exception
                    updateProgress("Skip already Exist UDF")
                End Try


                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Creating UDO for Setting Faktur Pajak")
                AddUDOFPSetup()

                '--------------------------------------------------------------------------------------------------------------------------------------

                Try
                    updateProgress("Creating UDF Faktur Pajak for Marketing Document")
                    AddUDFInvoice()
                Catch ex As Exception
                    updateProgress("Skip already Exist UDF")
                End Try


                '--------------------------------------------------------------------------------------------------------------------------------------
                Try
                    updateProgress("Creating UDF Faktur Pajak for Marketing Document")
                    AddUDFBP()
                Catch ex As Exception
                    updateProgress("Skip already Exist UDF")
                End Try


                '--------------------------------------------------------------------------------------------------------------------------------------
                If oSQLConnection.ServerName <> "" Then

                    If oSBOCompany.DbServerType = SAPbobsCOM.BoDataServerTypes.dst_HANADB Then
                        updateProgress("Creating SQL Programmability")
                        CreateAlterSQLProgrammabilityHANA()

                        'updateProgress("Creating Validation")
                        'AddSPValidationHANA()
                    Else
                        updateProgress("Creating SQL Programmability")
                        CreateAlterSQLProgrammability()

                        'updateProgress("Creating Validation")
                        'AddSPValidation()
                    End If

                End If
                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Creating Query Category")
                CreateQueryCategory()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Creating Query for Formatted Search")
                If oSBOCompany.DbServerType = SAPbobsCOM.BoDataServerTypes.dst_HANADB Then
                    addQueryFMSHANA()
                Else
                    addQueryFMS()
                End If


                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Setup UDO FP Gabungan") ' CREATE UDF UDT UDO DISINI GABUNGAN
                AddOffFakturGabungan()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Setup UDO FP Gunggung") ' CREATE UDF UDT UDO DISINI GUNGGUNG
                AddOffFakturGunggung()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Setup UDO FP Massal") ' CREATE UDF UDT UDO DISINI MASSAL
                AddOffFakturMassal()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Creating Formatted Search") ' create FMS semua FP diatas
                addFormattedSearch()
                addFormattedSearchArReserve()

                addFormattedSearchAp()
                Try
                    addFormattedSearchApReserve()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try

                Try
                    addFormattedSearchApDp()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try

                Try
                    addFormattedSearchApCm()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try

                Try
                    addFormattedSearchArCm()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try


                Try
                    addFormattedSearchBP()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try

                Try
                    addFormattedSearchGB()
                Catch ex As Exception
                    updateProgress("Skip already Exist fms")
                End Try


                '--------------------------------------------------------------------------------------------------------------------------------------

                Try
                    updateProgress("Creating UDT for Master Branch")
                    AddUDTMasterBranch()
                Catch ex As Exception
                    updateProgress("Skip already Exist UDT")
                End Try


                '--------------------------------------------------------------------------------------------------------------------------------------

                Try
                    updateProgress("Creating UDF for Master Branch")
                    AddUDFBranch()
                Catch ex As Exception
                    updateProgress("Skip already Exist UDF")
                End Try


                Try
                    updateProgress("creating udf role & udf format")
                    roleAndFormat()
                Catch ex As Exception
                    updateProgress("skip already exist")
                End Try


                Try
                    updateProgress("creating udt Cortax")
                    AddUDTCortax()
                Catch ex As Exception
                    updateProgress("skip already exist")
                End Try

                Try
                    updateProgress("creating udt Cortax")
                    AddUDFCortax()
                Catch ex As Exception
                    updateProgress("skip already exist")
                End Try


                updateProgress("Creating Query for Formatted Search")
                If oSBOCompany.DbServerType = SAPbobsCOM.BoDataServerTypes.dst_HANADB Then
                    AddQueryFMSCoretax()
                Else
                    AddQueryFMSCoretaxSQL()
                End If


                Try
                    updateProgress("creating FMS Cortax")
                    AddFMSCoretax()
                Catch ex As Exception
                    updateProgress("skip already exist")
                End Try

                '-------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("insert masterdata UDT")
                Add_MasterDataCoreTax()

                '-------------------------------------------------------------------------------------------------------------------------------------

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Delete SP Query")
                DeleteSPQuery()

                '--------------------------------------------------------------------------------------------------------------------------------------

                updateProgress("Done, Set Efaktur Setup = NO in UDF Company Details Menu!") ' SETUP SELESAI loncat ke manager lagi



                '--------------------------------------------------------------------------------------------------------------------------------------

            End If
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try
    End Sub

    Private Sub updateProgress(ByRef AddText As String)
        oSBOApplication.StatusBar.SetText(AddText, SAPbouiCOM.BoMessageTime.bmt_Short, SAPbouiCOM.BoStatusBarMessageType.smt_Success)
    End Sub

    Private Sub ExctractSPQuery() ' extrac SP query
        Try
            Dim zipPath As String = Application.StartupPath + "\Query.zip"
            Dim extractPath As String = Application.StartupPath + "\"
            'Dim zipPath As String = ".\Query.zip"
            'Dim extractPath As String = ".\"

            ZipFile.ExtractToDirectory(zipPath, extractPath)

        Catch ex As Exception
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub DeleteSPQuery()
        Try
            Dim pathHana As String = ".\HANA"
            Dim pathSQL As String = ".\SQL"
            Dim pathXML As String = ".\XML"
            Dim path As String = ".\Query"
            System.IO.Directory.Delete(path, True)
            System.IO.Directory.Delete(pathHana, True)
            System.IO.Directory.Delete(pathSQL, True)
            System.IO.Directory.Delete(pathXML, True)

        Catch ex As Exception
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub AddUDTFPSetup()
        Dim UTables As SAPbobsCOM.UserTablesMD
        Dim RetCode As Integer = 0
        Dim ErrCode As Integer = 0
        Dim ErrMsg As String = ""

        UTables = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserTables)

        If Not UTables.GetByKey("SOL_FP_SETUP") Then
            updateProgress("Creating UDT SOL_FP_SETUP")

            UTables.TableName = "SOL_FP_SETUP"
            UTables.TableDescription = "Setup Faktur Pajak"
            UTables.TableType = SAPbobsCOM.BoUTBTableType.bott_MasterData

            RetCode = UTables.Add()
        End If

        If RetCode <> 0 Then
            oSBOCompany.GetLastError(ErrCode, ErrMsg)
            updateProgress(ErrCode.ToString & " : " & ErrMsg)
            Throw New Exception(ErrCode.ToString & " : " & ErrMsg)
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(UTables)
        UTables = Nothing
        GC.Collect()

    End Sub

    Private Sub AddUDTMasterBranch()
        Dim UTables As SAPbobsCOM.UserTablesMD
        Dim RetCode As Integer = 0
        Dim ErrCode As Integer = 0
        Dim ErrMsg As String = ""
        GC.Collect()
        UTables = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserTables)

        If Not UTables.GetByKey("SOL_MST_BRCH_FP") Then
            updateProgress("Creating UDT SOL_MST_BRCH_FP")

            UTables.TableName = "SOL_MST_BRCH_FP"
            UTables.TableDescription = "Mst Cabang FP"
            UTables.TableType = SAPbobsCOM.BoUTBTableType.bott_NoObject

            RetCode = UTables.Add()
        End If

        If RetCode <> 0 Then
            oSBOCompany.GetLastError(ErrCode, ErrMsg)
            updateProgress(ErrCode.ToString & " : " & ErrMsg)
            Throw New Exception(ErrCode.ToString & " : " & ErrMsg)
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(UTables)
        UTables = Nothing
        GC.Collect()

    End Sub

    Private Sub AddUDFFPSetup()
        Dim oUFields As SAPbobsCOM.UserFieldsMD
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_YEAR'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_YEAR for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_YEAR"
            oUFields.Description = "Tahun Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Numeric
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 4
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_PERIOD'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_PERIOD for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_PERIOD"
            oUFields.Description = "Periode"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_DESCRIPTION'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_DESCRIPTION for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_DESCRIPTION"
            oUFields.Description = "Keterangan"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS1'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS1 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS1"
            oUFields.Description = "Start Section 1"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 3
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES1'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES1 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES1"
            oUFields.Description = "End Section 1"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 3
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS2'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS2 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS2"
            oUFields.Description = "Start Section 2"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES2'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES2 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES2"
            oUFields.Description = "End Section 2"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS3'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS3 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS3"
            oUFields.Description = "Start Section 3"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 8
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES3'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES3 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES3"
            oUFields.Description = "End Section 3"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 8
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_BRANCH'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_BRANCH for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_BRANCH"
            oUFields.Description = "Branch"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 20
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tNO

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_START_ACTIVE_DATE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_START_ACTIVE_DATE for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_START_ACTIVE_DATE"
            oUFields.Description = "Start Date"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Date
            'oUFields.EditSize = 254

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_END_ACTIVE_DATE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_END_ACTIVE_DATE for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_END_ACTIVE_DATE"
            oUFields.Description = "END Date"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Date
            'oUFields.EditSize = 254

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If




        '--------------------------------------------------------------------------------------------------------------------------------------
        ' EXAMPLE Section
        '--------------------------------------------------------------------------------------------------------------------------------------


        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_Dummy'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_YEAR_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_Dummy_EX"
            oUFields.Description = "DUMMY Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Numeric
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 4
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "2024"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "2024"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If
        '--------------------------------------------------------------------------------------------------------------------------------------


        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_Dummy_code'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_Dummy_code for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_Dummy_code"
            oUFields.Description = "DUMMY Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Numeric
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 4
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "1"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_YEAR_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_YEAR_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_YEAR_EX"
            oUFields.Description = "Tahun Pajak Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Numeric
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 4
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "2024"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "2024"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If

            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_PERIOD_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_PERIOD_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_PERIOD_EX"
            oUFields.Description = "Periode Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254
            oUFields.ValidValues.Value = "Sept 2024"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "Sept 2024"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_DESCRIPTION_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_DESCRIPTION_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_DESCRIPTION_EX"
            oUFields.Description = "Keterangan Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254
            oUFields.ValidValues.Value = "September 2024"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "September 2024"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS1_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS1_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS1_EX"
            oUFields.Description = "Start Section 1 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 3
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "000"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "000"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES1_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES1_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES1_EX"
            oUFields.Description = "End Section 1 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 3
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "000"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "000"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS2_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS2_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS2_EX"
            oUFields.Description = "Start Section 2 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "24"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "24"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES2_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES2_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES2_EX"
            oUFields.Description = "End Section 2 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "24"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "24"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_SS3_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_SS3_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_SS3_EX"
            oUFields.Description = "Start Section 3 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 8
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "00000001"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "00000001"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_NO_ES3_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NO_ES3 for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_NO_ES3_EX"
            oUFields.Description = "End Section 3 Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 8
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "00000010"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "00000010"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_FP_BRANCH_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_BRANCH_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_FP_BRANCH_EX"
            oUFields.Description = "Branch Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 20
            oUFields.Mandatory = SAPbobsCOM.BoYesNoEnum.tYES
            oUFields.ValidValues.Value = "-"
            oUFields.ValidValues.Add()
            oUFields.DefaultValue = "-"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_START_ACTIVE_DATE_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_START_ACTIVE_DATE_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_START_ACTIVE_DATE_EX"
            oUFields.Description = "Start Date"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Date
            'oUFields.EditSize = 254
            oUFields.DefaultValue = "20240901"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = '@SOL_FP_SETUP' AND ""AliasID"" = 'SOL_END_ACTIVE_DATE_EX'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_END_ACTIVE_DATE_EX for Table SOL_FP_SETUP")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "@SOL_FP_SETUP"
            oUFields.Name = "SOL_END_ACTIVE_DATE_EX"
            oUFields.Description = "END Date Example"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Date
            'oUFields.EditSize = 254
            oUFields.DefaultValue = "20240901"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If




    End Sub

    Private Sub AddUDFBranch()

        Utils.CreateUDF(oSBOCompany, "@SOL_MST_BRCH_FP", "SOL_FP_Branch", "Cabang FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 20)

        Dim oUFields As SAPbobsCOM.UserFieldsMD
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        '--https://community.sap.com/t5/enterprise-resource-planning-q-a/need-to-add-data-into-udt-via-di-api-sap-business-one-sql/qaq-p/13663362
        oRec.DoQuery("INSERT INTO ""@SOL_MST_BRCH_FP"" VALUES ('1','1','')")
        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

    End Sub


    Private Sub AddUDOFPSetup()
        Dim oUserObjectMD As SAPbobsCOM.UserObjectsMD
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT""Code"" FROM OUDO WHERE ""Code"" = 'SOL_FP_SETUP'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDO SOL_FP_SETUP")

            oUserObjectMD = oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserObjectsMD)

            oUserObjectMD.Code = "SOL_FP_SETUP"
            oUserObjectMD.Name = "Setting Faktur Pajak"
            oUserObjectMD.ObjectType = SAPbobsCOM.BoUDOObjType.boud_MasterData
            oUserObjectMD.TableName = "SOL_FP_SETUP"

            oUserObjectMD.CanFind = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.CanDelete = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.CanCancel = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.CanClose = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.ManageSeries = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.CanYearTransfer = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.CanArchive = SAPbobsCOM.BoYesNoEnum.tNO

            oUserObjectMD.CanCreateDefaultForm = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.EnableEnhancedForm = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.MenuItem = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.MenuCaption = "Setting Faktur Pajak"
            'oUserObjectMD.FatherMenuID = 43525
            'oUserObjectMD.Position = 0
            'oUserObjectMD.MenuUID = "SOL_FP_SETUP"



            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_YEAR"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_PERIOD"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_DESCRIPTION"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_START_ACTIVE_DATE"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_END_ACTIVE_DATE"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS1"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES1"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS2"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES2"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS3"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES3"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_BRANCH"
            oUserObjectMD.FindColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "Code"
            oUserObjectMD.FormColumns.FormColumnDescription = "Code"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_YEAR"
            oUserObjectMD.FormColumns.FormColumnDescription = "Tahun Pajak"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_PERIOD"
            oUserObjectMD.FormColumns.FormColumnDescription = "Periode"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_DESCRIPTION"
            oUserObjectMD.FormColumns.FormColumnDescription = "Keterangan"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_START_ACTIVE_DATE"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Active Date"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_END_ACTIVE_DATE"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Active Date"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS1"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 1"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES1"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 1"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS2"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 2"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES2"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 2"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS3"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 3"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES3"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 3"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_BRANCH"
            oUserObjectMD.FormColumns.FormColumnDescription = "Branch"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tYES
            oUserObjectMD.FormColumns.Add()



            '=================================================================================================
            'EXAMPLE Section
            '=================================================================================================

            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_Dummy_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_Dummy_code"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_YEAR_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_PERIOD_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_DESCRIPTION_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_START_ACTIVE_DATE_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_END_ACTIVE_DATE_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS1_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES1_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS2_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES2_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_SS3_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_NO_ES3_EX"
            oUserObjectMD.FindColumns.Add()
            oUserObjectMD.FindColumns.ColumnAlias = "U_SOL_FP_BRANCH_EX"
            oUserObjectMD.FindColumns.Add()


            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_Dummy_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Dummy Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_Dummy_code"
            oUserObjectMD.FormColumns.FormColumnDescription = "Code Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_YEAR_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Tahun Pajak Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_PERIOD_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Periode Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_DESCRIPTION_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Keterangan Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_START_ACTIVE_DATE_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Active Date Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_END_ACTIVE_DATE_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Active Date Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS1_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 1 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES1_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 1 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS2_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 2 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES2_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 2 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_SS3_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Start Section 3 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_NO_ES3_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "End Section 3 Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()
            oUserObjectMD.FormColumns.FormColumnAlias = "U_SOL_FP_BRANCH_EX"
            oUserObjectMD.FormColumns.FormColumnDescription = "Branch Example"
            oUserObjectMD.FormColumns.Editable = SAPbobsCOM.BoYesNoEnum.tNO
            oUserObjectMD.FormColumns.Add()

            lRetCode = oUserObjectMD.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserObjectMD)
            oUserObjectMD = Nothing

            GC.Collect() 'Release the handle to the table
        End If
    End Sub

    Private Sub AddUDFInvoice()
        Dim oUFields As SAPbobsCOM.UserFieldsMD
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True


        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OUSR' AND ""AliasID"" = 'SOL_FP_USER'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_FP_USER for User Master Data")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OUSR"
        '    oUFields.Name = "SOL_FP_USER"
        '    oUFields.Description = "User eFaktur"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 1

        '    oUFields.ValidValues.Value = "0"
        '    oUFields.ValidValues.Description = "No"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Yes"
        '    oUFields.ValidValues.Add()

        '    oUFields.DefaultValue = "0"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'Else

        '    'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
        '    'oUFields.GetByKey("OADM", 1)

        '    'lRetCode = oUFields.Remove
        '    'If lRetCode <> 0 Then
        '    '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '    '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    'End If
        '    'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    'oUFields = Nothing
        '    'GC.Collect()
        'End If
        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OADM' AND ""AliasID"" = 'SOL_FP_MASSAL'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_MASSAL for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OADM"
            oUFields.Name = "SOL_FP_MASSAL"
            oUFields.Description = "eFaktur Massal"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 1

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "No"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "Yes"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "0"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        Else

            'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
            'oUFields.GetByKey("OADM", 1)

            'lRetCode = oUFields.Remove
            'If lRetCode <> 0 Then
            '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            'End If
            'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            'oUFields = Nothing
            'GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OADM' AND ""AliasID"" = 'SOL_FP_GABUNGAN'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_FP_GABUNGAN for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OADM"
        '    oUFields.Name = "SOL_FP_GABUNGAN"
        '    oUFields.Description = "eFaktur Gabungan"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 1

        '    oUFields.ValidValues.Value = "0"
        '    oUFields.ValidValues.Description = "No"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Yes"
        '    oUFields.ValidValues.Add()

        '    oUFields.DefaultValue = "0"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'Else

        '    'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
        '    'oUFields.GetByKey("OADM", 1)

        '    'lRetCode = oUFields.Remove
        '    'If lRetCode <> 0 Then
        '    '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '    '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    'End If
        '    'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    'oUFields = Nothing
        '    'GC.Collect()
        'End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OADM' AND ""AliasID"" = 'SOL_FP_GUNGGUNG'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_FP_GUNGGUNG for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OADM"
        '    oUFields.Name = "SOL_FP_GUNGGUNG"
        '    oUFields.Description = "eFaktur Gunggung"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 1

        '    oUFields.ValidValues.Value = "0"
        '    oUFields.ValidValues.Description = "No"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Yes"
        '    oUFields.ValidValues.Add()

        '    oUFields.DefaultValue = "0"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'Else

        '    'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
        '    'oUFields.GetByKey("OADM", 1)

        '    'lRetCode = oUFields.Remove
        '    'If lRetCode <> 0 Then
        '    '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '    '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    'End If
        '    'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    'oUFields = Nothing
        '    'GC.Collect()
        'End If

        '---------------------------------------------------------------------------------------------------------
        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_LIST_FP_GABUNGAN'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_LIST_BP_GABUNGAN for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OCRD"
        '    oUFields.Name = "SOL_LIST_FP_GABUNGAN"
        '    oUFields.Description = "List FP Gabungan"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 1

        '    oUFields.ValidValues.Value = "0"
        '    oUFields.ValidValues.Description = "No"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Yes"
        '    oUFields.ValidValues.Add()

        '    oUFields.DefaultValue = "0"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        '---------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'CRD1' AND ""AliasID"" = 'SOL_LIST_FP_CABANG'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_Cabang for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "CRD1"
            oUFields.Name = "SOL_FP_CABANG"
            oUFields.Description = "Cabang FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254


            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '---------------------------------------------------------------------------------------------------------
        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_NAMA_NPWP'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_NAMA_NPWP for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OCRD"
        '    oUFields.Name = "SOL_NAMA_NPWP"
        '    oUFields.Description = "Nama NPWP FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 225

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If
        '---------------------------------------------------------------------------------------------------------
        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_NO_KTP'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_NO_KTP for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OCRD"
        '    oUFields.Name = "SOL_NO_KTP"
        '    oUFields.Description = "No KTP FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 225

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        ''---------------------------------------------------------------------------------------------------------
        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_FP_ALAMAT'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_FP_ALAMAT for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OCRD"
        '    oUFields.Name = "SOL_FP_ALAMAT"
        '    oUFields.Description = "Alamat NPWP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 225

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        ''---------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_TYPE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_TYPE for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_TYPE"
            oUFields.Description = "Tipe Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 10

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "FP On Invoice"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "FP Massal"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "2"
            oUFields.ValidValues.Description = "FP Gabungan"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "3"
            oUFields.ValidValues.Description = "FP Gunggung"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "0"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_REF_NO'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_REF_NO for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_REF_NO"
            oUFields.Description = "Ref No Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 50
            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If
        '---------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_BRANCH'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_BRANCH for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_BRANCH"
            oUFields.Description = "Cabang FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 20

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_PPN_DATE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_PPN_DATE"
            oUFields.Description = "Tanggal Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Date
            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_TRX_CODE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_TRX_CODE for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_TRX_CODE"
            oUFields.Description = "Kode Transaksi Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2

            oUFields.ValidValues.Value = "01"
            oUFields.ValidValues.Description = "01"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "02"
            oUFields.ValidValues.Description = "02"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "03"
            oUFields.ValidValues.Description = "03"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "04"
            oUFields.ValidValues.Description = "04"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "05"
            oUFields.ValidValues.Description = "05"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "06"
            oUFields.ValidValues.Description = "06"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "07"
            oUFields.ValidValues.Description = "07"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "08"
            oUFields.ValidValues.Description = "08"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "09"
            oUFields.ValidValues.Description = "09"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "01"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If
        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_STATUS_CODE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_STATUS_CODE for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_STATUS_CODE"
            oUFields.Description = "Kode Status Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 1

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "Normal"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "Penggantian"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "0"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If


        ''---------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'ORIN' AND ""AliasID"" = 'SOL_FP_TIPE_CM'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_TIPE_CM for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "ORIN"
            oUFields.Name = "SOL_FP_TIPE_CM"
            oUFields.Description = "Base Doc FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 10

            oUFields.ValidValues.Value = "No"
            oUFields.ValidValues.Description = "No"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "AR"
            oUFields.ValidValues.Description = "AR"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "AR Reserve"
            oUFields.ValidValues.Description = "AR Reserve"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "ARDP"
            oUFields.ValidValues.Description = "ARDP"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "No"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_RUNNING_NO'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_RUNNING_NO for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_RUNNING_NO"
            oUFields.Description = "Nomor Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 13

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_FULL_NO'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_FULL_NO for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_FULL_NO"
            oUFields.Description = "Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 19

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_PPN'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_PPN for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_PPN"
            oUFields.Description = "PPN Status FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 2

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_KMK'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_KMK for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_KMK"
            oUFields.Description = "KMK FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 100

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_KD_PENDUKUNG'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_KD_PENDUKUNG for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_KD_PENDUKUNG"
            oUFields.Description = "Kode Dokumen Pendukung FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 225

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_EXPORTED'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_EXPORTED for Marketing Document")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OINV"
        '    oUFields.Name = "SOL_EXPORTED"
        '    oUFields.Description = "Exported FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 5

        '    oUFields.ValidValues.Value = "0"
        '    oUFields.ValidValues.Description = "No"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Yes"
        '    oUFields.ValidValues.Add()

        '    oUFields.DefaultValue = "0"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_BP_JOIN'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_BP_JOIN for Marketing Document")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OINV"
        '    oUFields.Name = "SOL_BP_JOIN"
        '    oUFields.Description = "Kode BP Gabungan FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 15

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_BPNAME_JOIN'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_BPNAME_JOIN for Marketing Document")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OINV"
        '    oUFields.Name = "SOL_BPNAME_JOIN"
        '    oUFields.Description = "Nama BP Gabungan FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 100

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If


        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_NPWPNM'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_NPWPNM for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_NPWPNM"
            oUFields.Description = "Nama NPWP FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 200

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If


        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_NPWP'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_NPWP for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_NPWP"
            oUFields.Description = "No NPWP / KTP FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 200

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If


        ''--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_NIK'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_FP_NIK for Marketing Document")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OINV"
        '    oUFields.Name = "SOL_FP_NIK"
        '    oUFields.Description = "NIK FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 200

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_ALAMAT'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_ALAMAT for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_ALAMAT"
            oUFields.Description = "Alamat FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 200

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_FP_TYPE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_TYPE for Marketing Document")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OCRD"
            oUFields.Name = "SOL_FP_TYPE"
            oUFields.Description = "Tipe Faktur Pajak"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 10

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "FP On Invoice"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "FP Massal"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "2"
            oUFields.ValidValues.Description = "FP Gabungan"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "3"
            oUFields.ValidValues.Description = "FP Gunggung"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "1"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OCRD' AND ""AliasID"" = 'SOL_CUS_TYPE'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_CUS_TYPE for BP Master")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "OCRD"
        '    oUFields.Name = "SOL_CUS_TYPE"
        '    oUFields.Description = "Type Customer FP"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
        '    oUFields.EditSize = 10

        '    oUFields.ValidValues.Value = "1"
        '    oUFields.ValidValues.Description = "Cash"
        '    oUFields.ValidValues.Add()

        '    oUFields.ValidValues.Value = "2"
        '    oUFields.ValidValues.Description = "Credit"
        '    oUFields.ValidValues.Add()


        '    oUFields.DefaultValue = "1"

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If

        '--------------------------------------------------------------------------------------------------------------------------------------

        'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        'oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'CRD1' AND ""AliasID"" = 'SOL_ACTIVE'")

        'If oRec.RecordCount = 0 Then
        '    bIsContinue = True
        'Else
        '    bIsContinue = False
        'End If

        'System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        'oRec = Nothing
        'GC.Collect()

        'If bIsContinue Then
        '    updateProgress("Creating UDF SOL_ACTIVE for Setting")

        '    oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

        '    oUFields.TableName = "CRD1"
        '    oUFields.Name = "SOL_ACTIVE"
        '    oUFields.Description = "Active Address E-faktur"
        '    oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
        '    oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_Checkbox
        '    'oUFields.EditSize = 225

        '    lRetCode = oUFields.Add()
        '    If lRetCode <> 0 Then
        '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
        '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
        '    End If
        '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
        '    oUFields = Nothing
        '    GC.Collect()
        'End If
        '--------------------------------------------------------------------------------------------------------------------------------------
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_SCN_URL'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_SCN_URL for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_SCN_URL"
            oUFields.Description = "SCAN URL FP"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 225

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------



    End Sub

    Public Sub CreateAlterSQLProgrammability()

        Utils.CreateSP(oSBOCompany, "FN_ITER_CHARLIST_TO_TABLE", GetStringdotsql("FN_ITER_CHARLIST_TO_TABLE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "FN_ITER_INTLIST_TO_TABLE", GetStringdotsql("FN_ITER_INTLIST_TO_TABLE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "FN_PADDING", GetStringdotsql("FN_PADDING.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_FORMATTED_NPWP", GetStringdotsql("FN_SOL_FORMATTED_NPWP.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_NUMBERS_ONLY", GetStringdotsql("FN_SOL_NUMBERS_ONLY.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_TAX_BP_NAME", GetStringdotsql("FN_SOL_TAX_BP_NAME.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_REP_NFP_USAGE", GetStringdotsql("SOL_REP_NFP_USAGE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_MASUKAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_MASUKAN.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN", GetStringdotsql("SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_KELUARAN_LIST", GetStringdotsql("SOL_FORM_GET_PAJAK_KELUARAN_LIST.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG", GetStringdotsql("SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_MASUKAN_LIST", GetStringdotsql("SOL_FORM_GET_PAJAK_MASUKAN_LIST.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_KELUARAN_LIST", GetStringdotsql("SOL_FORM_GET_RETUR_KELUARAN_LIST.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_MASUKAN_LIST", GetStringdotsql("SOL_FORM_GET_RETUR_MASUKAN_LIST.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE", GetStringdotsql("SOL_FP_NEXT_SEQUENCE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE2", GetStringdotsql("SOL_FP_NEXT_SEQUENCE2.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_UNUSED_SEQUENCE", GetStringdotsql("SOL_FP_UNUSED_SEQUENCE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE", GetStringdotsql("SOL_REP_NFP_USAGE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_GET_DETAIL_BP", GetStringdotsql("SOL_FORM_E_FAKTUR_GET_DETAIL_BP.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SBO_SP_TransactionNotification_EFAKTUR", GetStringdotsql("SBO_SP_TransactionNotification_SOL_EFAKTUR.SQL", "SP", "SQL"))

        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE_AR", GetStringdotsql("SOL_FP_NEXT_SEQUENCE_AR.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE_ARDP", GetStringdotsql("SOL_FP_NEXT_SEQUENCE_ARDP.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_GenerateNumber", GetStringdotsql("SOL_GenerateNumber.SQL", "SP", "SQL"))

        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN.SQL", "SP", "SQL"))

        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE.SQL", "SP", "SQL"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE.SQL", "SP", "SQL"))

        Utils.CreateSP(oSBOCompany, "SOL_FP_REMAINING", GetStringdotsql("SOL_FP_REMAINING2.SQL", "SP", "SQL"))



        'Dim di As New DirectoryInfo(".\SQL\EXEC")
        'Dim fiArr As FileInfo() = di.GetFiles()
        'Dim fi As FileInfo
        'For Each fi In fiArr
        '    Dim fileName As String = fi.FullName
        '    Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

        '    Dim objReader As New System.IO.StreamReader(fileName)
        '    Dim sql As String = objReader.ReadToEnd
        '    objReader.Close()
        '    If oSQLConnection.isConnected = False Then
        '        oSQLConnection.Connect()
        '    End If

        '    Try
        '        If oSQLConnection.isConnected = True Then

        '            Dim adapter As New SqlDataAdapter
        '            Dim parameter As New SqlParameter

        '            Dim command As SqlCommand = New SqlCommand("SELECT definition FROM sys.sql_modules WHERE object_id = (OBJECT_ID(N'" + pName + "'))", oSQLConnection.Connection)
        '            command.Connection = oSQLConnection.Connection
        '            adapter.SelectCommand = command
        '            Dim ValueReader As String = ""
        '            Dim sdr As SqlDataReader = command.ExecuteReader()
        '            While sdr.Read = True
        '                ValueReader = ValueReader + sdr.Item("definition").ToString
        '            End While
        '            sdr.Close()

        '            If ValueReader.Trim <> "" Then
        '                sql = sql.Replace("CREATE FUNCTION ", "ALTER FUNCTION ")
        '                sql = sql.Replace("CREATE FUNC ", "ALTER FUNC ")

        '                sql = sql.Replace("CREATE PROCEDURE ", "ALTER PROCEDURE ")
        '                sql = sql.Replace("CREATE PROC ", "ALTER PROC ")

        '                updateProgress("Altering " + pName)
        '            Else
        '                updateProgress("Creating " + pName)
        '            End If

        '            command = New SqlCommand(sql, oSQLConnection.Connection)
        '            command.Connection = oSQLConnection.Connection
        '            adapter.SelectCommand = command
        '            command.ExecuteReader()
        '            oSQLConnection.Connection.Close()
        '        End If
        '    Catch ex As Exception
        '        oSQLConnection.Connection.Close()
        '        'Throw ex
        '    End Try
        '    'End If
        'Next fi
    End Sub

    Public Sub CreateAlterSQLProgrammabilityHANA()

        Utils.CreateSP(oSBOCompany, "A_SILENT_dynamic_sql_ddl_error_level", GetStringdotsql("A_SILENT_dynamic_sql_ddl_error_level.sql", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "A_SILENT_sudf_support_level_select_into", GetStringdotsql("A_SILENT_sudf_support_level_select_into.sql", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_IFEXISTS", GetStringdotsql("ASOL_IFEXISTS.sql", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_IFEXISTS_GLOBAL", GetStringdotsql("ASOL_IFEXISTS_GLOBAL.sql", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "FN_ITER_INTLIST_TO_TABLE", GetStringdotsql("FN_ITER_INTLIST_TO_TABLE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "FN_PADDING", GetStringdotsql("FN_PADDING.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_FORMATTED_NPWP", GetStringdotsql("FN_SOL_FORMATTED_NPWP.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_NUMBERS_ONLY", GetStringdotsql("FN_SOL_NUMBERS_ONLY.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "FN_SOL_TAX_BP_NAME", GetStringdotsql("FN_SOL_TAX_BP_NAME.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_REP_NFP_USAGE", GetStringdotsql("FSOL_REP_NFP_USAGE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_CLEANING_CHECK.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GB.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN_GET_DETAIL.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG", GetStringdotsql("SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_MASUKAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_MASUKAN.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_RETUR_PAJAK_KELUARAN.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN", GetStringdotsql("SOL_FORM_E_FAKTUR_RETUR_PAJAK_MASUKAN.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_KELUARAN_LIST", GetStringdotsql("SOL_FORM_GET_PAJAK_KELUARAN_LIST.SQL", "SP", "HANA"))
        'Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG", GetStringdotsql("SOL_FORM_GET_PAJAK_KELUARAN_LIST_OFF_INVOICE_GB_GG.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_MASUKAN_LIST", GetStringdotsql("SOL_FORM_GET_PAJAK_MASUKAN_LIST.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_KELUARAN_LIST", GetStringdotsql("SOL_FORM_GET_RETUR_KELUARAN_LIST.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_MASUKAN_LIST", GetStringdotsql("SOL_FORM_GET_RETUR_MASUKAN_LIST.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE", GetStringdotsql("SOL_FP_NEXT_SEQUENCE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE2", GetStringdotsql("SOL_FP_NEXT_SEQUENCE2.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_UNUSED_SEQUENCE", GetStringdotsql("SOL_FP_UNUSED_SEQUENCE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SBO_SP_TransactionNotification_EFAKTUR", GetStringdotsql("SBO_SP_TransactionNotification_EFAKTUR.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_GET_DETAIL_BP", GetStringdotsql("SOL_FORM_E_FAKTUR_GET_DETAIL_BP.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_REMAINING", GetStringdotsql("SOL_FP_REMAINING2.SQL", "SP", "HANA"))

        Utils.CreateSP(oSBOCompany, "SOL_FORM_E_FAKTUR_PAJAK_KELUARAN", GetStringdotsql("SOL_FORM_E_FAKTUR_PAJAK_KELUARAN.SQL", "SP", "HANA"))

        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_PAJAK_MASUKAN_LIST_OFF_INVOICE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_RETUR_PAJAK_MASUKAN_LIST_OFF_INVOICE.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE", GetStringdotsql("SOL_FORM_GET_RETUR_PAJAK_KELUARAN_LIST_OFF_INVOICE.SQL", "SP", "HANA"))


        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE_AR", GetStringdotsql("SOL_FP_NEXT_SEQUENCE_AR.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_FP_NEXT_SEQUENCE_ARDP", GetStringdotsql("SOL_FP_NEXT_SEQUENCE_ARDP.SQL", "SP", "HANA"))
        Utils.CreateSP(oSBOCompany, "SOL_GenerateNumber", GetStringdotsql("SOL_GenerateNumber.SQL", "SP", "HANA"))
        'Update By Teguh.Adi.Wibowo -untuk log tidak perlu di tambahkan
        'Utils.CreateSP(oSBOCompany, "SOL_E_FAKTUR_LOG", GetStringdotsql("SOL_E_FAKTUR_LOG.SQL", "SP", "HANA"))
        'Utils.CreateSP(oSBOCompany, "SOL_E_FAKTUR_INSERT_LOG", GetStringdotsql("SOL_E_FAKTUR_INSERT_LOG.SQL", "SP", "HANA"))


        'Dim di As New DirectoryInfo(".\HANA\EXEC")
        'Dim fiArr As FileInfo() = di.GetFiles()
        'Dim fi As FileInfo
        'For Each fi In fiArr
        '    Dim fileName As String = fi.FullName
        '    Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

        '    Dim objReader As New System.IO.StreamReader(fileName)
        '    Dim sql As String = objReader.ReadToEnd
        '    Dim Query As String = sql
        '    objReader.Close()

        '    Dim hanatransaction As Sap.Data.Hana.HanaTransaction
        '    Dim hanaconnection As New Sap.Data.Hana.HanaConnection
        '    Dim connectionstring As String
        '    Dim conn As String = "10.0.0.12:30015"
        '    If Not hanaconnection Is Nothing Then
        '        If hanaconnection.State = ConnectionState.Closed Then
        '            connectionstring = "Server=" + oSQLConnection.ServerName +
        '                    ";UserID=" + oSQLConnection.UserName +
        '                    ";Password=" + oSQLConnection.Password +
        '                    ";Current Schema=" + oSQLConnection.DatabaseName + ";"
        '        End If
        '    End If

        '    Try
        '        hanaconnection = New Sap.Data.Hana.HanaConnection(connectionstring)
        '        hanaconnection.Open()
        '        Dim halo As String = hanaconnection.Database
        '        Dim command As New Sap.Data.Hana.HanaCommand(sql, hanaconnection)

        '        If Not IsNothing(hanatransaction) Then
        '            command.Transaction = hanatransaction
        '        End If
        '        command.ExecuteNonQuery()
        '        hanaconnection.Close()
        '    Catch ex As Exception
        '        hanaconnection.Close()
        '    End Try

        '    'End If
        'Next fi
    End Sub

    Public Sub AddSPValidation()
        Dim qCustomSPValidation As String = ""

        Dim fileName As String = ".\SQL\VALIDATION\TAX.SQL"

        If File.Exists(fileName) Then
            Dim objReader As New System.IO.StreamReader(fileName)
            qCustomSPValidation = objReader.ReadToEnd
            objReader.Close()
        End If

        Dim qFindSPValidation As String = "" +
            "DECLARE @OBJECTID AS NVARCHAR(MAX) " + vbNewLine +
            "DECLARE @DEFINITION AS NVARCHAR(MAX) " + vbNewLine +
            "" + vbNewLine +
            "SELECT " + vbNewLine +
            "	@OBJECTID = object_id, " + vbNewLine +
            "	@DEFINITION = definition " + vbNewLine +
            "FROM sys.sql_modules " + vbNewLine +
            "WHERE " + vbNewLine +
            "	objectproperty(object_id, 'IsProcedure') = 1 " + vbNewLine +
            "	AND definition IS NOT NULL " + vbNewLine +
            "	AND OBJECT_NAME(object_id) = '" + SPValidation + "' " + vbNewLine +
            "" + vbNewLine +
            "SET @DEFINITION = (SELECT REPLACE(@definition, 'CREATE PROCEDURE ', 'ALTER PROCEDURE ')) " + vbNewLine +
            "SET @DEFINITION = (SELECT REPLACE(@definition, 'CREATE PROC ', 'ALTER PROC ')) " + vbNewLine +
            "" + vbNewLine +
            "SELECT @DEFINITION as SP "

        Dim qSPValidation As String = ""
        Dim ProcessFailed As Boolean = False

        updateProgress("Finding Stored Procedures " + SPValidation)

        If oSQLConnection.isConnected = False Then
            oSQLConnection.Connect()
        End If

        Try

            Dim parameter As New SqlParameter
            Dim ds As New DataSet

            Dim command As SqlCommand = New SqlCommand(qFindSPValidation, oSQLConnection.Connection)
            command.Connection = oSQLConnection.Connection

            Dim sdr As SqlDataReader = command.ExecuteReader()
            While sdr.Read = True
                qSPValidation = qSPValidation + sdr.Item("SP").ToString + " "
            End While
            sdr.Close()

            oSQLConnection.Connection.Close()
        Catch ex As Exception
            ProcessFailed = True
            oSQLConnection.Connection.Close()
            Throw ex
        End Try

        updateProgress("Altering Stored Procedures " + SPValidation)

        qCustomSPValidation = qCustomSPValidation.Trim
        qSPValidation = qSPValidation.Trim

        If ProcessFailed = False Then
            If qSPValidation.ToLower.Contains("-- Validasi Faktur Pajak".ToLower) = False Then
                If SPValidation.Trim.ToLower = "SBO_SP_TransactionNotification".Trim.ToLower Then
                    Dim a As String = "-- Select the return values"
                    Dim b As String = "SELECT @error, @error_message"

                    qCustomSPValidation = qCustomSPValidation + vbNewLine
                    qCustomSPValidation = qCustomSPValidation + vbNewLine + a
                    qCustomSPValidation = qCustomSPValidation + vbNewLine + b

                    If qSPValidation.ToLower.Contains(a.ToLower) Then
                        qSPValidation = qSPValidation.Substring(0, qSPValidation.ToLower.LastIndexOf(a.ToLower)) +
                            qSPValidation.Substring(qSPValidation.ToLower.LastIndexOf(a.ToLower) + a.Length)
                    End If

                    qSPValidation = qSPValidation.Substring(0, qSPValidation.ToLower.LastIndexOf(b.ToLower)) +
                        qCustomSPValidation +
                        qSPValidation.Substring(qSPValidation.ToLower.LastIndexOf(b.ToLower) + b.Length)
                Else
                    qSPValidation = qSPValidation.Substring(0, qSPValidation.ToLower.LastIndexOf("end".ToLower))

                    qSPValidation = qSPValidation + vbNewLine
                    qSPValidation = qSPValidation + qCustomSPValidation
                    qSPValidation = qSPValidation + vbNewLine
                    qSPValidation = qSPValidation + vbNewLine + "END"
                End If

                Try
                    oSQLConnection.Connection.Open()
                    Dim adapter As New SqlDataAdapter
                    Dim parameter As New SqlParameter
                    Dim command As SqlCommand = New SqlCommand(qSPValidation, oSQLConnection.Connection)
                    command.Connection = oSQLConnection.Connection
                    adapter.SelectCommand = command
                    command.ExecuteReader()
                    oSQLConnection.Connection.Close()
                Catch ex As Exception
                    oSQLConnection.Connection.Close()
                    updateProgress("Error While Altering Stored Procedures " + SPValidation)
                    updateProgress(ex.Message)
                End Try
            Else
                updateProgress("Tax Invoice Validations Already Exist in " + SPValidation)
            End If
        End If
    End Sub

    Private Sub CreateQueryCategory()
        Dim oQueryCategory As SAPbobsCOM.QueryCategories
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating Query Category for E-Faktur")

            oQueryCategory = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oQueryCategories), SAPbobsCOM.QueryCategories)
            oQueryCategory.Name = "E-Faktur"
            oQueryCategory.Permissions = "YYYYYYYYYYYYYYY"

            lRetCode = oQueryCategory.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oQueryCategory)
            oQueryCategory = Nothing
            GC.Collect()
        End If
    End Sub

    Private Sub addQueryFMS()
        Dim oUserQuery As SAPbobsCOM.UserQueries
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iCategoryId As Integer = 0

        Try
            Dim qDict As New Dictionary(Of String, String)

            Dim di As New DirectoryInfo(".\Query\SQL\FMS")
            Dim fiArr As FileInfo() = di.GetFiles()
            Dim fi As FileInfo
            For Each fi In fiArr
                Dim fileName As String = fi.FullName
                Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

                Dim objReader As New System.IO.StreamReader(fileName)
                Dim sql As String = objReader.ReadToEnd
                objReader.Close()

                qDict.Add(pName, sql)
                'End If
            Next fi

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FULL_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_PPN_STATUS for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FULL_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_PPN_STATUS for A/R Down Payment Invoice")
                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_LOOKUP_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_LOOKUP_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_LOOKUP_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_USED for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_USED")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_USED"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_EXPORTED for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_EXPORTED")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_EXPORTED"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If



                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_MS_GET_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_MS_GET_PPN_STATUS for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_MS_GET_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_MS_GET_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----SM--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_FPTYPE for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_FPTYPE")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_FPTYPE"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ODPI_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ODPI_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_OINV_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_OINV_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_REMAINING' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS SOL_FP_REMAINING ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("SOL_FP_REMAINING")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "SOL_FP_REMAINING"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_REMAINING2' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_REMAINING2 ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_REMAINING2")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_REMAINING2"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_NPWP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_NPWP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_NPWP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_NAMA_NPWP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_NAMA_NPWP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_NAMA_NPWP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_ALAMAT for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_ALAMAT")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_ALAMAT"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ODPO_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ODPO_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_OPCH_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_OPCH_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORIN_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORIN_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORPC_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORPC_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_MS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE_MS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE_MS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE_MS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORDR_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORDR_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'


                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FULL_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_PPN_STATUS for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'FMS_BP_GABUNGAN' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS FMS_BP_GABUNGAN for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("FMS_BP_GABUNGAN")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "FMS_BP_GABUNGAN"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If






            End If
        Catch ex As Exception
            isError = True
            errorMessage = ex.Message
            updateProgress("Error While Creating Query for Formatted Search")
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub addQueryFMSHANA()
        Dim oUserQuery As SAPbobsCOM.UserQueries
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iCategoryId As Integer = 0

        Try
            Dim qDict As New Dictionary(Of String, String)

            Dim di As New DirectoryInfo(".\Query\HANA\FMS")
            Dim fiArr As FileInfo() = di.GetFiles()
            Dim fi As FileInfo
            For Each fi In fiArr
                Dim fileName As String = fi.FullName
                Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

                Dim objReader As New System.IO.StreamReader(fileName)
                Dim sql As String = objReader.ReadToEnd
                objReader.Close()

                qDict.Add(pName, sql)
                'End If
            Next fi

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FULL_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_PPN_STATUS for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FULL_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_PPN_STATUS for A/R Down Payment Invoice")
                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_LOOKUP_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_LOOKUP_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_LOOKUP_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_LOOKUP_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_USED for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_USED")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_USED"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_EXPORTED for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_EXPORTED")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_EXPORTED"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_MS_GET_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_MS_GET_PPN_STATUS for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_MS_GET_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_MS_GET_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----SM--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_FPTYPE for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_FPTYPE")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_FPTYPE"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ODPI_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ODPI_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_OINV_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_OINV_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_REMAINING' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS SOL_FP_REMAINING ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("SOL_FP_REMAINING")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "SOL_FP_REMAINING"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_REMAINING2' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_REMAINING2 ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_REMAINING2")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_REMAINING2"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_NPWP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_NPWP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_NPWP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_NAMA_NPWP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_NAMA_NPWP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_NAMA_NPWP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----TAW--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORDR_ALAMAT for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_ALAMAT")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORDR_ALAMAT"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ODPO_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ODPO_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_OPCH_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_OPCH_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORIN_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORIN_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_ALAMAT ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_DATE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FP_COPY' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FP_COPY ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FP_COPY")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FP_COPY"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FPTYPE ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_FULL_FP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ORPC_KTP ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ORPC_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_NAMA_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_NPWP ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_PPN_STATUS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_MS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE_MS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE_MS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE_MS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS ")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If



                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORDR_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORDR_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPO_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPO_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPO_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OPCH_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OPCH_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OPCH_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FULL_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_PPN_STATUS for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_SO_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_SO_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_SO_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_SO_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_SO_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_SO_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'FMS_BP_GABUNGAN' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS FMS_BP_GABUNGAN for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("FMS_BP_GABUNGAN")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "FMS_BP_GABUNGAN"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NO' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NO for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NO")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NO"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NO' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NO for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NO")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NO"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NO' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORIN_NO for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORIN_NO")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORIN_NO"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

            End If
        Catch ex As Exception
            isError = True
            errorMessage = ex.Message
            updateProgress("Error While Creating Query for Formatted Search")
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub addQueryFMSHANA1()
        Dim oUserQuery As SAPbobsCOM.UserQueries
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iCategoryId As Integer = 0

        Try
            Dim qDict As New Dictionary(Of String, String)

            Dim di As New DirectoryInfo(".\Query\HANA\FMS")
            Dim fiArr As FileInfo() = di.GetFiles()
            Dim fi As FileInfo
            For Each fi In fiArr
                Dim fileName As String = fi.FullName
                Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

                Dim objReader As New System.IO.StreamReader(fileName)
                Dim sql As String = objReader.ReadToEnd
                objReader.Close()

                qDict.Add(pName, sql)
            Next fi

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FULL_FP for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_PPN_STATUS for A/R Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FULL_FP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FULL_FP for A/R Down Payment Invoice")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FULL_FP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FULL_FP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_PPN_STATUS for A/R Down Payment Invoice")
                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_LOOKUP_BRANCH' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_LOOKUP_BRANCH for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_LOOKUP_BRANCH")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_LOOKUP_BRANCH"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'


                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_INVOICE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_INVOICE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_INVOICE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_FP_USED for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_FP_USED")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_FP_USED"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_GET_LIST_CUSTOMER_GABUNGAN for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_GET_LIST_CUSTOMER_GABUNGAN")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_GET_LIST_CUSTOMER_GABUNGAN"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_MS_GET_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS SOL_FP_MS_GET_PPN_STATUS for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("SOL_FP_MS_GET_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "SOL_FP_MS_GET_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_DATE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_DATE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_DATE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_DATE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-------------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----SM--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FPTYPE' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FPTYPE for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FPTYPE")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FPTYPE"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_ODPI_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_ODPI_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NAMA_NPWP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_NAMA_NPWP for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_NAMA_NPWP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_NAMA_NPWP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KTP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS DEFAULT_OINV_KTP for Tax Invoice Branch")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KTP")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "DEFAULT_OINV_KTP"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

                '-----DS--------------------------------------------------------------------------------------------------------'

                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_ALAMAT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_ALAMAT for Tax Invoice Branch")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_ALAMAT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_ALAMAT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If


                '-------------------------------------------------------------------------------------------------------------'

                'oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'SOL_FP_REMAINING' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                'If oRec.RecordCount = 0 Then
                '    bIsContinue = True
                'Else
                '    bIsContinue = False
                'End If

                'If bIsContinue Then
                '    updateProgress("Creating Query FMS SOL_FP_REMAINING ")

                '    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                '    oUserQuery.Query = qDict.Item("SOL_FP_REMAINING")
                '    oUserQuery.QueryCategory = iCategoryId
                '    oUserQuery.QueryDescription = "SOL_FP_REMAINING"

                '    lRetCode = oUserQuery.Add()
                '    If lRetCode <> 0 Then
                '        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                '        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                '    End If
                '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                '    oUserQuery = Nothing
                '    GC.Collect()
                'End If

            End If
        Catch ex As Exception
            isError = True
            errorMessage = ex.Message
            updateProgress("Error While Creating Query for Formatted Search")
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub addFormattedSearch()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try
            'FP Gabungan'
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtFRINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "txtFRINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "txtFRINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_PER_CUSTOMER' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtTOINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "txtTOINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "txtTOINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtFRINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
            '        oFormattedSearch.ItemID = "txtFRINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGABUNGAN"
            '            oFormattedSearch.ItemID = "txtFRINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            ''------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtTOINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
            '        oFormattedSearch.ItemID = "txtTOINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGABUNGAN"
            '            oFormattedSearch.ItemID = "txtTOINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtCSTCD'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "txtCSTCD"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "txtCSTCD"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtNoRun'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "txtNoRun"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "txtNoRun"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_EXPORTED_FULL_NO'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'txtNoFP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "txtNoFP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_NORUN"

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "txtNoFP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_NORUN"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'
            'FP Gunggung'
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtFRINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                    oFormattedSearch.ItemID = "txtFRINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                        oFormattedSearch.ItemID = "txtFRINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtTOINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                    oFormattedSearch.ItemID = "txtTOINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                        oFormattedSearch.ItemID = "txtTOINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtFRINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '        oFormattedSearch.ItemID = "txtFRINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '            oFormattedSearch.ItemID = "txtFRINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            ''------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtTOINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '        oFormattedSearch.ItemID = "txtTOINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '            oFormattedSearch.ItemID = "txtTOINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtCSTFR'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                    oFormattedSearch.ItemID = "txtCSTFR"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                        oFormattedSearch.ItemID = "txtCSTFR"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_GG'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtCSTTO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                    oFormattedSearch.ItemID = "txtCSTTO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
                        oFormattedSearch.ItemID = "txtCSTTO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'
            'FP Massal'
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_MS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKMASSAL' AND ""ItemID"" = 'txtFRINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKMASSAL"
                    oFormattedSearch.ItemID = "txtFRINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKMASSAL"
                        oFormattedSearch.ItemID = "txtFRINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_INVOICE_MS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKMASSAL' AND ""ItemID"" = 'txtTOINVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKMASSAL"
                    oFormattedSearch.ItemID = "txtTOINVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKMASSAL"
                        oFormattedSearch.ItemID = "txtTOINVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtFRINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '        oFormattedSearch.ItemID = "txtFRINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '            oFormattedSearch.ItemID = "txtFRINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            ''------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_FP_USED'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGUNGGUNG' AND ""ItemID"" = 'txtTOINVFP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '        oFormattedSearch.ItemID = "txtTOINVFP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId

            '        lRetCode = oFormattedSearch.Add()

            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "frmOffFKGUNGGUNG"
            '            oFormattedSearch.ItemID = "txtTOINVFP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKMASSAL' AND ""ItemID"" = 'txtCSTFR'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKMASSAL"
                    oFormattedSearch.ItemID = "txtCSTFR"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKMASSAL"
                        oFormattedSearch.ItemID = "txtCSTFR"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_GET_LIST_CUSTOMER_GABUNGAN_MS'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKMASSAL' AND ""ItemID"" = 'txtCSTTO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKMASSAL"
                    oFormattedSearch.ItemID = "txtCSTTO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKMASSAL"
                        oFormattedSearch.ItemID = "txtCSTTO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_MS_GET_PPN_STATUS'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKMASSAL' AND ""ItemID"" = 'tblData' And ""ColID"" = 'PPNSTAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKMASSAL"
                    oFormattedSearch.ItemID = "tblData"
                    oFormattedSearch.ColumnID = "PPNSTAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKMASSAL"
                        oFormattedSearch.ItemID = "tblData"
                        oFormattedSearch.ColumnID = "PPNSTAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '---------------------------------------------ENDDD---------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If
            'ODPI'
            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "139"
            '        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.FieldID = "12"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "139"
            '            oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.FieldID = "12"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '--------------------------------------------NPWP----------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '--------------------------------------------NPWP----------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "139"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "12"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "139"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "12"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            ''------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "133"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "133"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '---------------------------------------KTP---------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "65300"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "65300"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "139"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "12"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "139"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "12"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '--------------------------------ALAMAT----------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "139"
            '        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "139"
            '            oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '---------------------------Nama NPWP---------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '---------------------------Nama NPWP---------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_NPWPNM'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "139"
            '        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "12"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "139"
            '            oFormattedSearch.ItemID = "U_SOL_NPWPNM"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "12"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If


            '------------------------------------------------------------------------------------------------------------------'
            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_SO_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchArReserve()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "60091"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "60091"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchAp()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "141"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "141"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "141"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "141"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchApDp()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '141' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "141"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "141"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPO_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '204' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65301"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65301"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchApReserve()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "60092"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "60092"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OPCH_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60092' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60092"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60092"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchApCm()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "181"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "181"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchArCm()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FPTYPE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_TYPE'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "179"
            '        oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.FieldID = "12"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "179"
            '            oFormattedSearch.ItemID = "U_SOL_FP_TYPE"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.FieldID = "12"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_BRANCH'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_BRANCH"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_DATE' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_PPN_DATE'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_PPN_DATE"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FP'AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_RUNNING_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()

                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_RUNNING_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_FULL_FP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_FULL_NO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_FULL_NO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_PPN_STATUS' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_PPN'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_PPN"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NAMA_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_NPWPNM'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_NPWPNM"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NPWP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_NPWP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_NPWP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            'oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            'If oRec1.RecordCount <> 0 Then
            '    iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            'End If

            'oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            'oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_KTP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            'If oRec.RecordCount <> 0 Then
            '    iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            'End If

            'If iQueryId > 0 Then
            '    oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_NIK'")

            '    If oRec.RecordCount = 0 Then
            '        bIsContinue = True
            '    Else
            '        bIsContinue = False
            '    End If

            '    Dim IndexID As String
            '    IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

            '    System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
            '    oRec = Nothing
            '    GC.Collect()

            '    If bIsContinue Then
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        oFormattedSearch.FormID = "179"
            '        oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '        oFormattedSearch.QueryID = iQueryId
            '        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '        oFormattedSearch.FieldID = "14"

            '        lRetCode = oFormattedSearch.Add()
            '        If lRetCode <> 0 Then
            '            oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '        End If
            '        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '        oFormattedSearch = Nothing
            '        GC.Collect()
            '    Else
            '        oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
            '        If oFormattedSearch.GetByKey(IndexID) Then
            '            oFormattedSearch.FormID = "179"
            '            oFormattedSearch.ItemID = "U_SOL_FP_NIK"
            '            oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
            '            oFormattedSearch.QueryID = iQueryId
            '            oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
            '            oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
            '            oFormattedSearch.FieldID = "14"

            '            lRetCode = oFormattedSearch.Update()
            '            If lRetCode <> 0 Then
            '                oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            '            End If
            '            System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
            '            oFormattedSearch = Nothing
            '            GC.Collect()
            '        End If
            '    End If
            'End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_ALAMAT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_ALAMAT'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "14"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_ALAMAT"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "14"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORIN_NO' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '179' AND ""ItemID"" = 'U_SOL_FP_INVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "179"
                    oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "179"
                        oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NO' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_INVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NO' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_INVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_NO' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_FP_INVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_NO' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_INVNO'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                    oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_INVNO"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.ForceRefresh = SAPbobsCOM.BoYesNoEnum.tNO
                        oFormattedSearch.FieldID = "U_SOL_FP_RUNNING_NO"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchBP()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'SOL_FP_LOOKUP_BRANCH' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '134' AND ""ItemID"" = 'U_SOL_FP_CABANG'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "134"
                    oFormattedSearch.ItemID = "178"
                    oFormattedSearch.ColumnID = "U_SOL_FP_CABANG"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "134"
                        oFormattedSearch.ItemID = "178"
                        oFormattedSearch.ColumnID = "U_SOL_FP_CABANG"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If





        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub addFormattedSearchGB()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '--------------SM----------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'FMS_BP_GABUNGAN' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = 'frmOffFKGABUNGAN' AND ""ItemID"" = 'Item_27'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                    oFormattedSearch.ItemID = "Item_27"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "frmOffFKGABUNGAN"
                        oFormattedSearch.ItemID = "Item_27"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If





        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    'Private Sub AddOffFaktur1on1()
    '    '--------------------------------ADD UDT---------------------------------------------
    '    Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_1ON1_HD", "Transaksi FP - Header", SAPbobsCOM.BoUTBTableType.bott_Document)
    '    Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_1ON1_DT", "Transaksi FP - Detail", SAPbobsCOM.BoUTBTableType.bott_DocumentLines)
    '    '--------------------------------ADD UDF---------------------------------------------
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "CHKINVNO", "Check Invoice No", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "INVNOFR", "Invoice From", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "INVNOTO", "Invoice To", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "CHKINVDT", "Check Date", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "INVDTFT", "Invoice Date From", SAPbobsCOM.BoFieldTypes.db_Date)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "INVDTTO", "Invoice Date To", SAPbobsCOM.BoFieldTypes.db_Date)

    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "CHKEXP", "Check Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_HD", "NOTES", "Status Notes", SAPbobsCOM.BoFieldTypes.db_Memo)

    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "TDPP", "Total DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "TPPH", "Total PPH", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCTOT", "Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "SELECT", "Selected", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "TRANSCD", "Kode Transaksi", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "STATUSCD", "Status Transaksi", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "NORUN", "Nomor Fatur Pajak", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "NOFP", "Faktur Pajak", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCTYPE", "Document Type", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCEN", "Document Entry", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCNUM", "Document Number", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "REFNO", "Document Reference", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCDATE", "Document Date", SAPbobsCOM.BoFieldTypes.db_Date)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "TAXDATE", "Tax Date", SAPbobsCOM.BoFieldTypes.db_Date)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCCURR", "Currency", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DPP", "DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "PPH", "PPH", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
    '    Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_1ON1_DT", "DOCTOT", "Document Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

    '    '----------------------------------------------------REGISTER UDO--------------------------------------------

    '    Dim ListColumnHeader(11) As String
    '    ListColumnHeader(0) = "U_CHKINVNO"
    '    ListColumnHeader(1) = "U_INVNOFR"
    '    ListColumnHeader(2) = "U_INVNOTO"
    '    ListColumnHeader(3) = "U_CHKINVDT"
    '    ListColumnHeader(4) = "U_INVDTFT"
    '    ListColumnHeader(5) = "U_INVDTTO"
    '    ListColumnHeader(6) = "U_CHKEXP"
    '    ListColumnHeader(7) = "U_TDPP"
    '    ListColumnHeader(8) = "U_TPPH"
    '    ListColumnHeader(9) = "U_DOCTOT"
    '    ListColumnHeader(10) = "Remark"
    '    ListColumnHeader(11) = "U_NOTES"

    '    Dim ListColumnHeaderDescription(11) As String
    '    ListColumnHeaderDescription(0) = "Check Invoice No"
    '    ListColumnHeaderDescription(1) = "Invoice From"
    '    ListColumnHeaderDescription(2) = "Invoice To"
    '    ListColumnHeaderDescription(3) = "Check Date"
    '    ListColumnHeaderDescription(4) = "Invoice Date From"
    '    ListColumnHeaderDescription(5) = "Invoice Date To"
    '    ListColumnHeaderDescription(6) = "Check Exported"
    '    ListColumnHeaderDescription(7) = "Total DPP"
    '    ListColumnHeaderDescription(8) = "Total PPH"
    '    ListColumnHeaderDescription(9) = "Total"
    '    ListColumnHeaderDescription(10) = "Remark"
    '    ListColumnHeaderDescription(11) = "Status Notes"


    '    Dim ListChildTable(0) As String
    '    ListChildTable(0) = "SOL_FP_TRX_1ON1_DT"

    '    Utils.CreateUDO(oSBOCompany, "FP1ON1", "FP1ON1", SAPbobsCOM.BoUDOObjType.boud_Document, "SOL_FP_TRX_1ON1_HD",
    '                        SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tYES,
    '                        SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
    '                        SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tNO,
    '                        SAPbobsCOM.BoYesNoEnum.tYES, ListColumnHeader, ListColumnHeaderDescription, ListChildTable)


    'End Sub

    Private Sub AddOffFakturGabungan()
        '--------------------------------ADD UDT---------------------------------------------
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_GB_HD", "Transaksi FP Gabungan - HD", SAPbobsCOM.BoUTBTableType.bott_Document)
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_GB_DT", "Transaksi FP Gabungan - DT", SAPbobsCOM.BoUTBTableType.bott_DocumentLines)
        '--------------------------------ADD UDF---------------------------------------------
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "BRANCH", "Branch", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "DOCDATE", "Doc Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "TAXDATE", "Tax Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "DOCSTAT", "Status Dokumen", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "TRANSCD", "Kode Transaksi", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "STATUSCD", "Status Transaksi", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "NORUN", "Nomor Running Fatur Pajak", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "NOFP", "Nomor Faktur Pajak", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "PPNSTAT", "PPN Status", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "KMK", "KMK", SAPbobsCOM.BoFieldTypes.db_Alpha, 100)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "CSTCD", "Customer Code", SAPbobsCOM.BoFieldTypes.db_Alpha, 100)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "CSTNM", "Customer Name", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "NNPWP", "Nama NPWP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "NPWP", "No NPWP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "KTP", "KTP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "KDDUKUNG", "Kode Dokumen Pendukung", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "BillTo", "BillTo", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)


        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "ADDRS", "Address", SAPbobsCOM.BoFieldTypes.db_Alpha, SAPbobsCOM.BoFldSubTypes.st_Address)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "EXPORT", "Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "NOTES", "Status Notes", SAPbobsCOM.BoFieldTypes.db_Memo)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "TDPP", "Total DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "TPPN", "Total PPN", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "DOCTOT", "Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "CHKINVNO", "Check Invoice No", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "INVNOFR", "Invoice From", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "INVNOTO", "Invoice To", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "CHKINVDT", "Check Invoice Date", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "INVDTFT", "Invoice Date From", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "INVDTTO", "Invoice Date To", SAPbobsCOM.BoFieldTypes.db_Date)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "CHKEXP", "Check Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "SELECT", "Selected", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCTYPE", "Document Type", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCEN", "Document Entry", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCNUM", "Document Number", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "REFNO", "Document Reference", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCDATE", "Document Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "TAXDATE", "Tax Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCCURR", "Currency", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DPP", "DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "PPN", "PPN", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_DT", "DOCTOT", "Document Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GB_HD", "ALAMAT", "ALAMAT", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        '----------------------------------------------------REGISTER UDO--------------------------------------------

        Dim ListColumnHeader(28) As String
        ListColumnHeader(0) = "U_BRANCH"
        ListColumnHeader(1) = "U_DOCDATE"
        ListColumnHeader(2) = "U_TAXDATE"
        ListColumnHeader(3) = "U_DOCSTAT"
        ListColumnHeader(4) = "U_TRANSCD"
        ListColumnHeader(5) = "U_STATUSCD"
        ListColumnHeader(6) = "U_NORUN"
        ListColumnHeader(7) = "U_NOFP"
        ListColumnHeader(8) = "U_PPNSTAT"
        ListColumnHeader(9) = "U_KMK"
        ListColumnHeader(10) = "U_CSTCD"
        ListColumnHeader(11) = "U_CSTNM"
        ListColumnHeader(12) = "U_NPWP"
        ListColumnHeader(13) = "U_KTP"
        ListColumnHeader(14) = "U_ADDRS"
        ListColumnHeader(15) = "U_EXPORT"
        ListColumnHeader(16) = "U_TDPP"
        ListColumnHeader(17) = "U_TPPN"
        ListColumnHeader(18) = "U_DOCTOT"
        ListColumnHeader(19) = "U_CHKINVNO"
        ListColumnHeader(20) = "U_INVNOFR"
        ListColumnHeader(21) = "U_INVNOTO"
        ListColumnHeader(22) = "U_CHKINVDT"
        ListColumnHeader(23) = "U_INVDTFT"
        ListColumnHeader(24) = "U_INVDTTO"
        ListColumnHeader(25) = "U_CHKEXP"
        ListColumnHeader(26) = "Remark"
        ListColumnHeader(27) = "U_NOTES"
        ListColumnHeader(28) = "U_ALAMAT"


        Dim ListColumnHeaderDescription(28) As String
        ListColumnHeaderDescription(0) = "Branch"
        ListColumnHeaderDescription(1) = "Doc Date"
        ListColumnHeaderDescription(2) = "Tax Date"
        ListColumnHeaderDescription(3) = "Status Dokumen"
        ListColumnHeaderDescription(4) = "Kode Transaksi"
        ListColumnHeaderDescription(5) = "Status Transaksi"
        ListColumnHeaderDescription(6) = "Nomor Running Fatur Pajak"
        ListColumnHeaderDescription(7) = "Nomor Faktur Pajak"
        ListColumnHeaderDescription(8) = "PPN Status"
        ListColumnHeaderDescription(9) = "KMK"
        ListColumnHeaderDescription(10) = "Customer Code"
        ListColumnHeaderDescription(11) = "Customer Name"
        ListColumnHeaderDescription(12) = "NPWP"
        ListColumnHeaderDescription(13) = "KTP"
        ListColumnHeaderDescription(14) = "Address"
        ListColumnHeaderDescription(15) = "Exported"
        ListColumnHeaderDescription(16) = "Total DPP"
        ListColumnHeaderDescription(17) = "Total PPN"
        ListColumnHeaderDescription(18) = "Total"
        ListColumnHeaderDescription(19) = "Check Invoice No"
        ListColumnHeaderDescription(20) = "Invoice From"
        ListColumnHeaderDescription(21) = "Invoice To"
        ListColumnHeaderDescription(22) = "Check Invoice Date"
        ListColumnHeaderDescription(23) = "Invoice Date From"
        ListColumnHeaderDescription(24) = "Invoice Date To"
        ListColumnHeaderDescription(25) = "Check Exported"
        ListColumnHeaderDescription(26) = "Remark"
        ListColumnHeaderDescription(27) = "Status Notes"
        ListColumnHeaderDescription(28) = "Alamat"

        Dim ListChildTable(0) As String
        ListChildTable(0) = "SOL_FP_TRX_GB_DT"

        Utils.CreateUDO(oSBOCompany, "FPGB", "FPGabungan", SAPbobsCOM.BoUDOObjType.boud_Document, "SOL_FP_TRX_GB_HD",
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, ListColumnHeader, ListColumnHeaderDescription, ListChildTable)

    End Sub

    Private Sub AddOffFakturGunggung()
        '--------------------------------ADD UDT---------------------------------------------
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_GG_HD", "Transaksi FP Gunggung - HD", SAPbobsCOM.BoUTBTableType.bott_Document)
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_GG_DT", "Transaksi FP Gunggung - DT", SAPbobsCOM.BoUTBTableType.bott_DocumentLines)
        '--------------------------------ADD UDF---------------------------------------------
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "DOCDATE", "Doc Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "DOCSTAT", "Status Dokumen", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "TDPP", "Total DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "TPPN", "Total PPN", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "DOCTOT", "Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CHKCST", "Check Customer", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CSTFR", "Customer From", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CSTTO", "Customer To", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CHKINVNO", "Check Invoice No", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "INVNOFR", "Invoice From", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "INVNOTO", "Invoice To", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CHKINVDT", "Check Invoice Date", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "INVDTFT", "Invoice Date From", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "INVDTTO", "Invoice Date To", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "MP_M", "Masa Pajak Bulan", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "MP_Y", "Masa Pajak Tahun", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "CHKEXP", "Check Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_HD", "NOTES", "Status Notes", SAPbobsCOM.BoFieldTypes.db_Memo)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "SELECT", "Selected", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCTYPE", "Document Type", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCEN", "Document Entry", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCNUM", "Document Number", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "REFNO", "Document Reference", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "CSTCD", "Customer Code", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "CSTNM", "Customer Name", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCDATE", "Document Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "TAXDATE", "Tax Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCCURR", "Currency", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DPP", "DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "PPN", "PPN", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_GG_DT", "DOCTOT", "Document Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

        '----------------------------------------------------REGISTER UDO--------------------------------------------

        Dim ListColumnHeader(18) As String
        ListColumnHeader(0) = "U_DOCDATE"
        ListColumnHeader(1) = "U_DOCSTAT"
        ListColumnHeader(2) = "U_CHKINVNO"
        ListColumnHeader(3) = "U_INVNOFR"
        ListColumnHeader(4) = "U_INVNOTO"
        ListColumnHeader(5) = "U_CHKINVDT"
        ListColumnHeader(6) = "U_INVDTFT"
        ListColumnHeader(7) = "U_INVDTTO"
        ListColumnHeader(8) = "U_CHKEXP"
        ListColumnHeader(9) = "U_TDPP"
        ListColumnHeader(10) = "U_TPPN"
        ListColumnHeader(11) = "U_DOCTOT"
        ListColumnHeader(12) = "Remark"
        ListColumnHeader(13) = "U_MP_M"
        ListColumnHeader(14) = "U_MP_Y"
        ListColumnHeader(15) = "U_CHKCST"
        ListColumnHeader(16) = "U_CSTFR"
        ListColumnHeader(17) = "U_CSTTO"
        ListColumnHeader(18) = "U_NOTES"

        Dim ListColumnHeaderDescription(18) As String
        ListColumnHeaderDescription(0) = "Tanggal Dokumen"
        ListColumnHeaderDescription(1) = "Status Dokumen"
        ListColumnHeaderDescription(2) = "Check Invoice No"
        ListColumnHeaderDescription(3) = "Invoice From"
        ListColumnHeaderDescription(4) = "Invoice To"
        ListColumnHeaderDescription(5) = "Check Date"
        ListColumnHeaderDescription(6) = "Invoice Date From"
        ListColumnHeaderDescription(7) = "Invoice Date To"
        ListColumnHeaderDescription(8) = "Check Exported"
        ListColumnHeaderDescription(9) = "Total DPP"
        ListColumnHeaderDescription(10) = "Total PPN"
        ListColumnHeaderDescription(11) = "Total"
        ListColumnHeaderDescription(12) = "Remark"
        ListColumnHeaderDescription(13) = "Masa Pajak Bulan"
        ListColumnHeaderDescription(14) = "Masa Pajak Tahun"
        ListColumnHeaderDescription(15) = "Check Customer"
        ListColumnHeaderDescription(16) = "Customer From"
        ListColumnHeaderDescription(17) = "Customer To"
        ListColumnHeaderDescription(18) = "Status Notes"

        Dim ListChildTable(0) As String
        ListChildTable(0) = "SOL_FP_TRX_GG_DT"

        Utils.CreateUDO(oSBOCompany, "FPGG", "FPGunggung", SAPbobsCOM.BoUDOObjType.boud_Document, "SOL_FP_TRX_GG_HD",
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, ListColumnHeader, ListColumnHeaderDescription, ListChildTable)

    End Sub

    Private Sub AddOffFakturMassal()
        '--------------------------------ADD UDT---------------------------------------------
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_MS_HD", "Transaksi FP Massal - HD", SAPbobsCOM.BoUTBTableType.bott_Document)
        Utils.CreateUDT(oSBOCompany, "SOL_FP_TRX_MS_DT", "Transaksi FP Massal - DT", SAPbobsCOM.BoUTBTableType.bott_DocumentLines)
        '--------------------------------ADD UDF---------------------------------------------
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "DOCDATE", "Doc Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "DOCSTAT", "Status Dokumen", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "HDBRANCH", "Header Branch", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CHKCST", "Check Customer", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CSTFR", "Customer From", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CSTTO", "Customer To", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CHKINVNO", "Check Invoice No", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "INVNOFR", "Invoice From", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "INVNOTO", "Invoice To", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CHKINVDT", "Check Invoice Date", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "INVDTFT", "Invoice Date From", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "INVDTTO", "Invoice Date To", SAPbobsCOM.BoFieldTypes.db_Date)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "CHKEXP", "Check Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "IIWP", "Inc With FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "NOTES", "Status Notes", SAPbobsCOM.BoFieldTypes.db_Memo)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "TipeFaktur", "Tipe Faktur", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_HD", "JenisFaktur", "Jenis Faktur", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)



        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "SELECT", "Selected", SAPbobsCOM.BoFieldTypes.db_Alpha, 1)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DTBRANCH", "Detail Branch", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "KDTRANS", "Kode Transaksi", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "KDSTATUS", "Kode Status", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "NORUN", "No Running FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "NOFP", "No FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "PPNSTAT", "PPN Status", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "KMK", "KMK", SAPbobsCOM.BoFieldTypes.db_Alpha, 100)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "CURFP", "Current FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "EXPORT", "Exported", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCTYPE", "Document Type", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCEN", "Document Entry", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCNUM", "Document Number", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "REFNO", "Document Reference", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "CSTCD", "Customer Code", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "CSTNM", "Customer Name", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCDATE", "Document Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "TAXDATE", "Tax Date", SAPbobsCOM.BoFieldTypes.db_Date)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCCURR", "Currency", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DPP", "DPP", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "PPN", "PPN", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "DOCTOT", "Document Total", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "KDDUKUNG", "Kode Dokumen Pendukung", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "NNPWP", "Nama NPWP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "NPWP", "No NPWP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "KTP", "KTP FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "ALAMAT", "ALAMAT FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "CAPFAS", "Cap Fasilitas", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "JNSIDPB", "Jenis ID Pembeli", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "NODOCPB", "No Dokumen Pembeli", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "@SOL_FP_TRX_MS_DT", "IDTKUPB", "Id TKU Pembeli", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)


        '----------------------------------------------------REGISTER UDO--------------------------------------------

        Dim ListColumnHeader(14) As String
        ListColumnHeader(0) = "U_DOCDATE"
        ListColumnHeader(1) = "U_DOCSTAT"
        ListColumnHeader(2) = "U_HDBRANCH"
        ListColumnHeader(3) = "U_CHKCST"
        ListColumnHeader(4) = "U_CSTFR"
        ListColumnHeader(5) = "U_CSTTO"
        ListColumnHeader(6) = "U_CHKINVNO"
        ListColumnHeader(7) = "U_INVNOFR"
        ListColumnHeader(8) = "U_INVNOTO"
        ListColumnHeader(9) = "U_CHKINVDT"
        ListColumnHeader(10) = "U_INVDTFT"
        ListColumnHeader(11) = "U_INVDTTO"
        ListColumnHeader(12) = "U_CHKEXP"
        ListColumnHeader(13) = "Remark"
        ListColumnHeader(14) = "U_NOTES"

        Dim ListColumnHeaderDescription(14) As String
        ListColumnHeaderDescription(0) = "Doc Date"
        ListColumnHeaderDescription(1) = "Status Dokumen"
        ListColumnHeaderDescription(2) = "Header Branch"
        ListColumnHeaderDescription(3) = "Check Customer"
        ListColumnHeaderDescription(4) = "Customer From"
        ListColumnHeaderDescription(5) = "Customer To"
        ListColumnHeaderDescription(6) = "Check Invoice No"
        ListColumnHeaderDescription(7) = "Invoice From"
        ListColumnHeaderDescription(8) = "Invoice To"
        ListColumnHeaderDescription(9) = "Check Invoice Date"
        ListColumnHeaderDescription(10) = "Invoice Date From"
        ListColumnHeaderDescription(11) = "Invoice Date To"
        ListColumnHeaderDescription(12) = "Check Exported"
        ListColumnHeaderDescription(13) = "Remark"
        ListColumnHeaderDescription(14) = "Status Notes"

        Dim ListChildTable(0) As String
        ListChildTable(0) = "SOL_FP_TRX_MS_DT"

        Utils.CreateUDO(oSBOCompany, "FPMS", "FPMassal", SAPbobsCOM.BoUDOObjType.boud_Document, "SOL_FP_TRX_MS_HD",
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tYES, SAPbobsCOM.BoYesNoEnum.tNO,
                            SAPbobsCOM.BoYesNoEnum.tYES, ListColumnHeader, ListColumnHeaderDescription, ListChildTable)

    End Sub

    Private Function GetStringdotsql(ByVal textFile As String, ByVal flag As String, ByVal DBType As String) As String

        Dim dir As String = ""
        Dim readText As String = ""
        Try
            dir = System.Reflection.Assembly.GetExecutingAssembly().Location
            dir = My.Computer.FileSystem.GetParentPath(dir) + "\" + textFile
            readText = File.ReadAllText(dir)
        Catch ex As Exception

        End Try
        Try
            dir = System.Reflection.Assembly.GetExecutingAssembly().Location
            If DBType = "HANA" Then
                If flag = "FMS" Then
                    dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\HANA\FMS\" + textFile
                    readText = File.ReadAllText(dir)
                Else
                    dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\HANA\EXEC\" + textFile
                    readText = dir
                End If
            Else
                If flag = "FMS" Then
                    dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\SQL\FMS\" + textFile
                    readText = File.ReadAllText(dir)
                Else
                    dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\SQL\EXEC\" + textFile
                    readText = dir
                End If
            End If

        Catch ex As Exception
            Dim a = ex
        End Try

        Return readText

    End Function
#End Region

#Region "Read XML DATA (SCAN AP)"
    Private Function ConvertXMLUrlToJSON(URL As String) As String

        Dim xmlString As String = DownloadXML(URL)
        Dim xmlDoc As New XmlDocument()
        xmlDoc.LoadXml(xmlString)

        Dim json As String = JsonConvert.SerializeXmlNode(xmlDoc)
        Return json
    End Function

    Private Function DownloadXML(url As String) As String
        'ignore SSL Certificate
        ServicePointManager.SecurityProtocol = SecurityProtocolType.Ssl3
        System.Net.ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls Or SecurityProtocolType.Tls11 Or SecurityProtocolType.Tls12

        Using client As New WebClient()
            Return client.DownloadString(url)
        End Using
    End Function

    Public Sub ItemEventHandler_AP_scan(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If (pVal.ItemUID = "U_SOL_FP_SCN_URL") Then
            If (pVal.ItemChanged = True) Then
                Try
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(FormUID)
                    Dim xmlUrl As String = oForm.Items.Item("U_SOL_FP_SCN_URL").Specific.value.ToString ' Replace with your XML URL

                    Dim oForm1 As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("141", oSBOApplication.Forms.ActiveForm.TypeCount)

                    If (xmlUrl.Length > 0) Then
                        Dim jsonRaw As String = ConvertXMLUrlToJSON(xmlUrl)
                        Dim jsonObject As JObject = JObject.Parse(jsonRaw)
                        Dim header As String = jsonObject("resValidateFakturPm").ToString()
                        Dim nomorFaktur As String = jsonObject("resValidateFakturPm")("nomorFaktur").ToString()
                        Dim tanggalFaktur As String = jsonObject("resValidateFakturPm")("tanggalFaktur").ToString()
                        Dim nomorNPWP As String = jsonObject("resValidateFakturPm")("npwpPenjual").ToString()
                        Dim namaNPWP As String = jsonObject("resValidateFakturPm")("namaPenjual").ToString()
                        Dim kodeTransFK As String = jsonObject("resValidateFakturPm")("kdJenisTransaksi").ToString()
                        Dim referensi As String = jsonObject("resValidateFakturPm")("referensi").ToString()
                        Dim statusCode As String = jsonObject("resValidateFakturPm")("fgPengganti").ToString()
                        Dim alamatFP As String = jsonObject("resValidateFakturPm")("alamatPenjual").ToString()

                        Dim docNum = oForm1.Items.Item("8").Specific
                        Dim docNumSAP = docNum.Value

                        'BUAT DUMMY 
                        docNumSAP = 240001254


                        'If (docNumSAP = referensi) Then

                        'Dim tanggal = tanggalFaktur.ToString("yyyMMdd")
                        Dim split = tanggalFaktur.Split("/")

                        Dim tanggal = split(2) + split(1) + split(0)

                        oForm.Items.Item("U_SOL_FP_RUNNING_NO").Specific.value = nomorFaktur
                        oForm.Items.Item("U_SOL_PPN_DATE").Specific.value = tanggal
                        'oForm.Items.Item("U_SOL_FP_TRX_CODE").sel = kodeTransFK

                        Dim cbx As SAPbouiCOM.ComboBox
                        Dim trx_code = oForm.Items.Item("U_SOL_FP_TRX_CODE")
                        cbx = trx_code.Specific
                        cbx.Select(kodeTransFK, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        Dim stat_code = oForm.Items.Item("U_SOL_FP_STATUS_CODE")
                        cbx = stat_code.Specific
                        cbx.Select(statusCode, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        oForm.Items.Item("U_SOL_FP_NPWP").Specific.value = nomorNPWP
                        'oForm.Items.Item("U_SOL_FP_NIK").Specific.value = nomorNPWP
                        oForm.Items.Item("U_SOL_NPWPNM").Specific.value = namaNPWP
                        oForm.Items.Item("U_SOL_FP_ALAMAT").Specific.value = alamatFP


                        'Dim exported_cd = oForm.Items.Item("U_SOL_EXPORTED")
                        'cbx = exported_cd.Specific
                        'cbx.Select("0", SAPbouiCOM.BoSearchKey.psk_ByValue)


                        'Else
                        '    oSBOApplication.MessageBox("Faktur Pajak tidak sesuai (Refrensi Link tidak sama dengan DocNum SAP)")
                        'End If

                    End If
                Catch ex As Exception
                    Dim a = ex
                    BubbleEvent = False
                End Try
            End If
        End If
    End Sub

    Public Sub ItemEventHandler_APCM_scan(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If (pVal.ItemUID = "U_SOL_FP_SCN_URL") Then
            If (pVal.ItemChanged = True) Then
                Try
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(FormUID)
                    Dim xmlUrl As String = oForm.Items.Item("U_SOL_FP_SCN_URL").Specific.value.ToString ' Replace with your XML URL

                    Dim oForm1 As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("181", oSBOApplication.Forms.ActiveForm.TypeCount)

                    If (xmlUrl.Length > 0) Then
                        Dim jsonRaw As String = ConvertXMLUrlToJSON(xmlUrl)
                        Dim jsonObject As JObject = JObject.Parse(jsonRaw)
                        Dim header As String = jsonObject("resValidateFakturPm").ToString()
                        Dim nomorFaktur As String = jsonObject("resValidateFakturPm")("nomorFaktur").ToString()
                        Dim tanggalFaktur As String = jsonObject("resValidateFakturPm")("tanggalFaktur").ToString()
                        Dim nomorNPWP As String = jsonObject("resValidateFakturPm")("npwpPenjual").ToString()
                        Dim namaNPWP As String = jsonObject("resValidateFakturPm")("namaPenjual").ToString()
                        Dim kodeTransFK As String = jsonObject("resValidateFakturPm")("kdJenisTransaksi").ToString()
                        Dim referensi As String = jsonObject("resValidateFakturPm")("referensi").ToString()
                        Dim statusCode As String = jsonObject("resValidateFakturPm")("fgPengganti").ToString()
                        Dim alamatFP As String = jsonObject("resValidateFakturPm")("alamatPenjual").ToString()

                        Dim docNum = oForm1.Items.Item("8").Specific
                        Dim docNumSAP = docNum.Value

                        'BUAT DUMMY 
                        docNumSAP = 240001254


                        'If (docNumSAP = referensi) Then

                        'Dim tanggal = Date.Parse(tanggalFaktur).ToString("yyyMMdd")

                        Dim split = tanggalFaktur.Split("/")

                        Dim tanggal = split(2) + split(1) + split(0)

                        oForm.Items.Item("U_SOL_FP_RUNNING_NO").Specific.value = nomorFaktur
                        oForm.Items.Item("U_SOL_PPN_DATE").Specific.value = tanggal
                        'oForm.Items.Item("U_SOL_FP_TRX_CODE").sel = kodeTransFK

                        Dim cbx As SAPbouiCOM.ComboBox
                        Dim trx_code = oForm.Items.Item("U_SOL_FP_TRX_CODE")
                        cbx = trx_code.Specific
                        cbx.Select(kodeTransFK, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        Dim stat_code = oForm.Items.Item("U_SOL_FP_STATUS_CODE")
                        cbx = stat_code.Specific
                        cbx.Select(statusCode, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        oForm.Items.Item("U_SOL_FP_NPWP").Specific.value = nomorNPWP
                        'oForm.Items.Item("U_SOL_FP_NIK").Specific.value = nomorNPWP
                        oForm.Items.Item("U_SOL_NPWPNM").Specific.value = namaNPWP
                        oForm.Items.Item("U_SOL_FP_ALAMAT").Specific.value = alamatFP


                        'Dim exported_cd = oForm.Items.Item("U_SOL_EXPORTED")
                        'cbx = exported_cd.Specific
                        'cbx.Select("0", SAPbouiCOM.BoSearchKey.psk_ByValue)


                        'Else
                        '    oSBOApplication.MessageBox("Faktur Pajak tidak sesuai (Refrensi Link tidak sama dengan DocNum SAP)")
                        'End If

                    End If
                Catch ex As Exception
                    Dim a = ex
                    BubbleEvent = False
                End Try
            End If
        End If
    End Sub

    Public Sub ItemEventHandler_APReserve_scan(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If (pVal.ItemUID = "U_SOL_FP_SCN_URL") Then
            If (pVal.ItemChanged = True) Then
                Try
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(FormUID)
                    Dim xmlUrl As String = oForm.Items.Item("U_SOL_FP_SCN_URL").Specific.value.ToString ' Replace with your XML URL

                    Dim oForm1 As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("60092", oSBOApplication.Forms.ActiveForm.TypeCount)

                    If (xmlUrl.Length > 0) Then
                        Dim jsonRaw As String = ConvertXMLUrlToJSON(xmlUrl)
                        Dim jsonObject As JObject = JObject.Parse(jsonRaw)
                        Dim header As String = jsonObject("resValidateFakturPm").ToString()
                        Dim nomorFaktur As String = jsonObject("resValidateFakturPm")("nomorFaktur").ToString()
                        Dim tanggalFaktur As String = jsonObject("resValidateFakturPm")("tanggalFaktur").ToString()
                        Dim nomorNPWP As String = jsonObject("resValidateFakturPm")("npwpPenjual").ToString()
                        Dim namaNPWP As String = jsonObject("resValidateFakturPm")("namaPenjual").ToString()
                        Dim kodeTransFK As String = jsonObject("resValidateFakturPm")("kdJenisTransaksi").ToString()
                        Dim referensi As String = jsonObject("resValidateFakturPm")("referensi").ToString()
                        Dim statusCode As String = jsonObject("resValidateFakturPm")("fgPengganti").ToString()
                        Dim alamatFP As String = jsonObject("resValidateFakturPm")("alamatPenjual").ToString()

                        Dim docNum = oForm1.Items.Item("8").Specific
                        Dim docNumSAP = docNum.Value

                        'BUAT DUMMY 
                        docNumSAP = 240001254


                        'If (docNumSAP = referensi) Then

                        'Dim tanggal = Date.Parse(tanggalFaktur).ToString("yyyMMdd")
                        Dim split = tanggalFaktur.Split("/")

                        Dim tanggal = split(2) + split(1) + split(0)

                        oForm.Items.Item("U_SOL_FP_RUNNING_NO").Specific.value = nomorFaktur
                        oForm.Items.Item("U_SOL_PPN_DATE").Specific.value = tanggal
                        'oForm.Items.Item("U_SOL_FP_TRX_CODE").sel = kodeTransFK

                        Dim cbx As SAPbouiCOM.ComboBox
                        Dim trx_code = oForm.Items.Item("U_SOL_FP_TRX_CODE")
                        cbx = trx_code.Specific
                        cbx.Select(kodeTransFK, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        Dim stat_code = oForm.Items.Item("U_SOL_FP_STATUS_CODE")
                        cbx = stat_code.Specific
                        cbx.Select(statusCode, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        oForm.Items.Item("U_SOL_FP_NPWP").Specific.value = nomorNPWP
                        'oForm.Items.Item("U_SOL_FP_NIK").Specific.value = nomorNPWP
                        oForm.Items.Item("U_SOL_NPWPNM").Specific.value = namaNPWP
                        oForm.Items.Item("U_SOL_FP_ALAMAT").Specific.value = alamatFP


                        'Dim exported_cd = oForm.Items.Item("U_SOL_EXPORTED")
                        'cbx = exported_cd.Specific
                        'cbx.Select("0", SAPbouiCOM.BoSearchKey.psk_ByValue)


                        'Else
                        '    oSBOApplication.MessageBox("Faktur Pajak tidak sesuai (Refrensi Link tidak sama dengan DocNum SAP)")
                        'End If

                    End If
                Catch ex As Exception
                    Dim a = ex
                    BubbleEvent = False
                End Try
            End If
        End If
    End Sub

    Public Sub ItemEventHandler_APDP_scan(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If (pVal.ItemUID = "U_SOL_FP_SCN_URL") Then
            If (pVal.ItemChanged = True) Then
                Try
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.Item(FormUID)
                    Dim xmlUrl As String = oForm.Items.Item("U_SOL_FP_SCN_URL").Specific.value.ToString ' Replace with your XML URL

                    Dim oForm1 As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("65301", oSBOApplication.Forms.ActiveForm.TypeCount)

                    If (xmlUrl.Length > 0) Then
                        Dim jsonRaw As String = ConvertXMLUrlToJSON(xmlUrl)
                        Dim jsonObject As JObject = JObject.Parse(jsonRaw)
                        Dim header As String = jsonObject("resValidateFakturPm").ToString()
                        Dim nomorFaktur As String = jsonObject("resValidateFakturPm")("nomorFaktur").ToString()
                        Dim tanggalFaktur As String = jsonObject("resValidateFakturPm")("tanggalFaktur").ToString()
                        Dim nomorNPWP As String = jsonObject("resValidateFakturPm")("npwpPenjual").ToString()
                        Dim namaNPWP As String = jsonObject("resValidateFakturPm")("namaPenjual").ToString()
                        Dim kodeTransFK As String = jsonObject("resValidateFakturPm")("kdJenisTransaksi").ToString()
                        Dim referensi As String = jsonObject("resValidateFakturPm")("referensi").ToString()
                        Dim statusCode As String = jsonObject("resValidateFakturPm")("fgPengganti").ToString()
                        Dim alamatFP As String = jsonObject("resValidateFakturPm")("alamatPenjual").ToString()

                        Dim docNum = oForm1.Items.Item("8").Specific
                        Dim docNumSAP = docNum.Value

                        'BUAT DUMMY 
                        docNumSAP = 240001254


                        'If (docNumSAP = referensi) Then

                        'Dim tanggal = Date.Parse(tanggalFaktur).ToString("yyyMMdd")
                        Dim split = tanggalFaktur.Split("/")

                        Dim tanggal = split(2) + split(1) + split(0)

                        oForm.Items.Item("U_SOL_FP_RUNNING_NO").Specific.value = nomorFaktur
                        oForm.Items.Item("U_SOL_PPN_DATE").Specific.value = tanggal
                        'oForm.Items.Item("U_SOL_FP_TRX_CODE").sel = kodeTransFK

                        Dim cbx As SAPbouiCOM.ComboBox
                        Dim trx_code = oForm.Items.Item("U_SOL_FP_TRX_CODE")
                        cbx = trx_code.Specific
                        cbx.Select(kodeTransFK, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        Dim stat_code = oForm.Items.Item("U_SOL_FP_STATUS_CODE")
                        cbx = stat_code.Specific
                        cbx.Select(statusCode, SAPbouiCOM.BoSearchKey.psk_ByValue)

                        oForm.Items.Item("U_SOL_FP_NPWP").Specific.value = nomorNPWP
                        'oForm.Items.Item("U_SOL_FP_NIK").Specific.value = nomorNPWP
                        oForm.Items.Item("U_SOL_NPWPNM").Specific.value = namaNPWP
                        oForm.Items.Item("U_SOL_FP_ALAMAT").Specific.value = alamatFP


                        'Dim exported_cd = oForm.Items.Item("U_SOL_EXPORTED")
                        'cbx = exported_cd.Specific
                        'cbx.Select("0", SAPbouiCOM.BoSearchKey.psk_ByValue)


                        'Else
                        '    oSBOApplication.MessageBox("Faktur Pajak tidak sesuai (Refrensi Link tidak sama dengan DocNum SAP)")
                        'End If

                    End If
                Catch ex As Exception
                    Dim a = ex
                    BubbleEvent = False
                End Try
            End If
        End If
    End Sub



    Public Sub MenuEvent_HandlerUDF(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        BubbleEvent = True
        If pVal.BeforeAction = True Then
            Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
            If oForm.TypeEx = "frmOffFKMASSAL" Or oForm.TypeEx = "frmOffFKGABUNGAN" Or oForm.TypeEx = "frmOffFKGUNGGUNG" Or oForm.TypeEx = "UDO_FT_SOL_FP_SETUP" Then
                BubbleEvent = False
            End If
        End If
    End Sub
#End Region

#Region "Global Variable"
    Public Class GlobalVar
        Public Shared ExportedFile As Boolean = False
    End Class
#End Region

#Region "setting faktur pajak (disabled udf & disable beberapa field saat update)"

    Public Sub DataEvent_Handler_SetupFaktur(ByRef BusinessObjectInfo As SAPbouiCOM.BusinessObjectInfo, ByRef BubbleEvent As Boolean)
        If BusinessObjectInfo.EventType <> SAPbouiCOM.BoEventTypes.et_FORM_DATA_ADD Then
            If BusinessObjectInfo.BeforeAction = False And BusinessObjectInfo.ActionSuccess = True Then

            End If
        End If
    End Sub


    Public Sub ItemEventHandler_SettingFP(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)

        Try
            BubbleEvent = True
            If pVal.BeforeAction = False Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("frmSetupFaktur", oSBOApplication.Forms.ActiveForm.TypeCount)

                If oForm.Mode = SAPbouiCOM.BoFormMode.fm_ADD_MODE And oForm.Items.Item("DocNum").Specific.value = "" Then
                    Dim oRec As SAPbobsCOM.Recordset
                    oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                    oRec.DoQuery("SELECT TOP 1 CAST(""Code"" AS INTEGER) as ""Code"" FROM ""@SOL_FP_SETUP"" ORDER BY CAST(""Code"" AS INTEGER) DESC ")

                    Dim check = oRec.Fields.Item("Code").Value.ToString()
                    If (check Is Nothing Or check = "") Then
                        check = 0
                    End If
                    Dim maximal As Decimal = Convert.ToDecimal(check)
                    Dim plus = maximal + 1
                    oForm.Items.Item("DocNum").Specific.value = plus
                End If

                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_LOST_FOCUS And pVal.ItemUID = "Item_25" Then
                    oForm.Items.Item("Item_55").Specific.value = oForm.Items.Item("Item_25").Specific.value
                End If

                If pVal.EventType = SAPbouiCOM.BoEventTypes.et_LOST_FOCUS And pVal.ItemUID = "Item_27" Then
                    oForm.Items.Item("Item_56").Specific.value = oForm.Items.Item("Item_27").Specific.value
                End If


            ElseIf pVal.ItemUID = "1" Then
                If pVal.ActionSuccess = False And pVal.BeforeAction = True Then
                    Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("frmSetupFaktur", oSBOApplication.Forms.ActiveForm.TypeCount)
                    oForm.Items.Item("Item_55").Specific.value = oForm.Items.Item("Item_25").Specific.value
                    oForm.Items.Item("Item_56").Specific.value = oForm.Items.Item("Item_27").Specific.value
                End If
            ElseIf pVal.ItemUID = "Item_25" Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("frmSetupFaktur", oSBOApplication.Forms.ActiveForm.TypeCount)
                oForm.Items.Item("Item_55").Specific.value = oForm.Items.Item("Item_25").Specific.value
            ElseIf pVal.ItemUID = "Item_27" Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.GetForm("frmSetupFaktur", oSBOApplication.Forms.ActiveForm.TypeCount)
                oForm.Items.Item("Item_56").Specific.value = oForm.Items.Item("Item_27").Specific.value

            End If




        Catch ex As Exception

        End Try
    End Sub


    Public Sub MenuEvent_Handler_SetupEfaktur(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        Dim oXMLDoc As New XmlDocument
        Dim oFormFKST As SAPbouiCOM.Form
        Dim oRec As SAPbobsCOM.Recordset
        Dim Query As String = ""
        Try
            Dim Found As Boolean = False
            Dim IndexFound As Integer
            Dim FormCount As Integer = oSBOApplication.Forms.Count
            For a As Integer = 0 To FormCount - 1
                If oSBOApplication.Forms.Item(a).TypeEx = "frmSetupFaktur" Then
                    Found = True
                    IndexFound = a
                    Exit For
                End If
            Next
            If Found = False Then
                oXMLDoc.Load("SetupEfaktur.srf")
                oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
            Else
                oSBOApplication.Forms.Item(IndexFound).Select()
            End If

            If Found = False Then

                oFormFKST = oSBOApplication.Forms.ActiveForm
                Dim TypeCode As String = "Faktur Pajak Setting"
                oFormFKST = oSBOApplication.Forms.Item("frmSetupFaktur")
                oFormFKST.Freeze(True)

                oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                oRec.DoQuery("SELECT TOP 1 CAST(""Code"" AS INTEGER) as ""Code"" FROM ""@SOL_FP_SETUP"" ORDER BY CAST(""Code"" AS INTEGER) DESC ")

                Dim check = oRec.Fields.Item("Code").Value.ToString()
                If (check Is Nothing Or check = "") Then
                    check = 0
                End If
                Dim maximal As Decimal = Convert.ToDecimal(check)
                Dim plus = maximal + 1


                Dim oCmbTipeFaktur As SAPbouiCOM.ComboBox = oFormFKST.Items.Item("Item_79").Specific
                oRec.DoQuery("SELECT  ""U_SOL_FP_Branch"" FROM ""@SOL_MST_BRCH_FP"" ORDER BY ""U_SOL_FP_Branch"" ")
                oRec.MoveFirst()
                For a As Integer = 0 To oRec.RecordCount() - 1
                    oCmbTipeFaktur.ValidValues.Add(oRec.Fields.Item("U_SOL_FP_Branch").Value.ToString(), oRec.Fields.Item("U_SOL_FP_Branch").Value.ToString())
                    oRec.MoveNext()
                Next
                oCmbTipeFaktur.Select(0, SAPbouiCOM.BoSearchKey.psk_Index)

                oFormFKST.Items.Item("DocNum").Specific.value = plus
                oFormFKST.Items.Item("Item_3").Click()
                oFormFKST.Items.Item("DocNum").Enabled = False
                oFormFKST.Items.Item("Item_58").Enabled = False
                oFormFKST.Items.Item("Item_62").Enabled = False
                oFormFKST.Items.Item("Item_60").Enabled = False
                oFormFKST.Items.Item("Item_64").Enabled = False
                oFormFKST.Items.Item("Item_66").Enabled = False
                oFormFKST.Items.Item("Item_68").Enabled = False
                oFormFKST.Items.Item("Item_70").Enabled = False
                oFormFKST.Items.Item("Item_72").Enabled = False
                oFormFKST.Items.Item("Item_74").Enabled = False
                oFormFKST.Items.Item("Item_76").Enabled = False
                oFormFKST.Items.Item("Item_78").Enabled = False

                oFormFKST.Freeze(False)
            End If

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
            Try
                oFormFKST.Freeze(False)
            Catch exa As Exception
            End Try
        End Try



    End Sub

#End Region

#Region "udf role & format"
    Private Sub roleAndFormat()

        Dim oUFields As SAPbobsCOM.UserFieldsMD
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True

        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OADM' AND ""AliasID"" = 'SOL_FP_INVNO'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_INVNO for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OADM"
            oUFields.Name = "SOL_FP_INVNO"
            oUFields.Description = "Base inv no"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 1

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "No"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "Yes"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "0"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        Else

            'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
            'oUFields.GetByKey("OADM", 1)

            'lRetCode = oUFields.Remove
            'If lRetCode <> 0 Then
            '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            'End If
            'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            'oUFields = Nothing
            'GC.Collect()
        End If


        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OUSR' AND ""AliasID"" = 'SOL_FP_ROLE'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_ROLE for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OUSR"
            oUFields.Name = "SOL_FP_ROLE"
            oUFields.Description = "Can Cancel"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 1

            oUFields.ValidValues.Value = "0"
            oUFields.ValidValues.Description = "No"
            oUFields.ValidValues.Add()

            oUFields.ValidValues.Value = "1"
            oUFields.ValidValues.Description = "Yes"
            oUFields.ValidValues.Add()

            oUFields.DefaultValue = "0"

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        Else

            'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
            'oUFields.GetByKey("OADM", 1)

            'lRetCode = oUFields.Remove
            'If lRetCode <> 0 Then
            '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            'End If
            'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            'oUFields = Nothing
            'GC.Collect()
        End If



        '--------------------------------------------------------------------------------------------------------------------------------------

        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRec.DoQuery("SELECT ""TableID"" FROM CUFD WHERE ""TableID"" = 'OINV' AND ""AliasID"" = 'SOL_FP_INVNO'")

        If oRec.RecordCount = 0 Then
            bIsContinue = True
        Else
            bIsContinue = False
        End If

        System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
        oRec = Nothing
        GC.Collect()

        If bIsContinue Then
            updateProgress("Creating UDF SOL_FP_INVNO for Setting")

            oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)

            oUFields.TableName = "OINV"
            oUFields.Name = "SOL_FP_INVNO"
            oUFields.Description = "Base inv no"
            oUFields.Type = SAPbobsCOM.BoFieldTypes.db_Alpha
            oUFields.SubType = SAPbobsCOM.BoFldSubTypes.st_None
            oUFields.EditSize = 254

            lRetCode = oUFields.Add()
            If lRetCode <> 0 Then
                oSBOCompany.GetLastError(lErrCode, sErrMsg)
                Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            End If
            System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            oUFields = Nothing
            GC.Collect()
        Else

            'oUFields = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserFields), SAPbobsCOM.UserFieldsMD)
            'oUFields.GetByKey("OADM", 1)

            'lRetCode = oUFields.Remove
            'If lRetCode <> 0 Then
            '    oSBOCompany.GetLastError(lErrCode, sErrMsg)
            '    Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
            'End If
            'System.Runtime.InteropServices.Marshal.ReleaseComObject(oUFields)
            'oUFields = Nothing
            'GC.Collect()
        End If


    End Sub

#End Region

#Region "UDF BP CRD1"
    Private Sub AddUDFBP()

        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_FP_ALAMAT", "Alamat FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 225)
        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_FP_NPWPNM", "Nama NPWP FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 225)
        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_FP_NPWP", "No NPWP FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 22)
        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_FP_KTP", "No KTP FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 22)
    End Sub

#End Region

#Region "Query to XML"
    Private Sub QueryToJSONKeluaran(queryString As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRecDetail As SAPbobsCOM.Recordset
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRecDetail = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)




        Dim ds As New DataSet
        Dim query = queryString
        oRec.DoQuery(query)
        oRecDetail.DoQuery(query)

        Dim List As New List(Of Dictionary(Of String, Object))()
        Dim loopCount As Integer = 1

        Do While Not oRec.EoF
            Dim row As New Dictionary(Of String, Object)()
            Dim Checker = False

            ' Iterate through each field (column) in the recordset
            For i As Integer = 0 To oRec.Fields.Count - 1
                row(oRec.Fields(i).Name) = oRec.Fields(i).Value

            Next

            If loopCount >= 4 Then
                If (row(1) = """FK""") Then
                    row.Add("ListOfGoodService", New List(Of Dictionary(Of Object, Object)))
                    List.Add(row)
                ElseIf (row(1) = """OF""") Then
                    Dim count As Integer = List.Count - 1
                    Dim detail As Dictionary(Of String, Object) = List(count)

                    If detail.ContainsKey("ListOfGoodService") Then
                        ' Retrieve the existing ListOfGoodService
                        Dim listOfGoodService As List(Of Dictionary(Of Object, Object)) = CType(detail("ListOfGoodService"), List(Of Dictionary(Of Object, Object)))

                        ' Create a new GoodService dictionary with the correct type
                        Dim goodService As New Dictionary(Of Object, Object)()
                        goodService("GoodService") = row

                        ' Add the GoodService dictionary to ListOfGoodService
                        listOfGoodService.Add(goodService)
                    End If



                End If
            Else
                row = Nothing
            End If


            ' Move to the next record
            oRec.MoveNext()
            loopCount = loopCount + 1
        Loop



        Dim Results As New Dictionary(Of Object, Object)()
        Results.Add("TIN", "xxxxxxxxxxxxxxxxxxxxxxx")
        Results.Add("ListOfTaxInvoice", List)
        Dim json = JsonConvert.SerializeObject(Results)

        Dim jsonObject As JObject = JObject.Parse(json)
        Dim ListOfTaxInvoiceArray As JArray = CType(jsonObject("ListOfTaxInvoice"), JArray)
        For i As Integer = ListOfTaxInvoiceArray.Count - 1 To 0 Step -1
            Dim item As JObject = CType(ListOfTaxInvoiceArray(i), JObject)

#Region "delete object"

            If item("1") IsNot Nothing Then
                item.Property("1").Remove()
            End If

            If item("4") IsNot Nothing Then
                item.Property("4").Remove()
            End If

            If item("5") IsNot Nothing Then
                item.Property("5").Remove()
            End If

            If item("6") IsNot Nothing Then
                item.Property("6").Remove()
            End If

            If item("9") IsNot Nothing Then
                item.Property("9").Remove()
            End If

            If item("10") IsNot Nothing Then
                item.Property("10").Remove()
            End If

            If item("11") IsNot Nothing Then
                item.Property("11").Remove()
            End If

            If item("12") IsNot Nothing Then
                item.Property("12").Remove()
            End If

            If item("13") IsNot Nothing Then
                item.Property("13").Remove()
            End If

            If item("15") IsNot Nothing Then
                item.Property("15").Remove()
            End If

            If item("16") IsNot Nothing Then
                item.Property("16").Remove()
            End If

            If item("17") IsNot Nothing Then
                item.Property("17").Remove()
            End If

            If item("18") IsNot Nothing Then
                item.Property("18").Remove()
            End If

            If item("20") IsNot Nothing Then
                item.Property("20").Remove()
            End If

#End Region

#Region "rename object"


            If item.Property("7") IsNot Nothing Then
                Dim zipValue As JToken = item("7")
                Dim newValue = zipValue.ToString()

                newValue = newValue.Replace("""", "")

                Dim parsedDate As DateTime = DateTime.ParseExact(newValue, "dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture)
                Dim formattedDate As String = parsedDate.ToString("yyyy-MM-dd")

                item.Add("TaxInvoiceDate", formattedDate)
                item.Property("7").Remove()
            End If

            If item.Property("3") IsNot Nothing Then
                Dim zipValue As JToken = item("3")
                Dim valuesx = zipValue.ToString()
                If (valuesx = """0""") Then
                    valuesx = "Normal"
                Else
                    valuesx = "Penggantian"
                End If
                item.Add("TaxInvoiceOpt", valuesx)
                item.Property("3").Remove()
            End If

            If item.Property("2") IsNot Nothing Then
                Dim zipValue As JToken = item("2")
                Dim newValue = zipValue.ToString()
                item.Add("TrxCode", newValue.Replace("""", ""))


                Dim trimValue_14 As JToken = item("14")
                Dim newtrimValue = trimValue_14.ToString()

                Dim trimValue = newValue.Replace("""", "")
                Dim trimValue_ = newtrimValue.Replace("""", "")
                If (trimValue = "07" Or trimValue = "08") Then


                    Dim oRecAddins As SAPbobsCOM.Recordset
                    oRecAddins = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                    Dim querystringAddins = "SELECT ""U_SOL_KODE_REF"" FROM ""@SOL_ADDINFO_REF"" WHERE ""Code"" = '" + trimValue_ + "' AND ""U_SOL_TRX_CODE"" = '" + trimValue + "' "
                    oRecAddins.DoQuery(querystringAddins)

                    Dim oRecFacilityStamp As SAPbobsCOM.Recordset
                    oRecFacilityStamp = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                    Dim querystringoRecFacilityStamp = "SELECT ""U_SOL_KODE_REF"" FROM ""@SOL_FACILITY_REF"" WHERE RIGHT( ""U_SOL_KODE_REF"",2) = (SELECT RIGHT(""U_SOL_KODE_REF"",2) FROM ""@SOL_ADDINFO_REF"" WHERE ""Code"" = '" + trimValue_ + "' AND ""U_SOL_TRX_CODE"" = '" + trimValue + "') "
                    oRecFacilityStamp.DoQuery(querystringoRecFacilityStamp)

                    item.Add("AddInfo", oRecAddins.Fields.Item("U_SOL_KODE_REF").Value.ToString())
                    item.Add("FacilityStamp", oRecFacilityStamp.Fields.Item("U_SOL_KODE_REF").Value.ToString())
                Else

                    item.Add("AddInfo", Nothing)
                    item.Add("FacilityStamp", Nothing)
                End If

                item.Property("2").Remove()
            End If

            If item.Property("19") IsNot Nothing Then
                Dim zipValue As JToken = item("19")
                Dim newValue = zipValue.ToString()

                newValue = newValue.ToString.Replace("""", "")

                Dim type = "AR"
                If (newValue.ToString().Split("-")(2) = "14") Then
                    type = "ARCM"
                ElseIf (newValue.ToString().Split("-")(2) = "19") Then
                    type = "APCM"
                ElseIf (newValue.ToString().Split("-")(2) = "203") Then
                    type = "ARDP"
                ElseIf (newValue.ToString().Split("-")(2) = "13a") Then
                    type = "ARR"
                End If

                Dim RefDesc = type + "#" + newValue.ToString().Split("-")(0) + "#" + newValue.ToString().Split("-")(1)



                item.Add("RefDesc", RefDesc)
                'item.Property("19").Remove()
            End If


            If item.Property("8") IsNot Nothing Then
                Dim zipValue As JToken = item("8")
                Dim newValue = zipValue.ToString()

                Dim oRecNPWPSELLER As SAPbobsCOM.Recordset
                oRecNPWPSELLER = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                Dim querystringAddins = "SELECT ""TaxIdNum"", ""TaxIdNum2"" FROM ""OADM"" "
                oRecNPWPSELLER.DoQuery(querystringAddins)

                Dim SellerIdTku = oRecNPWPSELLER.Fields.Item("TaxIdNum").Value + "" + oRecNPWPSELLER.Fields.Item("TaxIdNum2").Value

                item.Add("SellerIDTKU", SellerIdTku.ToString())
                item.Property("8").Remove()


                If jsonObject.Property("TIN") IsNot Nothing Then
                    jsonObject("TIN") = oRecNPWPSELLER.Fields.Item("TaxIdNum").Value.ToString()
                End If

            End If


            If item.Property("14") IsNot Nothing Then
                Dim zipValue As JToken = item("14")
                Dim newValue = zipValue.ToString()
                'item.Add("CustomDoc", newValue.Replace("""", ""))

                'Dim trimValue = newValue.Replace("""", "")
                'Dim oRecAddins As SAPbobsCOM.Recordset
                'oRecAddins = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                'Dim querystringAddins = "SELECT ""U_SOL_KODE_REF"" FROM ""@SOL_ADDINFO_REF"" WHERE ""U_SOL_TRX_CODE"" = '" + trimValue + "' "
                'oRecAddins.DoQuery(query)

                'item.Add("AddInfo", oRec.Fields.Item("U_SOL_KODE_REF").ToString())

                item.Add("CustomDoc", Nothing)
                item.Property("14").Remove()
                'Else
                '    item.Add("CustomDoc", Nothing)
            End If



            Dim DocEntryRawR As JToken = item("19")
            Dim DocEntryRaw = DocEntryRawR.ToString.Replace("""", "")
            If (DocEntryRaw.ToString().Split("|").Count > 1) Then
                DocEntryRaw = DocEntryRaw.ToString().Split("|")(0)
            End If
            Dim DocEntry = DocEntryRaw.ToString().Split("-")(1)
            Dim DocType = DocEntryRaw.ToString().Split("-")(2)

            Dim oRecTaxIdNum As SAPbobsCOM.Recordset
            oRecTaxIdNum = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

            Dim QueryTaxIDNum
            If (DocType = "203") Then
                QueryTaxIDNum = "
                select T0.""Country"",T0.""U_SOL_FP_KTP"",T0.""U_SOL_FP_NPWP"",T0.""U_SOL_FP_NPWPNM"",T0.""U_SOL_FP_ALAMAT"" ,T0.""U_SOL_EMAIL"" AS ""E_Mail"",  T0.""U_SOL_NO_PASPORT"", T0.""U_SOL_NO_OTHER"" from CRD1 T0
                INNER JOIN 
                OCRD T1 
                ON T0.""CardCode"" = T1.""CardCode""
                WHERE T1.""CardCode"" = (SELECT ""CardCode"" FROM ODPI WHERE ""DocEntry"" = '" + DocEntry + "')
                AND T0.""Address"" = (select ""PayToCode"" FROM ODPI WHERE ""DocEntry"" = '" + DocEntry + "')
            "
            Else
                QueryTaxIDNum = "
                select T0.""Country"",T0.""U_SOL_FP_KTP"",T0.""U_SOL_FP_NPWP"",T0.""U_SOL_FP_NPWPNM"",T0.""U_SOL_FP_ALAMAT"" ,T0.""U_SOL_EMAIL"" AS ""E_Mail"",  T0.""U_SOL_NO_PASPORT"", T0.""U_SOL_NO_OTHER"" from CRD1 T0
                INNER JOIN 
                OCRD T1 
                ON T0.""CardCode"" = T1.""CardCode""
                WHERE T1.""CardCode"" = (SELECT ""CardCode"" FROM OINV WHERE ""DocEntry"" = '" + DocEntry + "')
                AND T0.""Address"" = (select ""PayToCode"" FROM OINV WHERE ""DocEntry"" = '" + DocEntry + "')
            "
            End If


            oRecTaxIdNum.DoQuery(QueryTaxIDNum)

            Dim BuyerName = oRecTaxIdNum.Fields.Item("U_SOL_FP_NPWPNM").Value.ToString()
            Dim BuyerNPWP = oRecTaxIdNum.Fields.Item("U_SOL_FP_NPWP").Value.ToString()
            Dim BuyerNIK = oRecTaxIdNum.Fields.Item("U_SOL_FP_KTP").Value.ToString()
            Dim BuyerPasport = oRecTaxIdNum.Fields.Item("U_SOL_NO_PASPORT").Value.ToString()
            Dim BuyerOther = oRecTaxIdNum.Fields.Item("U_SOL_NO_OTHER").Value.ToString()
            Dim BuyerAddr = oRecTaxIdNum.Fields.Item("U_SOL_FP_ALAMAT").Value.ToString()
            Dim BuyerEmail = oRecTaxIdNum.Fields.Item("E_Mail").Value.ToString()
            Dim BuyerCountry = oRecTaxIdNum.Fields.Item("Country").Value.ToString()

            Dim oRecCountryCode As SAPbobsCOM.Recordset
            oRecCountryCode = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            Dim QueryCountryCode = "SELECT ""U_SOL_KODE_DJP"" FROM ""OCRY"" WHERE ""Code"" = '" + BuyerCountry + "' "
            oRecCountryCode.DoQuery(QueryCountryCode)

            Dim BuyerCountryCode = oRecCountryCode.Fields.Item("U_SOL_KODE_DJP").Value.ToString()

            If (BuyerNPWP <> "") Then
                item.Add("BuyerTin", BuyerNPWP.Substring(0, 16))
                item.Add("BuyerDocument", "TIN")
                item.Add("BuyerDocumentNumber", "-")
            ElseIf (BuyerNIK <> "") Then
                item.Add("BuyerTin", "0000000000000000")
                item.Add("BuyerDocument", "National ID")
                item.Add("BuyerDocumentNumber", BuyerNIK)
                BuyerNPWP = "000000"
            ElseIf (BuyerPasport <> "") Then
                item.Add("BuyerTin", "0000000000000000")
                item.Add("BuyerDocument", "Other ID")
                item.Add("BuyerDocumentNumber", BuyerPasport)
                BuyerNPWP = "000000"
            ElseIf (BuyerOther <> "") Then
                item.Add("BuyerTin", "0000000000000000")
                item.Add("BuyerDocument", "Other ID")
                item.Add("BuyerDocumentNumber", BuyerOther)
                BuyerNPWP = "000000"
            End If

            item.Add("BuyerName", BuyerName)
            item.Add("BuyerAdress", BuyerAddr)
            item.Add("BuyerEmail", BuyerEmail)
            item.Add("BuyerIDTKU", BuyerNPWP)
            item.Add("BuyerCountry", BuyerCountryCode)

#End Region


        Next


        For Each taxInvoice As JObject In jsonObject("ListOfTaxInvoice")

            For Each goodServiceObj As JObject In taxInvoice("ListOfGoodService")

                Dim goodService As JObject = CType(goodServiceObj("GoodService"), JObject)


#Region "delete object"
                If goodService.Property("1") IsNot Nothing Then
                    goodService.Property("1").Remove()
                End If

                If goodService.Property("6") IsNot Nothing Then
                    goodService.Property("6").Remove()
                End If

                'If goodService.Property("8") IsNot Nothing Then
                '    goodService.Property("8").Remove()
                'End If

                If goodService.Property("10") IsNot Nothing Then
                    goodService.Property("10").Remove()
                End If

                If goodService.Property("11") IsNot Nothing Then
                    goodService.Property("11").Remove()
                End If

                If goodService.Property("12") IsNot Nothing Then
                    goodService.Property("12").Remove()
                End If

                If goodService.Property("13") IsNot Nothing Then
                    goodService.Property("13").Remove()
                End If

                If goodService.Property("14") IsNot Nothing Then
                    goodService.Property("14").Remove()
                End If

                If goodService.Property("15") IsNot Nothing Then
                    goodService.Property("15").Remove()
                End If

                If goodService.Property("16") IsNot Nothing Then
                    goodService.Property("16").Remove()
                End If

                If goodService.Property("17") IsNot Nothing Then
                    goodService.Property("17").Remove()
                End If

                If goodService.Property("18") IsNot Nothing Then
                    goodService.Property("18").Remove()
                End If

                If goodService.Property("19") IsNot Nothing Then
                    goodService.Property("19").Remove()
                End If

                If goodService.Property("20") IsNot Nothing Then
                    goodService.Property("20").Remove()
                End If
#End Region

#Region "Rename Object"

                If goodService.Property("2") IsNot Nothing Then
                    'Dim zipValue As JToken = goodService("2")
                    'Dim newValue = zipValue.ToString()
                    'goodService.Add("Code", newValue.Replace("""", ""))
                    'goodService.Property("2").Remove()
                End If

                If goodService.Property("3") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("3")
                    Dim newValue = zipValue.ToString()
                    goodService.Add("Name", newValue.Replace("""", ""))
                    'goodService.Property("3").Remove()
                End If

                If goodService.Property("4") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("4")
                    Dim newValue = zipValue.ToString()
                    goodService.Add("Price", newValue.Replace("""", ""))
                    'goodService.Property("4").Remove()
                End If

                If goodService.Property("5") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("5")
                    Dim newValue = zipValue.ToString()
                    goodService.Add("Qty", newValue.Replace("""", ""))
                    'goodService.Property("5").Remove()
                End If

                If goodService.Property("7") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("7")
                    Dim newValue = zipValue.ToString()
                    goodService.Add("TotalDiscount", newValue.Replace("""", ""))
                    'goodService.Property("7").Remove()
                End If

                Dim dpp = 0
                If goodService.Property("8") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("8")
                    Dim newValue = zipValue.ToString()
                    newValue = newValue.Replace("""", "")
                    dpp = newValue
                    goodService.Property("8").Remove()
                End If


                If goodService.Property("9") IsNot Nothing Then
                    Dim zipValue As JToken = goodService("4")
                    Dim price = zipValue.ToString().Replace("""", "")

                    Dim zipValue2 As JToken = goodService("5")
                    Dim qty = zipValue2.ToString().Replace("""", "")

                    Dim zipValue3 As JToken = goodService("7")
                    Dim discount = zipValue3.ToString().Replace("""", "")

                    Dim taxBase = (Decimal.Parse(price) * Decimal.Parse(qty)) - Decimal.Parse(discount)

                    Dim DocEntryRawR_ As JToken = taxInvoice("19")
                    Dim DocEntryRaw_ = DocEntryRawR_.ToString.Replace("""", "")
                    If (DocEntryRaw_.ToString().Split("|").Count > 1) Then
                        DocEntryRaw_ = DocEntryRaw_.ToString().Split("|")(0)
                    End If
                    Dim DocEntry_ = DocEntryRaw_.ToString().Split("-")(1)
                    Dim DocType_ = DocEntryRaw_.ToString().Split("-")(2)

                    Dim oRecDetail1_ As SAPbobsCOM.Recordset
                    oRecDetail1_ = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                    Dim QueryDetail1_ = ""

                    Dim ItemCodeValue_ As JToken = goodService("3")
                    Dim ItemCode_ = ItemCodeValue_.ToString().Replace("""", "")

                    If (DocType_ = "13") Then
                        QueryDetail1_ = "SELECT ""VatPrcnt"", ""VatSum"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry_ & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                    ElseIf (DocType_ = "203") Then

                        QueryDetail1_ = "SELECT ""VatPrcnt"", ""VatSum"" FROM DPI1 WHERE ""DocEntry"" = '" & DocEntry_ & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                    End If
                    oRecDetail1_.DoQuery(QueryDetail1_)


                    Dim oRecDetail2_ As SAPbobsCOM.Recordset
                    oRecDetail2_ = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                    Dim QueryDetail2_ = "SELECT ""U_SOL_PPNPEMBAGI"" FROM OITM WHERE ""ItemName"" = '" & ItemCode_ & "' "
                    oRecDetail2_.DoQuery(QueryDetail2_)


                    Dim PPNPembagi = oRecDetail2_.Fields.Item("U_SOL_PPNPEMBAGI").Value.ToString()

                    If (PPNPembagi = 0) Then

                        If (DocType_ = "13") Then
                            QueryDetail2_ = "SELECT ""U_SOL_PPNPEMBAGI"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry_ & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                        ElseIf (DocType_ = "203") Then

                            QueryDetail2_ = "SELECT ""U_SOL_PPNPEMBAGI"" FROM DPI1 WHERE  ""DocEntry"" = '" & DocEntry_ & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                        End If


                        oRecDetail2_.DoQuery(QueryDetail2_)
                        PPNPembagi = oRecDetail2_.Fields.Item("U_SOL_PPNPEMBAGI").Value.ToString
                    End If

                    Dim ppn = oRecDetail1_.Fields.Item("VatPrcnt").Value.ToString()


                    Dim otherTaxBase = Decimal.Parse(dpp) * ((Decimal.Parse(ppn) / Decimal.Parse(PPNPembagi)))
                    Dim taxbase2 = Decimal.Parse(dpp)


                    goodService.Add("TaxBase", Math.Round(taxbase2, 2))
                    goodService.Add("OtherTaxBase", Math.Round(otherTaxBase, 0)) 'SEMENTARA NILAI OTHER TAX DISAMAKAN DENGAN TAXBASE

                    goodService.Property("4").Remove()
                    goodService.Property("5").Remove()
                    goodService.Property("7").Remove()
                    'goodService.Property("9").Remove()
                End If


                Dim DocEntryRawR As JToken = taxInvoice("19")
                Dim DocEntryRaw = DocEntryRawR.ToString.Replace("""", "")
                If (DocEntryRaw.ToString().Split("|").Count > 1) Then
                    DocEntryRaw = DocEntryRaw.ToString().Split("|")(0)
                End If
                Dim DocEntry = DocEntryRaw.ToString().Split("-")(1)
                Dim DocType = DocEntryRaw.ToString().Split("-")(2)

                Dim oRecDetail1 As SAPbobsCOM.Recordset
                oRecDetail1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                Dim QueryDetail1 = ""

                Dim ItemCodeValue As JToken = goodService("2")
                Dim ItemCode = ItemCodeValue.ToString().Replace("""", "")
                ItemCode = ItemCode.Split("-")(0).ToString()

                If (DocType = "13" And ItemCode <> "") Then
                    QueryDetail1 = "SELECT ""VatPrcnt"", ""VatSum"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""ItemCode"" = '" & ItemCode & "' "
                ElseIf (DocType = "203") Then

                    QueryDetail1 = "SELECT ""VatPrcnt"", ""VatSum"" FROM DPI1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""ItemCode"" = '" & ItemCode & "' "
                End If

                Dim ItemCodeValues_ As JToken = goodService("3")
                Dim ItemCodes_ = ItemCodeValues_.ToString().Replace("""", "")

                If (DocType = "13" And ItemCode = "") Then
                    QueryDetail1 = "SELECT ""VatPrcnt"", ""VatSum"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""Dscription"" = '" & ItemCodes_ & "' "
                ElseIf (DocType = "203") Then

                    QueryDetail1 = "SELECT ""VatPrcnt"", ""VatSum"" FROM DPI1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""Dscription"" = '" & ItemCodes_ & "' "
                End If

                oRecDetail1.DoQuery(QueryDetail1)


                Dim VatRate = oRecDetail1.Fields.Item("VatPrcnt").Value.ToString()
                Dim Vat = oRecDetail1.Fields.Item("VatSum").Value.ToString()

                Dim oRecIsService As SAPbobsCOM.Recordset
                oRecIsService = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
                Dim QueryIsService = ""
                If (DocType = "13") Then
                    QueryIsService = "SELECT ""DocType"" FROM OINV WHERE ""DocEntry"" = '" & DocEntry & "' "
                ElseIf (DocType = "203") Then

                    QueryIsService = "SELECT ""DocType"" FROM ODPI WHERE ""DocEntry"" = '" & DocEntry & "'  "
                End If

                oRecIsService.DoQuery(QueryIsService)
                Dim IsService = oRecIsService.Fields.Item("DocType").Value.ToString()
                Dim Opt = "A"
                If (IsService = "S") Then
                    Opt = "B"
                End If


                Dim oRecDetailItem As SAPbobsCOM.Recordset
                oRecDetailItem = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                Dim QueryDetailItem = ""
                QueryDetailItem = "SELECT U_SOL_KODE_BJ FROM OITM WHERE ""ItemCode""  = '" & ItemCode & "' "
                oRecDetailItem.DoQuery(QueryDetailItem)

                Dim CodeItem = oRecDetailItem.Fields.Item("U_SOL_KODE_BJ").Value.ToString()

                Dim oRecUomItem As SAPbobsCOM.Recordset
                oRecUomItem = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                Dim QueryUomItem = ""
                If (DocType = "13") Then
                    QueryUomItem = "SELECT ""UomCode"" FROM INV1 WHERE ""DocEntry""  = '" & DocEntry & "' AND ""ItemCode"" = '" & ItemCode & "' "
                Else
                    QueryUomItem = "SELECT ""UomCode"" FROM DPI1 WHERE ""DocEntry""  = '" & DocEntry & "' AND ""ItemCode"" = '" & ItemCode & "' "
                End If
                oRecUomItem.DoQuery(QueryUomItem)

                Dim uomItem = oRecUomItem.Fields.Item("UomCode").Value.ToString()


                Dim oRecUnitItem As SAPbobsCOM.Recordset
                oRecUnitItem = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                Dim QueryUnitItem = ""
                QueryUnitItem = " SELECT ""U_SOL_KODE_DJP"" FROM OUOM WHERE ""UomCode"" = '" & uomItem & "' "
                oRecUnitItem.DoQuery(QueryUnitItem)

                Dim ItemCodeRaw_ As JToken = goodService("2")
                Dim ItemCodex_ = ItemCodeRaw_.ToString().Replace("""", "")

                ItemCodex_ = ItemCodex_.Split("-")(1).ToString()


                Dim unit = oRecUnitItem.Fields.Item("U_SOL_KODE_DJP").Value.ToString()
                If (ItemCodex_ <> "") Then
                    unit = ItemCodex_
                End If




                If CodeItem = "" Then

                    Dim ItemCodeValue_ As JToken = goodService("3")
                    Dim ItemCode_ = ItemCodeValue_.ToString().Replace("""", "")

                    If (DocType = "13") Then
                        QueryDetailItem = "SELECT ""U_SOL_KODE_BJ_D"", ""U_SOL_CODE_DESC_D"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                    Else
                        QueryDetailItem = "SELECT ""U_SOL_KODE_BJ_D"", ""U_SOL_CODE_DESC_D"" FROM INV1 WHERE ""DocEntry"" = '" & DocEntry & "' AND ""Dscription"" = '" & ItemCode_ & "' "
                    End If

                    oRecDetailItem.DoQuery(QueryDetailItem)
                    CodeItem = oRecDetailItem.Fields.Item("U_SOL_KODE_BJ_D").Value.ToString()
                    unit = oRecDetailItem.Fields.Item("U_SOL_CODE_DESC_D").Value.ToString()
                End If


                Dim oRecDetailPpnPembagi_ As SAPbobsCOM.Recordset
                oRecDetailPpnPembagi_ = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                Dim ItemCodeValuePpnPembagi_ As JToken = goodService("3")
                Dim ItemCodePpnPembagi_ = ItemCodeValuePpnPembagi_.ToString().Replace("""", "")

                Dim QueryDetailPpnPembagi_ = "SELECT ""U_SOL_PPNPEMBAGI"" FROM OITM WHERE ""ItemName"" = '" & ItemCodePpnPembagi_ & "' "
                oRecDetailPpnPembagi_.DoQuery(QueryDetailPpnPembagi_)


                Dim PPNPembagi_ = oRecDetailPpnPembagi_.Fields.Item("U_SOL_PPNPEMBAGI").Value.ToString()


                Dim VATRAW As JToken = goodService("9")
                Dim Vat_ = VATRAW.ToString().Replace("""", "")
                Vat_ = Math.Floor(Decimal.Parse(Vat_))

                goodService.Add("Opt", Opt)
                goodService.Add("Code", CodeItem)
                goodService.Add("Unit", unit)
                goodService.Add("VATRate", PPNPembagi_)
                goodService.Add("VAT", Vat_)


                goodService.Add("STLGRate", Decimal.Parse(0))
                goodService.Add("STLG", Decimal.Parse(0))

                goodService.Property("2").Remove()
                goodService.Property("3").Remove()
                goodService.Property("9").Remove()


#End Region


            Next
            taxInvoice.Property("19").Remove()
        Next

#Region "reorder Header"

        ' Parse the JSON array
        Dim jsonArray As JArray = JArray.Parse(jsonObject("ListOfTaxInvoice").ToString())

        ' Define the target key order
        Dim keyOrder As List(Of String) = New List(Of String) From {"TaxInvoiceDate", "TaxInvoiceOpt", "TrxCode", "AddInfo", "CustomDoc", "RefDesc",
            "FacilityStamp", "SellerIDTKU", "BuyerTin", "BuyerDocument", "BuyerCountry", "BuyerDocumentNumber", "BuyerName", "BuyerAdress", "BuyerEmail",
            "BuyerIDTKU", "ListOfGoodService"
           }

        ' Process each object in the array
        Dim reorderedArray As New JArray()

        For Each item As JObject In jsonArray
            Dim reorderedObject As New JObject()

            ' Add keys to the new object in the desired order
            For Each key In keyOrder
                If item.ContainsKey(key) Then
                    reorderedObject(key) = item(key)
                End If
            Next

            ' Add the reordered object to the array
            reorderedArray.Add(reorderedObject)
        Next

        ' Convert the reordered array to a JSON string
        Dim reorderedJson = reorderedArray
        '.ToString(Newtonsoft.Json.Formatting.Indented)

        jsonObject("ListOfTaxInvoice") = reorderedJson

#End Region

#Region "reorder Detail"

        Dim desiredOrder As String() = {"Opt", "Code", "Name", "Unit", "Price", "Qty", "TotalDiscount", "TaxBase",
                                        "OtherTaxBase", "OtherTaxBase", "VATRate", "VAT", "STLGRate", "STLG"
                                    }

        ' Reorder GoodService objects
        For Each invoice As JObject In jsonObject("ListOfTaxInvoice")
            Dim goodServices As JArray = CType(invoice("ListOfGoodService"), JArray)
            For Each goodServiceWrapper As JObject In goodServices
                Dim goodService As JObject = CType(goodServiceWrapper("GoodService"), JObject)

                ' Create reordered GoodService using LINQ
                Dim reorderedGoodService As JObject = New JObject(
                    goodService.Properties().
                    Where(Function(p) desiredOrder.Contains(p.Name)).
                    OrderBy(Function(p) Array.IndexOf(desiredOrder, p.Name))
                )

                ' Replace the old GoodService object
                goodServiceWrapper("GoodService") = reorderedGoodService
            Next
        Next
#End Region

#Region "delete Validate object"

        ' Parse JSON
        Dim jsonObject2 As JObject = jsonObject

        ' Filter out invoices with empty ListOfGoodService
        Dim validInvoices As JArray = New JArray(
            jsonObject2("ListOfTaxInvoice").
            Where(Function(invoice)
                      Dim goodsList = invoice("ListOfGoodService")
                      Return goodsList IsNot Nothing AndAlso goodsList.HasValues
                  End Function)
        )

        ' Replace ListOfTaxInvoice with the filtered version
        jsonObject("ListOfTaxInvoice") = validInvoices


        If jsonObject("ListOfTaxInvoice") IsNot Nothing Then
            jsonObject("TaxInvoice") = jsonObject("ListOfTaxInvoice")
            jsonObject.Remove("ListOfTaxInvoice")


            Dim newListOfTaxInvoice As New JArray()

            ' Add the entire TaxInvoice array as an object inside ListOfTaxInvoice
            Dim taxInvoiceArray As JArray = jsonObject("TaxInvoice")
            Dim taxInvoiceObject As New JObject()
            taxInvoiceObject("TaxInvoice") = taxInvoiceArray

            ' Add the TaxInvoice object to ListOfTaxInvoice
            newListOfTaxInvoice.Add(taxInvoiceObject)

            ' Replace the original TaxInvoice with ListOfTaxInvoice
            jsonObject("ListOfTaxInvoice") = newListOfTaxInvoice

            ' Remove TaxInvoice key if not needed
            jsonObject.Remove("TaxInvoice")

        End If


#End Region

        Dim updatedJSON = jsonObject.ToString()

        Dim cekCompanyDetail As SAPbobsCOM.Recordset
        cekCompanyDetail = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Dim queryCompanyDetail = "select ""U_SOL_XLSX"" FROM OADM "

        'cekCompanyDetail.DoQuery(queryCompanyDetail)


        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
        Dim IsXlsx = oForm.Items.Item("Item_11").Specific.Value.ToString()
        If (IsXlsx = "XLSX") Then
            'If (cekCompanyDetail.Fields.Item("U_SOL_XLSX").Value.ToString() = 1) Then

#Region "use xlsx"


            Dim templatePath As String = Application.StartupPath + "/Templates/template-faktur-keluaran.json"
            Dim jsonText As String
            Dim jsonTemplate As JObject

            Dim JsonObj As JObject = Nothing
            Dim str As String = " { ""root"": " + updatedJSON + " } "
            JsonObj = JObject.Parse(str)

            Try
                jsonText = IO.File.ReadAllText(templatePath)
                jsonTemplate = JObject.Parse(jsonText)
                Dim jsonSheetList As JArray = jsonTemplate.Item("sheet")

                Dim fileName As String
                fileName = "PajakKeluaran_" +
              Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
              "_" +
              Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")


                Dim thread As Thread = New Thread(Sub()

                                                      Dim fileSaver = New System.Windows.Forms.SaveFileDialog
                                                      With fileSaver
                                                          .Filter = "Excel Files|*.xlsx;*.xls;*.xlsm"
                                                          .FilterIndex = 2
                                                          .InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.Personal)
                                                          .Title = "Save File"
                                                          .RestoreDirectory = True
                                                          .FileName = fileName
                                                      End With

                                                      If fileSaver.ShowDialog() = Windows.Forms.DialogResult.OK Then
                                                          Dim fullPath As String = fileSaver.FileName
                                                          Dim directoryPath As String = System.IO.Path.GetDirectoryName(fullPath)

                                                          JsonToExcel(fullPath, jsonTemplate, JsonObj)

                                                          MessageBox.Show("Excel file created at: " & fullPath)
                                                      End If


                                                  End Sub)
                thread.SetApartmentState(ApartmentState.STA)


                Try
                    thread.Start()
                    While (Not thread.IsAlive) ' Wait for thread to get started
                    End While
                    Thread.Sleep(1)           ' Wait a sec more
                    thread.Join()

                    'Update document A/R Invoice dan A/R DP Invoice
                    'updateAR(DocEntAR, DocEntARDP)
                Catch ex As Exception
                    oSBOApplication.MessageBox(ex.Message)
                End Try

            Catch ex As Exception
                MessageBox.Show(ex.Message, "Error")
            End Try
#End Region

        Else

#Region "use xml"


            Dim str = JsonConvert.DeserializeXmlNode("{""TaxInvoiceBulk"":" + updatedJSON + "}")

            Dim root As XmlElement = str.DocumentElement
            root.SetAttribute("xmlns:xsd", "http://www.w3.org/2001/XMLSchema")
            root.SetAttribute("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance")

            Dim xmlString = str.OuterXml

            Dim a = "test"



            Dim fileName As String
            fileName = "PajakKeluaran_" +
                Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                "_" +
                Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

            Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, xmlString))
            thread.SetApartmentState(ApartmentState.STA)

            Try
                thread.Start()
                While (Not thread.IsAlive) ' Wait for thread to get started
                End While
                Thread.Sleep(1)           ' Wait a sec more
                thread.Join()

                'Update document A/R Invoice dan A/R DP Invoice
                'updateAR(DocEntAR, DocEntARDP)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try
#End Region

        End If


    End Sub

    Private Sub QueryToJSONReturKeluaran(queryString As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRecDetail As SAPbobsCOM.Recordset
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRecDetail = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)




        Dim ds As New DataSet
        Dim query = queryString
        oRec.DoQuery(query)
        oRecDetail.DoQuery(query)

        Dim List As New List(Of Dictionary(Of String, Object))()
        Dim loopCount As Integer = 1

        Do While Not oRec.EoF
            Dim row As New Dictionary(Of String, Object)()
            Dim Checker = False

            ' Iterate through each field (column) in the recordset
            For i As Integer = 0 To oRec.Fields.Count - 1
                row(oRec.Fields(i).Name) = oRec.Fields(i).Value

            Next

            If loopCount >= 2 Then
                If (row(1) = """RK""") Then
                    'row.Add("OutputReturnDataList", New List(Of Dictionary(Of Object, Object)))
                    List.Add(row)
                End If
            Else
                row = Nothing
            End If


            ' Move to the next record
            oRec.MoveNext()
            loopCount = loopCount + 1
        Loop



        Dim Results_raw As New Dictionary(Of Object, Object)()
        'Results.Add("TIN", "xxxxxxxxxxxxxxxxxxxxxxx")
        Results_raw.Add("OutputReturnData", List)
        'Dim json = JsonConvert.SerializeObject(Results)

        Dim Results As New Dictionary(Of Object, Object)()
        Results.Add("TIN", "xxxxxxxxxxxxxxxxxxxxxxx")
        'Results.Add("OutputReturnDataList", Results_raw)
        Results.Add("OutputReturnDataList", New List(Of Dictionary(Of Object, Object))())
        Dim outputList As List(Of Dictionary(Of Object, Object)) = CType(Results("OutputReturnDataList"), List(Of Dictionary(Of Object, Object)))
        outputList.Add(Results_raw)

        Dim json = JsonConvert.SerializeObject(Results)

        Dim jsonObject As JObject = JObject.Parse(json)

        For Each taxInvoice As JObject In jsonObject("OutputReturnDataList")
            For Each taxInvoice2 As JObject In jsonObject("OutputReturnDataList")

#Region "Rename"

                If taxInvoice2.Property("8") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("8")
                    Dim newValue = zipValue.ToString()
                    taxInvoice2.Add("ReturnDocumentNumber", newValue.Replace("""", ""))


                    Dim oRecDetail1 As SAPbobsCOM.Recordset
                    oRecDetail1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

                    Dim QueryDetail1 = ""

                    QueryDetail1 = "SELECT ""U_SOL_FP_INVNO"" FROM ORIN WHERE ""DocNum""  = '" & newValue & "' "
                    oRecDetail1.DoQuery(QueryDetail1)

                    Dim BaseDocNum = oRecDetail1.Fields.Item("U_SOL_FP_INVNO").Value.ToString()

                    taxInvoice2.Add("DocumentNumber", BaseDocNum)
                    taxInvoice2.Property("8").Remove()
                End If

                If taxInvoice2.Property("4") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("4")
                    Dim newValue = zipValue.ToString()
                    taxInvoice2.Add("TransactionType", newValue.Replace("""", ""))
                    taxInvoice2.Property("4").Remove()
                End If

                If taxInvoice2.Property("5") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("5")
                    Dim newValue = zipValue.ToString()

                    Dim replacement = newValue.Replace("""", "")

                    If (replacement = "0") Then
                        replacement = "1"
                    Else
                        replacement = "2"
                    End If

                    taxInvoice2.Add("DocumentType", replacement)
                    taxInvoice2.Property("5").Remove()
                End If

                If taxInvoice2.Property("9") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("9")
                    Dim newValue = zipValue.ToString()
                    taxInvoice2.Add("DocumentDate", newValue.Replace("""", ""))
                    taxInvoice2.Property("9").Remove()
                End If

                If taxInvoice2.Property("9") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("9")
                    Dim newValue = zipValue.ToString()
                    taxInvoice2.Add("DocumentDate", newValue.Replace("""", ""))
                    taxInvoice2.Property("9").Remove()
                End If

                If taxInvoice2.Property("2") IsNot Nothing Then
                    Dim zipValue As JToken = taxInvoice2("2")
                    Dim newValue = zipValue.ToString()
                    taxInvoice2.Add("BuyerTin", newValue.Replace("""", ""))
                    taxInvoice2.Property("2").Remove()
                End If


#End Region

            Next

        Next


        Dim updatedJSON = jsonObject.ToString()

        'Dim str = JsonConvert.DeserializeXmlNode(json, "root")
        'Dim str = JsonConvert.DeserializeXmlNode("{""TaxInvoiceBulk"":  " + json + "}", "ListOfTaxInvoice")
        Dim str = JsonConvert.DeserializeXmlNode("{""TaxInvoiceBulk"":" + updatedJSON + "}")
        Dim xmlString = str.OuterXml
        Dim a = "test"



        Dim fileName As String
        fileName = "ReturPajakKeluaran_" +
                Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                "_" +
                Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

        Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, xmlString))
        thread.SetApartmentState(ApartmentState.STA)

        Try
            thread.Start()
            While (Not thread.IsAlive) ' Wait for thread to get started
            End While
            Thread.Sleep(1)           ' Wait a sec more
            thread.Join()

            'Update document A/R Invoice dan A/R DP Invoice
            'updateAR(DocEntAR, DocEntARDP)
        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try


    End Sub

    Private Sub QueryToJSONReturMasukan(queryString As String)
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRecDetail As SAPbobsCOM.Recordset
        oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        oRecDetail = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)




        Dim ds As New DataSet
        Dim query = queryString
        oRec.DoQuery(query)
        oRecDetail.DoQuery(query)

        Dim Lists As New List(Of Dictionary(Of String, Object))()
        Dim loopCount As Integer = 1

        Do While Not oRec.EoF
            Dim row As New Dictionary(Of String, Object)()
            Dim Checker = False

            ' Iterate through each field (column) in the recordset
            For i As Integer = 0 To oRec.Fields.Count - 1
                row(oRec.Fields(i).Name) = oRec.Fields(i).Value

            Next

            If loopCount >= 2 Then
                If (row(1) = """RM""") Then
                    'row.Add("TransactionDetailsData", New List(Of Dictionary(Of Object, Object)))
                    Lists.Add(row)

                End If
            Else
                row = Nothing
            End If


            ' Move to the next record
            oRec.MoveNext()
            loopCount = loopCount + 1
        Loop

        Dim Results As New Dictionary(Of String, Object)()
        Results.Add("TIN", "xxxxxxxxxxxxxxxxxxxxxxx")


        ' Initialize InputReturnDataList as a List(Of Dictionary(Of String, Object))
        Results.Add("InputReturnDataList", New List(Of Dictionary(Of String, Object))())

        ' Cast InputReturnDataList to the correct type
        Dim InputReturnDataList = CType(Results("InputReturnDataList"), List(Of Dictionary(Of String, Object)))

        ' Create a new dictionary for InputReturn
        Dim InputReturn As New Dictionary(Of String, Object)()

        ' Create a list for InputReturnData
        Dim InputReturnData As New List(Of Dictionary(Of String, Object))()

        ' Loop to add multiple TransactionDocumentData items
        For i As Integer = 0 To Lists.Count - 1 ' Adjust the loop count as needed
            ' Create a new dictionary for TransactionDocumentData
            Dim TransactionDocumentData As New Dictionary(Of String, Object)()
            Dim row As New Dictionary(Of String, Object)()
            Dim TransactionDocumentDataDetail As New Dictionary(Of String, Object)()


            ' Add documents to the TransactionDocumentData list (can be customized per loop iteration)
            TransactionDocumentData.Add("TransactionDocumentData", Lists(i))

            Dim ListDetail As New List(Of Dictionary(Of String, String))()

            Dim oRecD As SAPbobsCOM.Recordset
            oRecD = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

            Dim docnum = Lists(i)(9).ToString().Replace("""", "")

            Dim querystringDetail As String = "

                SELECT 
	                RPC1.""BaseType"", RPC1.""BaseEntry"",
	                ORPC.""DocType"", OITM.""U_SOL_NAMA_BJ"" as ""U_SOL_NAMA_BJ_D"" , OITM.""U_SOL_KODE_BJ"" as ""U_SOL_KODE_BJ_D"", RPC1.""Quantity"",
	                RPC1.""U_SOL_UOM_DESC_D"" , RPC1.""U_SOL_DEF_UOM_D"", ""U_SOL_FLAG_DPP"" ,RPC1.""Price"",RPC1.""DiscPrcnt"", RPC1.""LineTotal"", RPC1.""VatSum""
	
                FROM ORPC 
                INNER JOIN RPC1 ON ORPC.""DocEntry"" = RPC1.""DocEntry"" 
                INNER JOIN OITM ON OITM.""ItemCode"" = RPC1.""ItemCode""
                WHERE ""DocNum"" ='" + docnum + "'
"

            oRecD.DoQuery(querystringDetail)

            If (oRecD.Fields.Item("U_SOL_NAMA_BJ_D").Value.ToString = "") Then
                querystringDetail = "

                SELECT 
	                RPC1.""BaseType"", RPC1.""BaseEntry"",
	                ORPC.""DocType"", RPC1.""U_SOL_NAMA_BJ_D"", RPC1.""U_SOL_KODE_BJ_D"", RPC1.""Quantity"",
	                RPC1.""U_SOL_CODE_DESC_D"",RPC1.""Price"",RPC1.""DiscPrcnt"", RPC1.""LineTotal"", RPC1.""VatSum"",
                    RPC1.""U_SOL_UOM_DESC_D"" , RPC1.""U_SOL_DEF_UOM_D"", ""U_SOL_FLAG_DPP"" 
	
                FROM ORPC 
                INNER JOIN RPC1 ON ORPC.""DocEntry"" = RPC1.""DocEntry""
                WHERE ""DocNum"" ='" + docnum + "'
"

                oRecD.DoQuery(querystringDetail)

            End If

            Dim linenum = 0
            For ix As Integer = 0 To oRecD.RecordCount - 1

                Dim oRecDTrans As SAPbobsCOM.Recordset
                oRecDTrans = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)


                Dim baseType = oRecD.Fields.Item("BaseType").Value.ToString()
                Dim DocEntry = oRecD.Fields.Item("BaseEntry").Value.ToString()

                Dim tableName = "RPC1"

                If (baseType = "21") Then 'GOODS RETURN
                    tableName = "RPD1"

                ElseIf (baseType = "234000032") Then 'GOODS RETURN REQUEST
                    tableName = "PRR1"

                ElseIf (baseType = "204") Then ' AP DP
                    tableName = "DPO1"
                ElseIf (baseType = "18") Then
                    tableName = "PCH1"
                End If


                Dim querystringDetailTrans As String = "SELECT  T0.""Quantity"" ""RPC1"".""Quantity"" , RPC1.""U_SOL_UOM_DESC_D"" , ""U_SOL_DEF_UOM_D"", ""U_SOL_FLAG_DPP"" ,""Price"",""DiscPrcnt"", ""LineTotal"", ""VatSum""  FROM " + tableName + " T0 WHERE ""DocEntry"" = '" + DocEntry + "' and ""LineNum"" = '" + linenum.ToString() + "'"

                If baseType = "-1" Then
                    querystringDetailTrans = "SELECT  ""RPC1"".""Quantity"" , RPC1.""U_SOL_UOM_DESC_D"" , RPC1.""U_SOL_DEF_UOM_D"", ""U_SOL_FLAG_DPP"" ,RPC1.""Price"",RPC1.""DiscPrcnt"", RPC1.""LineTotal"", RPC1.""VatSum""  FROM RPC1 INNER JOIN ORPC ON ""ORPC"".""DocEntry"" = ""RPC1"".""DocEntry"" WHERE ""DocNum"" = '" + docnum + "' AND RPC1.""LineNum"" = '" + linenum.ToString() + "' "
                End If


                oRecDTrans.DoQuery(querystringDetailTrans)

                Dim detail As New Dictionary(Of String, String)()

                Dim Type = "A"
                If (oRecD.Fields.Item("DocType").Value.ToString() <> "I") Then
                    Type = "B"
                End If

                Dim units = oRecDTrans.Fields.Item("U_SOL_UOM_DESC_D").Value.ToString()
                If (units = "") Then
                    units = oRecDTrans.Fields.Item("U_SOL_DEF_UOM_D").Value.ToString()
                End If

                Dim qty____ = oRecDTrans.Fields.Item("Quantity").Value.ToString()

                detail.Add("Type", Type)
                detail.Add("Name", oRecD.Fields.Item("U_SOL_NAMA_BJ_D").Value.ToString())
                detail.Add("Code", oRecD.Fields.Item("U_SOL_KODE_BJ_D").Value.ToString())
                detail.Add("Quantity", oRecDTrans.Fields.Item("Quantity").Value.ToString())
                detail.Add("Unit", units)
                detail.Add("UnitPrice", oRecDTrans.Fields.Item("Price").Value.ToString())
                detail.Add("STLGRate", Decimal.Parse(0))
                detail.Add("ReturnQuantity", oRecDTrans.Fields.Item("Quantity").Value.ToString())
                detail.Add("ReturnDiscount", oRecDTrans.Fields.Item("DiscPrcnt").Value.ToString())
                detail.Add("ReturnTaxBase", oRecDTrans.Fields.Item("LineTotal").Value.ToString())
                detail.Add("ReturnOtherTaxBase", oRecDTrans.Fields.Item("LineTotal").Value.ToString())
                detail.Add("ReturnOtherTaxBaseCheck", oRecDTrans.Fields.Item("U_SOL_FLAG_DPP").Value.ToString())
                detail.Add("ReturnVAT", oRecDTrans.Fields.Item("VatSum").Value.ToString())
                detail.Add("ReturnSTLG", Decimal.Parse(0))

                ListDetail.Add(detail)
                linenum = linenum + 1
            Next


            row.Add("Rows", ListDetail)
            ' Add the created TransactionDocumentData to InputReturnData list
            TransactionDocumentData.Add("TransactionDetailsData", row)
            InputReturnData.Add(TransactionDocumentData)

        Next

        ' Add InputReturnData to InputReturn
        InputReturn.Add("InputReturnData", InputReturnData)

        InputReturnDataList.Add(InputReturn)


        Dim json As String = JsonConvert.SerializeObject(Results)
        Dim a = "asdads"



        Dim jsonObject As JObject = JObject.Parse(json)

        ' Loop through InputReturnDataList
        For Each returnData As JObject In jsonObject("InputReturnDataList")
            ' Loop through each item in InputReturnData
            For Each items As JObject In returnData("InputReturnData")
                ' Access the TransactionDocumentData
                Dim item As JObject = items("TransactionDocumentData")

#Region "delete object"

                If item("1") IsNot Nothing Then
                    item.Property("1").Remove()
                End If


                If item("3") IsNot Nothing Then
                    item.Property("3").Remove()
                End If

                'If item("4") IsNot Nothing Then
                '    item.Property("4").Remove()
                'End If

                If item("5") IsNot Nothing Then
                    item.Property("5").Remove()
                End If

                If item("8") IsNot Nothing Then
                    item.Property("8").Remove()
                End If

                If item("9") IsNot Nothing Then
                    item.Property("9").Remove()
                End If

                If item("10") IsNot Nothing Then
                    item.Property("10").Remove()
                End If

                If item("11") IsNot Nothing Then
                    item.Property("11").Remove()
                End If

                If item("12") IsNot Nothing Then
                    item.Property("12").Remove()
                End If

                If item("15") IsNot Nothing Then
                    item.Property("15").Remove()
                End If


#End Region

#Region "rename object"

                If item.Property("6") IsNot Nothing Then
                    Dim zipValue As JToken = item("6")
                    Dim newValue = zipValue.ToString()

                    newValue = newValue.Replace("""", "")


                    Dim zipValue2 As JToken = item("4")
                    Dim newValue2 = zipValue2.ToString()

                    newValue2 = newValue2.Replace("""", "")

                    Dim newValue3 = newValue2 + "0" + newValue


                    item.Add("InvoiceNumber", newValue3)
                    item.Property("6").Remove()
                    item.Property("4").Remove()
                End If

                If item.Property("2") IsNot Nothing Then
                    Dim zipValue As JToken = item("2")
                    Dim newValue = zipValue.ToString()

                    newValue = newValue.Replace("""", "").Substring(0, 16)

                    item.Add("SellerTIN", newValue)
                    item.Property("2").Remove()
                End If


                If item.Property("7") IsNot Nothing Then
                    Dim zipValue As JToken = item("7")
                    Dim newValue = zipValue.ToString()

                    newValue = newValue.Replace("""", "")

                    Dim parsedDate As DateTime = DateTime.ParseExact(newValue, "dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture)
                    Dim formattedDate As String = parsedDate.ToString("yyyy-MM-dd")

                    item.Add("TaxInvoiceDate", formattedDate)
                    item.Property("7").Remove()
                End If

                If item.Property("13") IsNot Nothing Then
                    Dim zipValue As JToken = item("13")
                    Dim newValue = zipValue.ToString()

                    newValue = newValue.Replace("""", "")

                    item.Add("ReturnTaxBase", newValue)
                    item.Add("ReturnOtherTaxBase", Nothing)

                    item.Property("13").Remove()
                End If

                'If item.Property("13") IsNot Nothing Then
                '    Dim zipValue As JToken = item("13")
                '    Dim newValue = zipValue.ToString()

                '    newValue = newValue.Replace("""", "")

                '    item.Add("ReturnOtherTaxBase", Nothing)
                '    item.Property("13").Remove()
                'End If

                If item.Property("14") IsNot Nothing Then
                    Dim zipValue As JToken = item("14")
                    Dim newValue = zipValue.ToString()

                    newValue = newValue.Replace("""", "")

                    item.Add("ReturnVAT", newValue)
                    item.Property("14").Remove()
                End If


                'If item.Property("14") IsNot Nothing Then
                '    Dim zipValue As JToken = item("14")
                '    Dim newValue = zipValue.ToString()

                '    newValue = newValue.Replace("""", "")

                '    item.Add("ReturnSTLG", newValue)
                '    item.Property("14").Remove()
                'End If

                item.Add("ReturnSTLG", Decimal.Parse(0))

#End Region

            Next

        Next




        Dim updatedJSON = jsonObject.ToString()


        Dim data As JObject = JObject.Parse(updatedJSON)



        For Each inputReturnDataX As JObject In data("InputReturnDataList")
            ' Access the InputReturnData array
            Dim inputReturnDataArray As JArray = inputReturnDataX("InputReturnData")

            ' Iterate through the InputReturnData array
            For Each returnData As JObject In inputReturnDataArray
                ' Access TransactionDetailsData
                Dim transactionDetailsData As JObject = returnData("TransactionDetailsData")
                Dim TransactionDocumentData As JObject = returnData("TransactionDocumentData")
                If transactionDetailsData IsNot Nothing Then

                    ' Add FooterRow object
                    transactionDetailsData("FooterRow") = New JObject() From {
                        {"ReturnTaxBaseTotal", TransactionDocumentData("ReturnTaxBase")},
                        {"ReturnOtherTaxBase", TransactionDocumentData("ReturnOtherTaxBase")},
                        {"ReturnVATTotal", TransactionDocumentData("ReturnVAT")},
                        {"ReturnSTLGTotal", TransactionDocumentData("ReturnSTLG")}
                    }
                End If
            Next
        Next


        Dim oRecNPWPSELLER As SAPbobsCOM.Recordset
        oRecNPWPSELLER = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
        Dim querystringAddins = "SELECT ""TaxIdNum"", ""TaxIdNum2"" FROM ""OADM"" "
        oRecNPWPSELLER.DoQuery(querystringAddins)

        If data.Property("TIN") IsNot Nothing Then
            data("TIN") = oRecNPWPSELLER.Fields.Item("TaxIdNum").Value.ToString()
        End If


        Dim updatedata = data.ToString()


        Dim jsonObjx As JObject = JObject.Parse(updatedata)

        ' Iterate through InputReturnDataList
        For Each inputReturnDataxx As JObject In jsonObjx("InputReturnDataList")(0)("InputReturnData")
            ' Access TransactionDocumentData and its properties
            Dim transactionData As JObject = CType(inputReturnDataxx("TransactionDocumentData"), JObject)

            ' Update ReturnOtherTaxBase with the value of ReturnTaxBase
            transactionData("ReturnOtherTaxBase") = transactionData("ReturnTaxBase")
        Next

        ' Serialize the modified JObject back to JSON string
        Dim updatedJsonX As String = JsonConvert.SerializeObject(jsonObjx, Newtonsoft.Json.Formatting.Indented)


        updatedata = updatedJsonX



        Dim cekCompanyDetail As SAPbobsCOM.Recordset
        cekCompanyDetail = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)

        'Dim queryCompanyDetail = "select ""U_SOL_XLSX"" FROM OADM "

        'cekCompanyDetail.DoQuery(queryCompanyDetail)

        'If (cekCompanyDetail.Fields.Item("U_SOL_XLSX").Value.ToString() = 1) Then

        Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
        Dim IsXlsx = oForm.Items.Item("Item_11").Specific.Value.ToString()
        If (IsXlsx = "XLSX") Then

#Region "use xlsx"

            Dim templatePath As String = Application.StartupPath + "/Templates/template-retur-faktur-keluaran.json"
            Dim jsonText As String
            Dim jsonTemplate As JObject

            Dim JsonObj As JObject = Nothing
            Dim str As String = " { ""root"": " + updatedata + " } "
            JsonObj = JObject.Parse(str)


            Try
                jsonText = IO.File.ReadAllText(templatePath)
                jsonTemplate = JObject.Parse(jsonText)
                Dim jsonSheetList As JArray = jsonTemplate.Item("sheet")

                Dim fileName As String
                fileName = "PajakReturMasukan_" +
                    Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                    "_" +
                    Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

                Dim thread As Thread = New Thread(Sub()

                                                      Dim fileSaver = New System.Windows.Forms.SaveFileDialog
                                                      With fileSaver
                                                          .Filter = "Excel Files|*.xlsx;*.xls;*.xlsm"
                                                          .FilterIndex = 2
                                                          .InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.Personal)
                                                          .Title = "Save File"
                                                          .RestoreDirectory = True
                                                          .FileName = fileName
                                                      End With

                                                      If fileSaver.ShowDialog() = Windows.Forms.DialogResult.OK Then
                                                          Dim fullPath As String = fileSaver.FileName
                                                          Dim directoryPath As String = System.IO.Path.GetDirectoryName(fullPath)

                                                          JsonToExcel(fullPath, jsonTemplate, JsonObj)

                                                          MessageBox.Show("Excel file created at: " & fullPath)
                                                      End If


                                                  End Sub)
                thread.SetApartmentState(ApartmentState.STA)


                Try
                    thread.Start()
                    While (Not thread.IsAlive) ' Wait for thread to get started
                    End While
                    Thread.Sleep(1)           ' Wait a sec more
                    thread.Join()

                    'Update document A/R Invoice dan A/R DP Invoice
                    'updateAR(DocEntAR, DocEntARDP)
                Catch ex As Exception
                    oSBOApplication.MessageBox(ex.Message)
                End Try

            Catch ex As Exception
                MessageBox.Show(ex.Message, "Error")
            End Try
#End Region

        Else

#Region "use xml"
            Dim str = JsonConvert.DeserializeXmlNode("{""InputTaxInvoiceReturn"":" + updatedata + "}")

            Dim root As XmlElement = str.DocumentElement
            root.SetAttribute("xmlns:xsd", "http://www.w3.org/2001/XMLSchema")
            root.SetAttribute("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance")

            Dim xmlString = str.OuterXml

            Dim axx = "test"


            Dim fileName As String
            fileName = "PajakReturMasukan_" +
                    Date.Now.Year.ToString + Date.Now.Month.ToString("#00") + Date.Now.Day.ToString("#00") +
                    "_" +
                    Date.Now.Hour.ToString("#00") + Date.Now.Minute.ToString("#00") + Date.Now.Second.ToString("#00")

            Dim thread As Thread = New Thread(Sub() Me.SaveToFile(fileName, xmlString))
            thread.SetApartmentState(ApartmentState.STA)

            Try
                thread.Start()
                While (Not thread.IsAlive) ' Wait for thread to get started
                End While
                Thread.Sleep(1)           ' Wait a sec more
                thread.Join()

                'Update document A/R Invoice dan A/R DP Invoice
                'updateAR(DocEntAR, DocEntARDP)
            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
            End Try
#End Region

        End If

    End Sub

#End Region

#Region "Query To Xlsx"
    Public Sub JsonToExcel(fullPath As String, jsonTemplate As JObject, jsonObj As JObject)
        Dim jsonSheetList As JArray = jsonTemplate.Item("sheet")
        Dim jsonDataSetup As JObject = jsonTemplate.Item("data")
        ExcelPackage.LicenseContext = LicenseContext.NonCommercial
        Try
            Using package = New ExcelPackage(fullPath)
                Dim a As String = ""
                For i As Integer = 0 To jsonSheetList.Count - 1
                    ' SHEET INFORMATION
                    Dim jsonSheetObj As JObject = jsonSheetList.Item(i)
                    Dim sheetName As String = jsonSheetObj.Item("sheet-name")
                    Dim worksheet = package.Workbook.Worksheets.Add(sheetName)

                    ' LABEL LIST
                    Dim jsonLabelList As JArray = jsonSheetObj.Item("label")
                    Dim jsonLabelFooterList As JArray = jsonSheetObj.Item("label-footer")

                    ' DATA LIST
                    Dim jsonDataHeaderList As JArray = jsonSheetObj("data")("header")
                    Dim jsonDataDetailList As JArray = jsonSheetObj("data")("detail")("data")
                    Dim jsonDataFooterList As JArray = jsonSheetObj("data")("footer")

                    ' DATA DETAIL NODE
                    Dim nodeRowDataName As String = jsonSheetObj("data")("detail")("node-data")
                    Dim nodeRowData As String() = nodeRowDataName.Split(".")


                    ' INPUT LABEL HEADER DAN DETAIL
                    For j As Integer = 0 To jsonLabelList.Count - 1
                        Dim labelName As String = jsonLabelList.Item(j).Item("title")
                        Dim cellPos As Integer = jsonLabelList.Item(j).Item("col-start")
                        Dim rowPos As Integer = jsonLabelList.Item(j).Item("row-start")

                        worksheet.Cells(rowPos, cellPos).Value = labelName
                    Next


                    ' INPUT DATA HEADER
                    For k As Integer = 0 To jsonDataHeaderList.Count - 1
                        Dim node As String = jsonDataHeaderList.Item(k).Item("node")
                        Dim nodeList As String() = node.Split(".")
                        Dim nodeIndex As String = If(jsonDataHeaderList.Item(k).Item("data-type") = "row-index", jsonDataHeaderList.Item(k).Item("node-index"), "")

                        Dim cellPos As Integer = jsonDataHeaderList.Item(k).Item("col-start")
                        Dim rowPos As Integer = jsonDataHeaderList.Item(k).Item("row-start")

                        Dim jsonToken As JToken = jsonObj
                        TokenValue(jsonToken, nodeList, "", node, worksheet, cellPos, rowPos, "header", nodeIndex)

                    Next

                    ' INPUT DATA DETAIL
                    For k As Integer = 0 To jsonDataDetailList.Count - 1
                        Dim node As String = jsonDataDetailList.Item(k).Item("node")
                        Dim nodeList As Array = node.Split(".")
                        Dim nodeIndex As String = If(jsonDataDetailList.Item(k).Item("data-type") = "row-index", jsonDataDetailList.Item(k).Item("node-index"), "")

                        Dim cellPos As Integer = jsonDataDetailList.Item(k).Item("col-start")
                        Dim rowPos As Integer = jsonDataDetailList.Item(k).Item("row-start")

                        Dim jsonToken As JToken = jsonObj
                        TokenValue(jsonToken, nodeList, "", nodeRowDataName, worksheet, cellPos, rowPos, "detail", nodeIndex)

                    Next

                    Dim worksheetRow As Integer = worksheet.Dimension.Rows

                    ' INPUT LABEL FOOTER
                    For j As Integer = 0 To jsonLabelFooterList.Count - 1
                        Dim labelName As String = jsonLabelFooterList.Item(j).Item("title")
                        Dim cellPos As Integer = jsonLabelFooterList.Item(j).Item("col-start")
                        Dim rowPos As Integer = jsonLabelFooterList.Item(j).Item("row-start")

                        rowPos += worksheetRow

                        worksheet.Cells(rowPos, cellPos).Value = labelName
                    Next

                    ' INPUT DATA FOOTER
                    For k As Integer = 0 To jsonDataFooterList.Count - 1
                        Dim node As String = jsonDataFooterList.Item(k).Item("node")
                        Dim nodeList As Array = node.Split(".")
                        Dim nodeIndex As String = If(jsonDataFooterList.Item(k).Item("data-type") = "row-index", jsonDataFooterList.Item(k).Item("node-index"), "")

                        Dim cellPos As Integer = jsonDataFooterList.Item(k).Item("col-start")
                        Dim rowPos As Integer = jsonDataFooterList.Item(k).Item("row-start")

                        rowPos += worksheetRow

                        Dim jsonToken As JToken = jsonObj
                        TokenValue(jsonToken, nodeList, "", node, worksheet, cellPos, rowPos, "footer", nodeIndex)

                    Next
                Next
                package.Save()
            End Using
        Catch ex As Exception
            MessageBox.Show(ex.Message)
        End Try

    End Sub

    Public Function TokenValue(
                               ByVal jsonToken As JToken,
                               ByVal nodeName As String(),
                               ByVal nodeParent As String,
                               ByVal nodeDetailInc As String,
                               ByVal worksheet As ExcelWorksheet,
                               ByVal cellPos As Integer,
                               ByVal rowPos As Integer,
                               Optional ByVal secPosition As String = "header",
                               Optional ByVal nodeIndex As String = "",
                               Optional ByVal rowIndex As String = ""
                               )

        Try

            Dim result As JObject = Nothing
            Dim newJsonToken As JToken = jsonToken(nodeName(0))
            Dim newNodeName = nodeName.Skip(1).Take(nodeName.Length - 1).ToArray()
            nodeParent += If(nodeParent = "", "", ".") & nodeName(0)


            If (TypeOf newJsonToken Is JArray) Then
                Dim countObj As Integer = 1

                If (secPosition = "detail") Then
                    countObj = newJsonToken.Count
                End If

                For i As Integer = 0 To countObj - 1
                    If (nodeIndex = nodeParent) Then
                        rowIndex = (i + 1).ToString()
                    End If


                    rowPos = TokenValue(newJsonToken(i), newNodeName, nodeParent, nodeDetailInc, worksheet, cellPos, rowPos, secPosition, nodeIndex, rowIndex)

                    If (nodeParent = nodeDetailInc) Then
                        rowPos += 1
                    End If
                Next
            ElseIf (TypeOf newJsonToken Is JObject) Then
                rowPos = TokenValue(newJsonToken, newNodeName, nodeParent, nodeDetailInc, worksheet, cellPos, rowPos, secPosition, nodeIndex, rowIndex)
            ElseIf (TypeOf newJsonToken Is JValue) Then
                Dim range As String = cellPos & rowPos.ToString()
                Dim value As String = If(nodeIndex = "", newJsonToken.ToString(), rowIndex)

                worksheet.Cells(rowPos, cellPos).Value = value
            End If

        Catch ex As Exception
            MessageBox.Show(ex.Message)
        End Try

        Return rowPos
    End Function

#End Region

    Private Sub AddUDTCortax()

        Utils.CreateUDT(oSBOCompany, "SOL_ADDINFO_REF", "AddInfo Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)
        Utils.CreateUDT(oSBOCompany, "SOL_BRGJASA_REF", "BrgJasa Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)
        Utils.CreateUDT(oSBOCompany, "SOL_COUNTRY_REF", "Country Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)
        Utils.CreateUDT(oSBOCompany, "SOL_FACILITY_REF", "Facility Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)
        Utils.CreateUDT(oSBOCompany, "SOL_TRXCODE_REF", "TRXCODE Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)
        Utils.CreateUDT(oSBOCompany, "SOL_UNIT_REF", "Unit Ref", SAPbobsCOM.BoUTBTableType.bott_NoObject)

    End Sub

    Private Sub AddUDFCortax()

        Utils.CreateUDF(oSBOCompany, "OINV", "SOL_FP_FACILITY", "Cap Fasilitas", SAPbobsCOM.BoFieldTypes.db_Alpha, SAPbobsCOM.BoFldSubTypes.st_None, 10)


        Utils.CreateUDF(oSBOCompany, "@SOL_ADDINFO_REF", "SOL_DESC", "Description", SAPbobsCOM.BoFieldTypes.db_Memo, SAPbobsCOM.BoFldSubTypes.st_None, 8)
        Utils.CreateUDF(oSBOCompany, "@SOL_ADDINFO_REF", "SOL_TRX_CODE", "TrxCode", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_ADDINFO_REF", "SOL_KODE_REF", "Kode Ref", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)

        Utils.CreateUDF(oSBOCompany, "@SOL_BRGJASA_REF", "SOL_KELOMPOK", "Kelompok", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_BRGJASA_REF", "SOL_KODE_BJ", "Kode Barang Jasa", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_BRGJASA_REF", "SOL_DESC", "Description", SAPbobsCOM.BoFieldTypes.db_Memo, SAPbobsCOM.BoFldSubTypes.st_None, 8)
        'Utils.CreateUDF(oSBOCompany, "@SOL_BRGJASA_REF", "SOL_BAHASA", "Bahasa", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "@SOL_COUNTRY_REF", "SOL_DESC", "Description", SAPbobsCOM.BoFieldTypes.db_Memo, SAPbobsCOM.BoFldSubTypes.st_None, 8)
        Utils.CreateUDF(oSBOCompany, "@SOL_COUNTRY_REF", "SOL_SAP_CODE", "Kode SAP", SAPbobsCOM.BoFieldTypes.db_Alpha, 10)
        Utils.CreateUDF(oSBOCompany, "@SOL_COUNTRY_REF", "SOL_SAP_DESC", "Nama SAP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)


        Utils.CreateUDF(oSBOCompany, "@SOL_FACILITY_REF", "SOL_DESC", "Description", SAPbobsCOM.BoFieldTypes.db_Memo, SAPbobsCOM.BoFldSubTypes.st_None, 8)
        Utils.CreateUDF(oSBOCompany, "@SOL_FACILITY_REF", "SOL_TRX_CODE", "Trx Code", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "@SOL_FACILITY_REF", "SOL_KODE_REF", "Kode Ref", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)

        Utils.CreateUDF(oSBOCompany, "@SOL_TRXCODE_REF", "SOL_DESC", "Description", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "@SOL_UNIT_REF", "SOL_CODE_DESC", "Kode Description", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)


        Utils.CreateUDF(oSBOCompany, "OITM", "SOL_KODE_BJ", "Kode Barang Jasa", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "OITM", "SOL_CODE_DESC", "Kode Unit", SAPbobsCOM.BoFieldTypes.db_Alpha, 100)

        Utils.CreateUDF(oSBOCompany, "OITM", "SOL_NAMA_BJ", "Nama Barang Jasa", SAPbobsCOM.BoFieldTypes.db_Memo)
        Utils.CreateUDF(oSBOCompany, "OITM", "SOL_NAMA_DESC", "Nama Unit", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_NO_PASPORT", "No Pasport FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_NO_OTHER", "No Other FP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        'Utils.CreateUDF(oSBOCompany, "OUGP", "SOL_KODE_DJP", "KODE DJP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "OUOM", "SOL_KODE_DJP", "KODE DJP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "OCRY", "SOL_KODE_DJP", "KODE DJP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "OINV", "SOL_KODE_ADDINF", "Kode AddInf", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "OINV", "SOL_KODE_FACILITY_STAMP", "Nama Cap Fasilitas", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "OITM", "SOL_PPNPEMBAGI", "PPN Pembagi", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Percentage)

        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_KODE_BJ_D", "Kode Barang Jasa", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_NAMA_BJ_D", "Nama Barang Jasa", SAPbobsCOM.BoFieldTypes.db_Memo)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_CODE_DESC_D", "Kode Unit", SAPbobsCOM.BoFieldTypes.db_Alpha, 50)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_NAMA_DESC_D", "Nama Unit", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_PPNPEMBAGI", "PPN Pembagi", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Percentage)

        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_UOM_DESC_D", "UOM DJP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_DEF_UOM_D", "UOM Default DJP", SAPbobsCOM.BoFieldTypes.db_Alpha, 200)

        Utils.CreateUDF(oSBOCompany, "RPC1", "SOL_DPP_NILAI_LAIN_D", "DPP Nilai Lain", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)

        Utils.CreateUDF(oSBOCompany, "CRD1", "SOL_EMAIL", "Email FP", SAPbobsCOM.BoFieldTypes.db_Memo, SAPbobsCOM.BoFldSubTypes.st_None, 8)


        Dim ValidValues As New List(Of String()) From {
            New String() {"Yes", "Yes"},
            New String() {"No", "No"}
        }

        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_FLAG_DPP", "Flag Dpp Lain Retur", SAPbobsCOM.BoFieldTypes.db_Alpha, SAPbobsCOM.BoFldSubTypes.st_None, 10, ValidValues, "")
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_DPP_LAIN_RETUR", "Dpp Lain Retur", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)
        Utils.CreateUDF(oSBOCompany, "INV1", "SOL_DPP_LNRT", "PPN Pembagi", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Price)



        'Utils.CreateUDF(oSBOCompany, "OADM", "SOL_XLSX", "USE XLSX", SAPbobsCOM.BoFieldTypes.db_Float, SAPbobsCOM.BoFldSubTypes.st_Percentage)

    End Sub

    Private Sub AddQueryFMSCoretax()
        Dim oUserQuery As SAPbobsCOM.UserQueries
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iCategoryId As Integer = 0

        Try
            Dim qDict As New Dictionary(Of String, String)

            Dim di As New DirectoryInfo(".\Query\HANA\FMS")
            Dim fiArr As FileInfo() = di.GetFiles()
            Dim fi As FileInfo
            For Each fi In fiArr
                Dim fileName As String = fi.FullName
                Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

                Dim objReader As New System.IO.StreamReader(fileName)
                Dim sql As String = objReader.ReadToEnd
                objReader.Close()

                qDict.Add(pName, sql)
                'End If
            Next fi

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("Select COALESCE(""CategoryId"", 0) As ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_BARANG_JASA' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_KODE_BARANG_JASA for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_KODE_BARANG_JASA")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_KODE_BARANG_JASA"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_KODE_UNIT for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_KODE_UNIT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_KODE_UNIT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_BARANG_JASA' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_NAMA_BARANG_JASA for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_NAMA_BARANG_JASA")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_NAMA_BARANG_JASA"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_UNIT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_NAMA_UNIT for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_NAMA_UNIT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_NAMA_UNIT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_KODE_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KODE_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_KODE_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_ADDINF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_KODE_ADDINF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KODE_ADDINF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_KODE_ADDINF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_PPN_STATUS for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORDR_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORDR_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODLN_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODLN_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODLN_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODLN_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


        Catch ex As Exception
            isError = True
            errorMessage = ex.Message
            updateProgress("Error While Creating Query for Formatted Search")
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub AddQueryFMSCoretaxSQL()
        Dim oUserQuery As SAPbobsCOM.UserQueries
        Dim oRec As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iCategoryId As Integer = 0

        Try
            Dim qDict As New Dictionary(Of String, String)

            Dim di As New DirectoryInfo(".\Query\SQL\FMS")
            Dim fiArr As FileInfo() = di.GetFiles()
            Dim fi As FileInfo
            For Each fi In fiArr
                Dim fileName As String = fi.FullName
                Dim pName As String = fi.Name.Substring(0, fi.Name.Length - fi.Extension.Length)

                Dim objReader As New System.IO.StreamReader(fileName)
                Dim sql As String = objReader.ReadToEnd
                objReader.Close()

                qDict.Add(pName, sql)
                'End If
            Next fi

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("Select COALESCE(""CategoryId"", 0) As ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_BARANG_JASA' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_KODE_BARANG_JASA for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_KODE_BARANG_JASA")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_KODE_BARANG_JASA"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_KODE_UNIT for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_KODE_UNIT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_KODE_UNIT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_BARANG_JASA' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_NAMA_BARANG_JASA for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_NAMA_BARANG_JASA")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_NAMA_BARANG_JASA"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_UNIT' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OITM_NAMA_UNIT for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OITM_NAMA_UNIT")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OITM_NAMA_UNIT"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODPI_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODPI_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODPI_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_FACILITY_STAMP' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_KODE_FACILITY_STAMP for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KODE_FACILITY_STAMP")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_KODE_FACILITY_STAMP"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_ADDINF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_KODE_ADDINF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_KODE_ADDINF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_KODE_ADDINF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_PPN_STATUS' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_PPN_STATUS for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_PPN_STATUS")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_PPN_STATUS"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_OINV_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_OINV_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_OINV_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORDR_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORDR_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORDR_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If


            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODLN_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ODLN_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ODLN_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ODLN_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

            '----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")

            If oRec.RecordCount <> 0 Then
                iCategoryId = CType(oRec.Fields.Item("CategoryId").Value, Integer)
            End If

            If iCategoryId > 0 Then
                oRec.DoQuery("SELECT ""QCategory"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_UOM_DEF' AND ""QCategory"" = '" + iCategoryId.ToString + "'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                If bIsContinue Then
                    updateProgress("Creating Query FMS DEFAULT_ORPC_UOM_DEF for Item Master")

                    oUserQuery = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oUserQueries), SAPbobsCOM.UserQueries)
                    oUserQuery.Query = qDict.Item("DEFAULT_ORPC_UOM_DEF")
                    oUserQuery.QueryCategory = iCategoryId
                    oUserQuery.QueryDescription = "DEFAULT_ORPC_UOM_DEF"

                    lRetCode = oUserQuery.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oUserQuery)
                    oUserQuery = Nothing
                    GC.Collect()
                End If
            End If

        Catch ex As Exception
            isError = True
            errorMessage = ex.Message
            updateProgress("Error While Creating Query for Formatted Search")
            updateProgress(ex.Message)
        End Try
    End Sub

    Private Sub AddFMSCoretax()
        Dim oFormattedSearch As SAPbobsCOM.FormattedSearches
        Dim oRec As SAPbobsCOM.Recordset
        Dim oRec1 As SAPbobsCOM.Recordset
        Dim lRetCode As Integer = 0
        Dim lErrCode As Integer = 0
        Dim sErrMsg As String = ""
        Dim bIsContinue As Boolean = True
        Dim iQueryId As Integer
        Dim iCategoryId As Integer

        Try

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_BARANG_JASA' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '150' AND ""ItemID"" = 'U_SOL_KODE_BJ'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "150"
                    oFormattedSearch.ItemID = "U_SOL_KODE_BJ"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    'oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "150"
                        oFormattedSearch.ItemID = "U_SOL_KODE_BJ"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        'oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '150' AND ""ItemID"" = 'U_SOL_CODE_DESC'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "150"
                    oFormattedSearch.ItemID = "U_SOL_CODE_DESC"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    'oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "150"
                        oFormattedSearch.ItemID = "U_SOL_CODE_DESC"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        'oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '13000005' AND ""ItemID"" = 'U_SOL_KODE_DJP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "13000005"
                    oFormattedSearch.ItemID = "U_SOL_KODE_DJP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    'oFormattedSearch.FieldID = "12"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "13000005"
                        oFormattedSearch.ItemID = "U_SOL_KODE_DJP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        'oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        'oFormattedSearch.FieldID = "12"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_BARANG_JASA' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '150' AND ""ItemID"" = 'U_SOL_NAMA_BJ'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "150"
                    oFormattedSearch.ItemID = "U_SOL_NAMA_BJ"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_KODE_BJ"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "150"
                        oFormattedSearch.ItemID = "U_SOL_NAMA_BJ"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_KODE_BJ"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_NAMA_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '150' AND ""ItemID"" = 'U_SOL_NAMA_DESC'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "150"
                    oFormattedSearch.ItemID = "U_SOL_NAMA_DESC"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_CODE_DESC"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "150"
                        oFormattedSearch.ItemID = "U_SOL_NAMA_DESC"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_CODE_DESC"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_FACILITY_STAMP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_FP_FACILITY'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_FP_FACILITY"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO
                    'oFormattedSearch.FieldID = "U_SOL_FP_FACILITY"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_FP_FACILITY"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO
                        'oFormattedSearch.FieldID = "U_SOL_CODE_DESC"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_FACILITY_STAMP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_FP_FACILITY'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_FP_FACILITY"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO
                    'oFormattedSearch.FieldID = "U_SOL_FP_FACILITY"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_FP_FACILITY"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO
                        'oFormattedSearch.FieldID = "U_SOL_CODE_DESC"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_FACILITY_STAMP' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_KODE_FACILITY_STAMP'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_KODE_FACILITY_STAMP"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_FACILITY"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_KODE_FACILITY_STAMP"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_FACILITY"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_KODE_ADDINF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_KODE_ADDINF'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_KODE_ADDINF"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "U_SOL_FP_PPN"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_KODE_ADDINF"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "U_SOL_FP_PPN"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_UOM_DESC_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "133"
                    oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "133"
                        oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORDR_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '139' AND ""ItemID"" = 'U_SOL_UOM_DESC_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "139"
                    oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "139"
                        oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODLN_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '140' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "140"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "140"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '140' AND ""ItemID"" = 'U_SOL_UOM_DESC_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "140"
                    oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "140"
                        oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '60091' AND ""ItemID"" = 'U_SOL_UOM_DESC_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OITM_KODE_UNIT' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_UOM_DESC_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_UOM_DESC_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tNO

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If


            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_OINV_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '133' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "60091"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "60091"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ODPI_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '65300' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "65300"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "65300"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If



            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

            '------------------------------------------------------------------------------------------------------------------'

            oRec1 = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec1.DoQuery("SELECT COALESCE(""CategoryId"", 0) AS ""CategoryId"" FROM OQCN WHERE ""CatName"" = 'E-Faktur'")
            If oRec1.RecordCount <> 0 Then
                iCategoryId = CType(oRec1.Fields.Item("CategoryId").Value, Integer)
            End If

            oRec = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.BoRecordset), SAPbobsCOM.Recordset)
            oRec.DoQuery("SELECT COALESCE(""IntrnalKey"", -1) AS ""QueryId"" FROM OUQR WHERE ""QName"" = 'DEFAULT_ORPC_UOM_DEF' AND ""QCategory"" = '" + CStr(iCategoryId) + "'")

            If oRec.RecordCount <> 0 Then
                iQueryId = CType(oRec.Fields.Item("QueryId").Value, Integer)
            End If

            If iQueryId > 0 Then
                oRec.DoQuery("SELECT ""IndexID"", ""QueryId"" FROM CSHS WHERE ""FormID"" = '181' AND ""ItemID"" = 'U_SOL_DEF_UOM_D'")

                If oRec.RecordCount = 0 Then
                    bIsContinue = True
                Else
                    bIsContinue = False
                End If

                Dim IndexID As String
                IndexID = oRec.Fields.Item("IndexID").Value.ToString.Trim

                System.Runtime.InteropServices.Marshal.ReleaseComObject(oRec)
                oRec = Nothing
                GC.Collect()

                If bIsContinue Then
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    oFormattedSearch.FormID = "181"
                    oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                    oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                    oFormattedSearch.QueryID = iQueryId
                    oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                    oFormattedSearch.FieldID = "1"

                    lRetCode = oFormattedSearch.Add()
                    If lRetCode <> 0 Then
                        oSBOCompany.GetLastError(lErrCode, sErrMsg)
                        Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                    End If
                    System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                    oFormattedSearch = Nothing
                    GC.Collect()
                Else
                    oFormattedSearch = CType(oSBOCompany.GetBusinessObject(SAPbobsCOM.BoObjectTypes.oFormattedSearches), SAPbobsCOM.FormattedSearches)
                    If oFormattedSearch.GetByKey(IndexID) Then
                        oFormattedSearch.FormID = "181"
                        oFormattedSearch.ItemID = "U_SOL_DEF_UOM_D"
                        oFormattedSearch.Action = SAPbobsCOM.BoFormattedSearchActionEnum.bofsaQuery
                        oFormattedSearch.QueryID = iQueryId
                        oFormattedSearch.Refresh = SAPbobsCOM.BoYesNoEnum.tYES
                        oFormattedSearch.FieldID = "1"

                        lRetCode = oFormattedSearch.Update()
                        If lRetCode <> 0 Then
                            oSBOCompany.GetLastError(lErrCode, sErrMsg)
                            Throw New Exception(lErrCode.ToString & " : " & sErrMsg)
                        End If
                        System.Runtime.InteropServices.Marshal.ReleaseComObject(oFormattedSearch)
                        oFormattedSearch = Nothing
                        GC.Collect()
                    End If
                End If
            End If

        Catch ex As Exception
            isError = True
            Throw ex
        End Try
    End Sub

    Private Sub Add_MasterDataCoreTax()
        'Utils.ExecMultiQuery(oSBOCompany, "Mapping_Country", GetStringdotsqlExec("Mapping_Country", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_BRGJASA_REF", GetStringdotsqlExec("SOL_BRGJASA_REF.sql", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_UNIT_REF", GetStringdotsqlExec("SOL_UNIT_REF.sql", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_COUNTRY_REF", GetStringdotsqlExec("SOL_COUNTRY_REF.sql", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_ADDINFO_REF", GetStringdotsqlExec("SOL_ADDINFO_REF.sql", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_FACILITY_REF", GetStringdotsqlExec("SOL_FACILITY_REF.sql", "MasterData", "MasterData"))
        Utils.ExecMultiQuery(oSBOCompany, "SOL_TRXCODE_REF", GetStringdotsqlExec("SOL_TRXCODE_REF.sql", "MasterData", "MasterData"))
    End Sub

    Private Function GetStringdotsqlExec(ByVal textFile As String, ByVal flag As String, ByVal DBType As String) As String

        Dim dir As String = ""
        Dim readText As String = ""
        Try
            dir = System.Reflection.Assembly.GetExecutingAssembly().Location
            dir = My.Computer.FileSystem.GetParentPath(dir) + "\" + textFile
            readText = File.ReadAllText(dir)
        Catch ex As Exception

        End Try
        Try
            dir = System.Reflection.Assembly.GetExecutingAssembly().Location
            dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\MasterData\" + textFile
            readText = File.ReadAllText(dir)
            'If DBType = "HANA" Then
            '    If flag = "FMS" Then
            '        dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\HANA\FMS\" + textFile
            '        readText = File.ReadAllText(dir)
            '    Else
            '        dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\HANA\EXEC\" + textFile
            '        readText = dir
            '    End If
            'Else
            '    If flag = "FMS" Then
            '        dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\SQL\FMS\" + textFile
            '        readText = File.ReadAllText(dir)
            '    Else
            '        dir = My.Computer.FileSystem.GetParentPath(dir) + "\Query\SQL\EXEC\" + textFile
            '        readText = dir
            '    End If
            'End If

        Catch ex As Exception
            Dim a = ex
        End Try

        Return readText

    End Function

    Private Function GetLinkFromPdf(pdfPath As String)
        ' Regular expression to validate URLs
        Dim urlPattern As String = "^(http|https)://[^\s/$.?#].[^\s]*$"

        ' Open the PDF document using PdfiumViewer
        Using pdfDocument = PdfiumViewer.PdfDocument.Load(pdfPath)
            ' Loop through each page
            For pageIndex As Integer = 0 To pdfDocument.PageCount - 1
                ' Render the page as an image
                Using pageImage As Image = pdfDocument.Render(pageIndex, 300, 300, True)
                    ' Decode the QR code from the image
                    Dim barcodeReader As New BarcodeReader()
                    Dim result = barcodeReader.Decode(DirectCast(pageImage, Bitmap))

                    If result IsNot Nothing AndAlso Regex.IsMatch(result.Text, urlPattern, RegexOptions.IgnoreCase) Then
                        Console.WriteLine($"Page {pageIndex + 1}: QR Code URL = {result.Text}")
                    Else
                        Console.WriteLine($"Page {pageIndex + 1}: No valid QR Code URL found.")
                    End If
                End Using
            Next
        End Using
    End Function

    Public Sub MenuEvent_Handler_upload(ByRef pVal As SAPbouiCOM.MenuEvent, ByRef BubbleEvent As Boolean)
        If pVal.BeforeAction = False Then

            Dim oXMLDoc As New XmlDocument
            Dim oFormFKMS As SAPbouiCOM.Form
            Dim MtxDetail As SAPbouiCOM.Matrix
            Dim oRec As SAPbobsCOM.Recordset
            Dim Query As String = ""
            Try
                Dim Found As Boolean = False
                Dim IndexFound As Integer
                Dim FormCount As Integer = oSBOApplication.Forms.Count
                For a As Integer = 0 To FormCount - 1
                    If oSBOApplication.Forms.Item(a).TypeEx = "frmOffFKUp" Then
                        Found = True
                        IndexFound = a
                        Exit For
                    End If
                Next
                If Found = False Then
                    oXMLDoc.Load("uploadpdf.srf")
                    oSBOApplication.LoadBatchActions(oXMLDoc.InnerXml)
                Else
                    oSBOApplication.Forms.Item(IndexFound).Select()
                End If



            Catch ex As Exception
                oSBOApplication.MessageBox(ex.Message)
                Try
                    oFormFKMS.Freeze(False)
                Catch exa As Exception
                End Try
            End Try
        End If
    End Sub


    Public Sub ItemEventHandler_UploadPDF(ByVal FormUID As String, ByRef pVal As SAPbouiCOM.ItemEvent, ByRef BubbleEvent As Boolean)
        If (pVal.ItemUID = "btnFind") Then
            If pVal.EventType = SAPbouiCOM.BoEventTypes.et_ITEM_PRESSED Then
                Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                If (oForm.Items.Item("txtPath").Specific.value = "") Then
                    BrowseFolder()
                    searchPdf(oForm.Items.Item("txtPath").Specific.value)
                End If
            End If
        End If
    End Sub


    Public Sub BrowseFolder()

        Dim thread As Thread = New Thread(Sub()

                                              Dim folderBrowser As New FolderBrowserDialog()

                                              ' Set dialog properties
                                              folderBrowser.Description = "Select a folder"
                                              folderBrowser.ShowNewFolderButton = True

                                              ' Show the dialog and check if the user clicked OK
                                              If folderBrowser.ShowDialog() = DialogResult.OK Then
                                                  ' Get the selected folder path
                                                  Dim selectedFolderPath As String = folderBrowser.SelectedPath

                                                  Dim oForm As SAPbouiCOM.Form = oSBOApplication.Forms.ActiveForm
                                                  oForm.Items.Item("txtPath").Specific.value = selectedFolderPath


                                              End If
                                          End Sub)
        thread.SetApartmentState(ApartmentState.STA)


        Try
            thread.Start()
            While (Not thread.IsAlive) ' Wait for thread to get started
            End While
            Thread.Sleep(1)           ' Wait a sec more
            thread.Join()

        Catch ex As Exception
            oSBOApplication.MessageBox(ex.Message)
        End Try


    End Sub

    Public Sub searchPdf(FolderPathString As String)
        ' Specify the folder path
        Dim folderPath As String = FolderPathString

        ' Check if the folder exists
        If Directory.Exists(folderPath) Then
            ' Get all PDF files in the folder
            Dim pdfFiles As String() = Directory.GetFiles(folderPath, "*.pdf", SearchOption.TopDirectoryOnly)

            ' Display the files
            If pdfFiles.Length > 0 Then
                Console.WriteLine("PDF files in the folder:")
                For Each file As String In pdfFiles
                    GetLinkFromPdf(folderPath + "/" + Path.GetFileName(file))
                    'Console.WriteLine(Path.GetFileName(file)) ' Display file name only
                Next
            End If
        End If
    End Sub
End Class
